"use strict";
/*
 * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.Control = void 0;
const ArrayUtils_1 = require("../utils/ArrayUtils");
/**
 * Abstract base class for Controls.
 */
class Control {
    constructor(id) {
        this.id = id;
    }
    /**
     * Determines if the value is ready for use by other parts of the skill.
     *
     * @param input - Input object.
     * @returns `true` if the Control or one of its children can take the initiative, false otherwise.
     */
    async isReady(input) {
        return !(await this.canTakeInitiative(input));
    }
    /**
     * Gets the Control's state as an object that is serializable.
     *
     * Only durable state should be included and the object should be serializable with a
     * straightforward application of `JSON.stringify(object)`.
     *
     * Default:
     *  `{return this.state;}`
     *
     * Usage:
     *  * The default is sufficient for Controls that use the `.state` variable and only store simple data.
     *    * Non-simple data includes functions, and objects with functions, as these will not survive the round trip.
     *    * Other non-simple data include types with non-enumerable properties.
     *  * It is safe to pass the actual state object as the framework guarantees to not mutate it.
     *  * Functions that operate on the Control's state should be defined as members of the Control
     *
     * Framework behavior:
     *  * The framework serializes the data use a simple application of `JSON.stringify`.
     *  * On the subsequent turn the control tree is re-established and the state objects
     *    are re-attached to each Control via `control.setSerializableState(serializedState)`.
     *
     * @returns Serializable object defining the state of the Control
     */
    getSerializableState() {
        return this.state;
    }
    /**
     * Sets the state from a serialized state object.
     *
     * Default:
     * `{this.state = serializedState;}`
     *
     * Usage:
     *  * It is safe to use serializedState without copying as the framework guarantees to not mutate it.
     *
     * Framework behavior:
     *  * After the control tree is re-established, the state objects
     *    are re-attached to each Control via `control.setSerializableState(serializedState)`.
     *
     * @param serializedState - Serializable object defining the state of the Control
     */
    setSerializableState(serializedState) {
        this.state = serializedState;
    }
    /**
     * Add response content for a system act produced by this control.
     *
     * This is intended to be used with the default ControlManager.render() which implements a
     * simple concatenation strategy to form a complete response from multiple result items.
     *
     * @param act - System act
     * @param input - Input
     * @param responseBuilder - Response builder
     */
    renderAct(act, input, responseBuilder) {
        // The default is to let the act render itself
        return act.render(input, responseBuilder);
    }
    // TODO: remove and/or create a new class... class UnhandledActError extends Error.
    throwUnhandledActError(act) {
        throw new Error(`No NLG for ${act}`);
    }
    /**
     * Evaluate a prompt prop.
     *
     * @param act - act
     * @param propValue - Constant or function producing String or List-of-Strings
     * @param input - Input object
     */
    evaluatePromptProp(act, propValue, input) {
        const stringOrList = (typeof propValue === 'function') ? propValue.call(this, act, input) : propValue;
        if (typeof stringOrList === 'string') {
            return stringOrList;
        }
        return ArrayUtils_1.randomlyPick(stringOrList);
    }
    /**
     * Evaluate a boolean prop.
     *
     * @param propValue - Constant or function producing boolean
     * @param input - The input object
     */
    evaluateBooleanProp(propValue, input) {
        return (typeof propValue === 'function') ? propValue.call(this, input) : propValue;
    }
}
exports.Control = Control;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29udHJvbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cm9scy9Db250cm9sLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7R0FXRzs7O0FBS0gsb0RBQW1EO0FBZ0NuRDs7R0FFRztBQUNILE1BQXNCLE9BQU87SUFJekIsWUFBWSxFQUFVO1FBQ2xCLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDO0lBQ2pCLENBQUM7SUFnRkQ7Ozs7O09BS0c7SUFDSCxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQW1CO1FBQzdCLE9BQU8sQ0FBQyxDQUFDLE1BQU0sSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDbEQsQ0FBQztJQUVEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O09Bc0JHO0lBQ0ksb0JBQW9CO1FBQ3ZCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztJQUN0QixDQUFDO0lBRUQ7Ozs7Ozs7Ozs7Ozs7O09BY0c7SUFDSSxvQkFBb0IsQ0FBQyxlQUFvQjtRQUM1QyxJQUFJLENBQUMsS0FBSyxHQUFHLGVBQWUsQ0FBQztJQUNqQyxDQUFDO0lBRUQ7Ozs7Ozs7OztPQVNHO0lBQ0gsU0FBUyxDQUFDLEdBQWMsRUFBRSxLQUFtQixFQUFFLGVBQXVDO1FBQ2xGLDhDQUE4QztRQUM5QyxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLGVBQWUsQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFFRCxtRkFBbUY7SUFDbkYsc0JBQXNCLENBQUMsR0FBYztRQUNqQyxNQUFNLElBQUksS0FBSyxDQUFDLGNBQWMsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBR0Q7Ozs7OztPQU1HO0lBQ0gsa0JBQWtCLENBQUMsR0FBYyxFQUFFLFNBQWdGLEVBQUUsS0FBbUI7UUFDcEksTUFBTSxZQUFZLEdBQUcsQ0FBQyxPQUFPLFNBQVMsS0FBSyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7UUFDdEcsSUFBSSxPQUFPLFlBQVksS0FBSyxRQUFRLEVBQUU7WUFDbEMsT0FBTyxZQUFZLENBQUM7U0FDdkI7UUFDRCxPQUFPLHlCQUFZLENBQVMsWUFBWSxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsbUJBQW1CLENBQUMsU0FBdUQsRUFBRSxLQUFtQjtRQUM1RixPQUFPLENBQUMsT0FBTyxTQUFTLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7SUFDdkYsQ0FBQztDQUNKO0FBM0xELDBCQTJMQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgMjAyMCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS5cbiAqIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIG9yIGluIHRoZSBcImxpY2Vuc2VcIiBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZFxuICogb24gYW4gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyXG4gKiBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZ1xuICogcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cblxuaW1wb3J0IHsgQ29udHJvbFJlc3BvbnNlQnVpbGRlciB9IGZyb20gJy4uL3Jlc3BvbnNlR2VuZXJhdGlvbi9Db250cm9sUmVzcG9uc2VCdWlsZGVyJztcbmltcG9ydCB7IFN5c3RlbUFjdCB9IGZyb20gJy4uL3N5c3RlbUFjdHMvU3lzdGVtQWN0JztcbmltcG9ydCB7IHJhbmRvbWx5UGljayB9IGZyb20gJy4uL3V0aWxzL0FycmF5VXRpbHMnO1xuaW1wb3J0IHsgU3RyaW5nT3JMaXN0IH0gZnJvbSAnLi4vdXRpbHMvQmFzaWNUeXBlcyc7XG5pbXBvcnQgeyBDb250cm9sSW5wdXQgfSBmcm9tICcuL0NvbnRyb2xJbnB1dCc7XG5pbXBvcnQgeyBDb250cm9sUmVzdWx0QnVpbGRlciB9IGZyb20gJy4vQ29udHJvbFJlc3VsdCc7XG5pbXBvcnQgeyBJQ29udHJvbCB9IGZyb20gJy4vaW50ZXJmYWNlcy9JQ29udHJvbCc7XG5cbi8qKlxuICogQmFzZSB0eXBlIGZvciB0aGUgcHJvcHMgb2YgYSBDb250cm9sLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIENvbnRyb2xQcm9wcyB7XG4gICAgaWQ6IHN0cmluZztcblxuICAgIC8qIFRPRE86IHJlZmFjdG9yLiBob2lzdCB1cCBtb3JlIGNvbW1vbiBwcm9wIHNoYXBlcy4gZS5nXG4gICAgICogSW50ZXJhY3Rpb25Nb2RlbFByb3BzLCBQcm9tcHRQcm9wcy4gaWYgb25seSB0byBjZW50cmFsaXplIHRoZSB0c0RvY3MuXG4gICAgICovXG59XG5cbi8qKlxuICogQmFzZSB0eXBlIGZvciB0aGUgc3RhdGUgb2YgYSBDb250cm9sLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIENvbnRyb2xTdGF0ZSB7XG4gICAgLyoqXG4gICAgICogVGhlIHZhbHVlIG1hbmFnZWQgYnkgYSBjb250cm9sLlxuICAgICAqXG4gICAgICogVXNhZ2U6XG4gICAgICogLSBUaGUgdmFsdWUgaXMgbm90IG5lY2Vzc2FyaWx5IHZhbGlkLCBjb25maXJtZWQgb3Igb3RoZXJ3aXNlIHJlYWR5IGZvclxuICAgICAqICAgdXNlLiBDb25zdW1lcnMgY2FuIGNhbGwgYGNvbnRyb2wuaXNSZWFkeSgpYCB0byBkZXRlcm1pbmUgaWYgdGhlIHZhbHVlXG4gICAgICogICBpcyByZWFkeSBmb3IgdXNlLlxuICAgICAqL1xuICAgIHZhbHVlPzogYW55O1xufVxuXG4vKipcbiAqIEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIENvbnRyb2xzLlxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQ29udHJvbCBpbXBsZW1lbnRzIElDb250cm9sIHtcbiAgICByZWFkb25seSBpZDogc3RyaW5nO1xuICAgIHN0YXRlOiBDb250cm9sU3RhdGU7XG5cbiAgICBjb25zdHJ1Y3RvcihpZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIGlmIHRoZSBDb250cm9sIG9yIG9uZSBvZiBpdHMgY2hpbGRyZW4gY2FuIGNvbnN1bWUgYSByZXF1ZXN0LlxuICAgICAqXG4gICAgICogUmV0dXJuaW5nIGB0cnVlYCBkb2VzIG5vdCBndWFyYW50ZWUgdGhhdCB0aGUgQ29udHJvbCB3aWxsIGJlIHNlbGVjdGVkLlxuICAgICAqXG4gICAgICogVXNhZ2U6XG4gICAgICogKiBUaGUgaGFuZGxpbmcgb2YgYSByZXF1ZXN0IGNhbiBhbmQgc2hvdWxkIGJlIGNvbnRleHR1YWwuIFRoYXQgaXMsIGFcbiAgICAgKiAgIGNvbnRyb2wgc2hvdWxkIG9ubHkgcmV0dXJuIGBjYW5IYW5kbGUgPSB0cnVlYCBpZiB0aGUgcmVxdWVzdCBtYWtlc1xuICAgICAqICAgc2Vuc2UgZm9yIHRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZSBjb250cm9sLlxuICAgICAqXG4gICAgICogKiBBIEBzZWUgQ29udGFpbmVyQ29udHJvbCBzaG91bGQgcmV0dXJuIHRydWUgaWYgb25lIG9yIG1vcmUgb2YgaXRzXG4gICAgICogICBjaGlsZHJlbiByZXR1cm5zIGBjYW5IYW5kbGUgPSB0cnVlYC4gVGh1cyB0aGUgcm9vdCBvZiBhIENvbnRyb2wgdHJlZVxuICAgICAqICAgc2hvdWxkIHJldHVybiBgY2FuSGFuZGxlID0gdHJ1ZWAgdW5sZXNzIHRoZSByZXF1ZXN0IGNhbm5vdCBiZVxuICAgICAqICAgbWVhbmluZ2Z1bGx5IGNvbnN1bWVkIGJ5IGFueSBDb250cm9sIGluIHRoZSB0cmVlLlxuICAgICAqXG4gICAgICogKiBUaGUgaW1wbGVtZW50YXRpb24gc2hvdWxkIGJlIGRldGVybWluaXN0aWMgYW5kIGVmZmVjdGl2ZWx5IG1lbW9yeWxlc3MuXG4gICAgICogICBpLmUuIG5vIHN0YXRlIGNoYW5nZXMgc2hvdWxkIGJlIG1hZGUgdGhhdCB3b3VsZCBiZSBleHBvc2VkIGJ5XG4gICAgICogICBgZ2V0U2VyaWFsaXphYmxlU3RhdGUoKWAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBJbnB1dCBvYmplY3QuIGBpbnB1dC5yZXF1ZXN0YCBjb250YWlucyB0aGUgcmVxdWVzdCB0byBiZVxuICAgICAqIGhhbmRsZWQuXG4gICAgICogQHJldHVybnMgYHRydWVgIGlmIHRoZSBDb250cm9sIG9yIG9uZSBvZiBpdHMgY2hpbGRyZW4gY2FuIGNvbnN1bWUgdGhlXG4gICAgICogZW50aXJlIHJlcXVlc3QsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuICAgICAqL1xuICAgIGFic3RyYWN0IGNhbkhhbmRsZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB8IFByb21pc2U8Ym9vbGVhbj47XG5cblxuICAgIC8qKlxuICAgICAqIEhhbmRsZXMgdGhlIHJlcXVlc3QuXG4gICAgICpcbiAgICAgKiBIYW5kbGluZyBhIHJlcXVlc3QgaW52b2x2ZXMgb3JjaGVzdHJhdGluZyBzdGF0ZSBjaGFuZ2VzIHRvIHRoZSBDb250cm9sXG4gICAgICogKGFuZCBpdHMgY2hpbGRyZW4pIGFuZCBhZGRpbmcgcmVzcG9uc2UgaXRlbXMgdG8gdGhlXG4gICAgICogYENvbnRyb2xSZXN1bHRCdWlsZGVyYC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbnB1dCAtIGBpbnB1dC5yZXF1ZXN0YCBjb250YWlucyB0aGUgcmVxdWVzdCB0byBiZSBoYW5kbGVkLlxuICAgICAqIEBwYXJhbSByZXN1bHRCdWlsZGVyIC0gQ29sbGVjdCBgU3lzdGVtQWN0c2AgdGhhdCByZXByZXNlbnQgdGhlIHN5c3RlbVxuICAgICAqIG91dHB1dC5cbiAgICAgKi9cbiAgICBhYnN0cmFjdCBoYW5kbGUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHwgUHJvbWlzZTx2b2lkPjtcblxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgaWYgdGhlIENvbnRyb2wgY2FuIHRha2UgdGhlIGluaXRpYXRpdmUuXG4gICAgICpcbiAgICAgKiBVc2FnZTpcbiAgICAgKiAtIFRha2luZyBpbml0aWF0aXZlIGNhbiBhbmQgc2hvdWxkIGJlIGNvbnRleHR1YWwsIGkuZS4gQSBjb250cm9sIHNob3VsZFxuICAgICAqICAgb25seSByZXR1cm4gYGNhblRha2VJbml0aWF0aXZlID0gdHJ1ZWAgaWYgdGhlIGNvbnRyb2wsIGluIGl0cyBjdXJyZW50XG4gICAgICogICBzdGF0ZSwgaGFzIHNvbWV0aGluZyBpbXBvcnRhbnQgdG8gYXNrIG9mIHRoZSB1c2VyLlxuICAgICAqXG4gICAgICogLSBBIEBzZWUgQ29udGFpbmVyQ29udHJvbCBzaG91bGQgcmV0dXJuIHRydWUgaWYgb25lIG9yIG1vcmUgb2YgaXRzXG4gICAgICogICBjaGlsZHJlbiByZXR1cm5zIGBjYW5UYWtlSW5pdGlhdGl2ZSA9IHRydWVgLiBUaHVzIHRoZSByb290IG9mIGEgQ29udHJvbFxuICAgICAqICAgdHJlZSBzaG91bGQgcmV0dXJuIGBjYW5UYWtlSW5pdGlhdGl2ZSA9IHRydWVgIHVubGVzcyB0aGVyZSBpcyBub1xuICAgICAqICAgY29udHJvbCBpbiB0aGUgZW50aXJlIHRyZWUgdGhhdCBjYW4gdGFrZSB0aGUgaW5pdGlhdGl2ZS5cbiAgICAgKlxuICAgICAqIC0gVGhlIGltcGxlbWVudGF0aW9uIHNob3VsZCBiZSBkZXRlcm1pbmlzdGljIGFuZCBlZmZlY3RpdmVseSBtZW1vcnlsZXNzLlxuICAgICAqICAgaS5lLiBubyBzdGF0ZSBjaGFuZ2VzIHNob3VsZCBiZSBtYWRlIHRoYXQgd291bGQgYmUgZXhwb3NlZCBieVxuICAgICAqICAgYGdldFNlcmlhbGl6YWJsZVN0YXRlKClgLlxuICAgICAqXG4gICAgICogRnJhbWV3b3JrIGJlaGF2aW9yOlxuICAgICAqIC0gVGhlIGluaXRpYXRpdmUgcGhhc2UgcnVucyBpZiB0aGUgaGFuZGxpbmcgcGhhc2UgZGlkIG5vdCBwcm9kdWNlIGFcbiAgICAgKiAgIHJlc3BvbnNlSXRlbSB0aGF0IGhhcyBgLnRha2VzSW5pdGlhdGl2ZSA9IHRydWVgLlxuICAgICAqXG4gICAgICogQHBhcmFtIGlucHV0IC0gSW5wdXQgb2JqZWN0LlxuICAgICAqIEByZXR1cm5zIGB0cnVlYCBpZiB0aGUgQ29udHJvbCBvciBvbmUgb2YgaXRzIGNoaWxkcmVuIGNhbiB0YWtlIHRoZVxuICAgICAqIGluaXRpYXRpdmUsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuICAgICAqL1xuICAgIGFic3RyYWN0IGNhblRha2VJbml0aWF0aXZlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHwgUHJvbWlzZTxib29sZWFuPjtcblxuICAgIC8qKlxuICAgICAqIFRha2VzIGluaXRpYXRpdmUgYnkgYWRkaW5nIGFuIEluaXRpYXRpdmVBY3QgdG8gdGhlIHJlc3VsdC5cbiAgICAgKlxuICAgICAqIEZyYW1ld29yayBiZWhhdmlvcjpcbiAgICAgKiAqIFRoZSBpbml0aWF0aXZlIHBoYXNlIHJ1bnMgaWYgdGhlIGhhbmRsaW5nIHBoYXNlIGRpZCBub3QgcHJvZHVjZSBhIHJlc3BvbnNlSXRlbSB0aGF0IGhhcyBgLnRha2VzSW5pdGlhdGl2ZSA9IHRydWVgLlxuICAgICAqXG4gICAgICogQHBhcmFtIGlucHV0IC0gSW5wdXQgb2JqZWN0LlxuICAgICAqIEBwYXJhbSByZXN1bHRCdWlsZGVyIC0gUmVzdWx0QnVpbGRlci4gQ29sbGVjdCBgU3lzdGVtQWN0c2AgdGhhdCByZXByZXNlbnQgdGhlIHN5c3RlbSBvdXRwdXQuXG4gICAgICovXG4gICAgYWJzdHJhY3QgdGFrZUluaXRpYXRpdmUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHwgUHJvbWlzZTx2b2lkPjtcblxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgaWYgdGhlIHZhbHVlIGlzIHJlYWR5IGZvciB1c2UgYnkgb3RoZXIgcGFydHMgb2YgdGhlIHNraWxsLlxuICAgICAqXG4gICAgICogQHBhcmFtIGlucHV0IC0gSW5wdXQgb2JqZWN0LlxuICAgICAqIEByZXR1cm5zIGB0cnVlYCBpZiB0aGUgQ29udHJvbCBvciBvbmUgb2YgaXRzIGNoaWxkcmVuIGNhbiB0YWtlIHRoZSBpbml0aWF0aXZlLCBmYWxzZSBvdGhlcndpc2UuXG4gICAgICovXG4gICAgYXN5bmMgaXNSZWFkeShpbnB1dDogQ29udHJvbElucHV0KTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIHJldHVybiAhKGF3YWl0IHRoaXMuY2FuVGFrZUluaXRpYXRpdmUoaW5wdXQpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBDb250cm9sJ3Mgc3RhdGUgYXMgYW4gb2JqZWN0IHRoYXQgaXMgc2VyaWFsaXphYmxlLlxuICAgICAqXG4gICAgICogT25seSBkdXJhYmxlIHN0YXRlIHNob3VsZCBiZSBpbmNsdWRlZCBhbmQgdGhlIG9iamVjdCBzaG91bGQgYmUgc2VyaWFsaXphYmxlIHdpdGggYVxuICAgICAqIHN0cmFpZ2h0Zm9yd2FyZCBhcHBsaWNhdGlvbiBvZiBgSlNPTi5zdHJpbmdpZnkob2JqZWN0KWAuXG4gICAgICpcbiAgICAgKiBEZWZhdWx0OlxuICAgICAqICBge3JldHVybiB0aGlzLnN0YXRlO31gXG4gICAgICpcbiAgICAgKiBVc2FnZTpcbiAgICAgKiAgKiBUaGUgZGVmYXVsdCBpcyBzdWZmaWNpZW50IGZvciBDb250cm9scyB0aGF0IHVzZSB0aGUgYC5zdGF0ZWAgdmFyaWFibGUgYW5kIG9ubHkgc3RvcmUgc2ltcGxlIGRhdGEuXG4gICAgICogICAgKiBOb24tc2ltcGxlIGRhdGEgaW5jbHVkZXMgZnVuY3Rpb25zLCBhbmQgb2JqZWN0cyB3aXRoIGZ1bmN0aW9ucywgYXMgdGhlc2Ugd2lsbCBub3Qgc3Vydml2ZSB0aGUgcm91bmQgdHJpcC5cbiAgICAgKiAgICAqIE90aGVyIG5vbi1zaW1wbGUgZGF0YSBpbmNsdWRlIHR5cGVzIHdpdGggbm9uLWVudW1lcmFibGUgcHJvcGVydGllcy5cbiAgICAgKiAgKiBJdCBpcyBzYWZlIHRvIHBhc3MgdGhlIGFjdHVhbCBzdGF0ZSBvYmplY3QgYXMgdGhlIGZyYW1ld29yayBndWFyYW50ZWVzIHRvIG5vdCBtdXRhdGUgaXQuXG4gICAgICogICogRnVuY3Rpb25zIHRoYXQgb3BlcmF0ZSBvbiB0aGUgQ29udHJvbCdzIHN0YXRlIHNob3VsZCBiZSBkZWZpbmVkIGFzIG1lbWJlcnMgb2YgdGhlIENvbnRyb2xcbiAgICAgKlxuICAgICAqIEZyYW1ld29yayBiZWhhdmlvcjpcbiAgICAgKiAgKiBUaGUgZnJhbWV3b3JrIHNlcmlhbGl6ZXMgdGhlIGRhdGEgdXNlIGEgc2ltcGxlIGFwcGxpY2F0aW9uIG9mIGBKU09OLnN0cmluZ2lmeWAuXG4gICAgICogICogT24gdGhlIHN1YnNlcXVlbnQgdHVybiB0aGUgY29udHJvbCB0cmVlIGlzIHJlLWVzdGFibGlzaGVkIGFuZCB0aGUgc3RhdGUgb2JqZWN0c1xuICAgICAqICAgIGFyZSByZS1hdHRhY2hlZCB0byBlYWNoIENvbnRyb2wgdmlhIGBjb250cm9sLnNldFNlcmlhbGl6YWJsZVN0YXRlKHNlcmlhbGl6ZWRTdGF0ZSlgLlxuICAgICAqXG4gICAgICogQHJldHVybnMgU2VyaWFsaXphYmxlIG9iamVjdCBkZWZpbmluZyB0aGUgc3RhdGUgb2YgdGhlIENvbnRyb2xcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0U2VyaWFsaXphYmxlU3RhdGUoKTogYW55IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgc3RhdGUgZnJvbSBhIHNlcmlhbGl6ZWQgc3RhdGUgb2JqZWN0LlxuICAgICAqXG4gICAgICogRGVmYXVsdDpcbiAgICAgKiBge3RoaXMuc3RhdGUgPSBzZXJpYWxpemVkU3RhdGU7fWBcbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqICAqIEl0IGlzIHNhZmUgdG8gdXNlIHNlcmlhbGl6ZWRTdGF0ZSB3aXRob3V0IGNvcHlpbmcgYXMgdGhlIGZyYW1ld29yayBndWFyYW50ZWVzIHRvIG5vdCBtdXRhdGUgaXQuXG4gICAgICpcbiAgICAgKiBGcmFtZXdvcmsgYmVoYXZpb3I6XG4gICAgICogICogQWZ0ZXIgdGhlIGNvbnRyb2wgdHJlZSBpcyByZS1lc3RhYmxpc2hlZCwgdGhlIHN0YXRlIG9iamVjdHNcbiAgICAgKiAgICBhcmUgcmUtYXR0YWNoZWQgdG8gZWFjaCBDb250cm9sIHZpYSBgY29udHJvbC5zZXRTZXJpYWxpemFibGVTdGF0ZShzZXJpYWxpemVkU3RhdGUpYC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBzZXJpYWxpemVkU3RhdGUgLSBTZXJpYWxpemFibGUgb2JqZWN0IGRlZmluaW5nIHRoZSBzdGF0ZSBvZiB0aGUgQ29udHJvbFxuICAgICAqL1xuICAgIHB1YmxpYyBzZXRTZXJpYWxpemFibGVTdGF0ZShzZXJpYWxpemVkU3RhdGU6IGFueSk6IHZvaWQge1xuICAgICAgICB0aGlzLnN0YXRlID0gc2VyaWFsaXplZFN0YXRlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkZCByZXNwb25zZSBjb250ZW50IGZvciBhIHN5c3RlbSBhY3QgcHJvZHVjZWQgYnkgdGhpcyBjb250cm9sLlxuICAgICAqXG4gICAgICogVGhpcyBpcyBpbnRlbmRlZCB0byBiZSB1c2VkIHdpdGggdGhlIGRlZmF1bHQgQ29udHJvbE1hbmFnZXIucmVuZGVyKCkgd2hpY2ggaW1wbGVtZW50cyBhXG4gICAgICogc2ltcGxlIGNvbmNhdGVuYXRpb24gc3RyYXRlZ3kgdG8gZm9ybSBhIGNvbXBsZXRlIHJlc3BvbnNlIGZyb20gbXVsdGlwbGUgcmVzdWx0IGl0ZW1zLlxuICAgICAqXG4gICAgICogQHBhcmFtIGFjdCAtIFN5c3RlbSBhY3RcbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBJbnB1dFxuICAgICAqIEBwYXJhbSByZXNwb25zZUJ1aWxkZXIgLSBSZXNwb25zZSBidWlsZGVyXG4gICAgICovXG4gICAgcmVuZGVyQWN0KGFjdDogU3lzdGVtQWN0LCBpbnB1dDogQ29udHJvbElucHV0LCByZXNwb25zZUJ1aWxkZXI6IENvbnRyb2xSZXNwb25zZUJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgLy8gVGhlIGRlZmF1bHQgaXMgdG8gbGV0IHRoZSBhY3QgcmVuZGVyIGl0c2VsZlxuICAgICAgICByZXR1cm4gYWN0LnJlbmRlcihpbnB1dCwgcmVzcG9uc2VCdWlsZGVyKTtcbiAgICB9XG5cbiAgICAvLyBUT0RPOiByZW1vdmUgYW5kL29yIGNyZWF0ZSBhIG5ldyBjbGFzcy4uLiBjbGFzcyBVbmhhbmRsZWRBY3RFcnJvciBleHRlbmRzIEVycm9yLlxuICAgIHRocm93VW5oYW5kbGVkQWN0RXJyb3IoYWN0OiBTeXN0ZW1BY3QpOiBuZXZlciB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gTkxHIGZvciAke2FjdH1gKTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIEV2YWx1YXRlIGEgcHJvbXB0IHByb3AuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYWN0IC0gYWN0XG4gICAgICogQHBhcmFtIHByb3BWYWx1ZSAtIENvbnN0YW50IG9yIGZ1bmN0aW9uIHByb2R1Y2luZyBTdHJpbmcgb3IgTGlzdC1vZi1TdHJpbmdzXG4gICAgICogQHBhcmFtIGlucHV0IC0gSW5wdXQgb2JqZWN0XG4gICAgICovXG4gICAgZXZhbHVhdGVQcm9tcHRQcm9wKGFjdDogU3lzdGVtQWN0LCBwcm9wVmFsdWU6IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBhbnksIGlucHV0OiBDb250cm9sSW5wdXQpID0+IHN0cmluZyB8IHN0cmluZ1tdKSwgaW5wdXQ6IENvbnRyb2xJbnB1dCk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IHN0cmluZ09yTGlzdCA9ICh0eXBlb2YgcHJvcFZhbHVlID09PSAnZnVuY3Rpb24nKSA/IHByb3BWYWx1ZS5jYWxsKHRoaXMsIGFjdCwgaW5wdXQpIDogcHJvcFZhbHVlO1xuICAgICAgICBpZiAodHlwZW9mIHN0cmluZ09yTGlzdCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiBzdHJpbmdPckxpc3Q7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJhbmRvbWx5UGljazxzdHJpbmc+KHN0cmluZ09yTGlzdCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXZhbHVhdGUgYSBib29sZWFuIHByb3AuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcHJvcFZhbHVlIC0gQ29uc3RhbnQgb3IgZnVuY3Rpb24gcHJvZHVjaW5nIGJvb2xlYW5cbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBUaGUgaW5wdXQgb2JqZWN0XG4gICAgICovXG4gICAgZXZhbHVhdGVCb29sZWFuUHJvcChwcm9wVmFsdWU6IGJvb2xlYW4gfCAoKGlucHV0OiBDb250cm9sSW5wdXQpID0+IGJvb2xlYW4pLCBpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAodHlwZW9mIHByb3BWYWx1ZSA9PT0gJ2Z1bmN0aW9uJykgPyBwcm9wVmFsdWUuY2FsbCh0aGlzLCBpbnB1dCkgOiBwcm9wVmFsdWU7XG4gICAgfVxufVxuIl19