"use strict";
/*
 * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.ControlResultBuilder = exports.ControlResult = void 0;
const SessionBehavior_1 = require("../runtime/SessionBehavior");
/**
 * Represents "what" the system should communicate to the user.
 *
 * This is the output object from the handle and initiative phases and is the
 * intermediate representation passed to the render phase.
 *
 * If the session is not being closed, the ControlResult must contain exactly
 * one `InitiativeAct`.
 */
class ControlResult {
    // jsDoc - see class jsDoc.
    constructor(acts, sessionBehavior) {
        this.acts = acts;
        this.sessionBehavior = sessionBehavior;
    }
    // jsDoc - see Object.
    toString() {
        return stringifyItems(this.acts);
    }
    /**
     * Determines if the result has an initiative act.
     */
    hasInitiativeAct() {
        return controlResultHasInitiativeAct(this);
    }
}
exports.ControlResult = ControlResult;
/**
 * Builder that creates a ControlResult.
 */
class ControlResultBuilder {
    constructor(acts) {
        this.acts = acts !== null && acts !== void 0 ? acts : [];
        this.sessionBehavior = SessionBehavior_1.SessionBehavior.OPEN;
    }
    build() {
        return new ControlResult(this.acts, this.sessionBehavior);
    }
    /**
     * Add a system act.
     *
     * Usage:
     *  * If the session needs to be ended, also call `resultBuilder.endSession()`.
     *
     * @param act - System act.
     */
    addAct(act) {
        if (this.hasInitiativeAct() && act.takesInitiative) {
            throw new Error(`Result already contains an initiative item. (If handle() produced an initiative item and takeInitiative also ran, a common issue is missing 'await').`
                + `Trying to add ${act.toString()}. Existing items: ${stringifyItems(this.acts)}`);
        }
        this.acts.push(act);
        return this;
    }
    /**
     * Force the user session to end.
     *
     * See
     * https://developer.amazon.com/en-US/docs/alexa/echo-button-skills/keep-session-open.html
     *
     * Framework behavior:
     *  * this causes the framework to call
     *    `ask-core.ResponseBuilder.withShouldEndSession(true)`.
     *
     * Skill/device behavior:
     *  * Subsequent utterances will not be routed to the skill.
     *  * A new launch command will start a fresh session.
     *
     */
    endSession() {
        this.sessionBehavior = SessionBehavior_1.SessionBehavior.END;
    }
    /**
     * Force the user session to immediately enter the idle state.
     *
     * * Framework behavior:
     *  * this causes the framework to call
     *    `ask-core.ResponseBuilder.withShouldEndSession(undefined)`.
     *
     *
     * Skill/device behavior:
     *  * The session remains alive but the microphone is closed.
     *  * The user can interact with the skill but must use the wake-word.
     */
    enterIdleState() {
        this.sessionBehavior = SessionBehavior_1.SessionBehavior.IDLE;
    }
    // jsDoc - see Object
    toString() {
        return stringifyItems(this.acts);
    }
    /**
     * Determines if the result has an initiative act.
     */
    hasInitiativeAct() {
        return controlResultHasInitiativeAct(this);
    }
}
exports.ControlResultBuilder = ControlResultBuilder;
function controlResultHasInitiativeAct(result) {
    return result.acts.find((item) => item.takesInitiative) !== undefined;
}
function stringifyItems(items) {
    const itemStrs = [];
    for (const item of items) {
        itemStrs.push(item.toString());
    }
    return `[${itemStrs.join(', ')}]`;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29udHJvbFJlc3VsdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cm9scy9Db250cm9sUmVzdWx0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7R0FXRzs7O0FBRUgsZ0VBQTZEO0FBSTdEOzs7Ozs7OztHQVFHO0FBQ0gsTUFBYSxhQUFhO0lBSXRCLDJCQUEyQjtJQUMzQixZQUFZLElBQWlCLEVBQUUsZUFBZ0M7UUFDM0QsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLGVBQWUsR0FBRyxlQUFlLENBQUM7SUFDM0MsQ0FBQztJQUVELHNCQUFzQjtJQUN0QixRQUFRO1FBQ0osT0FBTyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFRDs7T0FFRztJQUNILGdCQUFnQjtRQUNaLE9BQU8sNkJBQTZCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDL0MsQ0FBQztDQUVKO0FBdEJELHNDQXNCQztBQUVEOztHQUVHO0FBQ0gsTUFBYSxvQkFBb0I7SUFJN0IsWUFBWSxJQUFrQjtRQUMxQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksYUFBSixJQUFJLGNBQUosSUFBSSxHQUFJLEVBQUUsQ0FBQztRQUN2QixJQUFJLENBQUMsZUFBZSxHQUFHLGlDQUFlLENBQUMsSUFBSSxDQUFDO0lBQ2hELENBQUM7SUFFRCxLQUFLO1FBQ0QsT0FBTyxJQUFJLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBR0Q7Ozs7Ozs7T0FPRztJQUNILE1BQU0sQ0FBQyxHQUFjO1FBQ2pCLElBQUksSUFBSSxDQUFDLGdCQUFnQixFQUFFLElBQUksR0FBRyxDQUFDLGVBQWUsRUFBRTtZQUNoRCxNQUFNLElBQUksS0FBSyxDQUFDLHVKQUF1SjtrQkFDbkssaUJBQWlCLEdBQUcsQ0FBQyxRQUFRLEVBQUUscUJBQXFCLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ3hGO1FBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDcEIsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUdEOzs7Ozs7Ozs7Ozs7OztPQWNHO0lBQ0gsVUFBVTtRQUNOLElBQUksQ0FBQyxlQUFlLEdBQUcsaUNBQWUsQ0FBQyxHQUFHLENBQUM7SUFDL0MsQ0FBQztJQUVEOzs7Ozs7Ozs7OztPQVdHO0lBQ0gsY0FBYztRQUNWLElBQUksQ0FBQyxlQUFlLEdBQUcsaUNBQWUsQ0FBQyxJQUFJLENBQUM7SUFDaEQsQ0FBQztJQUVELHFCQUFxQjtJQUNyQixRQUFRO1FBQ0osT0FBTyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFRDs7T0FFRztJQUNILGdCQUFnQjtRQUNaLE9BQU8sNkJBQTZCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDL0MsQ0FBQztDQUNKO0FBOUVELG9EQThFQztBQUVELFNBQVMsNkJBQTZCLENBQUMsTUFBc0I7SUFDekQsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLFNBQVMsQ0FBQztBQUMxRSxDQUFDO0FBR0QsU0FBUyxjQUFjLENBQUMsS0FBbUI7SUFDdkMsTUFBTSxRQUFRLEdBQWEsRUFBRSxDQUFDO0lBQzlCLEtBQUssTUFBTSxJQUFJLElBQUksS0FBSyxFQUFFO1FBQ3RCLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7S0FDbEM7SUFDRCxPQUFPLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO0FBQ3RDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMjAgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuXG4gKiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBvciBpbiB0aGUgXCJsaWNlbnNlXCIgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWRcbiAqIG9uIGFuIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlclxuICogZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmdcbiAqIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBTZXNzaW9uQmVoYXZpb3IgfSBmcm9tICcuLi9ydW50aW1lL1Nlc3Npb25CZWhhdmlvcic7XG5pbXBvcnQgeyBTeXN0ZW1BY3QsIElTeXN0ZW1BY3QgfSBmcm9tICcuLi9zeXN0ZW1BY3RzL1N5c3RlbUFjdCc7XG5pbXBvcnQgeyBJQ29udHJvbFJlc3VsdCB9IGZyb20gJy4vaW50ZXJmYWNlcy9JQ29udHJvbFJlc3VsdCc7XG5cbi8qKlxuICogUmVwcmVzZW50cyBcIndoYXRcIiB0aGUgc3lzdGVtIHNob3VsZCBjb21tdW5pY2F0ZSB0byB0aGUgdXNlci5cbiAqXG4gKiBUaGlzIGlzIHRoZSBvdXRwdXQgb2JqZWN0IGZyb20gdGhlIGhhbmRsZSBhbmQgaW5pdGlhdGl2ZSBwaGFzZXMgYW5kIGlzIHRoZVxuICogaW50ZXJtZWRpYXRlIHJlcHJlc2VudGF0aW9uIHBhc3NlZCB0byB0aGUgcmVuZGVyIHBoYXNlLlxuICpcbiAqIElmIHRoZSBzZXNzaW9uIGlzIG5vdCBiZWluZyBjbG9zZWQsIHRoZSBDb250cm9sUmVzdWx0IG11c3QgY29udGFpbiBleGFjdGx5XG4gKiBvbmUgYEluaXRpYXRpdmVBY3RgLlxuICovXG5leHBvcnQgY2xhc3MgQ29udHJvbFJlc3VsdCBpbXBsZW1lbnRzIElDb250cm9sUmVzdWx0IHtcbiAgICBhY3RzOiBTeXN0ZW1BY3RbXTtcbiAgICBzZXNzaW9uQmVoYXZpb3I6IFNlc3Npb25CZWhhdmlvcjtcblxuICAgIC8vIGpzRG9jIC0gc2VlIGNsYXNzIGpzRG9jLlxuICAgIGNvbnN0cnVjdG9yKGFjdHM6IFN5c3RlbUFjdFtdLCBzZXNzaW9uQmVoYXZpb3I6IFNlc3Npb25CZWhhdmlvcikge1xuICAgICAgICB0aGlzLmFjdHMgPSBhY3RzO1xuICAgICAgICB0aGlzLnNlc3Npb25CZWhhdmlvciA9IHNlc3Npb25CZWhhdmlvcjtcbiAgICB9XG5cbiAgICAvLyBqc0RvYyAtIHNlZSBPYmplY3QuXG4gICAgdG9TdHJpbmcoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZ2lmeUl0ZW1zKHRoaXMuYWN0cyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyBpZiB0aGUgcmVzdWx0IGhhcyBhbiBpbml0aWF0aXZlIGFjdC5cbiAgICAgKi9cbiAgICBoYXNJbml0aWF0aXZlQWN0KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gY29udHJvbFJlc3VsdEhhc0luaXRpYXRpdmVBY3QodGhpcyk7XG4gICAgfVxuXG59XG5cbi8qKlxuICogQnVpbGRlciB0aGF0IGNyZWF0ZXMgYSBDb250cm9sUmVzdWx0LlxuICovXG5leHBvcnQgY2xhc3MgQ29udHJvbFJlc3VsdEJ1aWxkZXIge1xuICAgIGFjdHM6IFN5c3RlbUFjdFtdO1xuICAgIHNlc3Npb25CZWhhdmlvcjogU2Vzc2lvbkJlaGF2aW9yO1xuXG4gICAgY29uc3RydWN0b3IoYWN0cz86IFN5c3RlbUFjdFtdKSB7XG4gICAgICAgIHRoaXMuYWN0cyA9IGFjdHMgPz8gW107XG4gICAgICAgIHRoaXMuc2Vzc2lvbkJlaGF2aW9yID0gU2Vzc2lvbkJlaGF2aW9yLk9QRU47XG4gICAgfVxuXG4gICAgYnVpbGQoKTogQ29udHJvbFJlc3VsdCB7XG4gICAgICAgIHJldHVybiBuZXcgQ29udHJvbFJlc3VsdCh0aGlzLmFjdHMsIHRoaXMuc2Vzc2lvbkJlaGF2aW9yKTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIEFkZCBhIHN5c3RlbSBhY3QuXG4gICAgICpcbiAgICAgKiBVc2FnZTpcbiAgICAgKiAgKiBJZiB0aGUgc2Vzc2lvbiBuZWVkcyB0byBiZSBlbmRlZCwgYWxzbyBjYWxsIGByZXN1bHRCdWlsZGVyLmVuZFNlc3Npb24oKWAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYWN0IC0gU3lzdGVtIGFjdC5cbiAgICAgKi9cbiAgICBhZGRBY3QoYWN0OiBTeXN0ZW1BY3QpOiB0aGlzIHtcbiAgICAgICAgaWYgKHRoaXMuaGFzSW5pdGlhdGl2ZUFjdCgpICYmIGFjdC50YWtlc0luaXRpYXRpdmUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgUmVzdWx0IGFscmVhZHkgY29udGFpbnMgYW4gaW5pdGlhdGl2ZSBpdGVtLiAoSWYgaGFuZGxlKCkgcHJvZHVjZWQgYW4gaW5pdGlhdGl2ZSBpdGVtIGFuZCB0YWtlSW5pdGlhdGl2ZSBhbHNvIHJhbiwgYSBjb21tb24gaXNzdWUgaXMgbWlzc2luZyAnYXdhaXQnKS5gXG4gICAgICAgICAgICAgICsgYFRyeWluZyB0byBhZGQgJHthY3QudG9TdHJpbmcoKX0uIEV4aXN0aW5nIGl0ZW1zOiAke3N0cmluZ2lmeUl0ZW1zKHRoaXMuYWN0cyl9YCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hY3RzLnB1c2goYWN0KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBGb3JjZSB0aGUgdXNlciBzZXNzaW9uIHRvIGVuZC5cbiAgICAgKlxuICAgICAqIFNlZVxuICAgICAqIGh0dHBzOi8vZGV2ZWxvcGVyLmFtYXpvbi5jb20vZW4tVVMvZG9jcy9hbGV4YS9lY2hvLWJ1dHRvbi1za2lsbHMva2VlcC1zZXNzaW9uLW9wZW4uaHRtbFxuICAgICAqXG4gICAgICogRnJhbWV3b3JrIGJlaGF2aW9yOlxuICAgICAqICAqIHRoaXMgY2F1c2VzIHRoZSBmcmFtZXdvcmsgdG8gY2FsbFxuICAgICAqICAgIGBhc2stY29yZS5SZXNwb25zZUJ1aWxkZXIud2l0aFNob3VsZEVuZFNlc3Npb24odHJ1ZSlgLlxuICAgICAqXG4gICAgICogU2tpbGwvZGV2aWNlIGJlaGF2aW9yOlxuICAgICAqICAqIFN1YnNlcXVlbnQgdXR0ZXJhbmNlcyB3aWxsIG5vdCBiZSByb3V0ZWQgdG8gdGhlIHNraWxsLlxuICAgICAqICAqIEEgbmV3IGxhdW5jaCBjb21tYW5kIHdpbGwgc3RhcnQgYSBmcmVzaCBzZXNzaW9uLlxuICAgICAqXG4gICAgICovXG4gICAgZW5kU2Vzc2lvbigpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZXNzaW9uQmVoYXZpb3IgPSBTZXNzaW9uQmVoYXZpb3IuRU5EO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZvcmNlIHRoZSB1c2VyIHNlc3Npb24gdG8gaW1tZWRpYXRlbHkgZW50ZXIgdGhlIGlkbGUgc3RhdGUuXG4gICAgICpcbiAgICAgKiAqIEZyYW1ld29yayBiZWhhdmlvcjpcbiAgICAgKiAgKiB0aGlzIGNhdXNlcyB0aGUgZnJhbWV3b3JrIHRvIGNhbGxcbiAgICAgKiAgICBgYXNrLWNvcmUuUmVzcG9uc2VCdWlsZGVyLndpdGhTaG91bGRFbmRTZXNzaW9uKHVuZGVmaW5lZClgLlxuICAgICAqXG4gICAgICpcbiAgICAgKiBTa2lsbC9kZXZpY2UgYmVoYXZpb3I6XG4gICAgICogICogVGhlIHNlc3Npb24gcmVtYWlucyBhbGl2ZSBidXQgdGhlIG1pY3JvcGhvbmUgaXMgY2xvc2VkLlxuICAgICAqICAqIFRoZSB1c2VyIGNhbiBpbnRlcmFjdCB3aXRoIHRoZSBza2lsbCBidXQgbXVzdCB1c2UgdGhlIHdha2Utd29yZC5cbiAgICAgKi9cbiAgICBlbnRlcklkbGVTdGF0ZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZXNzaW9uQmVoYXZpb3IgPSBTZXNzaW9uQmVoYXZpb3IuSURMRTtcbiAgICB9XG5cbiAgICAvLyBqc0RvYyAtIHNlZSBPYmplY3RcbiAgICB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gc3RyaW5naWZ5SXRlbXModGhpcy5hY3RzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIGlmIHRoZSByZXN1bHQgaGFzIGFuIGluaXRpYXRpdmUgYWN0LlxuICAgICAqL1xuICAgIGhhc0luaXRpYXRpdmVBY3QoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBjb250cm9sUmVzdWx0SGFzSW5pdGlhdGl2ZUFjdCh0aGlzKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNvbnRyb2xSZXN1bHRIYXNJbml0aWF0aXZlQWN0KHJlc3VsdDogSUNvbnRyb2xSZXN1bHQpOiBib29sZWFuIHtcbiAgICByZXR1cm4gcmVzdWx0LmFjdHMuZmluZCgoaXRlbSkgPT4gaXRlbS50YWtlc0luaXRpYXRpdmUpICE9PSB1bmRlZmluZWQ7XG59XG5cblxuZnVuY3Rpb24gc3RyaW5naWZ5SXRlbXMoaXRlbXM6IElTeXN0ZW1BY3RbXSkge1xuICAgIGNvbnN0IGl0ZW1TdHJzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xuICAgICAgICBpdGVtU3Rycy5wdXNoKGl0ZW0udG9TdHJpbmcoKSk7XG4gICAgfVxuICAgIHJldHVybiBgWyR7aXRlbVN0cnMuam9pbignLCAnKX1dYDtcbn0iXX0=