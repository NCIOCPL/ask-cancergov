"use strict";
/*
 * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.getMVSSlotResolutions = exports.SimplifiedMVSIntent = exports.getSlotResolutions = exports.SimplifiedIntent = exports.IntentBuilder = void 0;
/**
 * Utility to construct intent objects for testing.
 */
class IntentBuilder {
    // TODO: bug/limitation: also include EntityResolution information.
    /**
     * Create an Intent object from a name and a set of slot values.
     *
     * - Multi-value slots can be provided as an array of values.
     * @param name - Intent name
     * @param slotValues - Slot value map
     */
    static of(name, slotValues) {
        const intent = {
            name,
            confirmationStatus: 'NONE',
            slots: {}
        };
        for (const prop of Object.entries(slotValues !== null && slotValues !== void 0 ? slotValues : {})) {
            const name = prop[0];
            const value = prop[1];
            if (Array.isArray(value)) {
                if (value.length === 0) {
                    throw new Error('Slot of empty-array is not supported');
                }
                // Multi-value slot
                intent.slots[name] = {
                    name,
                    slotValue: {
                        type: 'List',
                        values: value.map(item => ({
                            type: 'Simple',
                            value: item
                        }))
                    },
                    confirmationStatus: 'NONE'
                };
            }
            else {
                // Single-value slot
                intent.slots[name] = {
                    name,
                    value: value !== undefined ? value : '',
                    confirmationStatus: 'NONE'
                };
            }
        }
        return intent;
    }
}
exports.IntentBuilder = IntentBuilder;
// TODO: API: retire this class once SimplifiedMVSIntent is covering all cases successfully.
/**
 * Simplified representation of the data contained in a full Intent object.
 */
class SimplifiedIntent {
    constructor(name, slotResolutions) {
        this.name = name;
        this.slotResolutions = slotResolutions;
    }
    /**
     * Factory method to create a SimplifiedIntent from an Intent.
     * @param intent - Intent name
     */
    static fromIntent(intent) {
        const slotResolutions = {};
        if (intent.slots) {
            for (const [name, slot] of Object.entries(intent.slots)) {
                const slotObject = getSlotResolutions(slot);
                if (Array.isArray(slotObject)) {
                    throw new Error("Slot is multi-valued.  Use SimplifiedMVSIntent");
                }
                else {
                    slotResolutions[name] = slotObject !== undefined ? slotObject : undefined;
                }
            }
        }
        return new SimplifiedIntent(intent.name, slotResolutions);
    }
    // tsDoc - see Object
    toString() {
        return JSON.stringify(this);
    }
}
exports.SimplifiedIntent = SimplifiedIntent;
// TODO:retire this func once SimplifiedMVSIntent is covering all cases successfully.
/**
 * If there is an ER-Success, this returns the canonical value id of the first match resolution along with
 * isEntityResolutionMatch: boolean to indicate the status of ER_SUCCESS_MATCH
 * Otherwise this returns the object of literal slot value and isEntityResolutionMatch set to false.
 *
 * @param slot - Slot
 */
function getSlotResolutions(slot) {
    if (slot === undefined || slot.value === undefined || slot.value.length === 0) {
        return undefined;
    }
    // regular single-value handling
    if (slot.resolutions && slot.resolutions.resolutionsPerAuthority && slot.resolutions.resolutionsPerAuthority.length > 0) {
        for (const resolutionsPerAuthority of slot.resolutions.resolutionsPerAuthority) {
            if (resolutionsPerAuthority.status.code === 'ER_SUCCESS_MATCH') {
                return { slotValue: resolutionsPerAuthority.values[0].value.id, isEntityResolutionMatch: true };
            }
        }
    }
    return { slotValue: slot.value, isEntityResolutionMatch: false };
}
exports.getSlotResolutions = getSlotResolutions;
// ---- MVS support ----
/**
 * Simplified representation of the data contained in a full Intent object.
 *
 * - supports Multi-value-slots
 */
class SimplifiedMVSIntent {
    constructor(name, slotResolutions) {
        this.name = name;
        this.slotResolutions = slotResolutions;
    }
    /**
     * Factory method to create a SimplifiedMVSIntent from an Intent.
     * @param intent - Intent
     */
    static fromIntent(intent) {
        const slotResolutions = {};
        if (intent.slots) {
            for (const [name, slot] of Object.entries(intent.slots)) {
                const slotObject = getMVSSlotResolutions(slot);
                slotResolutions[name] = slotObject !== undefined ? slotObject : undefined;
            }
        }
        return new SimplifiedMVSIntent(intent.name, slotResolutions);
    }
    // tsDoc - see Object
    toString() {
        return JSON.stringify(this);
    }
}
exports.SimplifiedMVSIntent = SimplifiedMVSIntent;
/**
 * If there is an ER-Success, this returns the canonical value id of the first match resolution along with
 * isEntityResolutionMatch: boolean to indicate the status of ER_SUCCESS_MATCH
 * Otherwise this returns the object of literal slot value and isEntityResolutionMatch set to false.
 *
 * @param slot - Slot
 */
function getMVSSlotResolutions(slot) {
    if (slot === undefined) {
        return undefined;
    }
    {
        // handling for MVS which isn't in ask-sdk yet.
        const slotValue = slot.slotValue;
        // eslint-disable-next-line no-empty
        if (slotValue !== undefined && slotValue.type === 'List' && slotValue.values.length > 0) {
            const slotValuesAsSlots = slotValue.values;
            const values = slotValuesAsSlots.map(slot => {
                var _a, _b, _c;
                if (slot.resolutions && slot.resolutions.resolutionsPerAuthority && slot.resolutions.resolutionsPerAuthority.length > 0) {
                    for (const resolutionsPerAuthority of slot.resolutions.resolutionsPerAuthority) {
                        if (resolutionsPerAuthority.status.code === 'ER_SUCCESS_MATCH') {
                            return { slotValue: resolutionsPerAuthority.values[0].value.id, isEntityResolutionMatch: true };
                        }
                        else {
                            return { slotValue: (_a = slot.value) !== null && _a !== void 0 ? _a : "", isEntityResolutionMatch: false };
                        }
                    }
                    return { slotValue: (_b = slot.value) !== null && _b !== void 0 ? _b : "", isEntityResolutionMatch: false };
                }
                else {
                    return { slotValue: (_c = slot.value) !== null && _c !== void 0 ? _c : "", isEntityResolutionMatch: false };
                }
            });
            return values;
        }
    }
    if (slot.value === undefined || slot.value.length === 0) {
        return undefined;
    }
    // regular single-value handling
    if (slot.resolutions && slot.resolutions.resolutionsPerAuthority && slot.resolutions.resolutionsPerAuthority.length > 0) {
        for (const resolutionsPerAuthority of slot.resolutions.resolutionsPerAuthority) {
            if (resolutionsPerAuthority.status.code === 'ER_SUCCESS_MATCH') {
                return { slotValue: resolutionsPerAuthority.values[0].value.id, isEntityResolutionMatch: true };
            }
        }
    }
    return { slotValue: slot.value, isEntityResolutionMatch: false };
}
exports.getMVSSlotResolutions = getMVSSlotResolutions;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW50ZW50VXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvdXRpbHMvSW50ZW50VXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7OztHQVdHOzs7QUFJSDs7R0FFRztBQUNILE1BQWEsYUFBYTtJQUV0QixtRUFBbUU7SUFDbkU7Ozs7OztPQU1HO0lBQ0gsTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFZLEVBQUUsVUFBaUM7UUFDckQsTUFBTSxNQUFNLEdBQVc7WUFDbkIsSUFBSTtZQUNKLGtCQUFrQixFQUFFLE1BQU07WUFDMUIsS0FBSyxFQUFFLEVBQUU7U0FDWixDQUFDO1FBRUYsS0FBSyxNQUFNLElBQUksSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsYUFBVixVQUFVLGNBQVYsVUFBVSxHQUFJLEVBQUUsQ0FBQyxFQUFFO1lBQ2pELE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyQixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFdEIsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFDO2dCQUNyQixJQUFJLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFDO29CQUNuQixNQUFNLElBQUksS0FBSyxDQUFDLHNDQUFzQyxDQUFDLENBQUM7aUJBQzNEO2dCQUVELG1CQUFtQjtnQkFDbkIsTUFBTSxDQUFDLEtBQU0sQ0FBQyxJQUFJLENBQUMsR0FBRztvQkFDbEIsSUFBSTtvQkFDSixTQUFTLEVBQUU7d0JBQ1AsSUFBSSxFQUFFLE1BQU07d0JBQ1osTUFBTSxFQUFFLEtBQUssQ0FBQyxHQUFHLENBQ2IsSUFBSSxDQUFBLEVBQUUsQ0FBQSxDQUFDOzRCQUNILElBQUksRUFBRSxRQUFROzRCQUNkLEtBQUssRUFBRSxJQUFJO3lCQUNkLENBQUMsQ0FDTDtxQkFFSjtvQkFDRCxrQkFBa0IsRUFBRSxNQUFN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SSxJQUFJLENBQUMsV0FBVyxDQUFDLHVCQUF1QixDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7UUFDckgsS0FBSyxNQUFNLHVCQUF1QixJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsdUJBQXVCLEVBQUU7WUFDNUUsSUFBSSx1QkFBdUIsQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLGtCQUFrQixFQUFFO2dCQUM1RCxPQUFPLEVBQUUsU0FBUyxFQUFFLHVCQUF1QixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLHVCQUF1QixFQUFFLElBQUksRUFBRSxDQUFDO2FBQ3BHO1NBQ0o7S0FDSjtJQUNELE9BQU8sRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLEtBQU0sRUFBRSx1QkFBdUIsRUFBRSxLQUFLLEVBQUUsQ0FBQztBQUN0RSxDQUFDO0FBNUNELHNEQTRDQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgMjAyMCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS5cbiAqIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIG9yIGluIHRoZSBcImxpY2Vuc2VcIiBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZFxuICogb24gYW4gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyXG4gKiBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZ1xuICogcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEludGVudCwgU2xvdCB9IGZyb20gXCJhc2stc2RrLW1vZGVsXCI7XG5cbi8qKlxuICogVXRpbGl0eSB0byBjb25zdHJ1Y3QgaW50ZW50IG9iamVjdHMgZm9yIHRlc3RpbmcuXG4gKi9cbmV4cG9ydCBjbGFzcyBJbnRlbnRCdWlsZGVyIHtcblxuICAgIC8vIFRPRE86IGJ1Zy9saW1pdGF0aW9uOiBhbHNvIGluY2x1ZGUgRW50aXR5UmVzb2x1dGlvbiBpbmZvcm1hdGlvbi5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYW4gSW50ZW50IG9iamVjdCBmcm9tIGEgbmFtZSBhbmQgYSBzZXQgb2Ygc2xvdCB2YWx1ZXMuXG4gICAgICpcbiAgICAgKiAtIE11bHRpLXZhbHVlIHNsb3RzIGNhbiBiZSBwcm92aWRlZCBhcyBhbiBhcnJheSBvZiB2YWx1ZXMuXG4gICAgICogQHBhcmFtIG5hbWUgLSBJbnRlbnQgbmFtZVxuICAgICAqIEBwYXJhbSBzbG90VmFsdWVzIC0gU2xvdCB2YWx1ZSBtYXBcbiAgICAgKi9cbiAgICBzdGF0aWMgb2YobmFtZTogc3RyaW5nLCBzbG90VmFsdWVzPzogeyBbazogc3RyaW5nXTogYW55IH0pOiBJbnRlbnQge1xuICAgICAgICBjb25zdCBpbnRlbnQ6IEludGVudCA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBjb25maXJtYXRpb25TdGF0dXM6ICdOT05FJyxcbiAgICAgICAgICAgIHNsb3RzOiB7fVxuICAgICAgICB9O1xuXG4gICAgICAgIGZvciAoY29uc3QgcHJvcCBvZiBPYmplY3QuZW50cmllcyhzbG90VmFsdWVzID8/IHt9KSkge1xuICAgICAgICAgICAgY29uc3QgbmFtZSA9IHByb3BbMF07XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHByb3BbMV07XG5cbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSl7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMCl7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU2xvdCBvZiBlbXB0eS1hcnJheSBpcyBub3Qgc3VwcG9ydGVkJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gTXVsdGktdmFsdWUgc2xvdFxuICAgICAgICAgICAgICAgIGludGVudC5zbG90cyFbbmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHNsb3RWYWx1ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0xpc3QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiB2YWx1ZS5tYXAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbT0+KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1NpbXBsZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBpdGVtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIClcblxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBjb25maXJtYXRpb25TdGF0dXM6ICdOT05FJ1xuICAgICAgICAgICAgICAgIH0gYXMgU2xvdDtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gU2luZ2xlLXZhbHVlIHNsb3RcbiAgICAgICAgICAgICAgICBpbnRlbnQuc2xvdHMhW25hbWVdID0ge1xuICAgICAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUgIT09IHVuZGVmaW5lZCA/IHZhbHVlIDogJycsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1hdGlvblN0YXR1czogJ05PTkUnXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGludGVudDtcbiAgICB9XG59XG5cbi8qKlxuICogUmVwcmVzZW50cyBhIHNpbmdsZSBzbG90IHZhbHVlIGFuZCB3aGV0aGVyIGl0IHdhcyBhbiBFUl9NQVRDSC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTbG90UmVzb2x1dGlvblZhbHVlIHtcbiAgICBzbG90VmFsdWU6IHN0cmluZyxcbiAgICBpc0VudGl0eVJlc29sdXRpb25NYXRjaDogYm9vbGVhblxufVxuXG4vLyBUT0RPOiBBUEk6IHJldGlyZSB0aGlzIGNsYXNzIG9uY2UgU2ltcGxpZmllZE1WU0ludGVudCBpcyBjb3ZlcmluZyBhbGwgY2FzZXMgc3VjY2Vzc2Z1bGx5LlxuXG4vKipcbiAqIFNpbXBsaWZpZWQgcmVwcmVzZW50YXRpb24gb2YgdGhlIGRhdGEgY29udGFpbmVkIGluIGEgZnVsbCBJbnRlbnQgb2JqZWN0LlxuICovXG5leHBvcnQgY2xhc3MgU2ltcGxpZmllZEludGVudCB7XG4gICAgcHVibGljIHJlYWRvbmx5IG5hbWU6IHN0cmluZztcbiAgICBwdWJsaWMgcmVhZG9ubHkgc2xvdFJlc29sdXRpb25zOiB7IFtrOiBzdHJpbmddOiBTbG90UmVzb2x1dGlvblZhbHVlIHwgdW5kZWZpbmVkIH07XG4gICAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nLCBzbG90UmVzb2x1dGlvbnM6IHsgW2s6IHN0cmluZ106IFNsb3RSZXNvbHV0aW9uVmFsdWUgfCB1bmRlZmluZWQgfSkge1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLnNsb3RSZXNvbHV0aW9ucyA9IHNsb3RSZXNvbHV0aW9ucztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGYWN0b3J5IG1ldGhvZCB0byBjcmVhdGUgYSBTaW1wbGlmaWVkSW50ZW50IGZyb20gYW4gSW50ZW50LlxuICAgICAqIEBwYXJhbSBpbnRlbnQgLSBJbnRlbnQgbmFtZVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgZnJvbUludGVudChpbnRlbnQ6IEludGVudCk6IFNpbXBsaWZpZWRJbnRlbnQge1xuICAgICAgICBjb25zdCBzbG90UmVzb2x1dGlvbnM6IHsgW2s6IHN0cmluZ106IFNsb3RSZXNvbHV0aW9uVmFsdWUgfCB1bmRlZmluZWQgfSA9IHt9O1xuXG4gICAgICAgIGlmIChpbnRlbnQuc2xvdHMpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgW25hbWUsIHNsb3RdIG9mIE9iamVjdC5lbnRyaWVzKGludGVudC5zbG90cykpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzbG90T2JqZWN0ID0gZ2V0U2xvdFJlc29sdXRpb25zKHNsb3QpO1xuICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHNsb3RPYmplY3QpKXtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2xvdCBpcyBtdWx0aS12YWx1ZWQuICBVc2UgU2ltcGxpZmllZE1WU0ludGVudFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNsb3RSZXNvbHV0aW9uc1tuYW1lXSA9IHNsb3RPYmplY3QgIT09IHVuZGVmaW5lZCA/IHNsb3RPYmplY3QgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBTaW1wbGlmaWVkSW50ZW50KGludGVudC5uYW1lLCBzbG90UmVzb2x1dGlvbnMpO1xuICAgIH1cblxuICAgIC8vIHRzRG9jIC0gc2VlIE9iamVjdFxuICAgIHB1YmxpYyB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcyk7XG4gICAgfVxufVxuXG4vLyBUT0RPOnJldGlyZSB0aGlzIGZ1bmMgb25jZSBTaW1wbGlmaWVkTVZTSW50ZW50IGlzIGNvdmVyaW5nIGFsbCBjYXNlcyBzdWNjZXNzZnVsbHkuXG4vKipcbiAqIElmIHRoZXJlIGlzIGFuIEVSLVN1Y2Nlc3MsIHRoaXMgcmV0dXJucyB0aGUgY2Fub25pY2FsIHZhbHVlIGlkIG9mIHRoZSBmaXJzdCBtYXRjaCByZXNvbHV0aW9uIGFsb25nIHdpdGhcbiAqIGlzRW50aXR5UmVzb2x1dGlvbk1hdGNoOiBib29sZWFuIHRvIGluZGljYXRlIHRoZSBzdGF0dXMgb2YgRVJfU1VDQ0VTU19NQVRDSFxuICogT3RoZXJ3aXNlIHRoaXMgcmV0dXJucyB0aGUgb2JqZWN0IG9mIGxpdGVyYWwgc2xvdCB2YWx1ZSBhbmQgaXNFbnRpdHlSZXNvbHV0aW9uTWF0Y2ggc2V0IHRvIGZhbHNlLlxuICpcbiAqIEBwYXJhbSBzbG90IC0gU2xvdFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2xvdFJlc29sdXRpb25zKHNsb3Q6IFNsb3QgfCB1bmRlZmluZWQpOiBTbG90UmVzb2x1dGlvblZhbHVlIHwgdW5kZWZpbmVkIHtcbiAgICBpZiAoc2xvdCA9PT0gdW5kZWZpbmVkIHx8IHNsb3QudmFsdWUgPT09IHVuZGVmaW5lZCB8fCBzbG90LnZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvLyByZWd1bGFyIHNpbmdsZS12YWx1ZSBoYW5kbGluZ1xuICAgIGlmIChzbG90LnJlc29sdXRpb25zICYmIHNsb3QucmVzb2x1dGlvbnMucmVzb2x1dGlvbnNQZXJBdXRob3JpdHkgJiYgc2xvdC5yZXNvbHV0aW9ucy5yZXNvbHV0aW9uc1BlckF1dGhvcml0eS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGZvciAoY29uc3QgcmVzb2x1dGlvbnNQZXJBdXRob3JpdHkgb2Ygc2xvdC5yZXNvbHV0aW9ucy5yZXNvbHV0aW9uc1BlckF1dGhvcml0eSkge1xuICAgICAgICAgICAgaWYgKHJlc29sdXRpb25zUGVyQXV0aG9yaXR5LnN0YXR1cy5jb2RlID09PSAnRVJfU1VDQ0VTU19NQVRDSCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBzbG90VmFsdWU6IHJlc29sdXRpb25zUGVyQXV0aG9yaXR5LnZhbHVlc1swXSEudmFsdWUuaWQsIGlzRW50aXR5UmVzb2x1dGlvbk1hdGNoOiB0cnVlIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHsgc2xvdFZhbHVlOiBzbG90LnZhbHVlISwgaXNFbnRpdHlSZXNvbHV0aW9uTWF0Y2g6IGZhbHNlIH07XG59XG5cblxuXG4vLyAtLS0tIE1WUyBzdXBwb3J0IC0tLS1cblxuLyoqXG4gKiBTaW1wbGlmaWVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBkYXRhIGNvbnRhaW5lZCBpbiBhIGZ1bGwgSW50ZW50IG9iamVjdC5cbiAqXG4gKiAtIHN1cHBvcnRzIE11bHRpLXZhbHVlLXNsb3RzXG4gKi9cbmV4cG9ydCBjbGFzcyBTaW1wbGlmaWVkTVZTSW50ZW50IHtcbiAgICBwdWJsaWMgcmVhZG9ubHkgbmFtZTogc3RyaW5nO1xuICAgIHB1YmxpYyByZWFkb25seSBzbG90UmVzb2x1dGlvbnM6IHsgW2s6IHN0cmluZ106IFNsb3RSZXNvbHV0aW9uVmFsdWUgfCBTbG90UmVzb2x1dGlvblZhbHVlW10gfCB1bmRlZmluZWQgfTtcbiAgICBjb25zdHJ1Y3RvcihuYW1lOiBzdHJpbmcsIHNsb3RSZXNvbHV0aW9uczogeyBbazogc3RyaW5nXTogU2xvdFJlc29sdXRpb25WYWx1ZSB8IFNsb3RSZXNvbHV0aW9uVmFsdWVbXSB8IHVuZGVmaW5lZCB9KSB7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMuc2xvdFJlc29sdXRpb25zID0gc2xvdFJlc29sdXRpb25zO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZhY3RvcnkgbWV0aG9kIHRvIGNyZWF0ZSBhIFNpbXBsaWZpZWRNVlNJbnRlbnQgZnJvbSBhbiBJbnRlbnQuXG4gICAgICogQHBhcmFtIGludGVudCAtIEludGVudFxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgZnJvbUludGVudChpbnRlbnQ6IEludGVudCk6IFNpbXBsaWZpZWRNVlNJbnRlbnQge1xuICAgICAgICBjb25zdCBzbG90UmVzb2x1dGlvbnM6IHsgW2s6IHN0cmluZ106IFNsb3RSZXNvbHV0aW9uVmFsdWUgfCBTbG90UmVzb2x1dGlvblZhbHVlW10gfCB1bmRlZmluZWQgfSA9IHt9O1xuXG4gICAgICAgIGlmIChpbnRlbnQuc2xvdHMpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgW25hbWUsIHNsb3RdIG9mIE9iamVjdC5lbnRyaWVzKGludGVudC5zbG90cykpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzbG90T2JqZWN0ID0gZ2V0TVZTU2xvdFJlc29sdXRpb25zKHNsb3QpO1xuICAgICAgICAgICAgICAgIHNsb3RSZXNvbHV0aW9uc1tuYW1lXSA9IHNsb3RPYmplY3QgIT09IHVuZGVmaW5lZCA/IHNsb3RPYmplY3QgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBTaW1wbGlmaWVkTVZTSW50ZW50KGludGVudC5uYW1lLCBzbG90UmVzb2x1dGlvbnMpO1xuICAgIH1cblxuICAgIC8vIHRzRG9jIC0gc2VlIE9iamVjdFxuICAgIHB1YmxpYyB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcyk7XG4gICAgfVxufVxuXG5cbi8qKlxuICogSWYgdGhlcmUgaXMgYW4gRVItU3VjY2VzcywgdGhpcyByZXR1cm5zIHRoZSBjYW5vbmljYWwgdmFsdWUgaWQgb2YgdGhlIGZpcnN0IG1hdGNoIHJlc29sdXRpb24gYWxvbmcgd2l0aFxuICogaXNFbnRpdHlSZXNvbHV0aW9uTWF0Y2g6IGJvb2xlYW4gdG8gaW5kaWNhdGUgdGhlIHN0YXR1cyBvZiBFUl9TVUNDRVNTX01BVENIXG4gKiBPdGhlcndpc2UgdGhpcyByZXR1cm5zIHRoZSBvYmplY3Qgb2YgbGl0ZXJhbCBzbG90IHZhbHVlIGFuZCBpc0VudGl0eVJlc29sdXRpb25NYXRjaCBzZXQgdG8gZmFsc2UuXG4gKlxuICogQHBhcmFtIHNsb3QgLSBTbG90XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRNVlNTbG90UmVzb2x1dGlvbnMoc2xvdDogU2xvdCB8IHVuZGVmaW5lZCk6IFNsb3RSZXNvbHV0aW9uVmFsdWUgfCBTbG90UmVzb2x1dGlvblZhbHVlW10gfCB1bmRlZmluZWQge1xuICAgIGlmIChzbG90ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICB7XG4gICAgICAgIC8vIGhhbmRsaW5nIGZvciBNVlMgd2hpY2ggaXNuJ3QgaW4gYXNrLXNkayB5ZXQuXG4gICAgICAgIGNvbnN0IHNsb3RWYWx1ZTogYW55ID0gKHNsb3QgYXMgYW55KS5zbG90VmFsdWU7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1lbXB0eVxuICAgICAgICBpZiAoc2xvdFZhbHVlICE9PSB1bmRlZmluZWQgJiYgc2xvdFZhbHVlLnR5cGUgPT09ICdMaXN0JyAmJiBzbG90VmFsdWUudmFsdWVzLmxlbmd0aCA+IDApe1xuICAgICAgICAgICAgY29uc3Qgc2xvdFZhbHVlc0FzU2xvdHMgPSBzbG90VmFsdWUudmFsdWVzIGFzIFNsb3RbXTtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IHNsb3RWYWx1ZXNBc1Nsb3RzLm1hcChzbG90ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoc2xvdC5yZXNvbHV0aW9ucyAmJiBzbG90LnJlc29sdXRpb25zLnJlc29sdXRpb25zUGVyQXV0aG9yaXR5ICYmIHNsb3QucmVzb2x1dGlvbnMucmVzb2x1dGlvbnNQZXJBdXRob3JpdHkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHJlc29sdXRpb25zUGVyQXV0aG9yaXR5IG9mIHNsb3QucmVzb2x1dGlvbnMucmVzb2x1dGlvbnNQZXJBdXRob3JpdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNvbHV0aW9uc1BlckF1dGhvcml0eS5zdGF0dXMuY29kZSA9PT0gJ0VSX1NVQ0NFU1NfTUFUQ0gnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgc2xvdFZhbHVlOiByZXNvbHV0aW9uc1BlckF1dGhvcml0eS52YWx1ZXNbMF0hLnZhbHVlLmlkLCBpc0VudGl0eVJlc29sdXRpb25NYXRjaDogdHJ1ZSB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgc2xvdFZhbHVlOiBzbG90LnZhbHVlID8/IFwiXCIsIGlzRW50aXR5UmVzb2x1dGlvbk1hdGNoOiBmYWxzZSB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHNsb3RWYWx1ZTogc2xvdC52YWx1ZSA/PyBcIlwiLCBpc0VudGl0eVJlc29sdXRpb25NYXRjaDogZmFsc2UgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHNsb3RWYWx1ZTogc2xvdC52YWx1ZSA/PyBcIlwiLCBpc0VudGl0eVJlc29sdXRpb25NYXRjaDogZmFsc2UgfTtcbiAgICAgICAgICAgICAgICB9fSk7XG5cbiAgICAgICAgICAgIHJldHVybiB2YWx1ZXM7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoc2xvdC52YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHNsb3QudmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgLy8gcmVndWxhciBzaW5nbGUtdmFsdWUgaGFuZGxpbmdcbiAgICBpZiAoc2xvdC5yZXNvbHV0aW9ucyAmJiBzbG90LnJlc29sdXRpb25zLnJlc29sdXRpb25zUGVyQXV0aG9yaXR5ICYmIHNsb3QucmVzb2x1dGlvbnMucmVzb2x1dGlvbnNQZXJBdXRob3JpdHkubGVuZ3RoID4gMCkge1xuICAgICAgICBmb3IgKGNvbnN0IHJlc29sdXRpb25zUGVyQXV0aG9yaXR5IG9mIHNsb3QucmVzb2x1dGlvbnMucmVzb2x1dGlvbnNQZXJBdXRob3JpdHkpIHtcbiAgICAgICAgICAgIGlmIChyZXNvbHV0aW9uc1BlckF1dGhvcml0eS5zdGF0dXMuY29kZSA9PT0gJ0VSX1NVQ0NFU1NfTUFUQ0gnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc2xvdFZhbHVlOiByZXNvbHV0aW9uc1BlckF1dGhvcml0eS52YWx1ZXNbMF0hLnZhbHVlLmlkLCBpc0VudGl0eVJlc29sdXRpb25NYXRjaDogdHJ1ZSB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7IHNsb3RWYWx1ZTogc2xvdC52YWx1ZSEsIGlzRW50aXR5UmVzb2x1dGlvbk1hdGNoOiBmYWxzZSB9O1xufVxuXG4iXX0=