"use strict";
/*
 * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.InputUtil = void 0;
const Strings_1 = require("../constants/Strings");
const AmazonBuiltInIntent_1 = require("../intents/AmazonBuiltInIntent");
const GeneralControlIntent_1 = require("../intents/GeneralControlIntent");
const SingleValueControlIntent_1 = require("../intents/SingleValueControlIntent");
/**
 * Utilities to assist with input handling.
 */
var InputUtil;
(function (InputUtil) {
    /**
     * Test and assert if an object looks like an Intent.
     * (user-defined type guard)
     */
    function isIntentShape(x) {
        return (x.name !== undefined && x.confirmationStatus);
    }
    InputUtil.isIntentShape = isIntentShape;
    /**
     * Test if the input is a LaunchRequest.
     * @param input - Input
     */
    function isLaunchRequest(input) {
        return input.request.type === 'LaunchRequest';
    }
    InputUtil.isLaunchRequest = isLaunchRequest;
    /**
     * Test if the input is a SessionEndedRequest.
     * @param input - Input
     */
    function isSessionEndedRequest(input) {
        return input.request.type === 'SessionEndedRequest';
    }
    InputUtil.isSessionEndedRequest = isSessionEndedRequest;
    /**
     * Test if the input is an IntentRequest.
     * @param input - Input
     */
    function isIntent(input, intentName) {
        return input.request.type === 'IntentRequest' && input.request.intent.name === intentName;
    }
    InputUtil.isIntent = isIntent;
    /**
     * Test if the input is a SingleValueControlIntent for the provided slotType.
     * @param input - Input
     */
    function isSingleValueControlIntent(input, slotType) {
        return input.request.type === 'IntentRequest' && input.request.intent.name === SingleValueControlIntent_1.SingleValueControlIntent.intentName(slotType);
    }
    InputUtil.isSingleValueControlIntent = isSingleValueControlIntent;
    /**
     * Test if the input is an AMAZON.FallbackIntent.
     * @param input - Input
     */
    function isFallbackIntent(input) {
        return input.request.type === 'IntentRequest' && input.request.intent.name === 'AMAZON.FallbackIntent';
    }
    InputUtil.isFallbackIntent = isFallbackIntent;
    /**
     * Test if the input is an Alexa.Presentation.APL.UserEvent and has arguments.
     * @param input - Input
     */
    function isAPLUserEventWithArgs(input) {
        return input.request.type === 'Alexa.Presentation.APL.UserEvent' && input.request.arguments !== undefined && input.request.arguments.length > 0;
    }
    InputUtil.isAPLUserEventWithArgs = isAPLUserEventWithArgs;
    /**
     * Test if the input is an Alexa.Presentation.APL.UserEvent with a first
     * argument equal to the provided control ID.
     * @param input - Input
     */
    function isAPLUserEventWithMatchingControlId(input, controlId) {
        return isAPLUserEventWithArgs(input) && (input.request.arguments[0] === controlId);
    }
    InputUtil.isAPLUserEventWithMatchingControlId = isAPLUserEventWithMatchingControlId;
    /**
     * Test if the feedback is 'builtin_affirm'
     * @param feedback - Feedback slot value ID
     */
    // TODO: naming: improve name
    function feedbackIsTrue(feedback) {
        return (feedback === Strings_1.Strings.Feedback.Affirm);
    }
    InputUtil.feedbackIsTrue = feedbackIsTrue;
    /**
     * Test if the feedback is 'builtin_disaffirm'
     * @param feedback - Feedback slot value ID
     */
    // TODO: naming: improve name
    function feedbackIsFalse(feedback) {
        return (feedback === Strings_1.Strings.Feedback.Disaffirm);
    }
    InputUtil.feedbackIsFalse = feedbackIsFalse;
    /**
     * Test if the feedback is undefined
     * @param feedback - Feedback slot value ID
     */
    function feedbackIsUndefined(feedback) {
        return (feedback === undefined);
    }
    InputUtil.feedbackIsUndefined = feedbackIsUndefined;
    /**
     * Test if the feedback matches one of the provided identifiers, or is undefined.
     * @param feedback - Feedback slot value
     * @param feedbackIds - Feedback slot value IDs to match against
     */
    function feedbackIsMatchOrUndefined(feedback, feedbackIds) {
        return slotIsUndefinedOrMatch(feedback, feedbackIds);
    }
    InputUtil.feedbackIsMatchOrUndefined = feedbackIsMatchOrUndefined;
    /**
     * Test if the slot value matches one of the provided identifiers, or is undefined.
     * @param slotValue - Slot value ID
     * @param expectedValues - Slot value IDs to match against
     */
    function slotIsUndefinedOrMatch(slotValue, expectedValues) {
        return slotValue === undefined || expectedValues.includes(slotValue);
    }
    InputUtil.slotIsUndefinedOrMatch = slotIsUndefinedOrMatch;
    /**
     * Test if the action matches one of the provided identifiers, or is undefined.
     * @param action - Action slot value ID
     * @param expectedValues - Action slot value IDs to match against
     */
    function actionIsSetOrUndefined(action, expectedValues) {
        return slotIsUndefinedOrMatch(action, expectedValues);
    }
    InputUtil.actionIsSetOrUndefined = actionIsSetOrUndefined;
    /**
     * Test if the action is defined and matches one of the provided identifiers.
     * @param action - Action slot value ID
     * @param expectedValues - Action slot value IDs to match against
     */
    function actionIsMatch(action, expectedValues) {
        return action !== undefined && expectedValues.includes(action);
    }
    InputUtil.actionIsMatch = actionIsMatch;
    /**
     * Test if the action is undefined.
     * @param action - Action slot value ID
     */
    function actionIsUndefined(action) {
        return action === undefined;
    }
    InputUtil.actionIsUndefined = actionIsUndefined;
    /**
     * Test if the target is defined and matches one of the provided identifiers.
     * @param target - Target slot value ID
     * @param targetIds - Target slot value IDs to match against
     */
    function targetIsMatch(target, targetIds) {
        return target !== undefined && targetIds.includes(target);
    }
    InputUtil.targetIsMatch = targetIsMatch;
    /**
     * Test if the feedback is undefined.
     * @param target - Target slot value ID
     */
    function targetIsUndefined(target) {
        return target === undefined;
    }
    InputUtil.targetIsUndefined = targetIsUndefined;
    /**
     * Test if the target matches one of the provided identifiers, or is undefined.
     * @param target - Target slot value ID
     * @param targetIds - Target slot value IDs to match against
     */
    function targetIsMatchOrUndefined(target, targetIds) {
        return slotIsUndefinedOrMatch(target, targetIds);
    }
    InputUtil.targetIsMatchOrUndefined = targetIsMatchOrUndefined;
    /**
     * Test if the action matches one of the provided identifiers, or is undefined.
     * @param action - Action slot value ID
     * @param expectedValues - Action slot value IDs to match against
     */
    function actionIsMatchOrUndefined(action, actionIds) {
        return slotIsUndefinedOrMatch(action, actionIds);
    }
    InputUtil.actionIsMatchOrUndefined = actionIsMatchOrUndefined;
    /**
     * Test if the valueType is defined and matches the provided identifier.
     * @param valueType - ValueType slot value ID
     * @param expectedValueType - ValueType slot value ID to match against
     */
    function valueTypeMatch(valueType, expectedValueType) {
        return valueType !== undefined && valueType === expectedValueType;
    }
    InputUtil.valueTypeMatch = valueTypeMatch;
    /**
     * Test if the valueType is undefined.
     * @param valueType - ValueType slot value ID
     */
    function valueTypeIsUndefined(valueType) {
        return valueType === undefined;
    }
    InputUtil.valueTypeIsUndefined = valueTypeIsUndefined;
    /**
     * Test if the value is defined.
     *
     * A value of '?' is interpreted as being equal to undefined.  (A value of
     * '?' is produced by NLU when slot elicitation is used but the response
     * cannot be understood.)
     * @param value - Value
     */
    function valueStrDefined(value) {
        return value !== undefined && value !== '?';
    }
    InputUtil.valueStrDefined = valueStrDefined;
    /**
     * Test if the value is undefined.
     *
     * A value of '?' is interpreted as being equal to undefined.  (A value of
     * '?' is produced by NLU when slot elicitation is used but the response
     * cannot be understood.)
     * @param value - Value
     */
    function valueStrIsUndefined(value) {
        return value === undefined || value === '?';
    }
    InputUtil.valueStrIsUndefined = valueStrIsUndefined;
    /**
     * Test if the input is equivalent to simply saying "yes".
     *
     * @param input - Input
     *
     * @returns true if the input is:
     * - `AMAZON.YesIntent`, or,
     * - A `GeneralControlIntent` with `feedback = builtin_affirm` and no other
     *   filled.
     */
    function isBareYes(input) {
        if (input.request.type !== 'IntentRequest') {
            return false;
        }
        else if (input.request.intent.name === AmazonBuiltInIntent_1.AmazonIntent.YesIntent) {
            return true;
        }
        else if (input.request.intent.name === GeneralControlIntent_1.GeneralControlIntent.name) {
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            if (feedback === Strings_1.Strings.Feedback.Affirm && action === undefined && target === undefined) {
                return true;
            }
        }
        return false;
    }
    InputUtil.isBareYes = isBareYes;
    /**
     * Test if the input is equivalent to simply saying "no".
     *
     * @param input - Input
     *
     * @returns true if the input is:
     * - `AMAZON.NoIntent`, or,
     * - A `GeneralControlIntent` with `feedback = builtin_disaffirm` and no other
     *   filled.
     */
    function isBareNo(input) {
        if (input.request.type !== 'IntentRequest') {
            return false;
        }
        else if (input.request.intent.name === AmazonBuiltInIntent_1.AmazonIntent.NoIntent) {
            return true;
        }
        else if (input.request.intent.name === GeneralControlIntent_1.GeneralControlIntent.name) {
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            if (feedback === Strings_1.Strings.Feedback.Disaffirm && action === undefined && target === undefined) {
                return true;
            }
        }
        return false;
    }
    InputUtil.isBareNo = isBareNo;
    /**
     * Extracts the value and erMatch from a SingleValueControlIntent
     * @param input - Input
     */
    function getValueResolution(input) {
        const { valueStr, erMatch } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
        return { valueStr: valueStr, erMatch: erMatch };
    }
    InputUtil.getValueResolution = getValueResolution;
})(InputUtil = exports.InputUtil || (exports.InputUtil = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW5wdXRVdGlsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3V0aWxzL0lucHV0VXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7OztBQUdILGtEQUFvRDtBQUVwRCx3RUFBOEQ7QUFDOUQsMEVBQW1HO0FBQ25HLGtGQUErRztBQUUvRzs7R0FFRztBQUNILElBQWlCLFNBQVMsQ0FtUnpCO0FBblJELFdBQWlCLFNBQVM7SUFFdEI7OztPQUdHO0lBQ0gsU0FBZ0IsYUFBYSxDQUFDLENBQU07UUFDaEMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssU0FBUyxJQUFJLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBQzFELENBQUM7SUFGZSx1QkFBYSxnQkFFNUIsQ0FBQTtJQUdEOzs7T0FHRztJQUNILFNBQWdCLGVBQWUsQ0FBQyxLQUFtQjtRQUMvQyxPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxLQUFLLGVBQWUsQ0FBQztJQUNsRCxDQUFDO0lBRmUseUJBQWUsa0JBRTlCLENBQUE7SUFFRDs7O09BR0c7SUFDSCxTQUFnQixxQkFBcUIsQ0FBQyxLQUFtQjtRQUNyRCxPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxLQUFLLHFCQUFxQixDQUFDO0lBQ3hELENBQUM7SUFGZSwrQkFBcUIsd0JBRXBDLENBQUE7SUFFRDs7O09BR0c7SUFDSCxTQUFnQixRQUFRLENBQUMsS0FBbUIsRUFBRSxVQUFrQjtRQUM1RCxPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxLQUFLLGVBQWUsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEtBQUssVUFBVSxDQUFDO0lBQzlGLENBQUM7SUFGZSxrQkFBUSxXQUV2QixDQUFBO0lBRUQ7OztPQUdHO0lBQ0gsU0FBZ0IsMEJBQTBCLENBQUMsS0FBbUIsRUFBRSxRQUFnQjtRQUM1RSxPQUFPLEtBQUssQ0FB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SSxLQUFLLGtDQUFZLENBQUMsUUFBUSxFQUFFO1lBQzFELE9BQU8sSUFBSSxDQUFDO1NBQ2Y7YUFDSSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSywyQ0FBb0IsQ0FBQyxJQUFJLEVBQUU7WUFDOUQsTUFBTSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsaURBQTBCLENBQUUsS0FBSyxDQUFDLE9BQXlCLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDekcsSUFBSSxRQUFRLEtBQUssaUJBQUMsQ0FBQyxRQUFRLENBQUMsU0FBUyxJQUFJLE1BQU0sS0FBSyxTQUFTLElBQUksTUFBTSxLQUFLLFNBQVMsRUFBRTtnQkFDbkYsT0FBTyxJQUFJLENBQUM7YUFDZjtTQUNKO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQWRlLGtCQUFRLFdBY3ZCLENBQUE7SUFFRDs7O09BR0c7SUFDSCxTQUFnQixrQkFBa0IsQ0FBQyxLQUFtQjtRQUNsRCxNQUFNLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxHQUFHLHlEQUE4QixDQUFFLEtBQUssQ0FBQyxPQUF5QixDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3RHLE9BQU8sRUFBRSxRQUFRLEVBQUUsUUFBUyxFQUFFLE9BQU8sRUFBRSxPQUFRLEVBQUUsQ0FBQztJQUN0RCxDQUFDO0lBSGUsNEJBQWtCLHFCQUdqQyxDQUFBO0FBQ0wsQ0FBQyxFQW5SZ0IsU0FBUyxHQUFULGlCQUFTLEtBQVQsaUJBQVMsUUFtUnpCIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAyMDIwIEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLlxuICogWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogb3IgaW4gdGhlIFwibGljZW5zZVwiIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkXG4gKiBvbiBhbiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXJcbiAqIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nXG4gKiBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgSW50ZW50LCBJbnRlbnRSZXF1ZXN0LCBpbnRlcmZhY2VzIH0gZnJvbSAnYXNrLXNkay1tb2RlbCc7XG5pbXBvcnQgeyBTdHJpbmdzIGFzICQgfSBmcm9tIFwiLi4vY29uc3RhbnRzL1N0cmluZ3NcIjtcbmltcG9ydCB7IENvbnRyb2xJbnB1dCB9IGZyb20gJy4uL2NvbnRyb2xzL0NvbnRyb2xJbnB1dCc7XG5pbXBvcnQgeyBBbWF6b25JbnRlbnQgfSBmcm9tICcuLi9pbnRlbnRzL0FtYXpvbkJ1aWx0SW5JbnRlbnQnO1xuaW1wb3J0IHsgR2VuZXJhbENvbnRyb2xJbnRlbnQsIHVucGFja0dlbmVyYWxDb250cm9sSW50ZW50IH0gZnJvbSAnLi4vaW50ZW50cy9HZW5lcmFsQ29udHJvbEludGVudCc7XG5pbXBvcnQgeyBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQsIHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudCB9IGZyb20gJy4uL2ludGVudHMvU2luZ2xlVmFsdWVDb250cm9sSW50ZW50JztcblxuLyoqXG4gKiBVdGlsaXRpZXMgdG8gYXNzaXN0IHdpdGggaW5wdXQgaGFuZGxpbmcuXG4gKi9cbmV4cG9ydCBuYW1lc3BhY2UgSW5wdXRVdGlsIHtcblxuICAgIC8qKlxuICAgICAqIFRlc3QgYW5kIGFzc2VydCBpZiBhbiBvYmplY3QgbG9va3MgbGlrZSBhbiBJbnRlbnQuXG4gICAgICogKHVzZXItZGVmaW5lZCB0eXBlIGd1YXJkKVxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiBpc0ludGVudFNoYXBlKHg6IGFueSk6IHggaXMgSW50ZW50IHtcbiAgICAgICAgcmV0dXJuICh4Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB4LmNvbmZpcm1hdGlvblN0YXR1cyk7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBUZXN0IGlmIHRoZSBpbnB1dCBpcyBhIExhdW5jaFJlcXVlc3QuXG4gICAgICogQHBhcmFtIGlucHV0IC0gSW5wdXRcbiAgICAgKi9cbiAgICBleHBvcnQgZnVuY3Rpb24gaXNMYXVuY2hSZXF1ZXN0KGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGlucHV0LnJlcXVlc3QudHlwZSA9PT0gJ0xhdW5jaFJlcXVlc3QnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlc3QgaWYgdGhlIGlucHV0IGlzIGEgU2Vzc2lvbkVuZGVkUmVxdWVzdC5cbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBJbnB1dFxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiBpc1Nlc3Npb25FbmRlZFJlcXVlc3QoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gaW5wdXQucmVxdWVzdC50eXBlID09PSAnU2Vzc2lvbkVuZGVkUmVxdWVzdCc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVzdCBpZiB0aGUgaW5wdXQgaXMgYW4gSW50ZW50UmVxdWVzdC5cbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBJbnB1dFxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiBpc0ludGVudChpbnB1dDogQ29udHJvbElucHV0LCBpbnRlbnROYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGlucHV0LnJlcXVlc3QudHlwZSA9PT0gJ0ludGVudFJlcXVlc3QnICYmIGlucHV0LnJlcXVlc3QuaW50ZW50Lm5hbWUgPT09IGludGVudE5hbWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVzdCBpZiB0aGUgaW5wdXQgaXMgYSBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQgZm9yIHRoZSBwcm92aWRlZCBzbG90VHlwZS5cbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBJbnB1dFxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiBpc1NpbmdsZVZhbHVlQ29udHJvbEludGVudChpbnB1dDogQ29udHJvbElucHV0LCBzbG90VHlwZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBpbnB1dC5yZXF1ZXN0LnR5cGUgPT09ICdJbnRlbnRSZXF1ZXN0JyAmJiBpbnB1dC5yZXF1ZXN0LmludGVudC5uYW1lID09PSBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQuaW50ZW50TmFtZShzbG90VHlwZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVzdCBpZiB0aGUgaW5wdXQgaXMgYW4gQU1BWk9OLkZhbGxiYWNrSW50ZW50LlxuICAgICAqIEBwYXJhbSBpbnB1dCAtIElucHV0XG4gICAgICovXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGlzRmFsbGJhY2tJbnRlbnQoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gaW5wdXQucmVxdWVzdC50eXBlID09PSAnSW50ZW50UmVxdWVzdCcgJiYgaW5wdXQucmVxdWVzdC5pbnRlbnQubmFtZSA9PT0gJ0FNQVpPTi5GYWxsYmFja0ludGVudCc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVzdCBpZiB0aGUgaW5wdXQgaXMgYW4gQWxleGEuUHJlc2VudGF0aW9uLkFQTC5Vc2VyRXZlbnQgYW5kIGhhcyBhcmd1bWVudHMuXG4gICAgICogQHBhcmFtIGlucHV0IC0gSW5wdXRcbiAgICAgKi9cbiAgICBleHBvcnQgZnVuY3Rpb24gaXNBUExVc2VyRXZlbnRXaXRoQXJncyhpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBpbnB1dC5yZXF1ZXN0LnR5cGUgPT09ICdBbGV4YS5QcmVzZW50YXRpb24uQVBMLlVzZXJFdmVudCcgJiYgaW5wdXQucmVxdWVzdC5hcmd1bWVudHMgIT09IHVuZGVmaW5lZCAmJiBpbnB1dC5yZXF1ZXN0LmFyZ3VtZW50cy5sZW5ndGggPiAwO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlc3QgaWYgdGhlIGlucHV0IGlzIGFuIEFsZXhhLlByZXNlbnRhdGlvbi5BUEwuVXNlckV2ZW50IHdpdGggYSBmaXJzdFxuICAgICAqIGFyZ3VtZW50IGVxdWFsIHRvIHRoZSBwcm92aWRlZCBjb250cm9sIElELlxuICAgICAqIEBwYXJhbSBpbnB1dCAtIElucHV0XG4gICAgICovXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGlzQVBMVXNlckV2ZW50V2l0aE1hdGNoaW5nQ29udHJvbElkKGlucHV0OiBDb250cm9sSW5wdXQsIGNvbnRyb2xJZDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBpc0FQTFVzZXJFdmVudFdpdGhBcmdzKGlucHV0KSAmJiAoKGlucHV0LnJlcXVlc3QgYXMgaW50ZXJmYWNlcy5hbGV4YS5wcmVzZW50YXRpb24uYXBsLlVzZXJFdmVudCkuYXJndW1lbnRzIVswXSA9PT0gY29udHJvbElkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZXN0IGlmIHRoZSBmZWVkYmFjayBpcyAnYnVpbHRpbl9hZmZpcm0nXG4gICAgICogQHBhcmFtIGZlZWRiYWNrIC0gRmVlZGJhY2sgc2xvdCB2YWx1ZSBJRFxuICAgICAqL1xuICAgIC8vIFRPRE86IG5hbWluZzogaW1wcm92ZSBuYW1lXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGZlZWRiYWNrSXNUcnVlKGZlZWRiYWNrOiBzdHJpbmcgfCB1bmRlZmluZWQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIChmZWVkYmFjayA9PT0gJC5GZWVkYmFjay5BZmZpcm0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlc3QgaWYgdGhlIGZlZWRiYWNrIGlzICdidWlsdGluX2Rpc2FmZmlybSdcbiAgICAgKiBAcGFyYW0gZmVlZGJhY2sgLSBGZWVkYmFjayBzbG90IHZhbHVlIElEXG4gICAgICovXG4gICAgLy8gVE9ETzogbmFtaW5nOiBpbXByb3ZlIG5hbWVcbiAgICBleHBvcnQgZnVuY3Rpb24gZmVlZGJhY2tJc0ZhbHNlKGZlZWRiYWNrOiBzdHJpbmcgfCB1bmRlZmluZWQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIChmZWVkYmFjayA9PT0gJC5GZWVkYmFjay5EaXNhZmZpcm0pO1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogVGVzdCBpZiB0aGUgZmVlZGJhY2sgaXMgdW5kZWZpbmVkXG4gICAgICogQHBhcmFtIGZlZWRiYWNrIC0gRmVlZGJhY2sgc2xvdCB2YWx1ZSBJRFxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiBmZWVkYmFja0lzVW5kZWZpbmVkKGZlZWRiYWNrOiBzdHJpbmcgfCB1bmRlZmluZWQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIChmZWVkYmFjayA9PT0gdW5kZWZpbmVkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZXN0IGlmIHRoZSBmZWVkYmFjayBtYXRjaGVzIG9uZSBvZiB0aGUgcHJvdmlkZWQgaWRlbnRpZmllcnMsIG9yIGlzIHVuZGVmaW5lZC5cbiAgICAgKiBAcGFyYW0gZmVlZGJhY2sgLSBGZWVkYmFjayBzbG90IHZhbHVlXG4gICAgICogQHBhcmFtIGZlZWRiYWNrSWRzIC0gRmVlZGJhY2sgc2xvdCB2YWx1ZSBJRHMgdG8gbWF0Y2ggYWdhaW5zdFxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiBmZWVkYmFja0lzTWF0Y2hPclVuZGVmaW5lZChmZWVkYmFjazogc3RyaW5nIHwgdW5kZWZpbmVkLCBmZWVkYmFja0lkczogc3RyaW5nW10pOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHNsb3RJc1VuZGVmaW5lZE9yTWF0Y2goZmVlZGJhY2ssIGZlZWRiYWNrSWRzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZXN0IGlmIHRoZSBzbG90IHZhbHVlIG1hdGNoZXMgb25lIG9mIHRoZSBwcm92aWRlZCBpZGVudGlmaWVycywgb3IgaXMgdW5kZWZpbmVkLlxuICAgICAqIEBwYXJhbSBzbG90VmFsdWUgLSBTbG90IHZhbHVlIElEXG4gICAgICogQHBhcmFtIGV4cGVjdGVkVmFsdWVzIC0gU2xvdCB2YWx1ZSBJRHMgdG8gbWF0Y2ggYWdhaW5zdFxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiBzbG90SXNVbmRlZmluZWRPck1hdGNoKHNsb3RWYWx1ZTogc3RyaW5nIHwgdW5kZWZpbmVkLCBleHBlY3RlZFZhbHVlczogc3RyaW5nW10pOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHNsb3RWYWx1ZSA9PT0gdW5kZWZpbmVkIHx8IGV4cGVjdGVkVmFsdWVzLmluY2x1ZGVzKHNsb3RWYWx1ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVzdCBpZiB0aGUgYWN0aW9uIG1hdGNoZXMgb25lIG9mIHRoZSBwcm92aWRlZCBpZGVudGlmaWVycywgb3IgaXMgdW5kZWZpbmVkLlxuICAgICAqIEBwYXJhbSBhY3Rpb24gLSBBY3Rpb24gc2xvdCB2YWx1ZSBJRFxuICAgICAqIEBwYXJhbSBleHBlY3RlZFZhbHVlcyAtIEFjdGlvbiBzbG90IHZhbHVlIElEcyB0byBtYXRjaCBhZ2FpbnN0XG4gICAgICovXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGFjdGlvbklzU2V0T3JVbmRlZmluZWQoYWN0aW9uOiBzdHJpbmcgfCB1bmRlZmluZWQsIGV4cGVjdGVkVmFsdWVzOiBzdHJpbmdbXSk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gc2xvdElzVW5kZWZpbmVkT3JNYXRjaChhY3Rpb24sIGV4cGVjdGVkVmFsdWVzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZXN0IGlmIHRoZSBhY3Rpb24gaXMgZGVmaW5lZCBhbmQgbWF0Y2hlcyBvbmUgb2YgdGhlIHByb3ZpZGVkIGlkZW50aWZpZXJzLlxuICAgICAqIEBwYXJhbSBhY3Rpb24gLSBBY3Rpb24gc2xvdCB2YWx1ZSBJRFxuICAgICAqIEBwYXJhbSBleHBlY3RlZFZhbHVlcyAtIEFjdGlvbiBzbG90IHZhbHVlIElEcyB0byBtYXRjaCBhZ2FpbnN0XG4gICAgICovXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGFjdGlvbklzTWF0Y2goYWN0aW9uOiBzdHJpbmcgfCB1bmRlZmluZWQsIGV4cGVjdGVkVmFsdWVzOiBzdHJpbmdbXSk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gYWN0aW9uICE9PSB1bmRlZmluZWQgJiYgZXhwZWN0ZWRWYWx1ZXMuaW5jbHVkZXMoYWN0aW9uKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZXN0IGlmIHRoZSBhY3Rpb24gaXMgdW5kZWZpbmVkLlxuICAgICAqIEBwYXJhbSBhY3Rpb24gLSBBY3Rpb24gc2xvdCB2YWx1ZSBJRFxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiBhY3Rpb25Jc1VuZGVmaW5lZChhY3Rpb246IHN0cmluZyB8IHVuZGVmaW5lZCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gYWN0aW9uID09PSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVzdCBpZiB0aGUgdGFyZ2V0IGlzIGRlZmluZWQgYW5kIG1hdGNoZXMgb25lIG9mIHRoZSBwcm92aWRlZCBpZGVudGlmaWVycy5cbiAgICAgKiBAcGFyYW0gdGFyZ2V0IC0gVGFyZ2V0IHNsb3QgdmFsdWUgSURcbiAgICAgKiBAcGFyYW0gdGFyZ2V0SWRzIC0gVGFyZ2V0IHNsb3QgdmFsdWUgSURzIHRvIG1hdGNoIGFnYWluc3RcbiAgICAgKi9cbiAgICBleHBvcnQgZnVuY3Rpb24gdGFyZ2V0SXNNYXRjaCh0YXJnZXQ6IHN0cmluZyB8IHVuZGVmaW5lZCwgdGFyZ2V0SWRzOiBzdHJpbmdbXSk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGFyZ2V0ICE9PSB1bmRlZmluZWQgJiYgdGFyZ2V0SWRzLmluY2x1ZGVzKHRhcmdldCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVzdCBpZiB0aGUgZmVlZGJhY2sgaXMgdW5kZWZpbmVkLlxuICAgICAqIEBwYXJhbSB0YXJnZXQgLSBUYXJnZXQgc2xvdCB2YWx1ZSBJRFxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiB0YXJnZXRJc1VuZGVmaW5lZCh0YXJnZXQ6IHN0cmluZyB8IHVuZGVmaW5lZCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGFyZ2V0ID09PSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVzdCBpZiB0aGUgdGFyZ2V0IG1hdGNoZXMgb25lIG9mIHRoZSBwcm92aWRlZCBpZGVudGlmaWVycywgb3IgaXMgdW5kZWZpbmVkLlxuICAgICAqIEBwYXJhbSB0YXJnZXQgLSBUYXJnZXQgc2xvdCB2YWx1ZSBJRFxuICAgICAqIEBwYXJhbSB0YXJnZXRJZHMgLSBUYXJnZXQgc2xvdCB2YWx1ZSBJRHMgdG8gbWF0Y2ggYWdhaW5zdFxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiB0YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodGFyZ2V0OiBzdHJpbmcgfCB1bmRlZmluZWQsIHRhcmdldElkczogc3RyaW5nW10pOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHNsb3RJc1VuZGVmaW5lZE9yTWF0Y2godGFyZ2V0LCB0YXJnZXRJZHMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlc3QgaWYgdGhlIGFjdGlvbiBtYXRjaGVzIG9uZSBvZiB0aGUgcHJvdmlkZWQgaWRlbnRpZmllcnMsIG9yIGlzIHVuZGVmaW5lZC5cbiAgICAgKiBAcGFyYW0gYWN0aW9uIC0gQWN0aW9uIHNsb3QgdmFsdWUgSURcbiAgICAgKiBAcGFyYW0gZXhwZWN0ZWRWYWx1ZXMgLSBBY3Rpb24gc2xvdCB2YWx1ZSBJRHMgdG8gbWF0Y2ggYWdhaW5zdFxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiBhY3Rpb25Jc01hdGNoT3JVbmRlZmluZWQoYWN0aW9uOiBzdHJpbmcgfCB1bmRlZmluZWQsIGFjdGlvbklkczogc3RyaW5nW10pOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHNsb3RJc1VuZGVmaW5lZE9yTWF0Y2goYWN0aW9uLCBhY3Rpb25JZHMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlc3QgaWYgdGhlIHZhbHVlVHlwZSBpcyBkZWZpbmVkIGFuZCBtYXRjaGVzIHRoZSBwcm92aWRlZCBpZGVudGlmaWVyLlxuICAgICAqIEBwYXJhbSB2YWx1ZVR5cGUgLSBWYWx1ZVR5cGUgc2xvdCB2YWx1ZSBJRFxuICAgICAqIEBwYXJhbSBleHBlY3RlZFZhbHVlVHlwZSAtIFZhbHVlVHlwZSBzbG90IHZhbHVlIElEIHRvIG1hdGNoIGFnYWluc3RcbiAgICAgKi9cbiAgICBleHBvcnQgZnVuY3Rpb24gdmFsdWVUeXBlTWF0Y2godmFsdWVUeXBlOiBzdHJpbmcgfCB1bmRlZmluZWQsIGV4cGVjdGVkVmFsdWVUeXBlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlVHlwZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlVHlwZSA9PT0gZXhwZWN0ZWRWYWx1ZVR5cGU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVzdCBpZiB0aGUgdmFsdWVUeXBlIGlzIHVuZGVmaW5lZC5cbiAgICAgKiBAcGFyYW0gdmFsdWVUeXBlIC0gVmFsdWVUeXBlIHNsb3QgdmFsdWUgSURcbiAgICAgKi9cbiAgICBleHBvcnQgZnVuY3Rpb24gdmFsdWVUeXBlSXNVbmRlZmluZWQodmFsdWVUeXBlOiBzdHJpbmcgfCB1bmRlZmluZWQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlVHlwZSA9PT0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlc3QgaWYgdGhlIHZhbHVlIGlzIGRlZmluZWQuXG4gICAgICpcbiAgICAgKiBBIHZhbHVlIG9mICc/JyBpcyBpbnRlcnByZXRlZCBhcyBiZWluZyBlcXVhbCB0byB1bmRlZmluZWQuICAoQSB2YWx1ZSBvZlxuICAgICAqICc/JyBpcyBwcm9kdWNlZCBieSBOTFUgd2hlbiBzbG90IGVsaWNpdGF0aW9uIGlzIHVzZWQgYnV0IHRoZSByZXNwb25zZVxuICAgICAqIGNhbm5vdCBiZSB1bmRlcnN0b29kLilcbiAgICAgKiBAcGFyYW0gdmFsdWUgLSBWYWx1ZVxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiB2YWx1ZVN0ckRlZmluZWQodmFsdWU6IHN0cmluZyB8IHVuZGVmaW5lZCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gJz8nO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlc3QgaWYgdGhlIHZhbHVlIGlzIHVuZGVmaW5lZC5cbiAgICAgKlxuICAgICAqIEEgdmFsdWUgb2YgJz8nIGlzIGludGVycHJldGVkIGFzIGJlaW5nIGVxdWFsIHRvIHVuZGVmaW5lZC4gIChBIHZhbHVlIG9mXG4gICAgICogJz8nIGlzIHByb2R1Y2VkIGJ5IE5MVSB3aGVuIHNsb3QgZWxpY2l0YXRpb24gaXMgdXNlZCBidXQgdGhlIHJlc3BvbnNlXG4gICAgICogY2Fubm90IGJlIHVuZGVyc3Rvb2QuKVxuICAgICAqIEBwYXJhbSB2YWx1ZSAtIFZhbHVlXG4gICAgICovXG4gICAgZXhwb3J0IGZ1bmN0aW9uIHZhbHVlU3RySXNVbmRlZmluZWQodmFsdWU6IHN0cmluZyB8IHVuZGVmaW5lZCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gJz8nO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlc3QgaWYgdGhlIGlucHV0IGlzIGVxdWl2YWxlbnQgdG8gc2ltcGx5IHNheWluZyBcInllc1wiLlxuICAgICAqXG4gICAgICogQHBhcmFtIGlucHV0IC0gSW5wdXRcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHRydWUgaWYgdGhlIGlucHV0IGlzOlxuICAgICAqIC0gYEFNQVpPTi5ZZXNJbnRlbnRgLCBvcixcbiAgICAgKiAtIEEgYEdlbmVyYWxDb250cm9sSW50ZW50YCB3aXRoIGBmZWVkYmFjayA9IGJ1aWx0aW5fYWZmaXJtYCBhbmQgbm8gb3RoZXJcbiAgICAgKiAgIGZpbGxlZC5cbiAgICAgKi9cbiAgICBleHBvcnQgZnVuY3Rpb24gaXNCYXJlWWVzKGlucHV0OiBDb250cm9sSW5wdXQpIHtcbiAgICAgICAgaWYgKGlucHV0LnJlcXVlc3QudHlwZSAhPT0gJ0ludGVudFJlcXVlc3QnKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaW5wdXQucmVxdWVzdC5pbnRlbnQubmFtZSA9PT0gQW1hem9uSW50ZW50Llllc0ludGVudCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaW5wdXQucmVxdWVzdC5pbnRlbnQubmFtZSA9PT0gR2VuZXJhbENvbnRyb2xJbnRlbnQubmFtZSkge1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQgfSA9IHVucGFja0dlbmVyYWxDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBpZiAoZmVlZGJhY2sgPT09ICQuRmVlZGJhY2suQWZmaXJtICYmIGFjdGlvbiA9PT0gdW5kZWZpbmVkICYmIHRhcmdldCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlc3QgaWYgdGhlIGlucHV0IGlzIGVxdWl2YWxlbnQgdG8gc2ltcGx5IHNheWluZyBcIm5vXCIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBJbnB1dFxuICAgICAqXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGUgaW5wdXQgaXM6XG4gICAgICogLSBgQU1BWk9OLk5vSW50ZW50YCwgb3IsXG4gICAgICogLSBBIGBHZW5lcmFsQ29udHJvbEludGVudGAgd2l0aCBgZmVlZGJhY2sgPSBidWlsdGluX2Rpc2FmZmlybWAgYW5kIG5vIG90aGVyXG4gICAgICogICBmaWxsZWQuXG4gICAgICovXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGlzQmFyZU5vKGlucHV0OiBDb250cm9sSW5wdXQpIHtcbiAgICAgICAgaWYgKGlucHV0LnJlcXVlc3QudHlwZSAhPT0gJ0ludGVudFJlcXVlc3QnKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaW5wdXQucmVxdWVzdC5pbnRlbnQubmFtZSA9PT0gQW1hem9uSW50ZW50Lk5vSW50ZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpbnB1dC5yZXF1ZXN0LmludGVudC5uYW1lID09PSBHZW5lcmFsQ29udHJvbEludGVudC5uYW1lKSB7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCB9ID0gdW5wYWNrR2VuZXJhbENvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIGlmIChmZWVkYmFjayA9PT0gJC5GZWVkYmFjay5EaXNhZmZpcm0gJiYgYWN0aW9uID09PSB1bmRlZmluZWQgJiYgdGFyZ2V0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXh0cmFjdHMgdGhlIHZhbHVlIGFuZCBlck1hdGNoIGZyb20gYSBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnRcbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBJbnB1dFxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiBnZXRWYWx1ZVJlc29sdXRpb24oaW5wdXQ6IENvbnRyb2xJbnB1dCk6IHsgdmFsdWVTdHI6IHN0cmluZywgZXJNYXRjaDogYm9vbGVhbiB9IHtcbiAgICAgICAgY29uc3QgeyB2YWx1ZVN0ciwgZXJNYXRjaCB9ID0gdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgIHJldHVybiB7IHZhbHVlU3RyOiB2YWx1ZVN0ciEsIGVyTWF0Y2g6IGVyTWF0Y2ghIH07XG4gICAgfVxufVxuIl19