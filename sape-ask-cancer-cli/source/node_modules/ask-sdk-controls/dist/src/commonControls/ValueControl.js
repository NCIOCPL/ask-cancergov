"use strict";
/*
 * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.ValueControl = exports.ValueControlState = exports.ValueControlPromptProps = exports.ValueControlInteractionModelProps = void 0;
const tslib_1 = require("tslib");
const i18next_1 = tslib_1.__importDefault(require("i18next"));
const lodash_1 = tslib_1.__importDefault(require("lodash"));
const Strings_1 = require("../constants/Strings");
const Control_1 = require("../controls/Control");
const AmazonBuiltInSlotType_1 = require("../intents/AmazonBuiltInSlotType");
const GeneralControlIntent_1 = require("../intents/GeneralControlIntent");
const SingleValueControlIntent_1 = require("../intents/SingleValueControlIntent");
const Logger_1 = require("../logging/Logger");
const ContentActs_1 = require("../systemActs/ContentActs");
const InitiativeActs_1 = require("../systemActs/InitiativeActs");
const InputUtil_1 = require("../utils/InputUtil");
const Predicates_1 = require("../utils/Predicates");
const log = new Logger_1.Logger('AskSdkControls:ValueControl');
/**
 * Props associated with the interaction model.
 */
class ValueControlInteractionModelProps {
}
exports.ValueControlInteractionModelProps = ValueControlInteractionModelProps;
/**
 * Props to customize the prompt fragments that will be added by
 * `this.renderAct()`.
 */
class ValueControlPromptProps {
}
exports.ValueControlPromptProps = ValueControlPromptProps;
/**
 * State tracked by a ValueControl.
 */
class ValueControlState {
    constructor() {
        /**
         * Tracks whether the value has been explicitly confirmed by the user.
         */
        this.isValueConfirmed = false;
    }
}
exports.ValueControlState = ValueControlState;
/**
 * A Control that obtains a single value from the user.
 *
 * The type of value to obtain is defined by `this.slotType`.
 *
 * Capabilities:
 * - Request a value
 * - Change a value
 * - Validate the value
 * - Confirm the value
 *
 * Intents that can be handled:
 * - `GeneralControlIntent`: E.g. `"yes, update my name"`
 * - `{ValueType}_ValueControlIntent`: E.g. "no change it to Elvis".
 * - `AMAZON.YesIntent`, `AMAZON.NoIntent`
 */
class ValueControl extends Control_1.Control {
    constructor(props) {
        super(props.id);
        this.state = new ValueControlState();
        if (props.slotType === AmazonBuiltInSlotType_1.AmazonBuiltInSlotType.SEARCH_QUERY) {
            throw new Error('AMAZON.SearchQuery cannot be used with ValueControl due to the special rules regarding its use. '
                + 'Specifically, utterances that include SearchQuery must have a carrier phrase and not be comprised entirely of slot references. '
                + 'Use a custom intent to manage SearchQuery slots or create a regular slot for use with ValueControl.');
        }
        this.rawProps = props;
        this.props = ValueControl.mergeWithDefaultProps(props);
    }
    static mergeWithDefaultProps(props) {
        const defaults = {
            id: 'dummy',
            slotType: 'dummy',
            required: true,
            validation: [],
            confirmationRequired: false,
            interactionModel: {
                actions: {
                    set: [Strings_1.Strings.Action.Set],
                    change: [Strings_1.Strings.Action.Change],
                },
                targets: [Strings_1.Strings.Target.It]
            },
            prompts: {
                confirmValue: (act) => i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_CONFIRM_VALUE', { value: act.payload.value }),
                valueConfirmed: i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_VALUE_AFFIRMED'),
                valueDisconfirmed: i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_VALUE_DISAFFIRMED'),
                valueSet: (act) => i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_VALUE_SET', { value: act.payload.value }),
                valueChanged: (act) => i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_VALUE_CHANGED', { value: act.payload.value }),
                invalidValue: (act) => {
                    if (act.payload.renderedReason !== undefined) {
                        return i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_INVALID_VALUE_WITH_REASON', { value: act.payload.value, reason: act.payload.renderedReason });
                    }
                    return i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_GENERAL_INVALID_VALUE', { value: act.payload.value });
                },
                requestValue: () => i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_REQUEST_VALUE'),
                requestChangedValue: () => i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_REQUEST_CHANGED_VALUE'),
            },
            reprompts: {
                confirmValue: (act) => i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_CONFIRM_VALUE', { value: act.payload.value }),
                valueConfirmed: i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_VALUE_AFFIRMED'),
                valueDisconfirmed: i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_VALUE_DISAFFIRMED'),
                valueSet: (act) => i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_VALUE_SET', { value: act.payload.value }),
                valueChanged: (act) => i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_VALUE_CHANGED', { value: act.payload.value }),
                invalidValue: (act) => {
                    if (act.payload.renderedReason !== undefined) {
                        return i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_INVALID_VALUE_WITH_REASON', { value: act.payload.value, reason: act.payload.renderedReason });
                    }
                    return i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_GENERAL_INVALID_VALUE', { value: act.payload.value });
                },
                requestValue: () => i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_REQUEST_VALUE'),
                requestChangedValue: () => i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_REQUEST_CHANGED_VALUE'),
            }
        };
        return lodash_1.default.merge(defaults, props);
    }
    // tsDoc - see Control
    canHandle(input) {
        return this.isSetWithValue(input)
            || this.isChangeWithValue(input)
            || this.isSetWithoutValue(input)
            || this.isChangeWithoutValue(input)
            || this.isBareValue(input)
            || this.isConfirmationAffirmed(input)
            || this.isConfirmationDisaffirmed(input);
    }
    // tsDoc - see Control
    async handle(input, resultBuilder) {
        if (this.handleFunc === undefined) {
            log.error('ValueControl: handle called but this.handleFunc is not set. canHandle() should be called first to set this.handleFunc.');
            const intent = input.request.intent;
            throw new Error(`${intent.name} can not be handled by ${this.constructor.name}.`);
        }
        this.handleFunc(input, resultBuilder);
        if (resultBuilder.hasInitiativeAct() !== true && this.canTakeInitiative(input) === true) {
            await this.takeInitiative(input, resultBuilder);
        }
    }
    /**
     * Determine if the input is an implicit or explicit "set" with a value provided.
     *
     * Example utterance: "Set my name to Bob"
     *
     * @param input - Input
     */
    isSetWithValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, SingleValueControlIntent_1.SingleValueControlIntent.intentName(this.props.slotType)));
            const { feedback, action, target, valueStr, valueType } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueTypeMatch(valueType, this.props.slotType));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueStrDefined(valueStr));
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.set));
            this.handleFunc = this.handleSetWithValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    /**
     * Handle an implicit or explicit "set" with a value provided.
     *
     * @param input - Input
     * @param resultBuilder - ResultBuilder
     */
    handleSetWithValue(input, resultBuilder) {
        const { valueStr, erMatch } = InputUtil_1.InputUtil.getValueResolution(input);
        this.setValue(valueStr, erMatch);
        this.validateAndAddActs(input, resultBuilder, Strings_1.Strings.Action.Set);
        return;
    }
    /**
     * Determine if the input is an implicit or explicit "set" without a value.
     *
     * Example utterance: "Set my name"
     *
     * @param input - Input
     */
    isSetWithoutValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.set));
            this.handleFunc = this.handleSetWithoutValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    /**
     * Handle an implicit or explicit "set" without a value.
     *
     * @param input - Input
     * @param resultBuilder - Result builder
     */
    handleSetWithoutValue(input, resultBuilder) {
        this.askElicitationQuestion(input, resultBuilder, Strings_1.Strings.Action.Set);
        return;
    }
    /**
     * Determine if the input is "change" with a value provided.
     *
     * Example utterance: "Change my name to bob"
     *
     * @param input - Input
     */
    isChangeWithValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, SingleValueControlIntent_1.SingleValueControlIntent.intentName(this.props.slotType)));
            const { feedback, action, target, valueStr, valueType } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueTypeMatch(valueType, this.props.slotType));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueStrDefined(valueStr));
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.change));
            this.handleFunc = this.handleChangeWithValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    /**
     * Handle an implicit or explicit "change" with a value.
     *
     * @param input - Input
     * @param resultBuilder - Result builder
     */
    handleChangeWithValue(input, resultBuilder) {
        const { valueStr, erMatch } = InputUtil_1.InputUtil.getValueResolution(input);
        this.setValue(valueStr, erMatch);
        this.validateAndAddActs(input, resultBuilder, Strings_1.Strings.Action.Change);
        return;
    }
    /**
     * Determine if the input is "change" without a value.
     *
     * Example utterance: "Change my name"
     *
     * @param input - Input
     */
    isChangeWithoutValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.change));
            this.handleFunc = this.handleChangeWithoutValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    /**
     * Handle an implicit or explicit "change" without a value.
     *
     * @param input - Input
     * @param resultBuilder - Result builder
     */
    handleChangeWithoutValue(input, resultBuilder) {
        this.askElicitationQuestion(input, resultBuilder, Strings_1.Strings.Action.Change);
        return;
    }
    /**
     * Determine if the input is a value without any further information.
     *
     * Example utterance: 'Bob'
     *
     * Behavior:
     *  - If the control isn't actively asking a question, it assumes the user
     *    meant "set \{value\}".
     * @param input - Input
     */
    isBareValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, SingleValueControlIntent_1.SingleValueControlIntent.intentName(this.props.slotType)));
            const { feedback, action, target, valueStr, valueType } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsUndefined(feedback));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsUndefined(action));
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsUndefined(target));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueStrDefined(valueStr));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueTypeMatch(valueType, this.props.slotType));
            this.handleFunc = this.handleBareValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    /**
     * Handle a bare value.
     *
     * @param input - Input
     * @param resultBuilder - Result builder
     */
    handleBareValue(input, resultBuilder) {
        var _a;
        const { valueStr, erMatch } = InputUtil_1.InputUtil.getValueResolution(input);
        this.setValue(valueStr, erMatch);
        this.validateAndAddActs(input, resultBuilder, (_a = this.state.elicitationAction) !== null && _a !== void 0 ? _a : Strings_1.Strings.Action.Set);
        return;
    }
    /**
     * Determine if the input is an affirmation to an explicit confirmation question.
     *
     * Example dialog:
     * - 'A: Did you say Bob?'
     * - 'U: Yes.'
     *
     * @param input - Input
     */
    isConfirmationAffirmed(input) {
        try {
            /* TODO: feature: also handle "yes, {value}" for both expected and
             * unexpected values
             */
            Predicates_1.okIf(InputUtil_1.InputUtil.isBareYes(input));
            Predicates_1.okIf(this.state.activeInitiativeAct === 'ConfirmValueAct');
            this.handleFunc = this.handleConfirmationAffirmed;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    /**
     * Handle an affirmation to an explicit confirmation question.
     *
     * @param input - Input
     * @param resultBuilder - Result builder
     */
    handleConfirmationAffirmed(input, resultBuilder) {
        this.state.activeInitiativeAct = undefined;
        this.state.isValueConfirmed = true;
        this.state.activeInitiativeAct = undefined;
        resultBuilder.addAct(new ContentActs_1.ValueConfirmedAct(this, { value: this.state.value }));
    }
    /**
     * Determine if the input is an affirmation to an explicit confirmation question.
     *
     * Example dialog:
     * - 'A: Did you say Bob?'
     * - 'U: No.'
     *
     * @param input - Input
     */
    isConfirmationDisaffirmed(input) {
        try {
            /* TODO: feature: also handle "no, {value}" for both expected and
             * unexpected values
             */
            Predicates_1.okIf(InputUtil_1.InputUtil.isBareNo(input));
            Predicates_1.okIf(this.state.activeInitiativeAct === 'ConfirmValueAct');
            this.handleFunc = this.handleConfirmationDisaffirmed;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    /**
     * Handle a disaffirmation to an explicit confirmation question.
     *
     * @param input - Input
     * @param resultBuilder - Result builder
     */
    handleConfirmationDisaffirmed(input, resultBuilder) {
        this.state.isValueConfirmed = false;
        this.state.activeInitiativeAct = undefined;
        resultBuilder.addAct(new ContentActs_1.ValueDisconfirmedAct(this, { value: this.state.value }));
        resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
    }
    /**
     * Directly set the value.
     *
     * @param value - Value
     * @param erMatch - Whether the value is an ID defined for `this.slotType`
     * in the interaction model
     */
    setValue(value, erMatch = true) {
        this.state.previousValue = this.state.value;
        this.state.value = value;
        this.state.erMatch = erMatch;
        this.state.isValueConfirmed = false;
    }
    // TODO: naming: 'reset'?
    /**
     * Clear the state of this control.
     */
    clear() {
        this.state = new ValueControlState();
    }
    // tsDoc - see Control
    canTakeInitiative(input) {
        return this.wantsToConfirmValue(input)
            || this.wantsToFixInvalidValue(input)
            || this.wantsToElicitValue(input);
    }
    // tsDoc - see Control
    async takeInitiative(input, resultBuilder) {
        if (this.initiativeFunc === undefined) {
            const errorMsg = 'ValueControl: takeInitiative called but this.initiativeFunc is not set. canTakeInitiative() should be called first to set this.initiativeFunc.';
            log.error(errorMsg);
            throw new Error(errorMsg);
        }
        this.initiativeFunc(input, resultBuilder);
        return;
    }
    /**
     * Perform validation checks and add appropriate acts to the result.
     *
     * @param input - Input
     * @param resultBuilder - Result builder
     * @param elicitationAction - The type of elicitation question that has been
     * asked.
     */
    validateAndAddActs(input, resultBuilder, elicitationAction) {
        this.state.elicitationAction = elicitationAction;
        const validationResult = this.validate(input);
        if (typeof validationResult === 'boolean') {
            if (elicitationAction === Strings_1.Strings.Action.Change) {
                // if elicitationAction == 'change', then the previousValue must be defined.
                if (this.state.previousValue !== undefined) {
                    resultBuilder.addAct(new ContentActs_1.ValueChangedAct(this, { previousValue: this.state.previousValue, value: this.state.value }));
                }
                else {
                    throw new Error('ValueChangedAct should only be used if there is an actual previous value');
                }
            }
            else {
                resultBuilder.addAct(new ContentActs_1.ValueSetAct(this, { value: this.state.value }));
            }
        }
        else {
            // feedback
            resultBuilder.addAct(new ContentActs_1.InvalidValueAct(this, { value: this.state.value, reasonCode: validationResult.reasonCode, renderedReason: validationResult.renderedReason }));
            this.askElicitationQuestion(input, resultBuilder, elicitationAction);
        }
        return;
    }
    /**
     * Determine if the value is valid.
     *
     * @param input - Input.
     */
    validate(input) {
        const listOfValidationFunc = typeof (this.props.validation) === 'function' ? [this.props.validation] : this.props.validation;
        for (const validationFunction of listOfValidationFunc) {
            const validationResult = validationFunction(this.state, input);
            if (validationResult !== true) {
                log.debug(`ValueControl.validate(): validation failed. Reason: ${JSON.stringify(validationResult, null, 2)}.`);
                return validationResult;
            }
        }
        return true;
    }
    /**
     * Determine if the value needs to be explicitly confirmed
     *
     * @param input - Input
     */
    wantsToConfirmValue(input) {
        if (this.state.value !== undefined && this.state.isValueConfirmed === false && this.evaluateBooleanProp(this.props.confirmationRequired, input)) {
            this.initiativeFunc = this.confirmValue;
            return true;
        }
        return false;
    }
    /**
     * Ask the user to confirm the value.
     *
     * @param input - Input
     * @param resultBuilder - Result builder
     */
    confirmValue(input, resultBuilder) {
        this.state.activeInitiativeAct = 'ConfirmValueAct';
        resultBuilder.addAct(new InitiativeActs_1.ConfirmValueAct(this, { value: this.state.value }));
    }
    /**
     * Determine if the value needs to obtain a new value because the current
     * one is invalid.
     *
     * @param input - Input
     */
    wantsToFixInvalidValue(input) {
        if (this.state.value !== undefined && this.validate(input) !== true) {
            this.initiativeFunc = this.fixInvalidValue;
            return true;
        }
        return false;
    }
    /**
     * Ask the user to provide a new value because the current one is invalid.
     *
     * @param input - Input
     * @param resultBuilder - Result builder
     */
    fixInvalidValue(input, resultBuilder) {
        this.validateAndAddActs(input, resultBuilder, Strings_1.Strings.Action.Change);
    }
    /**
     * Determine if the value should be elicited.
     *
     * @param input - Input
     */
    wantsToElicitValue(input) {
        if (this.state.value === undefined && this.evaluateBooleanProp(this.props.required, input)) {
            this.initiativeFunc = this.elicitValue;
            return true;
        }
        return false;
    }
    /**
     * Ask the user to provide a value.
     *
     * @param input - Input
     * @param resultBuilder - Result builder
     */
    elicitValue(input, resultBuilder) {
        this.askElicitationQuestion(input, resultBuilder, Strings_1.Strings.Action.Set);
    }
    /**
     * Add an elicitation act to the result.
     *
     * @param input - Input
     * @param resultBuilder - Result builder
     * @param elicitationAction - The style of elicitation to use.
     */
    askElicitationQuestion(input, resultBuilder, elicitationAction) {
        this.state.elicitationAction = elicitationAction;
        switch (elicitationAction) {
            case Strings_1.Strings.Action.Set:
                resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
                return;
            case Strings_1.Strings.Action.Change:
                resultBuilder.addAct(new InitiativeActs_1.RequestChangedValueAct(this, { currentValue: this.state.value }));
                return;
            default:
                throw new Error(`Unhandled. Unknown elicitationAction: ${this.state.elicitationAction}`);
        }
    }
    // tsDoc - see ControlStateDiagramming
    stringifyStateForDiagram() {
        var _a;
        let text = (_a = this.state.value) !== null && _a !== void 0 ? _a : '<none>';
        if (this.state.elicitationAction !== undefined) {
            text += `[eliciting, ${this.state.elicitationAction}]`;
        }
        return text;
    }
    // tsDoc - see Control
    renderAct(act, input, builder) {
        if (act instanceof ContentActs_1.InvalidValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.invalidValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.invalidValue, input));
        }
        else if (act instanceof ContentActs_1.ValueSetAct) {
            // We must choose how to say the value.  The default is to assume that the Slot-type IDs are speakable.
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueSet, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueSet, input));
        }
        else if (act instanceof ContentActs_1.ValueChangedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueChanged, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueChanged, input));
        }
        else if (act instanceof InitiativeActs_1.RequestValueAct || act instanceof InitiativeActs_1.RequestChangedValueAct) {
            const prompt = act instanceof InitiativeActs_1.RequestValueAct ? this.props.prompts.requestValue : this.props.prompts.requestChangedValue;
            const reprompt = act instanceof InitiativeActs_1.RequestChangedValueAct ? this.props.reprompts.requestValue : this.props.reprompts.requestChangedValue;
            builder.addPromptFragment(this.evaluatePromptProp(act, prompt, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, reprompt, input));
            const slotElicitation = generateSlotElicitation(this.props.slotType);
            builder.addElicitSlotDirective(slotElicitation.slotName, slotElicitation.intent);
        }
        else if (act instanceof InitiativeActs_1.ConfirmValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.confirmValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.confirmValue, input));
        }
        else if (act instanceof ContentActs_1.ValueConfirmedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueConfirmed, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueConfirmed, input));
        }
        else if (act instanceof ContentActs_1.ValueDisconfirmedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueDisconfirmed, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueDisconfirmed, input));
        }
        else {
            this.throwUnhandledActError(act);
        }
    }
    // tsDoc - see Control
    updateInteractionModel(generator, imData) {
        generator.addControlIntent(new SingleValueControlIntent_1.SingleValueControlIntent(this.props.slotType), imData);
        generator.addControlIntent(new GeneralControlIntent_1.GeneralControlIntent(), imData);
        generator.addYesAndNoIntents();
    }
    // tsDoc - see InteractionModelContributor
    getTargetIds() {
        return this.props.interactionModel.targets;
    }
}
exports.ValueControl = ValueControl;
/**
 * Creates an elicit-slot directive for the provided slotType.
 *
 * - The intent specified is a `{slotType}_ValueControlIntent`
 * - The slot specified is the `slotType` slot.
 *
 * @param slotType - Slot type
 */
function generateSlotElicitation(slotType) {
    const intent = {
        // TODO: refactor: use SingleValueControlIntent.intentName
        name: `${slotType}_ValueControlIntent`.replace('.', '_'),
        slots: {
            slotType: { name: slotType, value: '', confirmationStatus: 'NONE' },
            feedback: { name: "feedback", value: '', confirmationStatus: 'NONE' },
            action: { name: "action", value: '', confirmationStatus: 'NONE' },
            target: { name: "target", value: '', confirmationStatus: 'NONE' },
            head: { name: "head", value: '', confirmationStatus: 'NONE' },
            tail: { name: "tail", value: '', confirmationStatus: 'NONE' },
            assign: { name: "assign", value: '', confirmationStatus: 'NONE' },
        },
        confirmationStatus: "NONE"
    };
    return {
        intent,
        slotName: slotType
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmFsdWVDb250cm9sLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NvbW1vbkNvbnRyb2xzL1ZhbHVlQ29udHJvbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7Ozs7QUFHSCw4REFBOEI7QUFDOUIsNERBQXVCO0FBQ3ZCLGtEQUFvRDtBQUNwRCxpREFBMEU7QUFNMUUsNEVBQXlFO0FBQ3pFLDBFQUFtRztBQUNuRyxrRkFBK0c7QUFHL0csOENBQTJDO0FBRTNDLDJEQUFtSTtBQUNuSSxpRUFBd0c7QUFJeEcsa0RBQStDO0FBQy9DLG9EQUErRDtBQUUvRCxNQUFNLEdBQUcsR0FBRyxJQUFJLGVBQU0sQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO0FBb0d0RDs7R0FFRztBQUNILE1BQWEsaUNBQWlDO0NBeUQ3QztBQXpERCw4RUF5REM7QUFFRDs7O0dBR0c7QUFDSCxNQUFhLHVCQUF1QjtDQVNuQztBQVRELDBEQVNDO0FBRUQ7O0dBRUc7QUFDSCxNQUFhLGlCQUFpQjtJQUE5QjtRQW9CSTs7V0FFRztRQUNILHFCQUFnQixHQUFZLEtBQUssQ0FBQztJQVd0QyxDQUFDO0NBQUE7QUFsQ0QsOENBa0NDO0FBRUQ7Ozs7Ozs7Ozs7Ozs7OztHQWVHO0FBQ0gsTUFBYSxZQUFhLFNBQVEsaUJBQU87SUFTckMsWUFBWSxLQUF3QjtRQUNoQyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBUnBCLFVBQUssR0FBc0IsSUFBSSxpQkFBaUIsRUFBRSxDQUFDO1FBVS9DLElBQUksS0FBSyxDQUFDLFFBQVEsS0FBSyw2Q0FBcUIsQ0FBQyxZQUFZLEVBQUM7WUFDdEQsTUFBTSxJQUFJLEtBQUssQ0FBQyxrR0FBa0c7a0JBQy9HLGlJQUFpSTtrQkFDakkscUdBQXFHLENBQUMsQ0FBQztTQUM3RztRQUVELElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ3RCLElBQUksQ0FBQyxLQUFLLEdB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RTtZQUNILFFBQVEsRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLEVBQUU7WUFDbkUsUUFBUSxFQUFFLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLGtCQUFrQixFQUFFLE1BQU0sRUFBRTtZQUNyRSxNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxFQUFFO1lBQ2pFLE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLEVBQUU7WUFDakUsSUFBSSxFQUFFLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLGtCQUFrQixFQUFFLE1BQU0sRUFBRTtZQUM3RCxJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxFQUFFO1lBQzdELE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLEVBQUU7U0FDcEU7UUFDRCxrQkFBa0IsRUFBRSxNQUFNO0tBQzdCLENBQUM7SUFFRixPQUFPO1FBQ0gsTUFBTTtRQUNOLFFBQVEsRUFBRSxRQUFRO0tBQ3JCLENBQUM7QUFDTixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAyMDIwIEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLlxuICogWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogb3IgaW4gdGhlIFwibGljZW5zZVwiIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkXG4gKiBvbiBhbiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXJcbiAqIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nXG4gKiBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgSW50ZW50LCBJbnRlbnRSZXF1ZXN0IH0gZnJvbSBcImFzay1zZGstbW9kZWxcIjtcbmltcG9ydCBpMThuZXh0IGZyb20gJ2kxOG5leHQnO1xuaW1wb3J0IF8gZnJvbSBcImxvZGFzaFwiO1xuaW1wb3J0IHsgU3RyaW5ncyBhcyAkIH0gZnJvbSBcIi4uL2NvbnN0YW50cy9TdHJpbmdzXCI7XG5pbXBvcnQgeyBDb250cm9sLCBDb250cm9sUHJvcHMsIENvbnRyb2xTdGF0ZSB9IGZyb20gJy4uL2NvbnRyb2xzL0NvbnRyb2wnO1xuaW1wb3J0IHsgQ29udHJvbElucHV0IH0gZnJvbSAnLi4vY29udHJvbHMvQ29udHJvbElucHV0JztcbmltcG9ydCB7IENvbnRyb2xSZXN1bHRCdWlsZGVyIH0gZnJvbSAnLi4vY29udHJvbHMvQ29udHJvbFJlc3VsdCc7XG5pbXBvcnQgeyBDb250cm9sU3RhdGVEaWFncmFtbWluZyB9IGZyb20gJy4uL2NvbnRyb2xzL21peGlucy9Db250cm9sU3RhdGVEaWFncmFtbWluZyc7XG5pbXBvcnQgeyBJbnRlcmFjdGlvbk1vZGVsQ29udHJpYnV0b3IgfSBmcm9tICcuLi9jb250cm9scy9taXhpbnMvSW50ZXJhY3Rpb25Nb2RlbENvbnRyaWJ1dG9yJztcbmltcG9ydCB7IFZhbGlkYXRpb25SZXN1bHQgfSBmcm9tICcuLi9jb250cm9scy9WYWxpZGF0aW9uUmVzdWx0JztcbmltcG9ydCB7IEFtYXpvbkJ1aWx0SW5TbG90VHlwZSB9IGZyb20gJy4uL2ludGVudHMvQW1hem9uQnVpbHRJblNsb3RUeXBlJztcbmltcG9ydCB7IEdlbmVyYWxDb250cm9sSW50ZW50LCB1bnBhY2tHZW5lcmFsQ29udHJvbEludGVudCB9IGZyb20gJy4uL2ludGVudHMvR2VuZXJhbENvbnRyb2xJbnRlbnQnO1xuaW1wb3J0IHsgU2luZ2xlVmFsdWVDb250cm9sSW50ZW50LCB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQgfSBmcm9tICcuLi9pbnRlbnRzL1NpbmdsZVZhbHVlQ29udHJvbEludGVudCc7XG5pbXBvcnQgeyBDb250cm9sSW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvciB9IGZyb20gJy4uL2ludGVyYWN0aW9uTW9kZWxHZW5lcmF0aW9uL0NvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yJztcbmltcG9ydCB7IE1vZGVsRGF0YSB9IGZyb20gJy4uL2ludGVyYWN0aW9uTW9kZWxHZW5lcmF0aW9uL01vZGVsVHlwZXMnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSBcIi4uL2xvZ2dpbmcvTG9nZ2VyXCI7XG5pbXBvcnQgeyBDb250cm9sUmVzcG9uc2VCdWlsZGVyIH0gZnJvbSAnLi4vcmVzcG9uc2VHZW5lcmF0aW9uL0NvbnRyb2xSZXNwb25zZUJ1aWxkZXInO1xuaW1wb3J0IHsgSW52YWxpZFZhbHVlQWN0LCBWYWx1ZUNoYW5nZWRBY3QsIFZhbHVlQ29uZmlybWVkQWN0LCBWYWx1ZURpc2NvbmZpcm1lZEFjdCwgVmFsdWVTZXRBY3QgfSBmcm9tIFwiLi4vc3lzdGVtQWN0cy9Db250ZW50QWN0c1wiO1xuaW1wb3J0IHsgQ29uZmlybVZhbHVlQWN0LCBSZXF1ZXN0Q2hhbmdlZFZhbHVlQWN0LCBSZXF1ZXN0VmFsdWVBY3QgfSBmcm9tIFwiLi4vc3lzdGVtQWN0cy9Jbml0aWF0aXZlQWN0c1wiO1xuaW1wb3J0IHsgU3lzdGVtQWN0IH0gZnJvbSAnLi4vc3lzdGVtQWN0cy9TeXN0ZW1BY3QnO1xuaW1wb3J0IHsgU3RyaW5nT3JMaXN0IH0gZnJvbSAnLi4vdXRpbHMvQmFzaWNUeXBlcyc7XG5pbXBvcnQgeyBEZWVwUmVxdWlyZWQgfSBmcm9tICcuLi91dGlscy9EZWVwUmVxdWlyZWQnO1xuaW1wb3J0IHsgSW5wdXRVdGlsIH0gZnJvbSBcIi4uL3V0aWxzL0lucHV0VXRpbFwiO1xuaW1wb3J0IHsgZmFsc2VJZkd1YXJkRmFpbGVkLCBva0lmIH0gZnJvbSAnLi4vdXRpbHMvUHJlZGljYXRlcyc7XG5cbmNvbnN0IGxvZyA9IG5ldyBMb2dnZXIoJ0Fza1Nka0NvbnRyb2xzOlZhbHVlQ29udHJvbCcpO1xuXG4vKipcbiAqIFByb3BzIGZvciBhIFZhbHVlQ29udHJvbC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBWYWx1ZUNvbnRyb2xQcm9wcyBleHRlbmRzIENvbnRyb2xQcm9wcyB7XG5cbiAgICAvKipcbiAgICAgKiBVbmlxdWUgaWRlbnRpZmllciBmb3IgY29udHJvbCBpbnN0YW5jZVxuICAgICAqL1xuICAgIGlkOiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBTbG90IHR5cGUgZm9yIHRoZSB2YWx1ZSB0aGF0IHRoaXMgY29udHJvbCBjb2xsZWN0cy5cbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqIC0gVGhlIHNsb3QgdHlwZSBkZWZpbmVzIHRoZSBzZXQgb2YgZXhwZWN0ZWQgdmFsdWUgaXRlbXMuXG4gICAgICogLSBOTFUgd2lsbCwgb24gb2NjYXNpb24sIGFjY2VwdCBub3ZlbCBzbG90IHZhbHVlIGFuZCBtYXJrIHRoZW0gYXNcbiAgICAgKiAgIEVSX05PX01BVENILiAgSWYgeW91IG9ubHkgd2FudCB0byBhY2NlcHQgdmFsdWVzIHRoYXQgYXJlIGV4cGxpY2l0bHlcbiAgICAgKiAgIGRlZmluZWQgYWRkIGEgdmFsaWRhdGlvbiBmdW5jdGlvbiB0byB0ZXN0IGB0aGlzLnN0YXRlLmVyTWF0Y2hgXG4gICAgICovXG4gICAgc2xvdFR5cGU6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uKHMpIHRoYXQgZGV0ZXJtaW5lIGlmIHRoZSB2YWx1ZSBpcyB2YWxpZC5cbiAgICAgKlxuICAgICAqIERlZmF1bHQ6IGB0cnVlYCwgaS5lLiBhbnkgdmFsdWUgaXMgdmFsaWQuXG4gICAgICpcbiAgICAgKiBVc2FnZTpcbiAgICAgKiAtIFZhbGlkYXRpb24gZnVuY3Rpb25zIHJldHVybiBlaXRoZXIgYHRydWVgIG9yIGEgYFZhbGlkYXRpb25SZXN1bHRgIHRvXG4gICAgICogICBkZXNjcmliZSB3aGF0IHZhbGlkYXRpb24gZmFpbGVkLlxuICAgICAqL1xuICAgIHZhbGlkYXRpb24/OiBTbG90VmFsaWRhdGlvbkZ1bmN0aW9uIHwgU2xvdFZhbGlkYXRpb25GdW5jdGlvbltdO1xuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyBpZiB0aGUgQ29udHJvbCBtdXN0IG9idGFpbiBhIHZhbHVlLlxuICAgICAqXG4gICAgICogSWYgYHRydWVgOlxuICAgICAqICAtIHRoZSBDb250cm9sIHJlcG9ydCBpc1JlYWR5KCkgPSBmYWxzZSBpZiBubyB2YWx1ZSBoYXMgYmVlbiBvYnRhaW5lZC5cbiAgICAgKiAgLSB0aGUgY29udHJvbCB3aWxsIHRha2UgdGhlIGluaXRpYXRpdmUgd2hlbiBnaXZlbiB0aGUgb3Bwb3J0dW5pdHkuXG4gICAgICovXG4gICAgcmVxdWlyZWQ/OiBib29sZWFuIHwgKChpbnB1dDogQ29udHJvbElucHV0KSA9PiBib29sZWFuKTtcblxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdGhlIENvbnRyb2wgaGFzIHRvIG9idGFpbiBleHBsaWNpdCBjb25maXJtYXRpb24gb2YgdGhlIHZhbHVlLlxuICAgICAqXG4gICAgICogSWYgYHRydWVgOlxuICAgICAqICAtIHRoZSBDb250cm9sIHdpbGwgcmVwb3J0IGBpc1JlYWR5KCkgPSBmYWxzZWAgaWYgdGhlIHZhbHVlIGhhcyBub3QgYmVlblxuICAgICAqICAgIGV4cGxpY2l0bHkgY29uZmlybWVkIGFzIGNvcnJlY3QgYnkgdXNlci5cbiAgICAgKiAgLSB0aGUgQ29udHJvbCB3aWxsIHRha2UgdGhlIGluaXRpYXRpdmUgd2hlbiBnaXZlbiB0aGUgb3Bwb3J0dW5pdHkuXG4gICAgICovXG4gICAgY29uZmlybWF0aW9uUmVxdWlyZWQ/OiBib29sZWFuIHwgKChpbnB1dDogQ29udHJvbElucHV0KSA9PiBib29sZWFuKTtcblxuICAgIC8qKlxuICAgICAqIFByb3BzIHRvIGN1c3RvbWl6ZSB0aGUgcHJvbXB0IGZyYWdtZW50cyB0aGF0IHdpbGwgYmUgYWRkZWQgYnlcbiAgICAgKiBgdGhpcy5yZW5kZXJBY3QoKWAuXG4gICAgICovXG4gICAgcHJvbXB0cz86IFZhbHVlQ29udHJvbFByb21wdFByb3BzO1xuXG4gICAgLyoqXG4gICAgICogUHJvcHMgdG8gY3VzdG9taXplIHRoZSByZXByb21wdCBmcmFnbWVudHMgdGhhdCB3aWxsIGJlIGFkZGVkIGJ5XG4gICAgICogYHRoaXMucmVuZGVyQWN0KClgLlxuICAgICAqL1xuICAgIHJlcHJvbXB0cz86IFZhbHVlQ29udHJvbFByb21wdFByb3BzO1xuXG4gICAgLyoqXG4gICAgICogUHJvcHMgdG8gY3VzdG9taXplIHRoZSByZWxhdGlvbnNoaXAgYmV0d2VlbiB0aGUgY29udHJvbCBhbmQgdGhlXG4gICAgICogaW50ZXJhY3Rpb24gbW9kZWwuXG4gICAgICovXG4gICAgaW50ZXJhY3Rpb25Nb2RlbD86IFZhbHVlQ29udHJvbEludGVyYWN0aW9uTW9kZWxQcm9wcztcbn1cblxuLyoqXG4gKiBWYWx1ZUNvbnRyb2wgdmFsaWRhdGlvbiBmdW5jdGlvblxuICovXG5leHBvcnQgdHlwZSBTbG90VmFsaWRhdGlvbkZ1bmN0aW9uID0gKHN0YXRlOiBWYWx1ZUNvbnRyb2xTdGF0ZSwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gdHJ1ZSB8IFZhbGlkYXRpb25SZXN1bHQ7XG5cbi8qKlxuICogTWFwcGluZyBvZiBhY3Rpb24gc2xvdCB2YWx1ZXMgdG8gdGhlIGJlaGF2aW9ycyB0aGF0IHRoaXMgY29udHJvbCBzdXBwb3J0cy5cbiAqXG4gKiBCZWhhdmlvcjpcbiAqIC0gVGhpcyBjb250cm9sIHdpbGwgbm90IGhhbmRsZSBhbiBpbnB1dCBpZiB0aGUgYWN0aW9uLXNsb3QgaXMgZmlsbGVkIHdpdGggYW5cbiAqICAgdmFsdWUgd2hvc2UgSUQgaXMgbm90IGFzc29jaWF0ZWQgd2l0aCBhIGNhcGFiaWxpdHkuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVmFsdWVDb250cm9sQWN0aW9uUHJvcHMge1xuICAgIC8qKlxuICAgICAqIEFjdGlvbiBzbG90IHZhbHVlIElEcyB0aGF0IGFyZSBhc3NvY2lhdGVkIHdpdGggdGhlIFwic2V0IHZhbHVlXCIgY2FwYWJpbGl0eS5cbiAgICAgKlxuICAgICAqIERlZmF1bHQ6IFsnYnVpbHRpbl9zZXQnXVxuICAgICAqL1xuICAgIHNldD86IHN0cmluZ1tdLFxuXG4gICAgLyoqXG4gICAgICogQWN0aW9uIHNsb3QgdmFsdWUgSURzIHRoYXQgYXJlIGFzc29jaWF0ZWQgd2l0aCB0aGUgXCJjaGFuZ2UgdmFsdWVcIiBjYXBhYmlsaXR5LlxuICAgICAqXG4gICAgICogRGVmYXVsdCBbJ2J1aWx0aW5fY2hhbmdlJ11cbiAgICAgKi9cbiAgICBjaGFuZ2U/OiBzdHJpbmdbXVxufVxuXG4vKipcbiAqIFByb3BzIGFzc29jaWF0ZWQgd2l0aCB0aGUgaW50ZXJhY3Rpb24gbW9kZWwuXG4gKi9cbmV4cG9ydCBjbGFzcyBWYWx1ZUNvbnRyb2xJbnRlcmFjdGlvbk1vZGVsUHJvcHMge1xuICAgIC8qKlxuICAgICAqIFRhcmdldC1zbG90IHZhbHVlcyBhc3NvY2lhdGVkIHdpdGggdGhpcyBDb250cm9sLlxuICAgICAqXG4gICAgICogVGFyZ2V0cyBhc3NvY2lhdGUgdXR0ZXJhbmNlcyB0byBhIGNvbnRyb2wuIEZvciBleGFtcGxlLCBpZiB0aGUgdXNlciBzYXlzXG4gICAgICogXCJjaGFuZ2UgdGhlIHRpbWVcIiwgaXQgaXMgcGFyc2VkIGFzIGEgYEdlbmVyYWxDb250cm9sSW50ZW50YCB3aXRoIHNsb3RcbiAgICAgKiB2YWx1ZXMgYGFjdGlvbiA9IGNoYW5nZWAgYW5kIGB0YXJnZXQgPSB0aW1lYC4gIE9ubHkgY29udHJvbHMgdGhhdCBhcmVcbiAgICAgKiByZWdpc3RlcmVkIHdpdGggdGhlIGB0aW1lYCB0YXJnZXQgc2hvdWxkIG9mZmVyIHRvIGhhbmRsZSB0aGlzIGludGVudC5cbiAgICAgKlxuICAgICAqIERlZmF1bHQ6IFsnYnVpbHRpbl9pdCddXG4gICAgICpcbiAgICAgKiBVc2FnZTpcbiAgICAgKiAtIElmIHRoaXMgcHJvcCBpcyBkZWZpbmVkLCBpdCByZXBsYWNlcyB0aGUgZGVmYXVsdDsgaXQgaXMgbm90IGFkZGl0aXZlXG4gICAgICogICB0aGUgZGVmYXVsdHMuICBUbyBhZGQgYW4gYWRkaXRpb25hbCB0YXJnZXQgdG8gdGhlIGRlZmF1bHRzLCBjb3B5IHRoZVxuICAgICAqICAgZGVmYXVsdHMgYW5kIGFtZW5kLlxuICAgICAqIC0gQSBjb250cm9sIGNhbiBiZSBhc3NvY2lhdGVkIHdpdGggbWFueSB0YXJnZXQtc2xvdC12YWx1ZXMsIGVnIFsnZGF0ZScsXG4gICAgICogICAnc3RhcnREYXRlJywgJ2V2ZW50U3RhcnREYXRlJywgJ3ZhY2F0aW9uU3RhcnQnXVxuICAgICAqIC0gSXQgaXMgYSBnb29kIGlkZWEgdG8gYXNzb2NpYXRlIHdpdGggZ2VuZXJhbCB0YXJnZXRzIChlLmcuIGRhdGUpIGFuZFxuICAgICAqICAgYWxzbyB3aXRoIHNwZWNpZmljIHRhcmdldHMgKGUuZy4gdmFjYXRpb25TdGFydCkgc28gdGhhdCB0aGUgdXNlciBjYW5cbiAgICAgKiAgIHNheSBlaXRoZXIgZ2VuZXJhbCBvciBzcGVjaWZpYyB0aGluZ3MuICBlLmcuICdjaGFuZ2UgdGhlIGRhdGUgdG9cbiAgICAgKiAgIFR1ZXNkYXknLCBvciAnSSB3YW50IG15IHZhY2F0aW9uIHRvIHN0YXJ0IG9uIFR1ZXNkYXknLlxuICAgICAqIC0gVGhlIGFzc29jaWF0aW9uIGRvZXMgbm90IGhhdmUgdG8gYmUgZXhjbHVzaXZlLCBhbmQgZ2VuZXJhbCB0YXJnZXQgc2xvdFxuICAgICAqICAgdmFsdWVzIHdpbGwgb2Z0ZW4gYmUgYXNzb2NpYXRlZCB3aXRoIG1hbnkgY29udHJvbHMuIEluIHNpdHVhdGlvbnMgd2hlcmVcbiAgICAgKiAgIHRoZXJlIGlzIGFtYmlndWl0eSBhYm91dCB3aGF0IHRoZSB1c2VyIGlzIHJlZmVycmluZyB0bywgdGhlIHBhcmVudFxuICAgICAqICAgY29udHJvbHMgbXVzdCByZXNvbHZlIHRoZSBjb25mdXNpb24uXG4gICAgICogLSBUaGUgJ2J1aWx0aW5fKicgSURzIGFyZSBhc3NvY2lhdGVkIHdpdGggZGVmYXVsdCBpbnRlcmFjdGlvbiBtb2RlbCBkYXRhXG4gICAgICogICAod2hpY2ggY2FuIGJlIGV4dGVuZGVkIGFzIGRlc2lyZWQpLiBBbnkgb3RoZXIgSURzIHdpbGwgcmVxdWlyZSBhIGZ1bGxcbiAgICAgKiAgIGRlZmluaXRpb24gb2YgdGhlIGFsbG93ZWQgc3lub255bXMgaW4gdGhlIGludGVyYWN0aW9uIG1vZGVsLlxuICAgICAqXG4gICAgICogQ29udHJvbCBiZWhhdmlvcjpcbiAgICAgKiAtIEEgY29udHJvbCB3aWxsIG5vdCBoYW5kbGUgYW4gaW5wdXQgdGhhdCBtZW50aW9ucyBhIHRhcmdldCB0aGF0IGlzIG5vdFxuICAgICAqICAgcmVnaXN0ZXJlZCBieSB0aGlzIHByb3AuXG4gICAgICpcbiAgICAgKi9cbiAgICB0YXJnZXRzPzogc3RyaW5nW107XG5cbiAgICAvKipcbiAgICAgKiBBY3Rpb24gc2xvdC12YWx1ZXMgYXNzb2NpYXRlZCB0byB0aGUgY29udHJvbCdzIGNhcGFiaWxpdGllcy5cbiAgICAgKlxuICAgICAqIEFjdGlvbiBzbG90LXZhbHVlcyBhc3NvY2lhdGUgdXR0ZXJhbmNlcyB0byBhIGNvbnRyb2wuIEZvciBleGFtcGxlLCBpZiB0aGVcbiAgICAgKiB1c2VyIHNheXMgXCJjaGFuZ2UgdGhlIHRpbWVcIiwgaXQgaXMgcGFyc2VkIGFzIGEgYEdlbmVyYWxDb250cm9sSW50ZW50YFxuICAgICAqIHdpdGggc2xvdCB2YWx1ZXMgYGFjdGlvbiA9IGNoYW5nZWAgYW5kIGB0YXJnZXQgPSB0aW1lYC4gIE9ubHkgY29udHJvbHNcbiAgICAgKiB0aGF0IGFyZSByZWdpc3RlcmVkIHdpdGggdGhlIGBjaGFuZ2VgIGFjdGlvbiBzaG91bGQgb2ZmZXIgdG8gaGFuZGxlIHRoaXNcbiAgICAgKiBpbnRlbnQuXG4gICAgICpcbiAgICAgKiBVc2FnZTpcbiAgICAgKiAgLSBUaGlzIGFsbG93cyB1c2VycyB0byByZWZlciB0byBhbiBhY3Rpb24gdXNpbmcgbW9yZSBkb21haW4tYXBwcm9wcmlhdGVcbiAgICAgKiAgICB3b3Jkcy4gRm9yIGV4YW1wbGUsIGEgdXNlciBtaWdodCBsaWtlIHRvIHNheSAnc2hvdyB0d28gaXRlbXMnIHJhdGhlclxuICAgICAqICAgIHRoYXQgJ3NldCBpdGVtIGNvdW50IHRvIHR3bycuICBUbyBhY2hpZXZlIHRoaXMsIGluY2x1ZGUgdGhlXG4gICAgICogICAgc2xvdC12YWx1ZS1pZCAnc2hvdycgaW4gdGhlIGxpc3QgYXNzb2NpYXRlZCB3aXRoIHRoZSAnc2V0JyBjYXBhYmlsaXR5XG4gICAgICogICAgYW5kIGVuc3VyZSB0aGUgaW50ZXJhY3Rpb24tbW9kZWwgaW5jbHVkZXMgYW4gYWN0aW9uIHNsb3QgdmFsdWUgd2l0aFxuICAgICAqICAgIGlkPXNob3cgYW5kIGFwcHJvcHJpYXRlIHN5bm9ueW1zLlxuICAgICAqICAtIFRoZSAnYnVpbHRpbl8qJyBJRHMgYXJlIGFzc29jaWF0ZWQgd2l0aCBkZWZhdWx0IGludGVyYWN0aW9uIG1vZGVsIGRhdGFcbiAgICAgKiAgICAod2hpY2ggY2FuIGJlIGV4dGVuZGVkIGFzIGRlc2lyZWQpLiBBbnkgb3RoZXIgSURzIHdpbGwgcmVxdWlyZSBhIGZ1bGxcbiAgICAgKiAgICBkZWZpbml0aW9uIG9mIHRoZSBhbGxvd2VkIHN5bm9ueW1zIGluIHRoZSBpbnRlcmFjdGlvbiBtb2RlbC5cbiAgICAgKi9cbiAgICBhY3Rpb25zPzogVmFsdWVDb250cm9sQWN0aW9uUHJvcHM7XG59XG5cbi8qKlxuICogUHJvcHMgdG8gY3VzdG9taXplIHRoZSBwcm9tcHQgZnJhZ21lbnRzIHRoYXQgd2lsbCBiZSBhZGRlZCBieVxuICogYHRoaXMucmVuZGVyQWN0KClgLlxuICovXG5leHBvcnQgY2xhc3MgVmFsdWVDb250cm9sUHJvbXB0UHJvcHMge1xuICAgIHZhbHVlU2V0PzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IFZhbHVlU2V0QWN0PGFueT4sIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG4gICAgdmFsdWVDaGFuZ2VkPzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IFZhbHVlQ2hhbmdlZEFjdDxhbnk+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIGludmFsaWRWYWx1ZT86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBJbnZhbGlkVmFsdWVBY3Q8YW55PiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICByZXF1ZXN0VmFsdWU/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogUmVxdWVzdFZhbHVlQWN0LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIHJlcXVlc3RDaGFuZ2VkVmFsdWU/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogUmVxdWVzdENoYW5nZWRWYWx1ZUFjdCwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICBjb25maXJtVmFsdWU/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogQ29uZmlybVZhbHVlQWN0PGFueT4sIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG4gICAgdmFsdWVEaXNjb25maXJtZWQ/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogVmFsdWVEaXNjb25maXJtZWRBY3Q8YW55PiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICB2YWx1ZUNvbmZpcm1lZD86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBWYWx1ZUNvbmZpcm1lZEFjdDxhbnk+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xufVxuXG4vKipcbiAqIFN0YXRlIHRyYWNrZWQgYnkgYSBWYWx1ZUNvbnRyb2wuXG4gKi9cbmV4cG9ydCBjbGFzcyBWYWx1ZUNvbnRyb2xTdGF0ZSBpbXBsZW1lbnRzIENvbnRyb2xTdGF0ZSB7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgdmFsdWUuXG4gICAgICpcbiAgICAgKiBJZiBgZXJNYXRjaCA9IHRydWVgIHRoZSB2YWx1ZSBpcyBhIHNsb3QgdmFsdWUgSUQgZm9yIHRoZSBzbG90IHR5cGUgYHRoaXMuc2xvdFR5cGVgLlxuICAgICAqIElmIGBlck1hdGNoID0gZmFsc2VgIHRoZSB2YWx1ZSBtYXkgYmUgYW4gYXJiaXRyYXJ5IHN0cmluZy5cbiAgICAgKi9cbiAgICB2YWx1ZT86IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFRyYWNrcyB3aGV0aGVyIHRoZSB2YWx1ZSBpcyBhbiBFbnRpdHkgUmVzb2x1dGlvbiBtYXRjaC5cbiAgICAgKi9cbiAgICBlck1hdGNoPzogYm9vbGVhbjtcblxuICAgIC8qKlxuICAgICAqIFRyYWNrcyBpZiB0aGUgY29udHJvbCBpcyBhY3RpdmVseSBhc2tpbmcgdGhlIHVzZXIgdG8gc2V0IG9yIGNoYW5nZSB0aGUgdmFsdWUuXG4gICAgICovXG4gICAgZWxpY2l0YXRpb25BY3Rpb24/OiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBUcmFja3Mgd2hldGhlciB0aGUgdmFsdWUgaGFzIGJlZW4gZXhwbGljaXRseSBjb25maXJtZWQgYnkgdGhlIHVzZXIuXG4gICAgICovXG4gICAgaXNWYWx1ZUNvbmZpcm1lZDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyoqXG4gICAgICogVGhlIHByZXZpb3VzIHZhbHVlLlxuICAgICAqL1xuICAgIHByZXZpb3VzVmFsdWU/OiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBUcmFja3MgdGhlIGxhc3QgaW5pdGlhdGl2ZSBhY3QgZnJvbSB0aGUgY29udHJvbFxuICAgICAqL1xuICAgIGFjdGl2ZUluaXRpYXRpdmVBY3Q/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogQSBDb250cm9sIHRoYXQgb2J0YWlucyBhIHNpbmdsZSB2YWx1ZSBmcm9tIHRoZSB1c2VyLlxuICpcbiAqIFRoZSB0eXBlIG9mIHZhbHVlIHRvIG9idGFpbiBpcyBkZWZpbmVkIGJ5IGB0aGlzLnNsb3RUeXBlYC5cbiAqXG4gKiBDYXBhYmlsaXRpZXM6XG4gKiAtIFJlcXVlc3QgYSB2YWx1ZVxuICogLSBDaGFuZ2UgYSB2YWx1ZVxuICogLSBWYWxpZGF0ZSB0aGUgdmFsdWVcbiAqIC0gQ29uZmlybSB0aGUgdmFsdWVcbiAqXG4gKiBJbnRlbnRzIHRoYXQgY2FuIGJlIGhhbmRsZWQ6XG4gKiAtIGBHZW5lcmFsQ29udHJvbEludGVudGA6IEUuZy4gYFwieWVzLCB1cGRhdGUgbXkgbmFtZVwiYFxuICogLSBge1ZhbHVlVHlwZX1fVmFsdWVDb250cm9sSW50ZW50YDogRS5nLiBcIm5vIGNoYW5nZSBpdCB0byBFbHZpc1wiLlxuICogLSBgQU1BWk9OLlllc0ludGVudGAsIGBBTUFaT04uTm9JbnRlbnRgXG4gKi9cbmV4cG9ydCBjbGFzcyBWYWx1ZUNvbnRyb2wgZXh0ZW5kcyBDb250cm9sIGltcGxlbWVudHMgSW50ZXJhY3Rpb25Nb2RlbENvbnRyaWJ1dG9yLCBDb250cm9sU3RhdGVEaWFncmFtbWluZyB7XG5cbiAgICBzdGF0ZTogVmFsdWVDb250cm9sU3RhdGUgPSBuZXcgVmFsdWVDb250cm9sU3RhdGUoKTtcblxuICAgIHByaXZhdGUgcmF3UHJvcHM6IFZhbHVlQ29udHJvbFByb3BzO1xuICAgIHByaXZhdGUgcHJvcHM6IERlZXBSZXF1aXJlZDxWYWx1ZUNvbnRyb2xQcm9wcz47XG4gICAgcHJpdmF0ZSBoYW5kbGVGdW5jPzogKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKSA9PiB2b2lkO1xuICAgIHByaXZhdGUgaW5pdGlhdGl2ZUZ1bmM/OiAoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpID0+IHZvaWQ7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogVmFsdWVDb250cm9sUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMuaWQpO1xuXG4gICAgICAgIGlmIChwcm9wcy5zbG90VHlwZSA9PT0gQW1hem9uQnVpbHRJblNsb3RUeXBlLlNFQVJDSF9RVUVSWSl7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FNQVpPTi5TZWFyY2hRdWVyeSBjYW5ub3QgYmUgdXNlZCB3aXRoIFZhbHVlQ29udHJvbCBkdWUgdG8gdGhlIHNwZWNpYWwgcnVsZXMgcmVnYXJkaW5nIGl0cyB1c2UuICdcbiAgICAgICAgICAgICArICdTcGVjaWZpY2FsbHksIHV0dGVyYW5jZXMgdGhhdCBpbmNsdWRlIFNlYXJjaFF1ZXJ5IG11c3QgaGF2ZSBhIGNhcnJpZXIgcGhyYXNlIGFuZCBub3QgYmUgY29tcHJpc2VkIGVudGlyZWx5IG9mIHNsb3QgcmVmZXJlbmNlcy4gJ1xuICAgICAgICAgICAgICsgJ1VzZSBhIGN1c3RvbSBpbnRlbnQgdG8gbWFuYWdlIFNlYXJjaFF1ZXJ5IHNsb3RzIG9yIGNyZWF0ZSBhIHJlZ3VsYXIgc2xvdCBmb3IgdXNlIHdpdGggVmFsdWVDb250cm9sLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yYXdQcm9wcyA9IHByb3BzO1xuICAgICAgICB0aGlzLnByb3BzID0gVmFsdWVDb250cm9sLm1lcmdlV2l0aERlZmF1bHRQcm9wcyhwcm9wcyk7XG4gICAgfVxuXG4gICAgc3RhdGljIG1lcmdlV2l0aERlZmF1bHRQcm9wcyhwcm9wczogVmFsdWVDb250cm9sUHJvcHMpOiBEZWVwUmVxdWlyZWQ8VmFsdWVDb250cm9sUHJvcHM+IHtcblxuICAgICAgICBjb25zdCBkZWZhdWx0czogRGVlcFJlcXVpcmVkPFZhbHVlQ29udHJvbFByb3BzPiA9XG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAnZHVtbXknLFxuICAgICAgICAgICAgc2xvdFR5cGU6ICdkdW1teScsXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIHZhbGlkYXRpb246IFtdLFxuICAgICAgICAgICAgY29uZmlybWF0aW9uUmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICAgICAgaW50ZXJhY3Rpb25Nb2RlbDoge1xuICAgICAgICAgICAgICAgIGFjdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgc2V0OiBbJC5BY3Rpb24uU2V0XSxcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlOiBbJC5BY3Rpb24uQ2hhbmdlXSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRhcmdldHM6IFskLlRhcmdldC5JdF1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcm9tcHRzOiB7XG4gICAgICAgICAgICAgICAgY29uZmlybVZhbHVlOiAoYWN0KSA9PiBpMThuZXh0LnQoJ1ZBTFVFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfQ09ORklSTV9WQUxVRScsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgIHZhbHVlQ29uZmlybWVkOiBpMThuZXh0LnQoJ1ZBTFVFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfVkFMVUVfQUZGSVJNRUQnKSxcbiAgICAgICAgICAgICAgICB2YWx1ZURpc2NvbmZpcm1lZDogaTE4bmV4dC50KCdWQUxVRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1ZBTFVFX0RJU0FGRklSTUVEJyksXG4gICAgICAgICAgICAgICAgdmFsdWVTZXQ6IChhY3QpID0+IGkxOG5leHQudCgnVkFMVUVfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9WQUxVRV9TRVQnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICB2YWx1ZUNoYW5nZWQ6IChhY3QpID0+IGkxOG5leHQudCgnVkFMVUVfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9WQUxVRV9DSEFOR0VEJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgaW52YWxpZFZhbHVlOiAoYWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3QucGF5bG9hZC5yZW5kZXJlZFJlYXNvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTE4bmV4dC50KCdWQUxVRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX0lOVkFMSURfVkFMVUVfV0lUSF9SRUFTT04nLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSwgcmVhc29uOiBhY3QucGF5bG9hZC5yZW5kZXJlZFJlYXNvbiB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTE4bmV4dC50KCdWQUxVRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX0dFTkVSQUxfSU5WQUxJRF9WQUxVRScsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcmVxdWVzdFZhbHVlOiAoKSA9PiBpMThuZXh0LnQoJ1ZBTFVFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfUkVRVUVTVF9WQUxVRScpLFxuICAgICAgICAgICAgICAgIHJlcXVlc3RDaGFuZ2VkVmFsdWU6ICgpID0+IGkxOG5leHQudCgnVkFMVUVfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9SRVFVRVNUX0NIQU5HRURfVkFMVUUnKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXByb21wdHM6IHtcbiAgICAgICAgICAgICAgICBjb25maXJtVmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnVkFMVUVfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX0NPTkZJUk1fVkFMVUUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICB2YWx1ZUNvbmZpcm1lZDogaTE4bmV4dC50KCdWQUxVRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfVkFMVUVfQUZGSVJNRUQnKSxcbiAgICAgICAgICAgICAgICB2YWx1ZURpc2NvbmZpcm1lZDogaTE4bmV4dC50KCdWQUxVRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfVkFMVUVfRElTQUZGSVJNRUQnKSxcbiAgICAgICAgICAgICAgICB2YWx1ZVNldDogKGFjdCkgPT4gaTE4bmV4dC50KCdWQUxVRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfVkFMVUVfU0VUJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgdmFsdWVDaGFuZ2VkOiAoYWN0KSA9PiBpMThuZXh0LnQoJ1ZBTFVFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9WQUxVRV9DSEFOR0VEJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgaW52YWxpZFZhbHVlOiAoYWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3QucGF5bG9hZC5yZW5kZXJlZFJlYXNvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTE4bmV4dC50KCdWQUxVRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfSU5WQUxJRF9WQUxVRV9XSVRIX1JFQVNPTicsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlLCByZWFzb246IGFjdC5wYXlsb2FkLnJlbmRlcmVkUmVhc29uIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ1ZBTFVFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9HRU5FUkFMX0lOVkFMSURfVkFMVUUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlcXVlc3RWYWx1ZTogKCkgPT4gaTE4bmV4dC50KCdWQUxVRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfUkVRVUVTVF9WQUxVRScpLFxuICAgICAgICAgICAgICAgIHJlcXVlc3RDaGFuZ2VkVmFsdWU6ICgpID0+IGkxOG5leHQudCgnVkFMVUVfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX1JFUVVFU1RfQ0hBTkdFRF9WQUxVRScpLFxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBfLm1lcmdlKGRlZmF1bHRzLCBwcm9wcyk7XG4gICAgfVxuXG4gICAgLy8gdHNEb2MgLSBzZWUgQ29udHJvbFxuICAgIGNhbkhhbmRsZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzU2V0V2l0aFZhbHVlKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc0NoYW5nZVdpdGhWYWx1ZShpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaXNTZXRXaXRob3V0VmFsdWUoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmlzQ2hhbmdlV2l0aG91dFZhbHVlKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc0JhcmVWYWx1ZShpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaXNDb25maXJtYXRpb25BZmZpcm1lZChpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaXNDb25maXJtYXRpb25EaXNhZmZpcm1lZChpbnB1dCk7XG4gICAgfVxuXG4gICAgLy8gdHNEb2MgLSBzZWUgQ29udHJvbFxuICAgIGFzeW5jIGhhbmRsZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAodGhpcy5oYW5kbGVGdW5jID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGxvZy5lcnJvcignVmFsdWVDb250cm9sOiBoYW5kbGUgY2FsbGVkIGJ1dCB0aGlzLmhhbmRsZUZ1bmMgaXMgbm90IHNldC4gY2FuSGFuZGxlKCkgc2hvdWxkIGJlIGNhbGxlZCBmaXJzdCB0byBzZXQgdGhpcy5oYW5kbGVGdW5jLicpO1xuICAgICAgICAgICAgY29uc3QgaW50ZW50OiBJbnRlbnQgPSAoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQ7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7aW50ZW50Lm5hbWV9IGNhbiBub3QgYmUgaGFuZGxlZCBieSAke3RoaXMuY29uc3RydWN0b3IubmFtZX0uYCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmhhbmRsZUZ1bmMoaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuXG4gICAgICAgIGlmIChyZXN1bHRCdWlsZGVyLmhhc0luaXRpYXRpdmVBY3QoKSAhPT0gdHJ1ZSAmJiB0aGlzLmNhblRha2VJbml0aWF0aXZlKGlucHV0KSA9PT0gdHJ1ZSl7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnRha2VJbml0aWF0aXZlKGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERldGVybWluZSBpZiB0aGUgaW5wdXQgaXMgYW4gaW1wbGljaXQgb3IgZXhwbGljaXQgXCJzZXRcIiB3aXRoIGEgdmFsdWUgcHJvdmlkZWQuXG4gICAgICpcbiAgICAgKiBFeGFtcGxlIHV0dGVyYW5jZTogXCJTZXQgbXkgbmFtZSB0byBCb2JcIlxuICAgICAqXG4gICAgICogQHBhcmFtIGlucHV0IC0gSW5wdXRcbiAgICAgKi9cbiAgICBwcml2YXRlIGlzU2V0V2l0aFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzSW50ZW50KGlucHV0LCBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQuaW50ZW50TmFtZSh0aGlzLnByb3BzLnNsb3RUeXBlKSkpO1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQsIHZhbHVlU3RyLCB2YWx1ZVR5cGUgfSA9IHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHRhcmdldCwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnZhbHVlVHlwZU1hdGNoKHZhbHVlVHlwZSwgdGhpcy5wcm9wcy5zbG90VHlwZSkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudmFsdWVTdHJEZWZpbmVkKHZhbHVlU3RyKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzTWF0Y2hPclVuZGVmaW5lZChmZWVkYmFjaywgWyQuRmVlZGJhY2suQWZmaXJtLCAkLkZlZWRiYWNrLkRpc2FmZmlybV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2goYWN0aW9uLCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQpKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlU2V0V2l0aFZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTsgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhhbmRsZSBhbiBpbXBsaWNpdCBvciBleHBsaWNpdCBcInNldFwiIHdpdGggYSB2YWx1ZSBwcm92aWRlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbnB1dCAtIElucHV0XG4gICAgICogQHBhcmFtIHJlc3VsdEJ1aWxkZXIgLSBSZXN1bHRCdWlsZGVyXG4gICAgICovXG4gICAgcHJpdmF0ZSBoYW5kbGVTZXRXaXRoVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpIHtcbiAgICAgICAgY29uc3QgeyB2YWx1ZVN0ciwgZXJNYXRjaCB9ID0gSW5wdXRVdGlsLmdldFZhbHVlUmVzb2x1dGlvbihpbnB1dCk7XG4gICAgICAgIHRoaXMuc2V0VmFsdWUodmFsdWVTdHIsIGVyTWF0Y2gpO1xuICAgICAgICB0aGlzLnZhbGlkYXRlQW5kQWRkQWN0cyhpbnB1dCwgcmVzdWx0QnVpbGRlciwgJC5BY3Rpb24uU2V0KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERldGVybWluZSBpZiB0aGUgaW5wdXQgaXMgYW4gaW1wbGljaXQgb3IgZXhwbGljaXQgXCJzZXRcIiB3aXRob3V0IGEgdmFsdWUuXG4gICAgICpcbiAgICAgKiBFeGFtcGxlIHV0dGVyYW5jZTogXCJTZXQgbXkgbmFtZVwiXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBJbnB1dFxuICAgICAqL1xuICAgIHByaXZhdGUgaXNTZXRXaXRob3V0VmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNJbnRlbnQoaW5wdXQsIEdlbmVyYWxDb250cm9sSW50ZW50Lm5hbWUpKTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmVlZGJhY2ssIGFjdGlvbiwgdGFyZ2V0IH0gPSB1bnBhY2tHZW5lcmFsQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHRhcmdldCwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmZlZWRiYWNrSXNNYXRjaE9yVW5kZWZpbmVkKGZlZWRiYWNrLCBbJC5GZWVkYmFjay5BZmZpcm0sICQuRmVlZGJhY2suRGlzYWZmaXJtXSkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuYWN0aW9uSXNNYXRjaChhY3Rpb24sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCkpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVTZXRXaXRob3V0VmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpOyB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIGFuIGltcGxpY2l0IG9yIGV4cGxpY2l0IFwic2V0XCIgd2l0aG91dCBhIHZhbHVlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGlucHV0IC0gSW5wdXRcbiAgICAgKiBAcGFyYW0gcmVzdWx0QnVpbGRlciAtIFJlc3VsdCBidWlsZGVyXG4gICAgICovXG4gICAgcHJpdmF0ZSBoYW5kbGVTZXRXaXRob3V0VmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5hc2tFbGljaXRhdGlvblF1ZXN0aW9uKGlucHV0LCByZXN1bHRCdWlsZGVyLCAkLkFjdGlvbi5TZXQpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lIGlmIHRoZSBpbnB1dCBpcyBcImNoYW5nZVwiIHdpdGggYSB2YWx1ZSBwcm92aWRlZC5cbiAgICAgKlxuICAgICAqIEV4YW1wbGUgdXR0ZXJhbmNlOiBcIkNoYW5nZSBteSBuYW1lIHRvIGJvYlwiXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBJbnB1dFxuICAgICAqL1xuICAgIHByaXZhdGUgaXNDaGFuZ2VXaXRoVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNJbnRlbnQoaW5wdXQsIFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5pbnRlbnROYW1lKHRoaXMucHJvcHMuc2xvdFR5cGUpKSk7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCwgdmFsdWVTdHIsIHZhbHVlVHlwZSB9ID0gdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cykpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudmFsdWVUeXBlTWF0Y2godmFsdWVUeXBlLCB0aGlzLnByb3BzLnNsb3RUeXBlKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC52YWx1ZVN0ckRlZmluZWQodmFsdWVTdHIpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmZlZWRiYWNrSXNNYXRjaE9yVW5kZWZpbmVkKGZlZWRiYWNrLCBbJC5GZWVkYmFjay5BZmZpcm0sICQuRmVlZGJhY2suRGlzYWZmaXJtXSkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuYWN0aW9uSXNNYXRjaChhY3Rpb24sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZSkpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVDaGFuZ2VXaXRoVmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgYW4gaW1wbGljaXQgb3IgZXhwbGljaXQgXCJjaGFuZ2VcIiB3aXRoIGEgdmFsdWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBJbnB1dFxuICAgICAqIEBwYXJhbSByZXN1bHRCdWlsZGVyIC0gUmVzdWx0IGJ1aWxkZXJcbiAgICAgKi9cbiAgICBwcml2YXRlIGhhbmRsZUNoYW5nZVdpdGhWYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB7IHZhbHVlU3RyLCBlck1hdGNoIH0gPSBJbnB1dFV0aWwuZ2V0VmFsdWVSZXNvbHV0aW9uKGlucHV0KTtcbiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZVN0ciwgZXJNYXRjaCk7XG4gICAgICAgIHRoaXMudmFsaWRhdGVBbmRBZGRBY3RzKGlucHV0LCByZXN1bHRCdWlsZGVyLCAkLkFjdGlvbi5DaGFuZ2UpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lIGlmIHRoZSBpbnB1dCBpcyBcImNoYW5nZVwiIHdpdGhvdXQgYSB2YWx1ZS5cbiAgICAgKlxuICAgICAqIEV4YW1wbGUgdXR0ZXJhbmNlOiBcIkNoYW5nZSBteSBuYW1lXCJcbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbnB1dCAtIElucHV0XG4gICAgICovXG4gICAgcHJpdmF0ZSBpc0NoYW5nZVdpdGhvdXRWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0ludGVudChpbnB1dCwgR2VuZXJhbENvbnRyb2xJbnRlbnQubmFtZSkpO1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQgfSA9IHVucGFja0dlbmVyYWxDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cykpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuZmVlZGJhY2tJc01hdGNoT3JVbmRlZmluZWQoZmVlZGJhY2ssIFskLkZlZWRiYWNrLkFmZmlybSwgJC5GZWVkYmFjay5EaXNhZmZpcm1dKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5hY3Rpb25Jc01hdGNoKGFjdGlvbiwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuY2hhbmdlKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUNoYW5nZVdpdGhvdXRWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgYW4gaW1wbGljaXQgb3IgZXhwbGljaXQgXCJjaGFuZ2VcIiB3aXRob3V0IGEgdmFsdWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBJbnB1dFxuICAgICAqIEBwYXJhbSByZXN1bHRCdWlsZGVyIC0gUmVzdWx0IGJ1aWxkZXJcbiAgICAgKi9cbiAgICBwcml2YXRlIGhhbmRsZUNoYW5nZVdpdGhvdXRWYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICB0aGlzLmFza0VsaWNpdGF0aW9uUXVlc3Rpb24oaW5wdXQsIHJlc3VsdEJ1aWxkZXIsICQuQWN0aW9uLkNoYW5nZSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIERldGVybWluZSBpZiB0aGUgaW5wdXQgaXMgYSB2YWx1ZSB3aXRob3V0IGFueSBmdXJ0aGVyIGluZm9ybWF0aW9uLlxuICAgICAqXG4gICAgICogRXhhbXBsZSB1dHRlcmFuY2U6ICdCb2InXG4gICAgICpcbiAgICAgKiBCZWhhdmlvcjpcbiAgICAgKiAgLSBJZiB0aGUgY29udHJvbCBpc24ndCBhY3RpdmVseSBhc2tpbmcgYSBxdWVzdGlvbiwgaXQgYXNzdW1lcyB0aGUgdXNlclxuICAgICAqICAgIG1lYW50IFwic2V0IFxce3ZhbHVlXFx9XCIuXG4gICAgICogQHBhcmFtIGlucHV0IC0gSW5wdXRcbiAgICAgKi9cbiAgICBwcml2YXRlIGlzQmFyZVZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBhbnkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNJbnRlbnQoaW5wdXQsIFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5pbnRlbnROYW1lKHRoaXMucHJvcHMuc2xvdFR5cGUpKSk7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCwgdmFsdWVTdHIsIHZhbHVlVHlwZSB9ID0gdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzVW5kZWZpbmVkKGZlZWRiYWNrKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5hY3Rpb25Jc1VuZGVmaW5lZChhY3Rpb24pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzVW5kZWZpbmVkKHRhcmdldCkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudmFsdWVTdHJEZWZpbmVkKHZhbHVlU3RyKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC52YWx1ZVR5cGVNYXRjaCh2YWx1ZVR5cGUsIHRoaXMucHJvcHMuc2xvdFR5cGUpKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlQmFyZVZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTsgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhhbmRsZSBhIGJhcmUgdmFsdWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBJbnB1dFxuICAgICAqIEBwYXJhbSByZXN1bHRCdWlsZGVyIC0gUmVzdWx0IGJ1aWxkZXJcbiAgICAgKi9cbiAgICBwcml2YXRlIGhhbmRsZUJhcmVWYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB7IHZhbHVlU3RyLCBlck1hdGNoIH0gPSBJbnB1dFV0aWwuZ2V0VmFsdWVSZXNvbHV0aW9uKGlucHV0KTtcbiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZVN0ciwgZXJNYXRjaCk7XG4gICAgICAgIHRoaXMudmFsaWRhdGVBbmRBZGRBY3RzKGlucHV0LCByZXN1bHRCdWlsZGVyLCB0aGlzLnN0YXRlLmVsaWNpdGF0aW9uQWN0aW9uID8/ICQuQWN0aW9uLlNldCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmUgaWYgdGhlIGlucHV0IGlzIGFuIGFmZmlybWF0aW9uIHRvIGFuIGV4cGxpY2l0IGNvbmZpcm1hdGlvbiBxdWVzdGlvbi5cbiAgICAgKlxuICAgICAqIEV4YW1wbGUgZGlhbG9nOlxuICAgICAqIC0gJ0E6IERpZCB5b3Ugc2F5IEJvYj8nXG4gICAgICogLSAnVTogWWVzLidcbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbnB1dCAtIElucHV0XG4gICAgICovXG4gICAgcHJpdmF0ZSBpc0NvbmZpcm1hdGlvbkFmZmlybWVkKGlucHV0OiBDb250cm9sSW5wdXQpOiBhbnkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLyogVE9ETzogZmVhdHVyZTogYWxzbyBoYW5kbGUgXCJ5ZXMsIHt2YWx1ZX1cIiBmb3IgYm90aCBleHBlY3RlZCBhbmRcbiAgICAgICAgICAgICAqIHVuZXhwZWN0ZWQgdmFsdWVzXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzQmFyZVllcyhpbnB1dCkpO1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLmFjdGl2ZUluaXRpYXRpdmVBY3QgPT09ICdDb25maXJtVmFsdWVBY3QnKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlQ29uZmlybWF0aW9uQWZmaXJtZWQ7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhhbmRsZSBhbiBhZmZpcm1hdGlvbiB0byBhbiBleHBsaWNpdCBjb25maXJtYXRpb24gcXVlc3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBJbnB1dFxuICAgICAqIEBwYXJhbSByZXN1bHRCdWlsZGVyIC0gUmVzdWx0IGJ1aWxkZXJcbiAgICAgKi9cbiAgICBwcml2YXRlIGhhbmRsZUNvbmZpcm1hdGlvbkFmZmlybWVkKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3RhdGUuYWN0aXZlSW5pdGlhdGl2ZUFjdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zdGF0ZS5pc1ZhbHVlQ29uZmlybWVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdGF0ZS5hY3RpdmVJbml0aWF0aXZlQWN0ID0gdW5kZWZpbmVkO1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgVmFsdWVDb25maXJtZWRBY3QodGhpcywgeyB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSB9KSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lIGlmIHRoZSBpbnB1dCBpcyBhbiBhZmZpcm1hdGlvbiB0byBhbiBleHBsaWNpdCBjb25maXJtYXRpb24gcXVlc3Rpb24uXG4gICAgICpcbiAgICAgKiBFeGFtcGxlIGRpYWxvZzpcbiAgICAgKiAtICdBOiBEaWQgeW91IHNheSBCb2I/J1xuICAgICAqIC0gJ1U6IE5vLidcbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbnB1dCAtIElucHV0XG4gICAgICovXG4gICAgcHJpdmF0ZSBpc0NvbmZpcm1hdGlvbkRpc2FmZmlybWVkKGlucHV0OiBDb250cm9sSW5wdXQpOiBhbnkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLyogVE9ETzogZmVhdHVyZTogYWxzbyBoYW5kbGUgXCJubywge3ZhbHVlfVwiIGZvciBib3RoIGV4cGVjdGVkIGFuZFxuICAgICAgICAgICAgICogdW5leHBlY3RlZCB2YWx1ZXNcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNCYXJlTm8oaW5wdXQpKTtcbiAgICAgICAgICAgIG9rSWYodGhpcy5zdGF0ZS5hY3RpdmVJbml0aWF0aXZlQWN0ID09PSAnQ29uZmlybVZhbHVlQWN0Jyk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUNvbmZpcm1hdGlvbkRpc2FmZmlybWVkO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgYSBkaXNhZmZpcm1hdGlvbiB0byBhbiBleHBsaWNpdCBjb25maXJtYXRpb24gcXVlc3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBJbnB1dFxuICAgICAqIEBwYXJhbSByZXN1bHRCdWlsZGVyIC0gUmVzdWx0IGJ1aWxkZXJcbiAgICAgKi9cbiAgICBwcml2YXRlIGhhbmRsZUNvbmZpcm1hdGlvbkRpc2FmZmlybWVkKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3RhdGUuaXNWYWx1ZUNvbmZpcm1lZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnN0YXRlLmFjdGl2ZUluaXRpYXRpdmVBY3QgPSB1bmRlZmluZWQ7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBWYWx1ZURpc2NvbmZpcm1lZEFjdCh0aGlzLCB7dmFsdWU6IHRoaXMuc3RhdGUudmFsdWV9KSk7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBSZXF1ZXN0VmFsdWVBY3QodGhpcykpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERpcmVjdGx5IHNldCB0aGUgdmFsdWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdmFsdWUgLSBWYWx1ZVxuICAgICAqIEBwYXJhbSBlck1hdGNoIC0gV2hldGhlciB0aGUgdmFsdWUgaXMgYW4gSUQgZGVmaW5lZCBmb3IgYHRoaXMuc2xvdFR5cGVgXG4gICAgICogaW4gdGhlIGludGVyYWN0aW9uIG1vZGVsXG4gICAgICovXG4gICAgc2V0VmFsdWUodmFsdWU6IHN0cmluZywgZXJNYXRjaDogYm9vbGVhbiA9IHRydWUpIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5wcmV2aW91c1ZhbHVlID0gdGhpcy5zdGF0ZS52YWx1ZTtcbiAgICAgICAgdGhpcy5zdGF0ZS52YWx1ZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLnN0YXRlLmVyTWF0Y2ggPSBlck1hdGNoO1xuICAgICAgICB0aGlzLnN0YXRlLmlzVmFsdWVDb25maXJtZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBUT0RPOiBuYW1pbmc6ICdyZXNldCc/XG4gICAgLyoqXG4gICAgICogQ2xlYXIgdGhlIHN0YXRlIG9mIHRoaXMgY29udHJvbC5cbiAgICAgKi9cbiAgICBjbGVhcigpIHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IG5ldyBWYWx1ZUNvbnRyb2xTdGF0ZSgpO1xuICAgIH1cblxuICAgIC8vIHRzRG9jIC0gc2VlIENvbnRyb2xcbiAgICBjYW5UYWtlSW5pdGlhdGl2ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLndhbnRzVG9Db25maXJtVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLndhbnRzVG9GaXhJbnZhbGlkVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLndhbnRzVG9FbGljaXRWYWx1ZShpbnB1dCk7XG4gICAgfVxuXG4gICAgLy8gdHNEb2MgLSBzZWUgQ29udHJvbFxuICAgIGFzeW5jIHRha2VJbml0aWF0aXZlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmICh0aGlzLmluaXRpYXRpdmVGdW5jID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yTXNnID0gJ1ZhbHVlQ29udHJvbDogdGFrZUluaXRpYXRpdmUgY2FsbGVkIGJ1dCB0aGlzLmluaXRpYXRpdmVGdW5jIGlzIG5vdCBzZXQuIGNhblRha2VJbml0aWF0aXZlKCkgc2hvdWxkIGJlIGNhbGxlZCBmaXJzdCB0byBzZXQgdGhpcy5pbml0aWF0aXZlRnVuYy4nO1xuICAgICAgICAgICAgbG9nLmVycm9yKGVycm9yTXNnKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1zZyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pbml0aWF0aXZlRnVuYyhpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQZXJmb3JtIHZhbGlkYXRpb24gY2hlY2tzIGFuZCBhZGQgYXBwcm9wcmlhdGUgYWN0cyB0byB0aGUgcmVzdWx0LlxuICAgICAqXG4gICAgICogQHBhcmFtIGlucHV0IC0gSW5wdXRcbiAgICAgKiBAcGFyYW0gcmVzdWx0QnVpbGRlciAtIFJlc3VsdCBidWlsZGVyXG4gICAgICogQHBhcmFtIGVsaWNpdGF0aW9uQWN0aW9uIC0gVGhlIHR5cGUgb2YgZWxpY2l0YXRpb24gcXVlc3Rpb24gdGhhdCBoYXMgYmVlblxuICAgICAqIGFza2VkLlxuICAgICAqL1xuICAgIHByaXZhdGUgdmFsaWRhdGVBbmRBZGRBY3RzKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyLCBlbGljaXRhdGlvbkFjdGlvbjogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3RhdGUuZWxpY2l0YXRpb25BY3Rpb24gPSBlbGljaXRhdGlvbkFjdGlvbjtcbiAgICAgICAgY29uc3QgdmFsaWRhdGlvblJlc3VsdDogdHJ1ZSB8IFZhbGlkYXRpb25SZXN1bHQgPSB0aGlzLnZhbGlkYXRlKGlucHV0KTtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWxpZGF0aW9uUmVzdWx0ID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIGlmIChlbGljaXRhdGlvbkFjdGlvbiA9PT0gJC5BY3Rpb24uQ2hhbmdlKSB7XG4gICAgICAgICAgICAgICAgLy8gaWYgZWxpY2l0YXRpb25BY3Rpb24gPT0gJ2NoYW5nZScsIHRoZW4gdGhlIHByZXZpb3VzVmFsdWUgbXVzdCBiZSBkZWZpbmVkLlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLnByZXZpb3VzVmFsdWUgIT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFZhbHVlQ2hhbmdlZEFjdDxzdHJpbmc+KHRoaXMsIHtwcmV2aW91c1ZhbHVlOiB0aGlzLnN0YXRlLnByZXZpb3VzVmFsdWUsIHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlISB9KVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdWYWx1ZUNoYW5nZWRBY3Qgc2hvdWxkIG9ubHkgYmUgdXNlZCBpZiB0aGVyZSBpcyBhbiBhY3R1YWwgcHJldmlvdXMgdmFsdWUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgVmFsdWVTZXRBY3QodGhpcywgeyB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBmZWVkYmFja1xuICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IEludmFsaWRWYWx1ZUFjdDxzdHJpbmc+KHRoaXMsIHsgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUhLCByZWFzb25Db2RlOiB2YWxpZGF0aW9uUmVzdWx0LnJlYXNvbkNvZGUsIHJlbmRlcmVkUmVhc29uOiB2YWxpZGF0aW9uUmVzdWx0LnJlbmRlcmVkUmVhc29uIH0pKTtcbiAgICAgICAgICAgIHRoaXMuYXNrRWxpY2l0YXRpb25RdWVzdGlvbihpbnB1dCwgcmVzdWx0QnVpbGRlciwgZWxpY2l0YXRpb25BY3Rpb24pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmUgaWYgdGhlIHZhbHVlIGlzIHZhbGlkLlxuICAgICAqXG4gICAgICogQHBhcmFtIGlucHV0IC0gSW5wdXQuXG4gICAgICovXG4gICAgcHJpdmF0ZSB2YWxpZGF0ZShpbnB1dDogQ29udHJvbElucHV0KTogdHJ1ZSB8IFZhbGlkYXRpb25SZXN1bHQge1xuICAgICAgICBjb25zdCBsaXN0T2ZWYWxpZGF0aW9uRnVuYzogU2xvdFZhbGlkYXRpb25GdW5jdGlvbltdID0gdHlwZW9mKHRoaXMucHJvcHMudmFsaWRhdGlvbikgPT09ICdmdW5jdGlvbicgPyBbdGhpcy5wcm9wcy52YWxpZGF0aW9uXSA6IHRoaXMucHJvcHMudmFsaWRhdGlvbjtcbiAgICAgICAgZm9yIChjb25zdCB2YWxpZGF0aW9uRnVuY3Rpb24gb2YgbGlzdE9mVmFsaWRhdGlvbkZ1bmMpIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQ6IHRydWUgfCBWYWxpZGF0aW9uUmVzdWx0ID0gdmFsaWRhdGlvbkZ1bmN0aW9uKHRoaXMuc3RhdGUsIGlucHV0KTtcbiAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uUmVzdWx0ICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgbG9nLmRlYnVnKGBWYWx1ZUNvbnRyb2wudmFsaWRhdGUoKTogdmFsaWRhdGlvbiBmYWlsZWQuIFJlYXNvbjogJHtKU09OLnN0cmluZ2lmeSh2YWxpZGF0aW9uUmVzdWx0LCBudWxsLCAyKX0uYCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbGlkYXRpb25SZXN1bHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lIGlmIHRoZSB2YWx1ZSBuZWVkcyB0byBiZSBleHBsaWNpdGx5IGNvbmZpcm1lZFxuICAgICAqXG4gICAgICogQHBhcmFtIGlucHV0IC0gSW5wdXRcbiAgICAgKi9cbiAgICBwcml2YXRlIHdhbnRzVG9Db25maXJtVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS52YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMuc3RhdGUuaXNWYWx1ZUNvbmZpcm1lZCA9PT0gZmFsc2UgJiYgdGhpcy5ldmFsdWF0ZUJvb2xlYW5Qcm9wKHRoaXMucHJvcHMuY29uZmlybWF0aW9uUmVxdWlyZWQsIGlucHV0KSl7XG4gICAgICAgICAgICB0aGlzLmluaXRpYXRpdmVGdW5jID0gdGhpcy5jb25maXJtVmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXNrIHRoZSB1c2VyIHRvIGNvbmZpcm0gdGhlIHZhbHVlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGlucHV0IC0gSW5wdXRcbiAgICAgKiBAcGFyYW0gcmVzdWx0QnVpbGRlciAtIFJlc3VsdCBidWlsZGVyXG4gICAgICovXG4gICAgcHJpdmF0ZSBjb25maXJtVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5hY3RpdmVJbml0aWF0aXZlQWN0ID0gJ0NvbmZpcm1WYWx1ZUFjdCc7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBDb25maXJtVmFsdWVBY3QodGhpcywgeyB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSB9KSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lIGlmIHRoZSB2YWx1ZSBuZWVkcyB0byBvYnRhaW4gYSBuZXcgdmFsdWUgYmVjYXVzZSB0aGUgY3VycmVudFxuICAgICAqIG9uZSBpcyBpbnZhbGlkLlxuICAgICAqXG4gICAgICogQHBhcmFtIGlucHV0IC0gSW5wdXRcbiAgICAgKi9cbiAgICBwcml2YXRlIHdhbnRzVG9GaXhJbnZhbGlkVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS52YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMudmFsaWRhdGUoaW5wdXQpICE9PSB0cnVlKXtcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhdGl2ZUZ1bmMgPSB0aGlzLmZpeEludmFsaWRWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBc2sgdGhlIHVzZXIgdG8gcHJvdmlkZSBhIG5ldyB2YWx1ZSBiZWNhdXNlIHRoZSBjdXJyZW50IG9uZSBpcyBpbnZhbGlkLlxuICAgICAqXG4gICAgICogQHBhcmFtIGlucHV0IC0gSW5wdXRcbiAgICAgKiBAcGFyYW0gcmVzdWx0QnVpbGRlciAtIFJlc3VsdCBidWlsZGVyXG4gICAgICovXG4gICAgcHJpdmF0ZSBmaXhJbnZhbGlkVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy52YWxpZGF0ZUFuZEFkZEFjdHMoaW5wdXQsIHJlc3VsdEJ1aWxkZXIsICQuQWN0aW9uLkNoYW5nZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lIGlmIHRoZSB2YWx1ZSBzaG91bGQgYmUgZWxpY2l0ZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBJbnB1dFxuICAgICAqL1xuICAgIHByaXZhdGUgd2FudHNUb0VsaWNpdFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUudmFsdWUgPT09IHVuZGVmaW5lZCAmJiB0aGlzLmV2YWx1YXRlQm9vbGVhblByb3AodGhpcy5wcm9wcy5yZXF1aXJlZCwgaW5wdXQpKXtcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhdGl2ZUZ1bmMgPSB0aGlzLmVsaWNpdFZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFzayB0aGUgdXNlciB0byBwcm92aWRlIGEgdmFsdWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBJbnB1dFxuICAgICAqIEBwYXJhbSByZXN1bHRCdWlsZGVyIC0gUmVzdWx0IGJ1aWxkZXJcbiAgICAgKi9cbiAgICBwcml2YXRlIGVsaWNpdFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMuYXNrRWxpY2l0YXRpb25RdWVzdGlvbihpbnB1dCwgcmVzdWx0QnVpbGRlciwgJC5BY3Rpb24uU2V0KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGQgYW4gZWxpY2l0YXRpb24gYWN0IHRvIHRoZSByZXN1bHQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXQgLSBJbnB1dFxuICAgICAqIEBwYXJhbSByZXN1bHRCdWlsZGVyIC0gUmVzdWx0IGJ1aWxkZXJcbiAgICAgKiBAcGFyYW0gZWxpY2l0YXRpb25BY3Rpb24gLSBUaGUgc3R5bGUgb2YgZWxpY2l0YXRpb24gdG8gdXNlLlxuICAgICAqL1xuICAgIHByaXZhdGUgYXNrRWxpY2l0YXRpb25RdWVzdGlvbihpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlciwgZWxpY2l0YXRpb25BY3Rpb246IHN0cmluZykge1xuICAgICAgICB0aGlzLnN0YXRlLmVsaWNpdGF0aW9uQWN0aW9uID0gZWxpY2l0YXRpb25BY3Rpb247XG4gICAgICAgIHN3aXRjaCAoZWxpY2l0YXRpb25BY3Rpb24pIHtcbiAgICAgICAgICAgIGNhc2UgJC5BY3Rpb24uU2V0OlxuICAgICAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBSZXF1ZXN0VmFsdWVBY3QodGhpcykpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGNhc2UgJC5BY3Rpb24uQ2hhbmdlOlxuICAgICAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBSZXF1ZXN0Q2hhbmdlZFZhbHVlQWN0KHRoaXMsIHtjdXJyZW50VmFsdWU6IHRoaXMuc3RhdGUudmFsdWUhfSkpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmhhbmRsZWQuIFVua25vd24gZWxpY2l0YXRpb25BY3Rpb246ICR7dGhpcy5zdGF0ZS5lbGljaXRhdGlvbkFjdGlvbn1gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIHRzRG9jIC0gc2VlIENvbnRyb2xTdGF0ZURpYWdyYW1taW5nXG4gICAgc3RyaW5naWZ5U3RhdGVGb3JEaWFncmFtKCk6IHN0cmluZyB7XG4gICAgICAgIGxldCB0ZXh0ID0gdGhpcy5zdGF0ZS52YWx1ZSA/PyAnPG5vbmU+JztcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuZWxpY2l0YXRpb25BY3Rpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGV4dCArPSBgW2VsaWNpdGluZywgJHt0aGlzLnN0YXRlLmVsaWNpdGF0aW9uQWN0aW9ufV1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0ZXh0O1xuICAgIH1cblxuICAgIC8vIHRzRG9jIC0gc2VlIENvbnRyb2xcbiAgICByZW5kZXJBY3QoYWN0OiBTeXN0ZW1BY3QsIGlucHV0OiBDb250cm9sSW5wdXQsIGJ1aWxkZXI6IENvbnRyb2xSZXNwb25zZUJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgaWYgKGFjdCBpbnN0YW5jZW9mIEludmFsaWRWYWx1ZUFjdCkge1xuICAgICAgICAgICAgYnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucHJvbXB0cy5pbnZhbGlkVmFsdWUsIGlucHV0KSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnJlcHJvbXB0cy5pbnZhbGlkVmFsdWUsIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBWYWx1ZVNldEFjdCkge1xuICAgICAgICAgICAgLy8gV2UgbXVzdCBjaG9vc2UgaG93IHRvIHNheSB0aGUgdmFsdWUuICBUaGUgZGVmYXVsdCBpcyB0byBhc3N1bWUgdGhhdCB0aGUgU2xvdC10eXBlIElEcyBhcmUgc3BlYWthYmxlLlxuICAgICAgICAgICAgYnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucHJvbXB0cy52YWx1ZVNldCwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnZhbHVlU2V0LCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgVmFsdWVDaGFuZ2VkQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnZhbHVlQ2hhbmdlZCwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnZhbHVlQ2hhbmdlZCwgaW5wdXQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGFjdCBpbnN0YW5jZW9mIFJlcXVlc3RWYWx1ZUFjdCB8fCBhY3QgaW5zdGFuY2VvZiBSZXF1ZXN0Q2hhbmdlZFZhbHVlQWN0KSB7XG4gICAgICAgICAgICBjb25zdCBwcm9tcHQgPSBhY3QgaW5zdGFuY2VvZiBSZXF1ZXN0VmFsdWVBY3QgPyB0aGlzLnByb3BzLnByb21wdHMucmVxdWVzdFZhbHVlIDogdGhpcy5wcm9wcy5wcm9tcHRzLnJlcXVlc3RDaGFuZ2VkVmFsdWU7XG4gICAgICAgICAgICBjb25zdCByZXByb21wdCA9IGFjdCBpbnN0YW5jZW9mIFJlcXVlc3RDaGFuZ2VkVmFsdWVBY3QgPyB0aGlzLnByb3BzLnJlcHJvbXB0cy5yZXF1ZXN0VmFsdWUgOiB0aGlzLnByb3BzLnJlcHJvbXB0cy5yZXF1ZXN0Q2hhbmdlZFZhbHVlO1xuXG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgcHJvbXB0LCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgcmVwcm9tcHQsIGlucHV0KSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHNsb3RFbGljaXRhdGlvbiA9IGdlbmVyYXRlU2xvdEVsaWNpdGF0aW9uKHRoaXMucHJvcHMuc2xvdFR5cGUpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRFbGljaXRTbG90RGlyZWN0aXZlKHNsb3RFbGljaXRhdGlvbi5zbG90TmFtZSwgc2xvdEVsaWNpdGF0aW9uLmludGVudCk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBDb25maXJtVmFsdWVBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMuY29uZmlybVZhbHVlLCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMuY29uZmlybVZhbHVlLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgVmFsdWVDb25maXJtZWRBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMudmFsdWVDb25maXJtZWQsIGlucHV0KSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnJlcHJvbXB0cy52YWx1ZUNvbmZpcm1lZCwgaW5wdXQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGFjdCBpbnN0YW5jZW9mIFZhbHVlRGlzY29uZmlybWVkQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnZhbHVlRGlzY29uZmlybWVkLCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMudmFsdWVEaXNjb25maXJtZWQsIGlucHV0KSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRocm93VW5oYW5kbGVkQWN0RXJyb3IoYWN0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIHRzRG9jIC0gc2VlIENvbnRyb2xcbiAgICB1cGRhdGVJbnRlcmFjdGlvbk1vZGVsKGdlbmVyYXRvcjogQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3IsIGltRGF0YTogTW9kZWxEYXRhKSB7XG4gICAgICAgIGdlbmVyYXRvci5hZGRDb250cm9sSW50ZW50KG5ldyBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQodGhpcy5wcm9wcy5zbG90VHlwZSksIGltRGF0YSk7XG4gICAgICAgIGdlbmVyYXRvci5hZGRDb250cm9sSW50ZW50KG5ldyBHZW5lcmFsQ29udHJvbEludGVudCgpLCBpbURhdGEpO1xuICAgICAgICBnZW5lcmF0b3IuYWRkWWVzQW5kTm9JbnRlbnRzKCk7XG4gICAgfVxuXG5cbiAgICAvLyB0c0RvYyAtIHNlZSBJbnRlcmFjdGlvbk1vZGVsQ29udHJpYnV0b3JcbiAgICBnZXRUYXJnZXRJZHMoKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHM7XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYW4gZWxpY2l0LXNsb3QgZGlyZWN0aXZlIGZvciB0aGUgcHJvdmlkZWQgc2xvdFR5cGUuXG4gKlxuICogLSBUaGUgaW50ZW50IHNwZWNpZmllZCBpcyBhIGB7c2xvdFR5cGV9X1ZhbHVlQ29udHJvbEludGVudGBcbiAqIC0gVGhlIHNsb3Qgc3BlY2lmaWVkIGlzIHRoZSBgc2xvdFR5cGVgIHNsb3QuXG4gKlxuICogQHBhcmFtIHNsb3RUeXBlIC0gU2xvdCB0eXBlXG4gKi9cbmZ1bmN0aW9uIGdlbmVyYXRlU2xvdEVsaWNpdGF0aW9uKHNsb3RUeXBlOiBzdHJpbmcpOiB7IGludGVudDogSW50ZW50LCBzbG90TmFtZTogc3RyaW5nIH0ge1xuICAgIGNvbnN0IGludGVudDogSW50ZW50ID0ge1xuICAgICAgICAvLyBUT0RPOiByZWZhY3RvcjogdXNlIFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5pbnRlbnROYW1lXG4gICAgICAgIG5hbWU6IGAke3Nsb3RUeXBlfV9WYWx1ZUNvbnRyb2xJbnRlbnRgLnJlcGxhY2UoJy4nLCAnXycpLFxuICAgICAgICBzbG90czoge1xuICAgICAgICAgICAgc2xvdFR5cGU6IHsgbmFtZTogc2xvdFR5cGUsIHZhbHVlOiAnJywgY29uZmlybWF0aW9uU3RhdHVzOiAnTk9ORScgfSxcbiAgICAgICAgICAgIGZlZWRiYWNrOiB7IG5hbWU6IFwiZmVlZGJhY2tcIiwgdmFsdWU6ICcnLCBjb25maXJtYXRpb25TdGF0dXM6ICdOT05FJyB9LFxuICAgICAgICAgICAgYWN0aW9uOiB7IG5hbWU6IFwiYWN0aW9uXCIsIHZhbHVlOiAnJywgY29uZmlybWF0aW9uU3RhdHVzOiAnTk9ORScgfSxcbiAgICAgICAgICAgIHRhcmdldDogeyBuYW1lOiBcInRhcmdldFwiLCB2YWx1ZTogJycsIGNvbmZpcm1hdGlvblN0YXR1czogJ05PTkUnIH0sXG4gICAgICAgICAgICBoZWFkOiB7IG5hbWU6IFwiaGVhZFwiLCB2YWx1ZTogJycsIGNvbmZpcm1hdGlvblN0YXR1czogJ05PTkUnIH0sXG4gICAgICAgICAgICB0YWlsOiB7IG5hbWU6IFwidGFpbFwiLCB2YWx1ZTogJycsIGNvbmZpcm1hdGlvblN0YXR1czogJ05PTkUnIH0sXG4gICAgICAgICAgICBhc3NpZ246IHsgbmFtZTogXCJhc3NpZ25cIiwgdmFsdWU6ICcnLCBjb25maXJtYXRpb25TdGF0dXM6ICdOT05FJyB9LFxuICAgICAgICB9LFxuICAgICAgICBjb25maXJtYXRpb25TdGF0dXM6IFwiTk9ORVwiXG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGludGVudCxcbiAgICAgICAgc2xvdE5hbWU6IHNsb3RUeXBlXG4gICAgfTtcbn1cbiJdfQ==