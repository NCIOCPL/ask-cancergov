"use strict";
/*
 * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.NumberControl = exports.NumberControlState = void 0;
const tslib_1 = require("tslib");
const i18next_1 = tslib_1.__importDefault(require("i18next"));
const lodash_1 = tslib_1.__importDefault(require("lodash"));
const __1 = require("..");
const Strings_1 = require("../constants/Strings");
const Control_1 = require("../controls/Control");
const GeneralControlIntent_1 = require("../intents/GeneralControlIntent");
const ModelTypes_1 = require("../interactionModelGeneration/ModelTypes");
const Logger_1 = require("../logging/Logger");
const ContentActs_1 = require("../systemActs/ContentActs");
const InitiativeActs_1 = require("../systemActs/InitiativeActs");
const log = new Logger_1.Logger('AskSdkControls:NumberControl');
/**
 * State tracked by a NumberControl.
 */
class NumberControlState {
    constructor() {
        /**
         * Tracks whether the value has been explicitly confirmed by the user.
         */
        this.isValueConfirmed = false;
        /**
         * Tracks the values the user disconfirmed.
         */
        this.rejectedValues = [];
    }
}
exports.NumberControlState = NumberControlState;
/**
 * A Control that obtains a single integer from the user.
 *
 * Capabilities:
 * - Request a value
 * - Change a value
 * - Validate the value
 * - Confirm the value
 * - Suggest a value, if the user disconfirms and we know a good alternative to suggest.
 *
 * Intents that can be handled:
 * - `GeneralControlIntent`: E.g. `"yes, update my age"`
 * - `AMAZON_NUMBER_ValueControlIntent`: E.g. "no change it to three".
 * - `AMAZON.YesIntent`, `AMAZON.NoIntent`
 */
class NumberControl extends Control_1.Control {
    constructor(props) {
        super(props.id);
        this.state = new NumberControlState();
        this.rawProps = props;
        this.props = NumberControl.mergeWithDefaultProps(props);
    }
    static mergeWithDefaultProps(props) {
        const defaults = {
            id: 'placeholder',
            interactionModel: {
                actions: {
                    set: [Strings_1.Strings.Action.Set],
                    change: [Strings_1.Strings.Action.Change],
                },
                targets: [Strings_1.Strings.Target.Number, Strings_1.Strings.Target.It]
            },
            prompts: {
                requestValue: i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_REQUEST_VALUE'),
                confirmValue: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_CONFIRM_VALUE', { value: act.payload.value }),
                valueDisconfirmed: i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_VALUE_DISAFFIRMED'),
                valueSet: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_VALUE_SET', { value: act.payload.value }),
                valueConfirmed: i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_VALUE_AFFIRMED'),
                suggestValue: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_SUGGEST_VALUE', { value: act.payload.value }),
                informConfusingDisconfirmation: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_INFORM_CONFUSING_DISCONFIRMATION'),
                informConfusingConfirmation: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_INFORM_CONFUSING_CONFIRMATION', { previousValue: act.payload.value }),
                problematicInputValue: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_REPEAT_UNUSABLE_VALUE', { value: act.payload.value }),
                invalidValue: (act) => {
                    if (act.payload.renderedReason !== undefined) {
                        return i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_INVALID_VALUE_WITH_REASON', { value: act.payload.value, reason: act.payload.renderedReason });
                    }
                    return i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_GENERAL_INVALID_VALUE', { value: act.payload.value });
                },
            },
            reprompts: {
                requestValue: i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_REQUEST_VALUE'),
                confirmValue: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_CONFIRM_VALUE', { value: act.payload.value }),
                valueDisconfirmed: i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_VALUE_DISAFFIRMED'),
                valueSet: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_VALUE_SET', { value: act.payload.value }),
                valueConfirmed: i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_VALUE_AFFIRMED'),
                suggestValue: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_SUGGEST_VALUE', { value: act.payload.value }),
                informConfusingDisconfirmation: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_INFORM_CONFUSING_DISCONFIRMATION'),
                informConfusingConfirmation: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_INFORM_CONFUSING_CONFIRMATION', { previousValue: act.payload.value }),
                problematicInputValue: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_REPEAT_UNUSABLE_VALUE', { value: act.payload.value }),
                invalidValue: (act) => {
                    if (act.payload.renderedReason !== undefined) {
                        return i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_INVALID_VALUE_WITH_REASON', { value: act.payload.value, reason: act.payload.renderedReason });
                    }
                    return i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_GENERAL_INVALID_VALUE', { value: act.payload.value });
                },
            },
            validation: [],
            confirmationRequired: false,
            ambiguousPairs: [[13, 30], [14, 40], [15, 50], [16, 60], [17, 70], [18, 80], [19, 90]],
            required: true,
        };
        return lodash_1.default.merge(defaults, props);
    }
    // tsDoc - see Control
    canHandle(input) {
        return this.canHandleForEmptyStateValue(input)
            || this.canHandleForExistingStateValue(input);
    }
    // tsDoc - see Control
    async handle(input, resultBuilder) {
        log.debug(`NumberControl[${this.id}]: handle(). Entering`);
        const intent = input.request.intent;
        if (this.handleFunc === undefined) {
            throw new Error(`${intent.name} can not be handled by ${this.constructor.name}.`);
        }
        this.handleFunc(input, resultBuilder);
        if (!resultBuilder.hasInitiativeAct() && this.canTakeInitiative(input)) {
            return this.takeInitiative(input, resultBuilder);
        }
    }
    // tsDoc - see Control
    canTakeInitiative(input) {
        return this.wantsToElicitValue(input)
            || this.wantsToFixInvalidValue(input)
            || this.wantsToConfirmValue(input);
    }
    // tsDoc - see Control
    takeInitiative(input, resultBuilder) {
        if (this.initiativeFunc === undefined) {
            const errorMsg = 'NumberControl: takeInitiative called but this.initiativeFunc is not set. canTakeInitiative() should be called first to set this.initiativeFunc.';
            log.error(errorMsg);
            throw new Error(errorMsg);
        }
        this.initiativeFunc(input, resultBuilder);
    }
    // tsDoc - see Control
    renderAct(act, input, builder) {
        if (act instanceof InitiativeActs_1.RequestValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.requestValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.requestValue, input));
            const slotElicitation = generateSlotElicitation();
            builder.addElicitSlotDirective(slotElicitation.slotName, slotElicitation.intent);
        }
        else if (act instanceof InitiativeActs_1.ConfirmValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.confirmValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.confirmValue, input));
        }
        else if (act instanceof ContentActs_1.ValueDisconfirmedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueDisconfirmed, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueDisconfirmed, input));
        }
        else if (act instanceof ContentActs_1.ValueSetAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueSet, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueSet, input));
        }
        else if (act instanceof ContentActs_1.ValueConfirmedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueConfirmed, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueConfirmed, input));
        }
        else if (act instanceof InitiativeActs_1.SuggestValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.suggestValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.suggestValue, input));
        }
        else if (act instanceof ContentActs_1.InformConfusingConfirmationAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.informConfusingConfirmation, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.informConfusingConfirmation, input));
        }
        else if (act instanceof ContentActs_1.InformConfusingDisconfirmationAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.informConfusingDisconfirmation, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.informConfusingDisconfirmation, input));
        }
        else if (act instanceof ContentActs_1.ProblematicInputValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.problematicInputValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.problematicInputValue, input));
        }
        else if (act instanceof ContentActs_1.InvalidValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.invalidValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.invalidValue, input));
        }
        else {
            this.throwUnhandledActError(act);
        }
    }
    // tsDoc - see Control
    updateInteractionModel(generator, imData) {
        generator.addControlIntent(new GeneralControlIntent_1.GeneralControlIntent(), imData);
        generator.addControlIntent(new __1.SingleValueControlIntent(__1.AmazonBuiltInSlotType.NUMBER), imData);
        generator.addYesAndNoIntents();
        if (this.props.interactionModel.targets.includes(Strings_1.Strings.Target.Number)) {
            generator.addValuesToSlotType(ModelTypes_1.SharedSlotType.TARGET, i18next_1.default.t('NUMBER_CONTROL_DEFAULT_SLOT_VALUES_TARGET_NUMBER', { returnObjects: true }));
        }
    }
    // tsDoc - see InteractionModelContributor
    getTargetIds() {
        return this.props.interactionModel.targets;
    }
    /**
     * Directly set the value.
     *
     * @param value - Value, either an integer or a string that can be parsed as a integer.
     */
    setValue(value) {
        this.state.value = typeof value === 'string' ? Number.parseInt(value, 10) : value;
    }
    /**
     * Clear the state of this control.
     */
    clear() {
        this.state = new NumberControlState();
    }
    canHandleForEmptyStateValue(input) {
        try {
            __1.okIf(this.state.value === undefined);
            if (__1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name)) {
                const { action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
                __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
                __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
                this.handleFunc = this.handleLastQuestionEmptyAndValueNotExisting;
                return true;
            }
            else if (__1.InputUtil.isSingleValueControlIntent(input, __1.AmazonBuiltInSlotType.NUMBER)) {
                const { action, target } = __1.unpackSingleValueControlIntent(input.request.intent);
                __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
                __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
                this.handleFunc = this.handleLastQuestionEmptyAndValueExisting;
                return true;
            }
            return false;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleLastQuestionEmptyAndValueNotExisting(input, resultBuilder) {
        resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
    }
    handleLastQuestionEmptyAndValueExisting(input, resultBuilder) {
        const { action, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
        this.setValue(valueStr);
        this.commonHandlerWhenValueChanged(action !== null && action !== void 0 ? action : Strings_1.Strings.Action.Set, input, resultBuilder);
    }
    canHandleForExistingStateValue(input) {
        try {
            __1.okIf(this.state.value !== undefined);
            return this.isValueInRejectedValues(input)
                || this.isBareNoWhenConfirmingValue(input)
                || this.isFeedbackNoAndValueUndefinedWhenConfirmingValue(input)
                || this.isFeedbackNoAndValueNotChangedWhenConfirmingValue(input)
                || this.isFeedbackNoAndValueChangedWhenConfirmingValue(input)
                || this.isBareYesConfirmingValue(input)
                || this.isFeedbackYesAndValueChangedWhenConfirmingValue(input)
                || this.isFeedbackYesAndValueNotChangedWhenConfirmingValue(input)
                || this.isFeedbackYesAndValueUndefinedWhenConfirmingValue(input)
                || this.isFeedbackUndefinedAndValueNotChangedWhenConfirmingValue(input)
                || this.isFeedbackUndefinedAndValueChangedWhenConfirmingValue(input)
                || this.isTargetsMatchWithoutFeedbackNorValueWhenConfirmingValue(input);
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    isValueInRejectedValues(input) {
        try {
            __1.okIf(__1.InputUtil.isSingleValueControlIntent(input, __1.AmazonBuiltInSlotType.NUMBER));
            const { action, target, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(this.state.rejectedValues.includes(Number.parseInt(valueStr, 10)));
            this.handleFunc = this.handleValueExistsInRejectedValues;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleValueExistsInRejectedValues(input, resultBuilder) {
        const { valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
        this.setValue(valueStr);
        resultBuilder.addAct(new ContentActs_1.ProblematicInputValueAct(this, { reasonCode: 'ValuePreviouslyRejected', value: this.state.value }));
        resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
    }
    isBareNoWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isBareNo(input));
            __1.okIf(this.state.activeInitiativeAct === 'ConfirmValueAct');
            this.handleFunc = this.handleFeedbackNoAndWithoutValueWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    isFeedbackNoAndValueUndefinedWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(__1.InputUtil.feedbackIsFalse(feedback));
            __1.okIf(this.state.activeInitiativeAct === 'ConfirmValueAct');
            this.handleFunc = this.handleFeedbackNoAndWithoutValueWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleFeedbackNoAndWithoutValueWhenConfirmingValue(input, resultBuilder) {
        this.state.activeInitiativeAct = undefined;
        resultBuilder.addAct(new ContentActs_1.ValueDisconfirmedAct(this, { value: this.state.value }));
        this.commonHandlerWhenValueRejected(input, resultBuilder);
    }
    isFeedbackNoAndValueNotChangedWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isSingleValueControlIntent(input, __1.AmazonBuiltInSlotType.NUMBER));
            const { action, target, feedback, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(__1.InputUtil.feedbackIsFalse(feedback));
            __1.okIf(this.state.activeInitiativeAct === 'ConfirmValueAct');
            __1.okIf(this.state.value === Number.parseInt(valueStr, 10));
            this.handleFunc = this.handleFeedbackNoAndValueNotChangedWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleFeedbackNoAndValueNotChangedWhenConfirmingValue(input, resultBuilder) {
        this.state.activeInitiativeAct = undefined;
        resultBuilder.addAct(new ContentActs_1.InformConfusingDisconfirmationAct(this, { value: this.state.value, reasonCode: 'DisconfirmedWithSameValue' }));
        this.commonHandlerWhenValueRejected(input, resultBuilder);
    }
    isFeedbackNoAndValueChangedWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isSingleValueControlIntent(input, __1.AmazonBuiltInSlotType.NUMBER));
            const { feedback, action, target, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(__1.InputUtil.feedbackIsFalse(feedback));
            __1.okIf(__1.InputUtil.valueStrDefined(valueStr));
            __1.okIf(this.state.activeInitiativeAct === 'ConfirmValueAct');
            __1.okIf(this.state.value !== Number.parseInt(valueStr, 10));
            this.handleFunc = this.handleFeedbackNoAndValueChangedWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleFeedbackNoAndValueChangedWhenConfirmingValue(input, resultBuilder) {
        const { action, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
        this.setValue(valueStr);
        this.commonHandlerWhenValueChanged(action !== null && action !== void 0 ? action : Strings_1.Strings.Action.Set, input, resultBuilder);
    }
    isFeedbackYesAndValueChangedWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isSingleValueControlIntent(input, __1.AmazonBuiltInSlotType.NUMBER));
            const { feedback, action, target, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(__1.InputUtil.feedbackIsTrue(feedback));
            __1.okIf(__1.InputUtil.valueStrDefined(valueStr));
            __1.okIf(this.state.activeInitiativeAct === 'ConfirmValueAct');
            __1.okIf(this.state.value !== Number.parseInt(valueStr, 10));
            this.handleFunc = this.handleFeedbackYesAndValueChangedWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleFeedbackYesAndValueChangedWhenConfirmingValue(input, resultBuilder) {
        const { action, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
        const previousValue = this.state.value;
        this.setValue(valueStr);
        resultBuilder.addAct(new ContentActs_1.InformConfusingConfirmationAct(this, { value: previousValue, reasonCode: 'ConfirmedWithDifferentValue' }));
        this.state.activeInitiativeAct = 'ConfirmValueAct';
        resultBuilder.addAct(new InitiativeActs_1.ConfirmValueAct(this, { value: this.state.value }));
    }
    isBareYesConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isBareYes(input));
            __1.okIf(this.state.activeInitiativeAct === 'ConfirmValueAct');
            this.handleFunc = this.handleFeedbackYesAndValueNotChangedOrUndefinedWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    isFeedbackYesAndValueNotChangedWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isSingleValueControlIntent(input, __1.AmazonBuiltInSlotType.NUMBER));
            const { feedback, action, target, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(__1.InputUtil.feedbackIsTrue(feedback));
            __1.okIf(this.state.activeInitiativeAct === 'ConfirmValueAct');
            __1.okIf(this.state.value === Number.parseInt(valueStr, 10));
            this.handleFunc = this.handleFeedbackYesAndValueNotChangedOrUndefinedWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    isFeedbackYesAndValueUndefinedWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(__1.InputUtil.feedbackIsTrue(feedback));
            __1.okIf(this.state.activeInitiativeAct === 'ConfirmValueAct');
            this.handleFunc = this.handleFeedbackYesAndValueNotChangedOrUndefinedWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleFeedbackYesAndValueNotChangedOrUndefinedWhenConfirmingValue(input, resultBuilder) {
        this.state.isValueConfirmed = true;
        this.state.activeInitiativeAct = undefined;
        resultBuilder.addAct(new ContentActs_1.ValueConfirmedAct(this, { value: this.state.value }));
    }
    isFeedbackUndefinedAndValueNotChangedWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isSingleValueControlIntent(input, __1.AmazonBuiltInSlotType.NUMBER));
            const { feedback, action, target, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(__1.InputUtil.feedbackIsUndefined(feedback));
            __1.okIf(__1.InputUtil.valueStrDefined(valueStr));
            __1.okIf(this.state.activeInitiativeAct === 'ConfirmValueAct');
            __1.okIf(this.state.value === Number.parseInt(valueStr, 10));
            this.handleFunc = this.handleFeedbackYesAndValueUndefinedWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleFeedbackYesAndValueUndefinedWhenConfirmingValue(input, resultBuilder) {
        this.state.isValueConfirmed = true;
        this.state.activeInitiativeAct = undefined;
        resultBuilder.addAct(new ContentActs_1.ValueConfirmedAct(this, { value: this.state.value }));
    }
    isFeedbackUndefinedAndValueChangedWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isSingleValueControlIntent(input, __1.AmazonBuiltInSlotType.NUMBER));
            const { feedback, action, target, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(__1.InputUtil.feedbackIsUndefined(feedback));
            __1.okIf(__1.InputUtil.valueStrDefined(valueStr));
            __1.okIf(this.state.value !== Number.parseInt(valueStr, 10));
            this.handleFunc = this.handleFeedbackUndefinedAndValueChangedWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleFeedbackUndefinedAndValueChangedWhenConfirmingValue(input, resultBuilder) {
        const { action, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
        this.setValue(valueStr);
        this.commonHandlerWhenValueChanged(action !== null && action !== void 0 ? action : Strings_1.Strings.Action.Set, input, resultBuilder);
    }
    isTargetsMatchWithoutFeedbackNorValueWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.feedbackIsUndefined(feedback));
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatch(target, lodash_1.default.without(this.props.interactionModel.targets, Strings_1.Strings.Target.It)));
            this.handleFunc = this.handleTargetMatchWithoutFeedbackNorValueWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleTargetMatchWithoutFeedbackNorValueWhenConfirmingValue(input, resultBuilder) {
        resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
    }
    commonHandlerWhenValueChanged(action, input, resultBuilder) {
        const validationResult = this.validateNumber(input);
        if (validationResult !== true) {
            this.state.rejectedValues.push(this.state.value);
            resultBuilder.addAct(new ContentActs_1.InvalidValueAct(this, { value: this.state.value, renderedReason: validationResult.renderedReason }));
            resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
        }
        else if (!this.isConfirmationRequired(input)) {
            this.state.isValueConfirmed = true;
            this.state.activeInitiativeAct = undefined;
            resultBuilder.addAct(new ContentActs_1.ValueSetAct(this, { value: this.state.value }));
        }
        else {
            this.state.activeInitiativeAct = 'ConfirmValueAct';
            resultBuilder.addAct(new InitiativeActs_1.ConfirmValueAct(this, { value: this.state.value }));
        }
    }
    /* TODO: bug: User's action has to be used in this function to form the response
     * prompt, need to define action in the related payloadType This will fix
     * the following: U: No, {change} the value please A: What value do you want
     * to {change} to?
     */
    commonHandlerWhenValueRejected(input, resultBuilder) {
        this.state.rejectedValues.push(this.state.value);
        const ambiguousPartner = this.getAmbiguousPartner(this.state.value);
        if (ambiguousPartner !== undefined && !this.state.rejectedValues.includes(ambiguousPartner)) {
            const previousValue = this.state.value;
            this.state.value = ambiguousPartner;
            const validationResult = this.validateNumber(input);
            if (validationResult === true) {
                // this is to confirm from users for the suggestedValue
                this.state.activeInitiativeAct = 'ConfirmValueAct';
                resultBuilder.addAct(new InitiativeActs_1.SuggestValueAct(this, { value: this.state.value }));
            }
            else {
                this.state.value = previousValue;
                resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
            }
        }
        else {
            resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
        }
    }
    wantsToElicitValue(input) {
        if (this.evaluateBooleanProp(this.props.required, input) && this.state.value === undefined) {
            this.initiativeFunc = this.elicitValue;
            return true;
        }
        return false;
    }
    elicitValue(input, resultBuilder) {
        resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
    }
    wantsToFixInvalidValue(input) {
        if (!this.evaluateBooleanProp(this.props.required, input) || this.state.value === undefined) {
            return false;
        }
        const validationResult = this.validateNumber(input);
        if (validationResult === true) {
            return false;
        }
        this.initiativeFunc = this.fixInvalidValue;
        return true;
    }
    fixInvalidValue(input, resultBuilder) {
        const validationResult = this.validateNumber(input);
        resultBuilder.addAct(new ContentActs_1.InvalidValueAct(this, {
            value: this.state.value,
            reasonCode: 'ValueInvalid',
            renderedReason: validationResult.renderedReason
        }));
        resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
    }
    wantsToConfirmValue(input) {
        if (!this.evaluateBooleanProp(this.props.required, input) || this.state.value === undefined) {
            return false;
        }
        if (this.state.isValueConfirmed || !this.isConfirmationRequired(input)) {
            return false;
        }
        this.initiativeFunc = this.confirmValue;
        return true;
    }
    confirmValue(input, resultBuilder) {
        this.state.activeInitiativeAct = 'ConfirmValueAct';
        resultBuilder.addAct(new InitiativeActs_1.ConfirmValueAct(this, { value: this.state.value }));
    }
    validateNumber(input) {
        const listOfValidationFunc = typeof (this.props.validation) === 'function' ? [this.props.validation] : this.props.validation;
        for (const validationFunction of listOfValidationFunc) {
            const validationResult = validationFunction(this.state, input);
            if (validationResult !== true) {
                log.debug(`NumberControl.validate(): validation failed. Reason: ${JSON.stringify(validationResult, null, 2)}.`);
                return validationResult;
            }
        }
        return true;
    }
    isConfirmationRequired(input) {
        if (typeof this.props.confirmationRequired === 'function') {
            return this.props.confirmationRequired(this.state, input);
        }
        else if (typeof this.props.confirmationRequired === 'boolean') {
            return this.props.confirmationRequired;
        }
        else {
            return true; // by default confirmation is required
        }
    }
    getAmbiguousPartner(value) {
        const pairs = this.props.ambiguousPairs;
        for (const pair of pairs) {
            if (pair[0] === value) {
                return pair[1];
            }
            else if (pair[1] === value) {
                return pair[0];
            }
        }
        return undefined;
    }
}
exports.NumberControl = NumberControl;
/**
 * Creates an elicit-slot directive for the provided slotType.
 *
 * - The intent specified is a `AMAZON_NUMBER_ValueControlIntent`
 * - The slot specified is the `slotType` slot.
 *
 * @param slotType - Slot type
 */
function generateSlotElicitation() {
    const intent = {
        name: __1.SingleValueControlIntent.intentName(__1.AmazonBuiltInSlotType.NUMBER),
        slots: {
            "AMAZON.NUMBER": { name: "AMAZON.NUMBER", value: '', confirmationStatus: 'NONE' },
            "feedback": { name: "feedback", value: '', confirmationStatus: 'NONE' },
            "action": { name: "action", value: '', confirmationStatus: 'NONE' },
            "target": { name: "target", value: '', confirmationStatus: 'NONE' },
            "head": { name: "head", value: '', confirmationStatus: 'NONE' },
            "tail": { name: "tail", value: '', confirmationStatus: 'NONE' },
            "preposition": { name: "preposition", value: '', confirmationStatus: 'NONE' },
        },
        confirmationStatus: "NONE"
    };
    return {
        intent,
        slotName: __1.AmazonBuiltInSlotType.NUMBER
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTnVtYmVyQ29udHJvbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21tb25Db250cm9scy9OdW1iZXJDb250cm9sLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7R0FXRzs7OztBQUdILDhEQUE4QjtBQUM5Qiw0REFBdUI7QUFDdkIsMEJBQXdKO0FBQ3hKLGtEQUFvRDtBQUNwRCxpREFBMEU7QUFLMUUsMEVBQW1HO0FBRW5HLHlFQUFxRjtBQUNyRiw4Q0FBMkM7QUFFM0MsMkRBQStNO0FBQy9NLGlFQUFpRztBQUtqRyxNQUFNLEdBQUcsR0FBRyxJQUFJLGVBQU0sQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0FBdUx2RDs7R0FFRztBQUNILE1BQWEsa0JBQWtCO0lBQS9CO1FBT0k7O1dBRUc7UUFDSCxxQkFBZ0IsR0FBWSxLQUFLLENBQUM7UUFPbEM7O1dBRUc7UUFDSCxtQkFBYyxHQUFhLEVBQUUsQ0FBQztJQUNsQyxDQUFDO0NBQUE7QUFyQkQsZ0RBcUJDO0FBRUQ7Ozs7Ozs7Ozs7Ozs7O0dBY0c7QUFDSCxNQUFhLGFBQWMsU0FBUSxpQkFBTztJQVF0QyxZQUFZLEtBQXlCO1FBQ2pDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7UUFScEIsVUFBSyxHQUF1QixJQUFJLGtCQUFrQixFQUFFLENBQUM7UUFTakQsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7UUFDdEIsSUFBSSxDQUFDLEtBQUssR0FBRyxhQUFhLENBQUMscUJBQXFCLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDNUQsQ0FBQztJQUVELE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxLQUF5QjtRQUNsRCxNQUFNLFFBQVEsR0FBcUM7WUFDL0MsRUFBRSxFQUFFLGFBQWE7WUFDakIsZ0JBQWdCLEVBQUU7Z0JBQ2QsT0FBTyxFQUFFO29CQUNMLEdBQUcsRUFBRSxDQUFDLGlCQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FB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RUFBRSxFQUFFLGtCQUFrQixFQUFFLE1BQU0sRUFBRTtTQUNoRjtRQUNELGtCQUFrQixFQUFFLE1BQU07S0FDN0IsQ0FBQztJQUVGLE9BQU87UUFDSCxNQUFNO1FBQ04sUUFBUSxFQUFFLHlCQUFxQixDQUFDLE1BQU07S0FDekMsQ0FBQztBQUNOLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMjAgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuXG4gKiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBvciBpbiB0aGUgXCJsaWNlbnNlXCIgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWRcbiAqIG9uIGFuIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlclxuICogZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmdcbiAqIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBJbnRlbnQsIEludGVudFJlcXVlc3QgfSBmcm9tIFwiYXNrLXNkay1tb2RlbFwiO1xuaW1wb3J0IGkxOG5leHQgZnJvbSAnaTE4bmV4dCc7XG5pbXBvcnQgXyBmcm9tIFwibG9kYXNoXCI7XG5pbXBvcnQgeyBBbWF6b25CdWlsdEluU2xvdFR5cGUsIERlZXBSZXF1aXJlZCwgZmFsc2VJZkd1YXJkRmFpbGVkLCBJbnB1dFV0aWwsIG9rSWYsIFNpbmdsZVZhbHVlQ29udHJvbEludGVudCwgdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50IH0gZnJvbSAnLi4nO1xuaW1wb3J0IHsgU3RyaW5ncyBhcyAkIH0gZnJvbSBcIi4uL2NvbnN0YW50cy9TdHJpbmdzXCI7XG5pbXBvcnQgeyBDb250cm9sLCBDb250cm9sUHJvcHMsIENvbnRyb2xTdGF0ZSB9IGZyb20gJy4uL2NvbnRyb2xzL0NvbnRyb2wnO1xuaW1wb3J0IHsgQ29udHJvbElucHV0IH0gZnJvbSAnLi4vY29udHJvbHMvQ29udHJvbElucHV0JztcbmltcG9ydCB7IENvbnRyb2xSZXN1bHRCdWlsZGVyIH0gZnJvbSAnLi4vY29udHJvbHMvQ29udHJvbFJlc3VsdCc7XG5pbXBvcnQgeyBJbnRlcmFjdGlvbk1vZGVsQ29udHJpYnV0b3IgfSBmcm9tICcuLi9jb250cm9scy9taXhpbnMvSW50ZXJhY3Rpb25Nb2RlbENvbnRyaWJ1dG9yJztcbmltcG9ydCB7IFZhbGlkYXRpb25SZXN1bHQgfSBmcm9tICcuLi9jb250cm9scy9WYWxpZGF0aW9uUmVzdWx0JztcbmltcG9ydCB7IEdlbmVyYWxDb250cm9sSW50ZW50LCB1bnBhY2tHZW5lcmFsQ29udHJvbEludGVudCB9IGZyb20gJy4uL2ludGVudHMvR2VuZXJhbENvbnRyb2xJbnRlbnQnO1xuaW1wb3J0IHsgQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3IgfSBmcm9tICcuLi9pbnRlcmFjdGlvbk1vZGVsR2VuZXJhdGlvbi9Db250cm9sSW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvcic7XG5pbXBvcnQgeyBNb2RlbERhdGEsIFNoYXJlZFNsb3RUeXBlIH0gZnJvbSAnLi4vaW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRpb24vTW9kZWxUeXBlcyc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi9sb2dnaW5nL0xvZ2dlcic7XG5pbXBvcnQgeyBDb250cm9sUmVzcG9uc2VCdWlsZGVyIH0gZnJvbSAnLi4vcmVzcG9uc2VHZW5lcmF0aW9uL0NvbnRyb2xSZXNwb25zZUJ1aWxkZXInO1xuaW1wb3J0IHsgSW5mb3JtQ29uZnVzaW5nQ29uZmlybWF0aW9uQWN0LCBJbmZvcm1Db25mdXNpbmdEaXNjb25maXJtYXRpb25BY3QsIEludmFsaWRWYWx1ZUFjdCwgUHJvYmxlbWF0aWNJbnB1dFZhbHVlQWN0LCBWYWx1ZUNvbmZpcm1lZEFjdCwgVmFsdWVEaXNjb25maXJtZWRBY3QsIFZhbHVlU2V0QWN0IH0gZnJvbSBcIi4uL3N5c3RlbUFjdHMvQ29udGVudEFjdHNcIjtcbmltcG9ydCB7IENvbmZpcm1WYWx1ZUFjdCwgUmVxdWVzdFZhbHVlQWN0LCBTdWdnZXN0VmFsdWVBY3QgfSBmcm9tICcuLi9zeXN0ZW1BY3RzL0luaXRpYXRpdmVBY3RzJztcbmltcG9ydCB7IFN5c3RlbUFjdCB9IGZyb20gJy4uL3N5c3RlbUFjdHMvU3lzdGVtQWN0JztcbmltcG9ydCB7IFN0cmluZ09yTGlzdCB9IGZyb20gJy4uL3V0aWxzL0Jhc2ljVHlwZXMnO1xuXG5cbmNvbnN0IGxvZyA9IG5ldyBMb2dnZXIoJ0Fza1Nka0NvbnRyb2xzOk51bWJlckNvbnRyb2wnKTtcblxuXG4vKipcbiAqIFByb3BzIGZvciBhIE51bWJlckNvbnRyb2wuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTnVtYmVyQ29udHJvbFByb3BzIGV4dGVuZHMgQ29udHJvbFByb3BzIHtcblxuICAgIC8qKlxuICAgICAqIFVuaXF1ZSBpZGVudGlmaWVyIGZvciBjb250cm9sIGluc3RhbmNlXG4gICAgICovXG4gICAgaWQ6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uKHMpIHRoYXQgZGV0ZXJtaW5lIGlmIHRoZSB2YWx1ZSBpcyB2YWxpZC5cbiAgICAgKlxuICAgICAqIERlZmF1bHQ6IGB0cnVlYCwgaS5lLiBhbnkgdmFsdWUgaXMgdmFsaWQuXG4gICAgICpcbiAgICAgKiBVc2FnZTpcbiAgICAgKiAtIFZhbGlkYXRpb24gZnVuY3Rpb25zIHJldHVybiBlaXRoZXIgYHRydWVgIG9yIGEgYFZhbGlkYXRpb25SZXN1bHRgIHRvXG4gICAgICogICBkZXNjcmliZSB3aGF0IHZhbGlkYXRpb24gZmFpbGVkLlxuICAgICAqL1xuICAgIHZhbGlkYXRpb24/OiBOdW1iZXJWYWxpZGF0aW9uRnVuY3Rpb24gfCBOdW1iZXJWYWxpZGF0aW9uRnVuY3Rpb25bXTtcblxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgaWYgdGhlIENvbnRyb2wgbXVzdCBvYnRhaW4gYSB2YWx1ZS5cbiAgICAgKlxuICAgICAqIElmIGB0cnVlYDpcbiAgICAgKiAgLSB0aGUgQ29udHJvbCByZXBvcnQgaXNSZWFkeSgpID0gZmFsc2UgaWYgbm8gdmFsdWUgaGFzIGJlZW4gb2J0YWluZWQuXG4gICAgICogIC0gdGhlIGNvbnRyb2wgd2lsbCB0YWtlIHRoZSBpbml0aWF0aXZlIHdoZW4gZ2l2ZW4gdGhlIG9wcG9ydHVuaXR5LlxuICAgICAqL1xuICAgIHJlcXVpcmVkPzogYm9vbGVhbiB8ICgoaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gYm9vbGVhbik7XG5cbiAgICAvKipcbiAgICAgKiBQcm9wcyB0byBjdXN0b21pemUgdGhlIHByb21wdCBmcmFnbWVudHMgdGhhdCB3aWxsIGJlIGFkZGVkIGJ5IGB0aGlzLnJlbmRlckFjdCgpYC5cbiAgICAgKi9cbiAgICBwcm9tcHRzPzogTnVtYmVyQ29udHJvbFByb21wdHNQcm9wcztcblxuXG4gICAgLyoqXG4gICAgICogUHJvcHMgdG8gY3VzdG9taXplIHRoZSByZXByb21wdCBmcmFnbWVudHMgdGhhdCB3aWxsIGJlIGFkZGVkIGJ5IGB0aGlzLnJlbmRlckFjdCgpYC5cbiAgICAgKi9cbiAgICByZXByb21wdHM/OiBOdW1iZXJDb250cm9sUHJvbXB0c1Byb3BzO1xuXG4gICAgLyoqXG4gICAgICogV2hldGhlciB0aGUgQ29udHJvbCBoYXMgdG8gb2J0YWluIGV4cGxpY2l0IGNvbmZpcm1hdGlvbiBvZiB0aGUgdmFsdWUuXG4gICAgICpcbiAgICAgKiBJZiBgdHJ1ZWA6XG4gICAgICogIC0gdGhlIENvbnRyb2wgd2lsbCByZXBvcnQgYGlzUmVhZHkoKSA9IGZhbHNlYCBpZiB0aGUgdmFsdWUgaGFzIG5vdCBiZWVuXG4gICAgICogICAgZXhwbGljaXRseSBjb25maXJtZWQgYXMgY29ycmVjdCBieSB1c2VyLlxuICAgICAqICAtIHRoZSBDb250cm9sIHdpbGwgdGFrZSB0aGUgaW5pdGlhdGl2ZSB3aGVuIGdpdmVuIHRoZSBvcHBvcnR1bml0eS5cbiAgICAgKi9cbiAgICBjb25maXJtYXRpb25SZXF1aXJlZD86IGJvb2xlYW4gfCBOdW1iZXJDb25maXJtYXRpb25SZXF1aXJlRnVuY3Rpb247XG5cbiAgICAvLyBUT0RPOiBmZWF0dXJlLiBnZW5lcmFsaXplIHRoaXMgdG8gXCJ2YWx1ZVRvU3VnZ2VzdFwiXG4gICAgLyoqXG4gICAgICogTGlzdCBvZiB2YWx1ZS1wYWlycyB0aGF0IGFyZSBrbm93biB0byBiZSBmcmVxdWVudGx5IG1pc3VuZGVyc3Rvb2QgYnkgTkxVXG4gICAgICpcbiAgICAgKiBDb250cm9sIGJlaGF2aW9yOlxuICAgICAqIC0gSWYgdGhlIHVzZXIgZGlzYWZmaXJtcyBvbmUgdmFsdWUgb2YgYSBwYWlyLCB0aGUgb3RoZXIgd2lsbCBiZVxuICAgICAqICAgc3VnZ2VzdGVkLlxuICAgICAqL1xuICAgIGFtYmlndW91c1BhaXJzPzogQXJyYXk8W251bWJlciwgbnVtYmVyXT47XG5cbiAgICAvKipcbiAgICAgKiBQcm9wcyB0byBjdXN0b21pemUgdGhlIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIHRoZSBjb250cm9sIGFuZCB0aGVcbiAgICAgKiBpbnRlcmFjdGlvbiBtb2RlbC5cbiAgICAgKi9cbiAgICBpbnRlcmFjdGlvbk1vZGVsPzogTnVtYmVyQ29udHJvbEludGVyYWN0aW9uTW9kZWxQcm9wcztcbn1cblxuLyoqXG4gKiBOdW1iZXJDb250cm9sIHZhbGlkYXRpb24gZnVuY3Rpb25cbiAqL1xuZXhwb3J0IHR5cGUgTnVtYmVyVmFsaWRhdGlvbkZ1bmN0aW9uID0gKHN0YXRlOiBOdW1iZXJDb250cm9sU3RhdGUsIGlucHV0OiBDb250cm9sSW5wdXQpID0+IHRydWUgfCBWYWxpZGF0aW9uUmVzdWx0O1xuXG4vKipcbiAqIE51bWJlckNvbnRyb2wgaXNSZXF1aXJlZCBmdW5jdGlvblxuICovXG5leHBvcnQgdHlwZSBOdW1iZXJDb25maXJtYXRpb25SZXF1aXJlRnVuY3Rpb24gPSAoc3RhdGU6IE51bWJlckNvbnRyb2xTdGF0ZSwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gYm9vbGVhbjtcblxuXG4vKipcbiAqIE1hcHBpbmcgb2YgYWN0aW9uIHNsb3QgdmFsdWVzIHRvIHRoZSBiZWhhdmlvcnMgdGhhdCB0aGlzIGNvbnRyb2wgc3VwcG9ydHMuXG4gKlxuICogQmVoYXZpb3I6XG4gKiAtIFRoaXMgY29udHJvbCB3aWxsIG5vdCBoYW5kbGUgYW4gaW5wdXQgaWYgdGhlIGFjdGlvbi1zbG90IGlzIGZpbGxlZCB3aXRoIGFuXG4gKiAgIHZhbHVlIHdob3NlIElEIGlzIG5vdCBhc3NvY2lhdGVkIHdpdGggYSBjYXBhYmlsaXR5LlxuICovXG5leHBvcnQgdHlwZSBOdW1iZXJDb250cm9sQWN0aW9uUHJvcHMgPSB7XG4gICAgLyoqXG4gICAgICogQWN0aW9uIHNsb3QgdmFsdWUgSURzIHRoYXQgYXJlIGFzc29jaWF0ZWQgd2l0aCB0aGUgXCJzZXQgdmFsdWVcIiBjYXBhYmlsaXR5LlxuICAgICAqXG4gICAgICogRGVmYXVsdDogWydidWlsdGluX3NldCddXG4gICAgICovXG4gICAgc2V0Pzogc3RyaW5nW107XG5cbiAgICAvKipcbiAgICAgKiBBY3Rpb24gc2xvdCB2YWx1ZSBJRHMgdGhhdCBhcmUgYXNzb2NpYXRlZCB3aXRoIHRoZSBcImNoYW5nZSB2YWx1ZVwiIGNhcGFiaWxpdHkuXG4gICAgICpcbiAgICAgKiBEZWZhdWx0IFsnYnVpbHRpbl9jaGFuZ2UnXVxuICAgICAqL1xuICAgIGNoYW5nZT86IHN0cmluZ1tdO1xufTtcblxuLyoqXG4gKiBQcm9wcyBhc3NvY2lhdGVkIHdpdGggdGhlIGludGVyYWN0aW9uIG1vZGVsLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIE51bWJlckNvbnRyb2xJbnRlcmFjdGlvbk1vZGVsUHJvcHMge1xuICAgIC8qKlxuICAgICAqIFRhcmdldC1zbG90IHZhbHVlcyBhc3NvY2lhdGVkIHdpdGggdGhpcyBDb250cm9sLlxuICAgICAqXG4gICAgICogVGFyZ2V0cyBhc3NvY2lhdGUgdXR0ZXJhbmNlcyB0byBhIGNvbnRyb2wuIEZvciBleGFtcGxlLCBpZiB0aGUgdXNlciBzYXlzXG4gICAgICogXCJjaGFuZ2UgdGhlIHRpbWVcIiwgaXQgaXMgcGFyc2VkIGFzIGEgYEdlbmVyYWxDb250cm9sSW50ZW50YCB3aXRoIHNsb3RcbiAgICAgKiB2YWx1ZXMgYGFjdGlvbiA9IGNoYW5nZWAgYW5kIGB0YXJnZXQgPSB0aW1lYC4gIE9ubHkgY29udHJvbHMgdGhhdCBhcmVcbiAgICAgKiByZWdpc3RlcmVkIHdpdGggdGhlIGB0aW1lYCB0YXJnZXQgc2hvdWxkIG9mZmVyIHRvIGhhbmRsZSB0aGlzIGludGVudC5cbiAgICAgKlxuICAgICAqIERlZmF1bHQ6IFsnYnVpbHRpbl9pdCddXG4gICAgICpcbiAgICAgKiBVc2FnZTpcbiAgICAgKiAtIElmIHRoaXMgcHJvcCBpcyBkZWZpbmVkLCBpdCByZXBsYWNlcyB0aGUgZGVmYXVsdDsgaXQgaXMgbm90IGFkZGl0aXZlXG4gICAgICogICB0aGUgZGVmYXVsdHMuICBUbyBhZGQgYW4gYWRkaXRpb25hbCB0YXJnZXQgdG8gdGhlIGRlZmF1bHRzLCBjb3B5IHRoZVxuICAgICAqICAgZGVmYXVsdHMgYW5kIGFtZW5kLlxuICAgICAqIC0gQSBjb250cm9sIGNhbiBiZSBhc3NvY2lhdGVkIHdpdGggbWFueSB0YXJnZXQtc2xvdC12YWx1ZXMsIGVnIFsnZGF0ZScsXG4gICAgICogICAnc3RhcnREYXRlJywgJ2V2ZW50U3RhcnREYXRlJywgJ3ZhY2F0aW9uU3RhcnQnXVxuICAgICAqIC0gSXQgaXMgYSBnb29kIGlkZWEgdG8gYXNzb2NpYXRlIHdpdGggZ2VuZXJhbCB0YXJnZXRzIChlLmcuIGRhdGUpIGFuZFxuICAgICAqICAgYWxzbyB3aXRoIHNwZWNpZmljIHRhcmdldHMgKGUuZy4gdmFjYXRpb25TdGFydCkgc28gdGhhdCB0aGUgdXNlciBjYW5cbiAgICAgKiAgIHNheSBlaXRoZXIgZ2VuZXJhbCBvciBzcGVjaWZpYyB0aGluZ3MuICBlLmcuICdjaGFuZ2UgdGhlIGRhdGUgdG9cbiAgICAgKiAgIFR1ZXNkYXknLCBvciAnSSB3YW50IG15IHZhY2F0aW9uIHRvIHN0YXJ0IG9uIFR1ZXNkYXknLlxuICAgICAqIC0gVGhlIGFzc29jaWF0aW9uIGRvZXMgbm90IGhhdmUgdG8gYmUgZXhjbHVzaXZlLCBhbmQgZ2VuZXJhbCB0YXJnZXQgc2xvdFxuICAgICAqICAgdmFsdWVzIHdpbGwgb2Z0ZW4gYmUgYXNzb2NpYXRlZCB3aXRoIG1hbnkgY29udHJvbHMuIEluIHNpdHVhdGlvbnMgd2hlcmVcbiAgICAgKiAgIHRoZXJlIGlzIGFtYmlndWl0eSBhYm91dCB3aGF0IHRoZSB1c2VyIGlzIHJlZmVycmluZyB0bywgdGhlIHBhcmVudFxuICAgICAqICAgY29udHJvbHMgbXVzdCByZXNvbHZlIHRoZSBjb25mdXNpb24uXG4gICAgICogLSBUaGUgJ2J1aWx0aW5fKicgSURzIGFyZSBhc3NvY2lhdGVkIHdpdGggZGVmYXVsdCBpbnRlcmFjdGlvbiBtb2RlbCBkYXRhXG4gICAgICogICAod2hpY2ggY2FuIGJlIGV4dGVuZGVkIGFzIGRlc2lyZWQpLiBBbnkgb3RoZXIgSURzIHdpbGwgcmVxdWlyZSBhIGZ1bGxcbiAgICAgKiAgIGRlZmluaXRpb24gb2YgdGhlIGFsbG93ZWQgc3lub255bXMgaW4gdGhlIGludGVyYWN0aW9uIG1vZGVsLlxuICAgICAqXG4gICAgICogQ29udHJvbCBiZWhhdmlvcjpcbiAgICAgKiAtIEEgY29udHJvbCB3aWxsIG5vdCBoYW5kbGUgYW4gaW5wdXQgdGhhdCBtZW50aW9ucyBhIHRhcmdldCB0aGF0IGlzIG5vdFxuICAgICAqICAgcmVnaXN0ZXJlZCBieSB0aGlzIHByb3AuXG4gICAgICpcbiAgICAgKi9cbiAgICB0YXJnZXRzPzogc3RyaW5nW107XG5cbiAgICAvKipcbiAgICAgKiBBY3Rpb24gc2xvdC12YWx1ZXMgYXNzb2NpYXRlZCB0byB0aGUgY29udHJvbCdzIGNhcGFiaWxpdGllcy5cbiAgICAgKlxuICAgICAqIEFjdGlvbiBzbG90LXZhbHVlcyBhc3NvY2lhdGUgdXR0ZXJhbmNlcyB0byBhIGNvbnRyb2wuIEZvciBleGFtcGxlLCBpZiB0aGVcbiAgICAgKiB1c2VyIHNheXMgXCJjaGFuZ2UgdGhlIHRpbWVcIiwgaXQgaXMgcGFyc2VkIGFzIGEgYEdlbmVyYWxDb250cm9sSW50ZW50YFxuICAgICAqIHdpdGggc2xvdCB2YWx1ZXMgYGFjdGlvbiA9IGNoYW5nZWAgYW5kIGB0YXJnZXQgPSB0aW1lYC4gIE9ubHkgY29udHJvbHNcbiAgICAgKiB0aGF0IGFyZSByZWdpc3RlcmVkIHdpdGggdGhlIGBjaGFuZ2VgIGFjdGlvbiBzaG91bGQgb2ZmZXIgdG8gaGFuZGxlIHRoaXNcbiAgICAgKiBpbnRlbnQuXG4gICAgICpcbiAgICAgKiBVc2FnZTpcbiAgICAgKiAgLSBUaGlzIGFsbG93cyB1c2VycyB0byByZWZlciB0byBhbiBhY3Rpb24gdXNpbmcgbW9yZSBkb21haW4tYXBwcm9wcmlhdGVcbiAgICAgKiAgICB3b3Jkcy4gRm9yIGV4YW1wbGUsIGEgdXNlciBtaWdodCBsaWtlIHRvIHNheSAnc2hvdyB0d28gaXRlbXMnIHJhdGhlclxuICAgICAqICAgIHRoYXQgJ3NldCBpdGVtIGNvdW50IHRvIHR3bycuICBUbyBhY2hpZXZlIHRoaXMsIGluY2x1ZGUgdGhlXG4gICAgICogICAgc2xvdC12YWx1ZS1pZCAnc2hvdycgaW4gdGhlIGxpc3QgYXNzb2NpYXRlZCB3aXRoIHRoZSAnc2V0JyBjYXBhYmlsaXR5XG4gICAgICogICAgYW5kIGVuc3VyZSB0aGUgaW50ZXJhY3Rpb24tbW9kZWwgaW5jbHVkZXMgYW4gYWN0aW9uIHNsb3QgdmFsdWUgd2l0aFxuICAgICAqICAgIGlkPXNob3cgYW5kIGFwcHJvcHJpYXRlIHN5bm9ueW1zLlxuICAgICAqICAtIFRoZSAnYnVpbHRpbl8qJyBJRHMgYXJlIGFzc29jaWF0ZWQgd2l0aCBkZWZhdWx0IGludGVyYWN0aW9uIG1vZGVsIGRhdGFcbiAgICAgKiAgICAod2hpY2ggY2FuIGJlIGV4dGVuZGVkIGFzIGRlc2lyZWQpLiBBbnkgb3RoZXIgSURzIHdpbGwgcmVxdWlyZSBhIGZ1bGxcbiAgICAgKiAgICBkZWZpbml0aW9uIG9mIHRoZSBhbGxvd2VkIHN5bm9ueW1zIGluIHRoZSBpbnRlcmFjdGlvbiBtb2RlbC5cbiAgICAgKi9cbiAgICBhY3Rpb25zPzogTnVtYmVyQ29udHJvbEFjdGlvblByb3BzO1xufVxuXG4vKipcbiAqIFByb3BzIHRvIGN1c3RvbWl6ZSB0aGUgcHJvbXB0IGZyYWdtZW50cyB0aGF0IHdpbGwgYmUgYWRkZWQgYnkgYHRoaXMucmVuZGVyQWN0KClgLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIE51bWJlckNvbnRyb2xQcm9tcHRzUHJvcHMge1xuICAgIHJlcXVlc3RWYWx1ZT86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBSZXF1ZXN0VmFsdWVBY3QsIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG4gICAgY29uZmlybVZhbHVlPzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IENvbmZpcm1WYWx1ZUFjdDxudW1iZXI+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIHZhbHVlRGlzY29uZmlybWVkPzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IFZhbHVlRGlzY29uZmlybWVkQWN0PG51bWJlcj4sIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG4gICAgdmFsdWVTZXQ/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogVmFsdWVTZXRBY3Q8bnVtYmVyPiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICB2YWx1ZUNvbmZpcm1lZD86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBWYWx1ZUNvbmZpcm1lZEFjdDxudW1iZXI+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIHN1Z2dlc3RWYWx1ZT86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBTdWdnZXN0VmFsdWVBY3Q8bnVtYmVyPiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICBpbmZvcm1Db25mdXNpbmdEaXNjb25maXJtYXRpb24/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogSW5mb3JtQ29uZnVzaW5nRGlzY29uZmlybWF0aW9uQWN0PG51bWJlcj4sIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG4gICAgaW5mb3JtQ29uZnVzaW5nQ29uZmlybWF0aW9uPzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IEluZm9ybUNvbmZ1c2luZ0NvbmZpcm1hdGlvbkFjdDxudW1iZXI+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIHByb2JsZW1hdGljSW5wdXRWYWx1ZT86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBQcm9ibGVtYXRpY0lucHV0VmFsdWVBY3Q8bnVtYmVyPiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICBpbnZhbGlkVmFsdWU/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogSW52YWxpZFZhbHVlQWN0PG51bWJlcj4sIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG59XG5cbi8qKlxuICogU3RhdGUgdHJhY2tlZCBieSBhIE51bWJlckNvbnRyb2wuXG4gKi9cbmV4cG9ydCBjbGFzcyBOdW1iZXJDb250cm9sU3RhdGUgaW1wbGVtZW50cyBDb250cm9sU3RhdGUge1xuXG4gICAgLyoqXG4gICAgICogVGhlIHZhbHVlLCBhbiBpbnRlZ2VyLlxuICAgICAqL1xuICAgIHZhbHVlPzogbnVtYmVyO1xuXG4gICAgLyoqXG4gICAgICogVHJhY2tzIHdoZXRoZXIgdGhlIHZhbHVlIGhhcyBiZWVuIGV4cGxpY2l0bHkgY29uZmlybWVkIGJ5IHRoZSB1c2VyLlxuICAgICAqL1xuICAgIGlzVmFsdWVDb25maXJtZWQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIC8qKlxuICAgICAqIFRyYWNrcyB0aGUgbGFzdCBpbml0aWF0aXZlIGFjdCBmcm9tIHRoZSBjb250cm9sXG4gICAgICovXG4gICAgYWN0aXZlSW5pdGlhdGl2ZUFjdD86IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFRyYWNrcyB0aGUgdmFsdWVzIHRoZSB1c2VyIGRpc2NvbmZpcm1lZC5cbiAgICAgKi9cbiAgICByZWplY3RlZFZhbHVlczogbnVtYmVyW10gPSBbXTtcbn1cblxuLyoqXG4gKiBBIENvbnRyb2wgdGhhdCBvYnRhaW5zIGEgc2luZ2xlIGludGVnZXIgZnJvbSB0aGUgdXNlci5cbiAqXG4gKiBDYXBhYmlsaXRpZXM6XG4gKiAtIFJlcXVlc3QgYSB2YWx1ZVxuICogLSBDaGFuZ2UgYSB2YWx1ZVxuICogLSBWYWxpZGF0ZSB0aGUgdmFsdWVcbiAqIC0gQ29uZmlybSB0aGUgdmFsdWVcbiAqIC0gU3VnZ2VzdCBhIHZhbHVlLCBpZiB0aGUgdXNlciBkaXNjb25maXJtcyBhbmQgd2Uga25vdyBhIGdvb2QgYWx0ZXJuYXRpdmUgdG8gc3VnZ2VzdC5cbiAqXG4gKiBJbnRlbnRzIHRoYXQgY2FuIGJlIGhhbmRsZWQ6XG4gKiAtIGBHZW5lcmFsQ29udHJvbEludGVudGA6IEUuZy4gYFwieWVzLCB1cGRhdGUgbXkgYWdlXCJgXG4gKiAtIGBBTUFaT05fTlVNQkVSX1ZhbHVlQ29udHJvbEludGVudGA6IEUuZy4gXCJubyBjaGFuZ2UgaXQgdG8gdGhyZWVcIi5cbiAqIC0gYEFNQVpPTi5ZZXNJbnRlbnRgLCBgQU1BWk9OLk5vSW50ZW50YFxuICovXG5leHBvcnQgY2xhc3MgTnVtYmVyQ29udHJvbCBleHRlbmRzIENvbnRyb2wgaW1wbGVtZW50cyBJbnRlcmFjdGlvbk1vZGVsQ29udHJpYnV0b3Ige1xuICAgIHN0YXRlOiBOdW1iZXJDb250cm9sU3RhdGUgPSBuZXcgTnVtYmVyQ29udHJvbFN0YXRlKCk7XG5cbiAgICBwcml2YXRlIHJhd1Byb3BzOiBOdW1iZXJDb250cm9sUHJvcHM7XG4gICAgcHJpdmF0ZSBwcm9wczogRGVlcFJlcXVpcmVkPE51bWJlckNvbnRyb2xQcm9wcz47XG4gICAgcHJpdmF0ZSBoYW5kbGVGdW5jPzogKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKSA9PiB2b2lkO1xuICAgIHByaXZhdGUgaW5pdGlhdGl2ZUZ1bmM/OiAoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpID0+IHZvaWQ7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogTnVtYmVyQ29udHJvbFByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzLmlkKTtcbiAgICAgICAgdGhpcy5yYXdQcm9wcyA9IHByb3BzO1xuICAgICAgICB0aGlzLnByb3BzID0gTnVtYmVyQ29udHJvbC5tZXJnZVdpdGhEZWZhdWx0UHJvcHMocHJvcHMpO1xuICAgIH1cblxuICAgIHN0YXRpYyBtZXJnZVdpdGhEZWZhdWx0UHJvcHMocHJvcHM6IE51bWJlckNvbnRyb2xQcm9wcyk6IERlZXBSZXF1aXJlZDxOdW1iZXJDb250cm9sUHJvcHM+IHtcbiAgICAgICAgY29uc3QgZGVmYXVsdHM6IERlZXBSZXF1aXJlZDxOdW1iZXJDb250cm9sUHJvcHM+ID0ge1xuICAgICAgICAgICAgaWQ6ICdwbGFjZWhvbGRlcicsXG4gICAgICAgICAgICBpbnRlcmFjdGlvbk1vZGVsOiB7XG4gICAgICAgICAgICAgICAgYWN0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICBzZXQ6IFskLkFjdGlvbi5TZXRdLFxuICAgICAgICAgICAgICAgICAgICBjaGFuZ2U6IFskLkFjdGlvbi5DaGFuZ2VdLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdGFyZ2V0czogWyQuVGFyZ2V0Lk51bWJlciwgJC5UYXJnZXQuSXRdXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcHJvbXB0czoge1xuICAgICAgICAgICAgICAgIHJlcXVlc3RWYWx1ZTogaTE4bmV4dC50KCdOVU1CRVJfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9SRVFVRVNUX1ZBTFVFJyksXG4gICAgICAgICAgICAgICAgY29uZmlybVZhbHVlOiAoYWN0KSA9PiBpMThuZXh0LnQoJ05VTUJFUl9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX0NPTkZJUk1fVkFMVUUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICB2YWx1ZURpc2NvbmZpcm1lZDogaTE4bmV4dC50KCdOVU1CRVJfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9WQUxVRV9ESVNBRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgIHZhbHVlU2V0OiAoYWN0KSA9PiBpMThuZXh0LnQoJ05VTUJFUl9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1ZBTFVFX1NFVCcsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgIHZhbHVlQ29uZmlybWVkOiBpMThuZXh0LnQoJ05VTUJFUl9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1ZBTFVFX0FGRklSTUVEJyksXG4gICAgICAgICAgICAgICAgc3VnZ2VzdFZhbHVlOiAoYWN0KSA9PiBpMThuZXh0LnQoJ05VTUJFUl9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1NVR0dFU1RfVkFMVUUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICBpbmZvcm1Db25mdXNpbmdEaXNjb25maXJtYXRpb246IChhY3QpID0+IGkxOG5leHQudCgnTlVNQkVSX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfSU5GT1JNX0NPTkZVU0lOR19ESVNDT05GSVJNQVRJT04nKSxcbiAgICAgICAgICAgICAgICBpbmZvcm1Db25mdXNpbmdDb25maXJtYXRpb246IChhY3QpID0+IGkxOG5leHQudCgnTlVNQkVSX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfSU5GT1JNX0NPTkZVU0lOR19DT05GSVJNQVRJT04nLCB7IHByZXZpb3VzVmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgIHByb2JsZW1hdGljSW5wdXRWYWx1ZTogKGFjdCkgPT4gaTE4bmV4dC50KCdOVU1CRVJfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9SRVBFQVRfVU5VU0FCTEVfVkFMVUUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICBpbnZhbGlkVmFsdWU6IChhY3QpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdC5wYXlsb2FkLnJlbmRlcmVkUmVhc29uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ05VTUJFUl9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX0lOVkFMSURfVkFMVUVfV0lUSF9SRUFTT04nLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSwgcmVhc29uOiBhY3QucGF5bG9hZC5yZW5kZXJlZFJlYXNvbiB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTE4bmV4dC50KCdOVU1CRVJfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9HRU5FUkFMX0lOVkFMSURfVkFMVUUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlcHJvbXB0czoge1xuICAgICAgICAgICAgICAgIHJlcXVlc3RWYWx1ZTogaTE4bmV4dC50KCdOVU1CRVJfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX1JFUVVFU1RfVkFMVUUnKSxcbiAgICAgICAgICAgICAgICBjb25maXJtVmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnTlVNQkVSX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9DT05GSVJNX1ZBTFVFJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgdmFsdWVEaXNjb25maXJtZWQ6IGkxOG5leHQudCgnTlVNQkVSX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9WQUxVRV9ESVNBRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgIHZhbHVlU2V0OiAoYWN0KSA9PiBpMThuZXh0LnQoJ05VTUJFUl9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfVkFMVUVfU0VUJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgdmFsdWVDb25maXJtZWQ6IGkxOG5leHQudCgnTlVNQkVSX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9WQUxVRV9BRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgIHN1Z2dlc3RWYWx1ZTogKGFjdCkgPT4gaTE4bmV4dC50KCdOVU1CRVJfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX1NVR0dFU1RfVkFMVUUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICBpbmZvcm1Db25mdXNpbmdEaXNjb25maXJtYXRpb246IChhY3QpID0+IGkxOG5leHQudCgnTlVNQkVSX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9JTkZPUk1fQ09ORlVTSU5HX0RJU0NPTkZJUk1BVElPTicpLFxuICAgICAgICAgICAgICAgIGluZm9ybUNvbmZ1c2luZ0NvbmZpcm1hdGlvbjogKGFjdCkgPT4gaTE4bmV4dC50KCdOVU1CRVJfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX0lORk9STV9DT05GVVNJTkdfQ09ORklSTUFUSU9OJywgeyBwcmV2aW91c1ZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICBwcm9ibGVtYXRpY0lucHV0VmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnTlVNQkVSX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9SRVBFQVRfVU5VU0FCTEVfVkFMVUUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICBpbnZhbGlkVmFsdWU6IChhY3QpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdC5wYXlsb2FkLnJlbmRlcmVkUmVhc29uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ05VTUJFUl9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfSU5WQUxJRF9WQUxVRV9XSVRIX1JFQVNPTicsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlLCByZWFzb246IGFjdC5wYXlsb2FkLnJlbmRlcmVkUmVhc29uIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ05VTUJFUl9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfR0VORVJBTF9JTlZBTElEX1ZBTFVFJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB2YWxpZGF0aW9uOiBbXSxcbiAgICAgICAgICAgIGNvbmZpcm1hdGlvblJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgICAgIGFtYmlndW91c1BhaXJzOiBbWzEzLCAzMF0sIFsxNCwgNDBdLCBbMTUsIDUwXSwgWzE2LCA2MF0sIFsxNywgNzBdLCBbMTgsIDgwXSwgWzE5LCA5MF1dLCAvLyBUT0RPOiBnZW5lcmFsaXplIHRoZSBkZWZhdWx0LiBpbiBlbmdsaXNoIGl0IHNob3VsZCBzdWdnZXN0ICgxMTMgPC0+IDEzMCkgZXRjLlxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfLm1lcmdlKGRlZmF1bHRzLCBwcm9wcyk7XG4gICAgfVxuXG4gICAgLy8gdHNEb2MgLSBzZWUgQ29udHJvbFxuICAgIGNhbkhhbmRsZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNhbkhhbmRsZUZvckVtcHR5U3RhdGVWYWx1ZShpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuY2FuSGFuZGxlRm9yRXhpc3RpbmdTdGF0ZVZhbHVlKGlucHV0KTtcbiAgICB9XG5cbiAgICAvLyB0c0RvYyAtIHNlZSBDb250cm9sXG4gICAgYXN5bmMgaGFuZGxlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgTnVtYmVyQ29udHJvbFske3RoaXMuaWR9XTogaGFuZGxlKCkuIEVudGVyaW5nYCk7XG5cbiAgICAgICAgY29uc3QgaW50ZW50OiBJbnRlbnQgPSAoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQ7XG4gICAgICAgIGlmICh0aGlzLmhhbmRsZUZ1bmMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke2ludGVudC5uYW1lfSBjYW4gbm90IGJlIGhhbmRsZWQgYnkgJHt0aGlzLmNvbnN0cnVjdG9yLm5hbWV9LmApO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5oYW5kbGVGdW5jKGlucHV0LCByZXN1bHRCdWlsZGVyKTtcblxuICAgICAgICBpZiAoIXJlc3VsdEJ1aWxkZXIuaGFzSW5pdGlhdGl2ZUFjdCgpICYmIHRoaXMuY2FuVGFrZUluaXRpYXRpdmUoaW5wdXQpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50YWtlSW5pdGlhdGl2ZShpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyB0c0RvYyAtIHNlZSBDb250cm9sXG4gICAgY2FuVGFrZUluaXRpYXRpdmUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy53YW50c1RvRWxpY2l0VmFsdWUoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLndhbnRzVG9GaXhJbnZhbGlkVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLndhbnRzVG9Db25maXJtVmFsdWUoaW5wdXQpO1xuICAgIH1cblxuICAgIC8vIHRzRG9jIC0gc2VlIENvbnRyb2xcbiAgICB0YWtlSW5pdGlhdGl2ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5pbml0aWF0aXZlRnVuYyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb25zdCBlcnJvck1zZyA9ICdOdW1iZXJDb250cm9sOiB0YWtlSW5pdGlhdGl2ZSBjYWxsZWQgYnV0IHRoaXMuaW5pdGlhdGl2ZUZ1bmMgaXMgbm90IHNldC4gY2FuVGFrZUluaXRpYXRpdmUoKSBzaG91bGQgYmUgY2FsbGVkIGZpcnN0IHRvIHNldCB0aGlzLmluaXRpYXRpdmVGdW5jLic7XG4gICAgICAgICAgICBsb2cuZXJyb3IoZXJyb3JNc2cpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTXNnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmluaXRpYXRpdmVGdW5jKGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICB9XG5cbiAgICAvLyB0c0RvYyAtIHNlZSBDb250cm9sXG4gICAgcmVuZGVyQWN0KGFjdDogU3lzdGVtQWN0LCBpbnB1dDogQ29udHJvbElucHV0LCBidWlsZGVyOiBDb250cm9sUmVzcG9uc2VCdWlsZGVyKSB7XG4gICAgICAgIGlmIChhY3QgaW5zdGFuY2VvZiBSZXF1ZXN0VmFsdWVBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMucmVxdWVzdFZhbHVlLCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMucmVxdWVzdFZhbHVlLCBpbnB1dCkpO1xuICAgICAgICAgICAgY29uc3Qgc2xvdEVsaWNpdGF0aW9uID0gZ2VuZXJhdGVTbG90RWxpY2l0YXRpb24oKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkRWxpY2l0U2xvdERpcmVjdGl2ZShzbG90RWxpY2l0YXRpb24uc2xvdE5hbWUsIHNsb3RFbGljaXRhdGlvbi5pbnRlbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgQ29uZmlybVZhbHVlQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLmNvbmZpcm1WYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLmNvbmZpcm1WYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGFjdCBpbnN0YW5jZW9mIFZhbHVlRGlzY29uZmlybWVkQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnZhbHVlRGlzY29uZmlybWVkLCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMudmFsdWVEaXNjb25maXJtZWQsIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBWYWx1ZVNldEFjdCkge1xuICAgICAgICAgICAgYnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucHJvbXB0cy52YWx1ZVNldCwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnZhbHVlU2V0LCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgVmFsdWVDb25maXJtZWRBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMudmFsdWVDb25maXJtZWQsIGlucHV0KSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnJlcHJvbXB0cy52YWx1ZUNvbmZpcm1lZCwgaW5wdXQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGFjdCBpbnN0YW5jZW9mIFN1Z2dlc3RWYWx1ZUFjdCkge1xuICAgICAgICAgICAgYnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucHJvbXB0cy5zdWdnZXN0VmFsdWUsIGlucHV0KSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnJlcHJvbXB0cy5zdWdnZXN0VmFsdWUsIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBJbmZvcm1Db25mdXNpbmdDb25maXJtYXRpb25BY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMuaW5mb3JtQ29uZnVzaW5nQ29uZmlybWF0aW9uLCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMuaW5mb3JtQ29uZnVzaW5nQ29uZmlybWF0aW9uLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgSW5mb3JtQ29uZnVzaW5nRGlzY29uZmlybWF0aW9uQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLmluZm9ybUNvbmZ1c2luZ0Rpc2NvbmZpcm1hdGlvbiwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLmluZm9ybUNvbmZ1c2luZ0Rpc2NvbmZpcm1hdGlvbiwgaW5wdXQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGFjdCBpbnN0YW5jZW9mIFByb2JsZW1hdGljSW5wdXRWYWx1ZUFjdCkge1xuICAgICAgICAgICAgYnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucHJvbXB0cy5wcm9ibGVtYXRpY0lucHV0VmFsdWUsIGlucHV0KSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnJlcHJvbXB0cy5wcm9ibGVtYXRpY0lucHV0VmFsdWUsIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBJbnZhbGlkVmFsdWVBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMuaW52YWxpZFZhbHVlLCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMuaW52YWxpZFZhbHVlLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRocm93VW5oYW5kbGVkQWN0RXJyb3IoYWN0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIHRzRG9jIC0gc2VlIENvbnRyb2xcbiAgICB1cGRhdGVJbnRlcmFjdGlvbk1vZGVsKGdlbmVyYXRvcjogQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3IsIGltRGF0YTogTW9kZWxEYXRhKSB7XG4gICAgICAgIGdlbmVyYXRvci5hZGRDb250cm9sSW50ZW50KG5ldyBHZW5lcmFsQ29udHJvbEludGVudCgpLCBpbURhdGEpO1xuICAgICAgICBnZW5lcmF0b3IuYWRkQ29udHJvbEludGVudChuZXcgU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KEFtYXpvbkJ1aWx0SW5TbG90VHlwZS5OVU1CRVIpLCBpbURhdGEpO1xuICAgICAgICBnZW5lcmF0b3IuYWRkWWVzQW5kTm9JbnRlbnRzKCk7XG5cbiAgICAgICAgaWYgKHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzLmluY2x1ZGVzKCQuVGFyZ2V0Lk51bWJlcikpIHtcbiAgICAgICAgICAgIGdlbmVyYXRvci5hZGRWYWx1ZXNUb1Nsb3RUeXBlKFNoYXJlZFNsb3RUeXBlLlRBUkdFVCwgaTE4bmV4dC50KCdOVU1CRVJfQ09OVFJPTF9ERUZBVUxUX1NMT1RfVkFMVUVTX1RBUkdFVF9OVU1CRVInLCB7IHJldHVybk9iamVjdHM6IHRydWUgfSkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gdHNEb2MgLSBzZWUgSW50ZXJhY3Rpb25Nb2RlbENvbnRyaWJ1dG9yXG4gICAgZ2V0VGFyZ2V0SWRzKCk6IHN0cmluZ1tdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzO1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogRGlyZWN0bHkgc2V0IHRoZSB2YWx1ZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB2YWx1ZSAtIFZhbHVlLCBlaXRoZXIgYW4gaW50ZWdlciBvciBhIHN0cmluZyB0aGF0IGNhbiBiZSBwYXJzZWQgYXMgYSBpbnRlZ2VyLlxuICAgICAqL1xuICAgIHNldFZhbHVlKHZhbHVlOiBzdHJpbmcgfCBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5zdGF0ZS52YWx1ZSA9IHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgPyBOdW1iZXIucGFyc2VJbnQodmFsdWUhLCAxMCkgOiB2YWx1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbGVhciB0aGUgc3RhdGUgb2YgdGhpcyBjb250cm9sLlxuICAgICAqL1xuICAgIGNsZWFyKCkge1xuICAgICAgICB0aGlzLnN0YXRlID0gbmV3IE51bWJlckNvbnRyb2xTdGF0ZSgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2FuSGFuZGxlRm9yRW1wdHlTdGF0ZVZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYodGhpcy5zdGF0ZS52YWx1ZSA9PT0gdW5kZWZpbmVkKTtcblxuICAgICAgICAgICAgaWYgKElucHV0VXRpbC5pc0ludGVudChpbnB1dCwgR2VuZXJhbENvbnRyb2xJbnRlbnQubmFtZSkpe1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgYWN0aW9uLCB0YXJnZXQgfSA9IHVucGFja0dlbmVyYWxDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuYWN0aW9uSXNNYXRjaE9yVW5kZWZpbmVkKGFjdGlvbiwgWy4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCwgLi4udGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuY2hhbmdlXSkpO1xuICAgICAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUxhc3RRdWVzdGlvbkVtcHR5QW5kVmFsdWVOb3RFeGlzdGluZztcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKElucHV0VXRpbC5pc1NpbmdsZVZhbHVlQ29udHJvbEludGVudChpbnB1dCwgQW1hem9uQnVpbHRJblNsb3RUeXBlLk5VTUJFUikpe1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgYWN0aW9uLCB0YXJnZXQgfSA9IHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2hPclVuZGVmaW5lZChhY3Rpb24sIFsuLi50aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQsIC4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZV0pKTtcbiAgICAgICAgICAgICAgICBva0lmKElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cykpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlTGFzdFF1ZXN0aW9uRW1wdHlBbmRWYWx1ZUV4aXN0aW5nO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVMYXN0UXVlc3Rpb25FbXB0eUFuZFZhbHVlTm90RXhpc3RpbmcoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QoXG4gICAgICAgICAgICBuZXcgUmVxdWVzdFZhbHVlQWN0KHRoaXMpXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVMYXN0UXVlc3Rpb25FbXB0eUFuZFZhbHVlRXhpc3RpbmcoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeyBhY3Rpb24sIHZhbHVlU3RyIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZVN0cik7XG4gICAgICAgIHRoaXMuY29tbW9uSGFuZGxlcldoZW5WYWx1ZUNoYW5nZWQoYWN0aW9uID8/ICQuQWN0aW9uLlNldCwgaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2FuSGFuZGxlRm9yRXhpc3RpbmdTdGF0ZVZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYodGhpcy5zdGF0ZS52YWx1ZSAhPT0gdW5kZWZpbmVkKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzVmFsdWVJblJlamVjdGVkVmFsdWVzKGlucHV0KVxuICAgICAgICAgICAgICAgIHx8IHRoaXMuaXNCYXJlTm9XaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0KVxuICAgICAgICAgICAgICAgIHx8IHRoaXMuaXNGZWVkYmFja05vQW5kVmFsdWVVbmRlZmluZWRXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0KVxuICAgICAgICAgICAgICAgIHx8IHRoaXMuaXNGZWVkYmFja05vQW5kVmFsdWVOb3RDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dClcbiAgICAgICAgICAgICAgICB8fCB0aGlzLmlzRmVlZGJhY2tOb0FuZFZhbHVlQ2hhbmdlZFdoZW5Db25maXJtaW5nVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICAgICAgfHwgdGhpcy5pc0JhcmVZZXNDb25maXJtaW5nVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICAgICAgfHwgdGhpcy5pc0ZlZWRiYWNrWWVzQW5kVmFsdWVDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dClcbiAgICAgICAgICAgICAgICB8fCB0aGlzLmlzRmVlZGJhY2tZZXNBbmRWYWx1ZU5vdENoYW5nZWRXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0KVxuICAgICAgICAgICAgICAgIHx8IHRoaXMuaXNGZWVkYmFja1llc0FuZFZhbHVlVW5kZWZpbmVkV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dClcbiAgICAgICAgICAgICAgICB8fCB0aGlzLmlzRmVlZGJhY2tVbmRlZmluZWRBbmRWYWx1ZU5vdENoYW5nZWRXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0KVxuICAgICAgICAgICAgICAgIHx8IHRoaXMuaXNGZWVkYmFja1VuZGVmaW5lZEFuZFZhbHVlQ2hhbmdlZFdoZW5Db25maXJtaW5nVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICAgICAgfHwgdGhpcy5pc1RhcmdldHNNYXRjaFdpdGhvdXRGZWVkYmFja05vclZhbHVlV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dCk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGlzVmFsdWVJblJlamVjdGVkVmFsdWVzKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KGlucHV0LCBBbWF6b25CdWlsdEluU2xvdFR5cGUuTlVNQkVSKSk7XG4gICAgICAgICAgICBjb25zdCB7IGFjdGlvbiwgdGFyZ2V0LCB2YWx1ZVN0ciB9ID0gdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5hY3Rpb25Jc01hdGNoT3JVbmRlZmluZWQoYWN0aW9uLCBbLi4udGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuc2V0LCAuLi50aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5jaGFuZ2VdKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cykpO1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLnJlamVjdGVkVmFsdWVzLmluY2x1ZGVzKE51bWJlci5wYXJzZUludCh2YWx1ZVN0ciwgMTApKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZVZhbHVlRXhpc3RzSW5SZWplY3RlZFZhbHVlcztcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVWYWx1ZUV4aXN0c0luUmVqZWN0ZWRWYWx1ZXMoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeyB2YWx1ZVN0ciB9ID0gdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgIHRoaXMuc2V0VmFsdWUodmFsdWVTdHIpO1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgIG5ldyBQcm9ibGVtYXRpY0lucHV0VmFsdWVBY3QodGhpcywgeyByZWFzb25Db2RlOiAnVmFsdWVQcmV2aW91c2x5UmVqZWN0ZWQnLCB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSB9KVxuICAgICAgICApO1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgIG5ldyBSZXF1ZXN0VmFsdWVBY3QodGhpcylcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzQmFyZU5vV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0JhcmVObyhpbnB1dCkpO1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLmFjdGl2ZUluaXRpYXRpdmVBY3QgPT09ICdDb25maXJtVmFsdWVBY3QnKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlRmVlZGJhY2tOb0FuZFdpdGhvdXRWYWx1ZVdoZW5Db25maXJtaW5nVmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaXNGZWVkYmFja05vQW5kVmFsdWVVbmRlZmluZWRXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzSW50ZW50KGlucHV0LCBHZW5lcmFsQ29udHJvbEludGVudC5uYW1lKSk7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCB9ID0gdW5wYWNrR2VuZXJhbENvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2hPclVuZGVmaW5lZChhY3Rpb24sIFsuLi50aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQsIC4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzRmFsc2UoZmVlZGJhY2spKTtcbiAgICAgICAgICAgIG9rSWYodGhpcy5zdGF0ZS5hY3RpdmVJbml0aWF0aXZlQWN0ID09PSAnQ29uZmlybVZhbHVlQWN0Jyk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUZlZWRiYWNrTm9BbmRXaXRob3V0VmFsdWVXaGVuQ29uZmlybWluZ1ZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZUZlZWRiYWNrTm9BbmRXaXRob3V0VmFsdWVXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3RhdGUuYWN0aXZlSW5pdGlhdGl2ZUFjdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QoXG4gICAgICAgICAgICBuZXcgVmFsdWVEaXNjb25maXJtZWRBY3QodGhpcywge3ZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlIX0pXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuY29tbW9uSGFuZGxlcldoZW5WYWx1ZVJlamVjdGVkKGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzRmVlZGJhY2tOb0FuZFZhbHVlTm90Q2hhbmdlZFdoZW5Db25maXJtaW5nVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoaW5wdXQsIEFtYXpvbkJ1aWx0SW5TbG90VHlwZS5OVU1CRVIpKTtcbiAgICAgICAgICAgIGNvbnN0IHsgYWN0aW9uLCB0YXJnZXQsIGZlZWRiYWNrLCB2YWx1ZVN0ciB9ID0gdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5hY3Rpb25Jc01hdGNoT3JVbmRlZmluZWQoYWN0aW9uLCBbLi4udGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuc2V0LCAuLi50aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5jaGFuZ2VdKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cykpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuZmVlZGJhY2tJc0ZhbHNlKGZlZWRiYWNrKSk7XG4gICAgICAgICAgICBva0lmKHRoaXMuc3RhdGUuYWN0aXZlSW5pdGlhdGl2ZUFjdCA9PT0gJ0NvbmZpcm1WYWx1ZUFjdCcpO1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLnZhbHVlID09PSBOdW1iZXIucGFyc2VJbnQodmFsdWVTdHIsIDEwKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUZlZWRiYWNrTm9BbmRWYWx1ZU5vdENoYW5nZWRXaGVuQ29uZmlybWluZ1ZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZUZlZWRiYWNrTm9BbmRWYWx1ZU5vdENoYW5nZWRXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3RhdGUuYWN0aXZlSW5pdGlhdGl2ZUFjdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QoXG4gICAgICAgICAgICBuZXcgSW5mb3JtQ29uZnVzaW5nRGlzY29uZmlybWF0aW9uQWN0KHRoaXMsIHsgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUhLCByZWFzb25Db2RlOiAnRGlzY29uZmlybWVkV2l0aFNhbWVWYWx1ZScgfSlcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5jb21tb25IYW5kbGVyV2hlblZhbHVlUmVqZWN0ZWQoaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNGZWVkYmFja05vQW5kVmFsdWVDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc1NpbmdsZVZhbHVlQ29udHJvbEludGVudChpbnB1dCwgQW1hem9uQnVpbHRJblNsb3RUeXBlLk5VTUJFUikpO1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQsIHZhbHVlU3RyIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2hPclVuZGVmaW5lZChhY3Rpb24sIFsuLi50aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQsIC4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzRmFsc2UoZmVlZGJhY2spKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnZhbHVlU3RyRGVmaW5lZCh2YWx1ZVN0cikpO1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLmFjdGl2ZUluaXRpYXRpdmVBY3QgPT09ICdDb25maXJtVmFsdWVBY3QnKTtcbiAgICAgICAgICAgIG9rSWYodGhpcy5zdGF0ZS52YWx1ZSAhPT0gTnVtYmVyLnBhcnNlSW50KHZhbHVlU3RyLCAxMCkpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVGZWVkYmFja05vQW5kVmFsdWVDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVGZWVkYmFja05vQW5kVmFsdWVDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB7IGFjdGlvbiwgdmFsdWVTdHIgfSA9IHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICB0aGlzLnNldFZhbHVlKHZhbHVlU3RyKTtcbiAgICAgICAgdGhpcy5jb21tb25IYW5kbGVyV2hlblZhbHVlQ2hhbmdlZChhY3Rpb24gPz8gJC5BY3Rpb24uU2V0LCBpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0ZlZWRiYWNrWWVzQW5kVmFsdWVDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc1NpbmdsZVZhbHVlQ29udHJvbEludGVudChpbnB1dCwgQW1hem9uQnVpbHRJblNsb3RUeXBlLk5VTUJFUikpO1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQsIHZhbHVlU3RyIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2hPclVuZGVmaW5lZChhY3Rpb24sIFsuLi50aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQsIC4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzVHJ1ZShmZWVkYmFjaykpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudmFsdWVTdHJEZWZpbmVkKHZhbHVlU3RyKSk7XG4gICAgICAgICAgICBva0lmKHRoaXMuc3RhdGUuYWN0aXZlSW5pdGlhdGl2ZUFjdCA9PT0gJ0NvbmZpcm1WYWx1ZUFjdCcpO1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLnZhbHVlICE9PSBOdW1iZXIucGFyc2VJbnQodmFsdWVTdHIsIDEwKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUZlZWRiYWNrWWVzQW5kVmFsdWVDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVGZWVkYmFja1llc0FuZFZhbHVlQ2hhbmdlZFdoZW5Db25maXJtaW5nVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeyBhY3Rpb24sIHZhbHVlU3RyIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgY29uc3QgcHJldmlvdXNWYWx1ZSA9IHRoaXMuc3RhdGUudmFsdWU7XG4gICAgICAgIHRoaXMuc2V0VmFsdWUodmFsdWVTdHIpO1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgIG5ldyBJbmZvcm1Db25mdXNpbmdDb25maXJtYXRpb25BY3QodGhpcywgeyB2YWx1ZTogcHJldmlvdXNWYWx1ZSwgcmVhc29uQ29kZTogJ0NvbmZpcm1lZFdpdGhEaWZmZXJlbnRWYWx1ZScgfSlcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5zdGF0ZS5hY3RpdmVJbml0aWF0aXZlQWN0ID0gJ0NvbmZpcm1WYWx1ZUFjdCc7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KFxuICAgICAgICAgICAgbmV3IENvbmZpcm1WYWx1ZUFjdCh0aGlzLCB7IHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlIH0pXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0JhcmVZZXNDb25maXJtaW5nVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNCYXJlWWVzKGlucHV0KSk7XG4gICAgICAgICAgICBva0lmKHRoaXMuc3RhdGUuYWN0aXZlSW5pdGlhdGl2ZUFjdCA9PT0gJ0NvbmZpcm1WYWx1ZUFjdCcpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVGZWVkYmFja1llc0FuZFZhbHVlTm90Q2hhbmdlZE9yVW5kZWZpbmVkV2hlbkNvbmZpcm1pbmdWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0ZlZWRiYWNrWWVzQW5kVmFsdWVOb3RDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc1NpbmdsZVZhbHVlQ29udHJvbEludGVudChpbnB1dCwgQW1hem9uQnVpbHRJblNsb3RUeXBlLk5VTUJFUikpO1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQsIHZhbHVlU3RyIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2hPclVuZGVmaW5lZChhY3Rpb24sIFsuLi50aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQsIC4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzVHJ1ZShmZWVkYmFjaykpO1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLmFjdGl2ZUluaXRpYXRpdmVBY3QgPT09ICdDb25maXJtVmFsdWVBY3QnKTtcbiAgICAgICAgICAgIG9rSWYodGhpcy5zdGF0ZS52YWx1ZSA9PT0gTnVtYmVyLnBhcnNlSW50KHZhbHVlU3RyLCAxMCkpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVGZWVkYmFja1llc0FuZFZhbHVlTm90Q2hhbmdlZE9yVW5kZWZpbmVkV2hlbkNvbmZpcm1pbmdWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0ZlZWRiYWNrWWVzQW5kVmFsdWVVbmRlZmluZWRXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzSW50ZW50KGlucHV0LCBHZW5lcmFsQ29udHJvbEludGVudC5uYW1lKSk7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCB9ID0gdW5wYWNrR2VuZXJhbENvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2hPclVuZGVmaW5lZChhY3Rpb24sIFsuLi50aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQsIC4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzVHJ1ZShmZWVkYmFjaykpO1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLmFjdGl2ZUluaXRpYXRpdmVBY3QgPT09ICdDb25maXJtVmFsdWVBY3QnKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlRmVlZGJhY2tZZXNBbmRWYWx1ZU5vdENoYW5nZWRPclVuZGVmaW5lZFdoZW5Db25maXJtaW5nVmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlRmVlZGJhY2tZZXNBbmRWYWx1ZU5vdENoYW5nZWRPclVuZGVmaW5lZFdoZW5Db25maXJtaW5nVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5pc1ZhbHVlQ29uZmlybWVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdGF0ZS5hY3RpdmVJbml0aWF0aXZlQWN0ID0gdW5kZWZpbmVkO1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgIG5ldyBWYWx1ZUNvbmZpcm1lZEFjdCh0aGlzLCB7IHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlIH0pXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0ZlZWRiYWNrVW5kZWZpbmVkQW5kVmFsdWVOb3RDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc1NpbmdsZVZhbHVlQ29udHJvbEludGVudChpbnB1dCwgQW1hem9uQnVpbHRJblNsb3RUeXBlLk5VTUJFUikpO1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQsIHZhbHVlU3RyIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2hPclVuZGVmaW5lZChhY3Rpb24sIFsuLi50aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQsIC4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzVW5kZWZpbmVkKGZlZWRiYWNrKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC52YWx1ZVN0ckRlZmluZWQodmFsdWVTdHIpKTtcbiAgICAgICAgICAgIG9rSWYodGhpcy5zdGF0ZS5hY3RpdmVJbml0aWF0aXZlQWN0ID09PSAnQ29uZmlybVZhbHVlQWN0Jyk7XG4gICAgICAgICAgICBva0lmKHRoaXMuc3RhdGUudmFsdWUgPT09IE51bWJlci5wYXJzZUludCh2YWx1ZVN0ciwgMTApKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlRmVlZGJhY2tZZXNBbmRWYWx1ZVVuZGVmaW5lZFdoZW5Db25maXJtaW5nVmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlRmVlZGJhY2tZZXNBbmRWYWx1ZVVuZGVmaW5lZFdoZW5Db25maXJtaW5nVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5pc1ZhbHVlQ29uZmlybWVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdGF0ZS5hY3RpdmVJbml0aWF0aXZlQWN0ID0gdW5kZWZpbmVkO1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgIG5ldyBWYWx1ZUNvbmZpcm1lZEFjdCh0aGlzLCB7IHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlIH0pXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0ZlZWRiYWNrVW5kZWZpbmVkQW5kVmFsdWVDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc1NpbmdsZVZhbHVlQ29udHJvbEludGVudChpbnB1dCwgQW1hem9uQnVpbHRJblNsb3RUeXBlLk5VTUJFUikpO1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQsIHZhbHVlU3RyIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2hPclVuZGVmaW5lZChhY3Rpb24sIFsuLi50aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQsIC4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzVW5kZWZpbmVkKGZlZWRiYWNrKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC52YWx1ZVN0ckRlZmluZWQodmFsdWVTdHIpKTtcbiAgICAgICAgICAgIG9rSWYodGhpcy5zdGF0ZS52YWx1ZSAhPT0gTnVtYmVyLnBhcnNlSW50KHZhbHVlU3RyLCAxMCkpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVGZWVkYmFja1VuZGVmaW5lZEFuZFZhbHVlQ2hhbmdlZFdoZW5Db25maXJtaW5nVmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlRmVlZGJhY2tVbmRlZmluZWRBbmRWYWx1ZUNoYW5nZWRXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHsgYWN0aW9uLCB2YWx1ZVN0ciB9ID0gdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgIHRoaXMuc2V0VmFsdWUodmFsdWVTdHIpO1xuICAgICAgICB0aGlzLmNvbW1vbkhhbmRsZXJXaGVuVmFsdWVDaGFuZ2VkKGFjdGlvbiA/PyAkLkFjdGlvbi5TZXQsIGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzVGFyZ2V0c01hdGNoV2l0aG91dEZlZWRiYWNrTm9yVmFsdWVXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzSW50ZW50KGlucHV0LCBHZW5lcmFsQ29udHJvbEludGVudC5uYW1lKSk7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCB9ID0gdW5wYWNrR2VuZXJhbENvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmZlZWRiYWNrSXNVbmRlZmluZWQoZmVlZGJhY2spKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2hPclVuZGVmaW5lZChhY3Rpb24sIFsuLi50aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQsIC4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2godGFyZ2V0LCBfLndpdGhvdXQodGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMsICQuVGFyZ2V0Lkl0KSkpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVUYXJnZXRNYXRjaFdpdGhvdXRGZWVkYmFja05vclZhbHVlV2hlbkNvbmZpcm1pbmdWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVUYXJnZXRNYXRjaFdpdGhvdXRGZWVkYmFja05vclZhbHVlV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgIG5ldyBSZXF1ZXN0VmFsdWVBY3QodGhpcylcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNvbW1vbkhhbmRsZXJXaGVuVmFsdWVDaGFuZ2VkKGFjdGlvbjogc3RyaW5nLCBpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gdGhpcy52YWxpZGF0ZU51bWJlcihpbnB1dCk7XG4gICAgICAgIGlmICh2YWxpZGF0aW9uUmVzdWx0ICE9PSB0cnVlKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnJlamVjdGVkVmFsdWVzLnB1c2godGhpcy5zdGF0ZS52YWx1ZSEpO1xuICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QoXG4gICAgICAgICAgICAgICAgbmV3IEludmFsaWRWYWx1ZUFjdCh0aGlzLCB7IHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlISwgcmVuZGVyZWRSZWFzb246IHZhbGlkYXRpb25SZXN1bHQucmVuZGVyZWRSZWFzb24gfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgICAgICBuZXcgUmVxdWVzdFZhbHVlQWN0KHRoaXMpXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCF0aGlzLmlzQ29uZmlybWF0aW9uUmVxdWlyZWQoaW5wdXQpKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLmlzVmFsdWVDb25maXJtZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS5hY3RpdmVJbml0aWF0aXZlQWN0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QoXG4gICAgICAgICAgICAgICAgbmV3IFZhbHVlU2V0QWN0KHRoaXMsIHsgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLmFjdGl2ZUluaXRpYXRpdmVBY3QgPSAnQ29uZmlybVZhbHVlQWN0JztcbiAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KFxuICAgICAgICAgICAgICAgIG5ldyBDb25maXJtVmFsdWVBY3QodGhpcywgeyB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qIFRPRE86IGJ1ZzogVXNlcidzIGFjdGlvbiBoYXMgdG8gYmUgdXNlZCBpbiB0aGlzIGZ1bmN0aW9uIHRvIGZvcm0gdGhlIHJlc3BvbnNlXG4gICAgICogcHJvbXB0LCBuZWVkIHRvIGRlZmluZSBhY3Rpb24gaW4gdGhlIHJlbGF0ZWQgcGF5bG9hZFR5cGUgVGhpcyB3aWxsIGZpeFxuICAgICAqIHRoZSBmb2xsb3dpbmc6IFU6IE5vLCB7Y2hhbmdlfSB0aGUgdmFsdWUgcGxlYXNlIEE6IFdoYXQgdmFsdWUgZG8geW91IHdhbnRcbiAgICAgKiB0byB7Y2hhbmdlfSB0bz9cbiAgICAgKi9cbiAgICBwcml2YXRlIGNvbW1vbkhhbmRsZXJXaGVuVmFsdWVSZWplY3RlZChpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICB0aGlzLnN0YXRlLnJlamVjdGVkVmFsdWVzLnB1c2godGhpcy5zdGF0ZS52YWx1ZSEpO1xuICAgICAgICBjb25zdCBhbWJpZ3VvdXNQYXJ0bmVyID0gdGhpcy5nZXRBbWJpZ3VvdXNQYXJ0bmVyKHRoaXMuc3RhdGUudmFsdWUhKTtcbiAgICAgICAgaWYgKGFtYmlndW91c1BhcnRuZXIgIT09IHVuZGVmaW5lZCAmJiAhdGhpcy5zdGF0ZS5yZWplY3RlZFZhbHVlcy5pbmNsdWRlcyhhbWJpZ3VvdXNQYXJ0bmVyKSkge1xuICAgICAgICAgICAgY29uc3QgcHJldmlvdXNWYWx1ZSA9IHRoaXMuc3RhdGUudmFsdWU7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnZhbHVlID0gYW1iaWd1b3VzUGFydG5lcjtcbiAgICAgICAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSB0aGlzLnZhbGlkYXRlTnVtYmVyKGlucHV0KTtcbiAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uUmVzdWx0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgLy8gdGhpcyBpcyB0byBjb25maXJtIGZyb20gdXNlcnMgZm9yIHRoZSBzdWdnZXN0ZWRWYWx1ZVxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUuYWN0aXZlSW5pdGlhdGl2ZUFjdCA9ICdDb25maXJtVmFsdWVBY3QnO1xuICAgICAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KFxuICAgICAgICAgICAgICAgICAgICBuZXcgU3VnZ2VzdFZhbHVlQWN0KHRoaXMsIHsgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUgfSlcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS52YWx1ZSA9IHByZXZpb3VzVmFsdWU7XG4gICAgICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QoXG4gICAgICAgICAgICAgICAgICAgIG5ldyBSZXF1ZXN0VmFsdWVBY3QodGhpcylcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QoXG4gICAgICAgICAgICAgICAgbmV3IFJlcXVlc3RWYWx1ZUFjdCh0aGlzKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgd2FudHNUb0VsaWNpdFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMuZXZhbHVhdGVCb29sZWFuUHJvcCh0aGlzLnByb3BzLnJlcXVpcmVkLCBpbnB1dCkgJiYgdGhpcy5zdGF0ZS52YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmluaXRpYXRpdmVGdW5jID0gdGhpcy5lbGljaXRWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGVsaWNpdFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBSZXF1ZXN0VmFsdWVBY3QodGhpcykpO1xuICAgIH1cblxuICAgIHByaXZhdGUgd2FudHNUb0ZpeEludmFsaWRWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIGlmICghdGhpcy5ldmFsdWF0ZUJvb2xlYW5Qcm9wKHRoaXMucHJvcHMucmVxdWlyZWQsIGlucHV0KSB8fCB0aGlzLnN0YXRlLnZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0OiB0cnVlIHwgVmFsaWRhdGlvblJlc3VsdCA9IHRoaXMudmFsaWRhdGVOdW1iZXIoaW5wdXQpO1xuICAgICAgICBpZiAodmFsaWRhdGlvblJlc3VsdCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pbml0aWF0aXZlRnVuYyA9IHRoaXMuZml4SW52YWxpZFZhbHVlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGZpeEludmFsaWRWYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gdGhpcy52YWxpZGF0ZU51bWJlcihpbnB1dCk7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBJbnZhbGlkVmFsdWVBY3QodGhpcywge1xuICAgICAgICAgICAgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUhLFxuICAgICAgICAgICAgcmVhc29uQ29kZTogJ1ZhbHVlSW52YWxpZCcsXG4gICAgICAgICAgICByZW5kZXJlZFJlYXNvbjogKHZhbGlkYXRpb25SZXN1bHQgYXMgVmFsaWRhdGlvblJlc3VsdCkucmVuZGVyZWRSZWFzb25cbiAgICAgICAgfSkpO1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgUmVxdWVzdFZhbHVlQWN0KHRoaXMpKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHdhbnRzVG9Db25maXJtVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAoIXRoaXMuZXZhbHVhdGVCb29sZWFuUHJvcCh0aGlzLnByb3BzLnJlcXVpcmVkLCBpbnB1dCkgfHwgdGhpcy5zdGF0ZS52YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuaXNWYWx1ZUNvbmZpcm1lZCB8fCAhdGhpcy5pc0NvbmZpcm1hdGlvblJlcXVpcmVkKGlucHV0KSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pbml0aWF0aXZlRnVuYyA9IHRoaXMuY29uZmlybVZhbHVlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNvbmZpcm1WYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICB0aGlzLnN0YXRlLmFjdGl2ZUluaXRpYXRpdmVBY3QgPSAnQ29uZmlybVZhbHVlQWN0JztcbiAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IENvbmZpcm1WYWx1ZUFjdCh0aGlzLCB7IHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlIH0pKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHZhbGlkYXRlTnVtYmVyKGlucHV0OiBDb250cm9sSW5wdXQpOiB0cnVlIHwgVmFsaWRhdGlvblJlc3VsdCB7XG4gICAgICAgIGNvbnN0IGxpc3RPZlZhbGlkYXRpb25GdW5jOiBOdW1iZXJWYWxpZGF0aW9uRnVuY3Rpb25bXSA9IHR5cGVvZih0aGlzLnByb3BzLnZhbGlkYXRpb24pID09PSAnZnVuY3Rpb24nID8gW3RoaXMucHJvcHMudmFsaWRhdGlvbl0gOiB0aGlzLnByb3BzLnZhbGlkYXRpb247XG4gICAgICAgIGZvciAoY29uc3QgdmFsaWRhdGlvbkZ1bmN0aW9uIG9mIGxpc3RPZlZhbGlkYXRpb25GdW5jKSB7XG4gICAgICAgICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0OiBib29sZWFuIHwgVmFsaWRhdGlvblJlc3VsdCA9IHZhbGlkYXRpb25GdW5jdGlvbih0aGlzLnN0YXRlLCBpbnB1dCk7XG4gICAgICAgICAgICBpZiAodmFsaWRhdGlvblJlc3VsdCAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyhgTnVtYmVyQ29udHJvbC52YWxpZGF0ZSgpOiB2YWxpZGF0aW9uIGZhaWxlZC4gUmVhc29uOiAke0pTT04uc3RyaW5naWZ5KHZhbGlkYXRpb25SZXN1bHQsIG51bGwsIDIpfS5gKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsaWRhdGlvblJlc3VsdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzQ29uZmlybWF0aW9uUmVxdWlyZWQoaW5wdXQ6IENvbnRyb2xJbnB1dCkge1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMucHJvcHMuY29uZmlybWF0aW9uUmVxdWlyZWQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnByb3BzLmNvbmZpcm1hdGlvblJlcXVpcmVkKHRoaXMuc3RhdGUsIGlucHV0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlb2YgdGhpcy5wcm9wcy5jb25maXJtYXRpb25SZXF1aXJlZCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wcm9wcy5jb25maXJtYXRpb25SZXF1aXJlZDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlOyAvLyBieSBkZWZhdWx0IGNvbmZpcm1hdGlvbiBpcyByZXF1aXJlZFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRBbWJpZ3VvdXNQYXJ0bmVyKHZhbHVlPzogbnVtYmVyKTogbnVtYmVyIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgY29uc3QgcGFpcnMgPSB0aGlzLnByb3BzLmFtYmlndW91c1BhaXJzO1xuXG4gICAgICAgIGZvciAoY29uc3QgcGFpciBvZiBwYWlycykge1xuICAgICAgICAgICAgaWYgKHBhaXJbMF0gPT09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhaXJbMV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwYWlyWzFdID09PSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwYWlyWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYW4gZWxpY2l0LXNsb3QgZGlyZWN0aXZlIGZvciB0aGUgcHJvdmlkZWQgc2xvdFR5cGUuXG4gKlxuICogLSBUaGUgaW50ZW50IHNwZWNpZmllZCBpcyBhIGBBTUFaT05fTlVNQkVSX1ZhbHVlQ29udHJvbEludGVudGBcbiAqIC0gVGhlIHNsb3Qgc3BlY2lmaWVkIGlzIHRoZSBgc2xvdFR5cGVgIHNsb3QuXG4gKlxuICogQHBhcmFtIHNsb3RUeXBlIC0gU2xvdCB0eXBlXG4gKi9cbmZ1bmN0aW9uIGdlbmVyYXRlU2xvdEVsaWNpdGF0aW9uKCk6IHsgaW50ZW50OiBJbnRlbnQsIHNsb3ROYW1lOiBzdHJpbmcgfSB7XG4gICAgY29uc3QgaW50ZW50OiBJbnRlbnQgPSB7XG4gICAgICAgIG5hbWU6IFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5pbnRlbnROYW1lKEFtYXpvbkJ1aWx0SW5TbG90VHlwZS5OVU1CRVIpLFxuICAgICAgICBzbG90czoge1xuICAgICAgICAgICAgXCJBTUFaT04uTlVNQkVSXCI6IHsgbmFtZTogXCJBTUFaT04uTlVNQkVSXCIsIHZhbHVlOiAnJywgY29uZmlybWF0aW9uU3RhdHVzOiAnTk9ORScgfSxcbiAgICAgICAgICAgIFwiZmVlZGJhY2tcIjogeyBuYW1lOiBcImZlZWRiYWNrXCIsIHZhbHVlOiAnJywgY29uZmlybWF0aW9uU3RhdHVzOiAnTk9ORScgfSxcbiAgICAgICAgICAgIFwiYWN0aW9uXCI6IHsgbmFtZTogXCJhY3Rpb25cIiwgdmFsdWU6ICcnLCBjb25maXJtYXRpb25TdGF0dXM6ICdOT05FJyB9LFxuICAgICAgICAgICAgXCJ0YXJnZXRcIjogeyBuYW1lOiBcInRhcmdldFwiLCB2YWx1ZTogJycsIGNvbmZpcm1hdGlvblN0YXR1czogJ05PTkUnIH0sXG4gICAgICAgICAgICBcImhlYWRcIjogeyBuYW1lOiBcImhlYWRcIiwgdmFsdWU6ICcnLCBjb25maXJtYXRpb25TdGF0dXM6ICdOT05FJyB9LFxuICAgICAgICAgICAgXCJ0YWlsXCI6IHsgbmFtZTogXCJ0YWlsXCIsIHZhbHVlOiAnJywgY29uZmlybWF0aW9uU3RhdHVzOiAnTk9ORScgfSxcbiAgICAgICAgICAgIFwicHJlcG9zaXRpb25cIjogeyBuYW1lOiBcInByZXBvc2l0aW9uXCIsIHZhbHVlOiAnJywgY29uZmlybWF0aW9uU3RhdHVzOiAnTk9ORScgfSxcbiAgICAgICAgfSxcbiAgICAgICAgY29uZmlybWF0aW9uU3RhdHVzOiBcIk5PTkVcIlxuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBpbnRlbnQsXG4gICAgICAgIHNsb3ROYW1lOiBBbWF6b25CdWlsdEluU2xvdFR5cGUuTlVNQkVSXG4gICAgfTtcbn1cbiJdfQ==