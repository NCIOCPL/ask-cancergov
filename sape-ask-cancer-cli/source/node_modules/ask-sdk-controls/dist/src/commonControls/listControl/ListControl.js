"use strict";
/*
 * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.ListControl = exports.ListControlState = exports.ListControlAPLProps = exports.ListControlPromptProps = exports.ListControlInteractionModelProps = void 0;
const tslib_1 = require("tslib");
const ask_sdk_core_1 = require("ask-sdk-core");
const i18next_1 = tslib_1.__importDefault(require("i18next"));
const lodash_1 = tslib_1.__importDefault(require("lodash"));
const Strings_1 = require("../../constants/Strings");
const Control_1 = require("../../controls/Control");
const AmazonBuiltInSlotType_1 = require("../../intents/AmazonBuiltInSlotType");
const GeneralControlIntent_1 = require("../../intents/GeneralControlIntent");
const OrdinalControlIntent_1 = require("../../intents/OrdinalControlIntent");
const SingleValueControlIntent_1 = require("../../intents/SingleValueControlIntent");
const ModelTypes_1 = require("../../interactionModelGeneration/ModelTypes");
const ListFormat_1 = require("../../intl/ListFormat");
const Logger_1 = require("../../logging/Logger");
const ContentActs_1 = require("../../systemActs/ContentActs");
const InitiativeActs_1 = require("../../systemActs/InitiativeActs");
const InputUtil_1 = require("../../utils/InputUtil");
const Predicates_1 = require("../../utils/Predicates");
const APL_1 = require("./APL");
// TODO: feature: support "what are my choices"
// TODO: feature: voice pagination of choices.
const log = new Logger_1.Logger('AskSdkControls:ListControl');
/**
 * Props associated with the interaction model.
 */
class ListControlInteractionModelProps {
}
exports.ListControlInteractionModelProps = ListControlInteractionModelProps;
/**
 * Props to customize the prompt fragments that will be added by
 * `this.renderAct()`.
 */
class ListControlPromptProps {
}
exports.ListControlPromptProps = ListControlPromptProps;
/**
 * Props associated with the APL produced by ListControl.
 */
class ListControlAPLProps {
}
exports.ListControlAPLProps = ListControlAPLProps;
/**
 * State tracked by a ListControl.
 */
class ListControlState {
    constructor() {
        /**
         * Tracks whether the value has been explicitly confirmed by the user.
         */
        this.isValueConfirmed = false;
    }
}
exports.ListControlState = ListControlState;
/**
 * A Control that obtains a single value from the user by presenting a list of
 * available options using voice and/or APL.
 *
 * The type of value to obtain is defined by `this.slotType`.
 *
 * Capabilities:
 * - Request a value
 * - Change a value
 * - Validate the value
 * - Confirm the value
 * - Speak the first few options
 * - Show all the options on APL enabled devices
 * - Selection of a value using a spoken ordinal, e.g. "The first one".
 * - Selection of a value using touch screen.
 *
 * Intents that can be handled:
 * - `GeneralControlIntent`: E.g. `"yes, update my name"`
 * - `{ValueType}_ValueControlIntent`: E.g. "no change it to Elvis".
 * - `AMAZON_ORDINAL_ValueControlIntent`: E.g. "no change it to Elvis".
 * - `AMAZON.YesIntent`, `AMAZON.NoIntent`
 *
 * APL events that can be handled:
 *  - touch events indicating selection of an item on screen.
 *
 * Limitations:
 * - This control is not compatible with the `AMAZON.SearchQuery` slot type.
 */
class ListControl extends Control_1.Control {
    constructor(props) {
        super(props.id);
        this.state = new ListControlState();
        if (props.slotType === AmazonBuiltInSlotType_1.AmazonBuiltInSlotType.SEARCH_QUERY) {
            throw new Error('AMAZON.SearchQuery cannot be used with ListControl due to the special rules regarding its use. '
                + 'Specifically, utterances that include SearchQuery must have a carrier phrase and not be comprised entirely of slot references. '
                + 'Use a custom intent to manage SearchQuery slots or create a regular slot for use with ListControl.');
        }
        this.rawProps = props;
        this.props = ListControl.mergeWithDefaultProps(props);
    }
    static mergeWithDefaultProps(props) {
        const defaults = {
            id: 'dummy',
            slotType: 'dummy',
            required: true,
            validation: [],
            pageSize: 3,
            listItemIDs: [],
            confirmationRequired: false,
            interactionModel: {
                actions: {
                    set: [Strings_1.Strings.Action.Set, Strings_1.Strings.Action.Select],
                    change: [Strings_1.Strings.Action.Change],
                },
                targets: [Strings_1.Strings.Target.Choice, Strings_1.Strings.Target.It]
            },
            prompts: {
                confirmValue: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_CONFIRM_VALUE', { value: act.payload.value }),
                valueConfirmed: i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_VALUE_AFFIRMED'),
                valueDisconfirmed: i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_VALUE_DISAFFIRMED'),
                valueSet: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_VALUE_SET', { value: act.payload.value }),
                valueChanged: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_VALUE_CHANGED', { value: act.payload.value }),
                invalidValue: (act) => {
                    if (act.payload.renderedReason !== undefined) {
                        return i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_INVALID_VALUE_WITH_REASON', { value: act.payload.value, reason: act.payload.renderedReason });
                    }
                    return i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_GENERAL_INVALID_VALUE');
                },
                unusableInputValue: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_UNUSABLE_INPUT_VALUE'),
                requestValue: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_REQUEST_VALUE', { suggestions: ListFormat_1.ListFormatting.format(act.payload.choicesFromActivePage) }),
                requestChangedValue: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_REQUEST_CHANGED_VALUE', { suggestions: ListFormat_1.ListFormatting.format(act.payload.choicesFromActivePage) }),
            },
            reprompts: {
                confirmValue: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_CONFIRM_VALUE', { value: act.payload.value }),
                valueConfirmed: i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_VALUE_AFFIRMED'),
                valueDisconfirmed: i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_VALUE_DISAFFIRMED'),
                valueSet: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_VALUE_SET', { value: act.payload.value }),
                valueChanged: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_VALUE_CHANGED', { value: act.payload.value }),
                invalidValue: (act) => {
                    if (act.payload.renderedReason !== undefined) {
                        return i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_INVALID_VALUE_WITH_REASON', { value: act.payload.value, reason: act.payload.renderedReason });
                    }
                    return i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_GENERAL_INVALID_VALUE');
                },
                unusableInputValue: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_UNUSABLE_INPUT_VALUE'),
                requestValue: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_REQUEST_VALUE', { suggestions: ListFormat_1.ListFormatting.format(act.payload.choicesFromActivePage) }),
                requestChangedValue: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_REQUEST_CHANGED_VALUE', { suggestions: ListFormat_1.ListFormatting.format(act.payload.choicesFromActivePage) }),
            },
            apl: {
                enabled: true,
                requestAPLDocument: APL_1.generateTextListDocumentForListControl()
            }
        };
        return lodash_1.default.merge(defaults, props);
    }
    // tsDoc - see Control
    canHandle(input) {
        return this.isSetWithValue(input)
            || this.isChangeWithValue(input)
            || this.isSetWithoutValue(input)
            || this.isChangeWithoutValue(input)
            || this.isBareValue(input)
            || this.isConfirmationAffirmed(input)
            || this.isConfirmationDisAffirmed(input)
            || this.isOrdinalScreenEvent(input)
            || this.isOrdinalSelection(input);
    }
    // tsDoc - see Control
    async handle(input, resultBuilder) {
        if (this.handleFunc === undefined) {
            log.error('ListControl: handle called but no clause matched.  are canHandle/handle out of sync?');
            const intent = input.request.intent;
            throw new Error(`${intent.name} can not be handled by ${this.constructor.name}.`);
        }
        this.handleFunc(input, resultBuilder);
        if (resultBuilder.hasInitiativeAct() !== true && this.canTakeInitiative(input) === true) {
            await this.takeInitiative(input, resultBuilder);
        }
    }
    isSetWithValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, SingleValueControlIntent_1.SingleValueControlIntent.intentName(this.props.slotType)));
            const { feedback, action, target, valueStr, valueType } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueTypeMatch(valueType, this.props.slotType));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueStrDefined(valueStr));
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.set));
            this.handleFunc = this.handleSetWithValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleSetWithValue(input, resultBuilder) {
        const { valueStr, erMatch } = InputUtil_1.InputUtil.getValueResolution(input);
        this.setValue(valueStr, erMatch);
        this.validateAndAddActs(input, resultBuilder, Strings_1.Strings.Action.Set);
        return;
    }
    isSetWithoutValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.set));
            this.handleFunc = this.handleSetWithoutValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleSetWithoutValue(input, resultBuilder) {
        this.askElicitationQuestion(input, resultBuilder, Strings_1.Strings.Action.Set);
        return;
    }
    isChangeWithValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, SingleValueControlIntent_1.SingleValueControlIntent.intentName(this.props.slotType)));
            const { feedback, action, target, valueStr, valueType } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueTypeMatch(valueType, this.props.slotType));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueStrDefined(valueStr));
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.change));
            this.handleFunc = this.handleChangeWithValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleChangeWithValue(input, resultBuilder) {
        const { valueStr, erMatch } = InputUtil_1.InputUtil.getValueResolution(input);
        this.setValue(valueStr, erMatch);
        this.validateAndAddActs(input, resultBuilder, Strings_1.Strings.Action.Change);
        return;
    }
    isChangeWithoutValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.change));
            this.handleFunc = this.handleChangeWithoutValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleChangeWithoutValue(input, resultBuilder) {
        this.askElicitationQuestion(input, resultBuilder, Strings_1.Strings.Action.Change);
        return;
    }
    isBareValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, SingleValueControlIntent_1.SingleValueControlIntent.intentName(this.props.slotType)));
            const { feedback, action, target, valueStr, valueType } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsUndefined(feedback));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsUndefined(action));
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueStrDefined(valueStr));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueTypeMatch(valueType, this.props.slotType));
            this.handleFunc = this.handleBareValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleBareValue(input, resultBuilder) {
        var _a;
        const { valueStr, erMatch } = InputUtil_1.InputUtil.getValueResolution(input);
        this.setValue(valueStr, erMatch);
        this.validateAndAddActs(input, resultBuilder, (_a = this.state.elicitationAction) !== null && _a !== void 0 ? _a : Strings_1.Strings.Action.Set);
        return;
    }
    isConfirmationAffirmed(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isBareYes(input));
            Predicates_1.okIf(this.state.activeInitiativeAct === 'ConfirmValueAct');
            this.handleFunc = this.handleConfirmationAffirmed;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleConfirmationAffirmed(input, resultBuilder) {
        this.state.activeInitiativeAct = undefined;
        this.state.isValueConfirmed = true;
        resultBuilder.addAct(new ContentActs_1.ValueConfirmedAct(this, { value: this.state.value }));
    }
    isConfirmationDisAffirmed(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isBareNo(input));
            Predicates_1.okIf(this.state.activeInitiativeAct === 'ConfirmValueAct');
            this.handleFunc = this.handleConfirmationDisAffirmed;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleConfirmationDisAffirmed(input, resultBuilder) {
        this.state.isValueConfirmed = false;
        this.state.activeInitiativeAct = undefined;
        resultBuilder.addAct(new ContentActs_1.ValueDisconfirmedAct(this, { value: this.state.value }));
        const allChoices = this.getChoicesList(input);
        if (allChoices === null) {
            throw new Error('ListControl.listItemIDs is null');
        }
        const choicesFromActivePage = this.getChoicesFromActivePage(allChoices);
        resultBuilder.addAct(new InitiativeActs_1.RequestValueByListAct(this, { choicesFromActivePage, allChoices }));
    }
    isOrdinalScreenEvent(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isAPLUserEventWithMatchingControlId(input, this.id));
            this.handleFunc = this.handleOrdinalScreenEvent;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleOrdinalScreenEvent(input, resultBuilder) {
        const onScreenChoices = this.getChoicesList(input);
        if (onScreenChoices === null) {
            throw new Predicates_1.StateConsistencyError('OrdinalScreenEvent received but no known list values.');
        }
        const ordinal = input.request.arguments[1];
        if (ordinal < 0 || ordinal > onScreenChoices.length) {
            throw new Predicates_1.StateConsistencyError(`APL Ordinal out of range. ordinal=${ordinal} valueList=${onScreenChoices}`);
        }
        const value = onScreenChoices[ordinal - 1];
        this.setValue(value, true);
        // feedback
        resultBuilder.addAct(new ContentActs_1.ValueSetAct(this, { value }));
        return;
    }
    isOrdinalSelection(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, OrdinalControlIntent_1.OrdinalControlIntent.name));
            const { feedback, action, target, 'AMAZON.Ordinal': value } = OrdinalControlIntent_1.unpackOrdinalControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatchOrUndefined(action, this.props.interactionModel.actions.set));
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueStrDefined(value));
            this.handleFunc = this.handleOrdinalSelection;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleOrdinalSelection(input, resultBuilder) {
        const allChoices = this.getChoicesList(input);
        const spokenChoices = this.getChoicesFromActivePage(allChoices);
        const { 'AMAZON.Ordinal': valueStr } = OrdinalControlIntent_1.unpackOrdinalControlIntent(input.request.intent);
        const value = valueStr !== undefined ? Number.parseInt(valueStr, 10) : undefined;
        if (value !== undefined && value <= spokenChoices.length) {
            this.setValue(spokenChoices[value - 1], true);
            resultBuilder.addAct(new ContentActs_1.ValueSetAct(this, { value: this.state.value }));
            return;
        }
        resultBuilder.addAct(new ContentActs_1.UnusableInputValueAct(this, { value, reasonCode: 'OrdinalOutOfRange', renderedReason: 'I don\'t know which you mean.' }));
        return;
    }
    /**
     * Directly set the value.
     *
     * @param value - Value
     * @param erMatch - Whether the value is an ID defined for `this.slotType`
     * in the interaction model
     */
    setValue(value, erMatch = true) {
        this.state.previousValue = this.state.value;
        this.state.value = value;
        this.state.erMatch = erMatch;
        this.state.isValueConfirmed = false;
    }
    /**
     * Clear the state of this control.
     */
    clear() {
        this.state = new ListControlState();
    }
    // tsDoc - see Control
    canTakeInitiative(input) {
        return this.wantsToConfirmValue(input)
            || this.wantsToFixInvalidValue(input)
            || this.wantsToElicitValue(input);
    }
    // tsDoc - see Control
    async takeInitiative(input, resultBuilder) {
        if (this.initiativeFunc === undefined) {
            const errorMsg = 'ListControl: takeInitiative called but this.initiativeFunc is not set. canTakeInitiative() should be called first to set this.initiativeFunc.';
            log.error(errorMsg);
            throw new Error(errorMsg);
        }
        this.initiativeFunc(input, resultBuilder);
        return;
    }
    wantsToConfirmValue(input) {
        if (this.state.value !== undefined && this.state.isValueConfirmed === false && this.evaluateBooleanProp(this.props.confirmationRequired, input)) {
            this.initiativeFunc = this.confirmValue;
            return true;
        }
        return false;
    }
    confirmValue(input, resultBuilder) {
        this.state.activeInitiativeAct = 'ConfirmValueAct';
        resultBuilder.addAct(new InitiativeActs_1.ConfirmValueAct(this, { value: this.state.value }));
    }
    wantsToFixInvalidValue(input) {
        if (this.state.value !== undefined && this.validate(input) !== true) {
            this.initiativeFunc = this.fixInvalidValue;
            return true;
        }
        return false;
    }
    fixInvalidValue(input, resultBuilder) {
        this.validateAndAddActs(input, resultBuilder, Strings_1.Strings.Action.Change);
    }
    wantsToElicitValue(input) {
        if (this.state.value === undefined && this.evaluateBooleanProp(this.props.required, input)) {
            this.initiativeFunc = this.elicitValue;
            return true;
        }
        return false;
    }
    elicitValue(input, resultBuilder) {
        this.askElicitationQuestion(input, resultBuilder, Strings_1.Strings.Action.Set);
    }
    validateAndAddActs(input, resultBuilder, elicitationAction) {
        this.state.elicitationAction = elicitationAction;
        const validationResult = this.validate(input);
        if (validationResult === true) {
            if (elicitationAction === Strings_1.Strings.Action.Change) {
                // if elicitationAction == 'change', then the previousValue must be defined.
                if (this.state.previousValue !== undefined) {
                    resultBuilder.addAct(new ContentActs_1.ValueChangedAct(this, { previousValue: this.state.previousValue, value: this.state.value }));
                }
                else {
                    throw new Error('ValueChangedAct should only be used if there is an actual previous value');
                }
            }
            else {
                resultBuilder.addAct(new ContentActs_1.ValueSetAct(this, { value: this.state.value }));
            }
        }
        else {
            // feedback
            resultBuilder.addAct(new ContentActs_1.InvalidValueAct(this, {
                value: this.state.value,
                reasonCode: validationResult.reasonCode,
                renderedReason: validationResult.renderedReason
            }));
            this.askElicitationQuestion(input, resultBuilder, elicitationAction);
        }
        return;
    }
    validate(input) {
        const listOfValidationFunc = typeof (this.props.validation) === 'function' ? [this.props.validation] : this.props.validation;
        for (const validationFunction of listOfValidationFunc) {
            const validationResult = validationFunction(this.state, input);
            if (validationResult !== true) {
                log.debug(`ListControl.validate(): validation failed. Reason: ${JSON.stringify(validationResult, null, 2)}.`);
                return validationResult;
            }
        }
        return true;
    }
    askElicitationQuestion(input, resultBuilder, elicitationAction) {
        this.state.elicitationAction = elicitationAction;
        const allChoices = this.getChoicesList(input);
        if (allChoices === null) {
            throw new Error('ListControl.listItemIDs is null');
        }
        const choicesFromActivePage = this.getChoicesFromActivePage(allChoices);
        switch (elicitationAction) {
            case Strings_1.Strings.Action.Set:
                resultBuilder.addAct(new InitiativeActs_1.RequestValueByListAct(this, { choicesFromActivePage, allChoices }));
                return;
            case Strings_1.Strings.Action.Change:
                resultBuilder.addAct(new InitiativeActs_1.RequestChangedValueByListAct(this, { currentValue: this.state.value, choicesFromActivePage, allChoices }));
                return;
            default:
                throw new Error(`Unhandled. Unknown elicitationAction: ${elicitationAction}`);
        }
    }
    // tsDoc - see ControlStateDiagramming
    stringifyStateForDiagram() {
        var _a;
        let text = (_a = this.state.value) !== null && _a !== void 0 ? _a : '<none>';
        if (this.state.elicitationAction !== undefined) {
            text += `[eliciting, ${this.state.elicitationAction}]`;
        }
        return text;
    }
    getChoicesList(input) {
        const slotIds = (typeof this.props.listItemIDs === 'function')
            ? this.props.listItemIDs.call(this, input)
            : this.props.listItemIDs;
        return slotIds;
    }
    getChoicesFromActivePage(allChoices) {
        const start = this.getPageIndex();
        const end = start + this.props.pageSize;
        return allChoices.slice(start, end);
    }
    getPageIndex() {
        if (this.state.spokenItemsPageIndex === undefined) {
            this.state.spokenItemsPageIndex = 0;
        }
        return this.state.spokenItemsPageIndex;
    }
    // tsDoc - see Control
    renderAct(act, input, builder) {
        if (act instanceof InitiativeActs_1.RequestValueByListAct || act instanceof InitiativeActs_1.RequestChangedValueByListAct) {
            const prompt = act instanceof InitiativeActs_1.RequestValueByListAct
                ? this.evaluatePromptProp(act, this.props.prompts.requestValue, input)
                : this.evaluatePromptProp(act, this.props.prompts.requestChangedValue, input);
            const reprompt = act instanceof InitiativeActs_1.RequestValueByListAct
                ? this.evaluatePromptProp(act, this.props.reprompts.requestValue, input)
                : this.evaluatePromptProp(act, this.props.reprompts.requestChangedValue, input);
            builder.addPromptFragment(this.evaluatePromptProp(act, prompt, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, reprompt, input));
            if (this.evaluateBooleanProp(this.props.apl.enabled, input)) {
                const itemsArray = [];
                for (const choice of act.payload.allChoices) {
                    itemsArray.push({
                        primaryText: choice
                    });
                }
                // If APL is defined in act & users' device support APL
                if (ask_sdk_core_1.getSupportedInterfaces(input.handlerInput.requestEnvelope)['Alexa.Presentation.APL']) {
                    const aplDataSource = {
                        textListData: {
                            controlId: this.id,
                            headerTitle: i18next_1.default.t('LIST_CONTROL_DEFAULT_APL_HEADER_TITLE'),
                            items: itemsArray,
                        }
                    };
                    // TODO: apl merging / combination strategy
                    builder.addAPLRenderDocumentDirective('Token', this.props.apl.requestAPLDocument, aplDataSource);
                }
            }
        }
        else if (act instanceof ContentActs_1.UnusableInputValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.unusableInputValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.unusableInputValue, input));
        }
        else if (act instanceof ContentActs_1.InvalidValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.invalidValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.invalidValue, input));
        }
        else if (act instanceof ContentActs_1.ValueSetAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueSet, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueSet, input));
        }
        else if (act instanceof ContentActs_1.ValueChangedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueChanged, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueChanged, input));
        }
        else if (act instanceof InitiativeActs_1.ConfirmValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.confirmValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.confirmValue, input));
        }
        else if (act instanceof ContentActs_1.ValueConfirmedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueConfirmed, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueConfirmed, input));
        }
        else if (act instanceof ContentActs_1.ValueDisconfirmedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueDisconfirmed, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueDisconfirmed, input));
        }
        else {
            this.throwUnhandledActError(act);
        }
    }
    // tsDoc - see Control
    updateInteractionModel(generator, imData) {
        generator.addControlIntent(new GeneralControlIntent_1.GeneralControlIntent(), imData);
        generator.addControlIntent(new SingleValueControlIntent_1.SingleValueControlIntent(this.props.slotType), imData);
        generator.addControlIntent(new OrdinalControlIntent_1.OrdinalControlIntent(), imData);
        generator.addYesAndNoIntents();
        if (this.props.interactionModel.targets.includes(Strings_1.Strings.Target.Choice)) {
            generator.addValuesToSlotType(ModelTypes_1.SharedSlotType.TARGET, i18next_1.default.t('LIST_CONTROL_DEFAULT_SLOT_VALUES_TARGET_CHOICE', { returnObjects: true }));
        }
        if (this.props.interactionModel.actions.set.includes(Strings_1.Strings.Action.Select)) {
            generator.addValuesToSlotType(ModelTypes_1.SharedSlotType.ACTION, i18next_1.default.t('LIST_CONTROL_DEFAULT_SLOT_VALUES_ACTION_SELECT', { returnObjects: true }));
        }
    }
    // tsDoc - see InteractionModelContributor
    getTargetIds() {
        return this.props.interactionModel.targets;
    }
}
exports.ListControl = ListControl;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTGlzdENvbnRyb2wuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tbW9uQ29udHJvbHMvbGlzdENvbnRyb2wvTGlzdENvbnRyb2wudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7OztHQVdHOzs7O0FBRUgsK0NBQXNEO0FBRXRELDhEQUE4QjtBQUM5Qiw0REFBdUI7QUFDdkIscURBQXVEO0FBQ3ZELG9EQUE2RTtBQUs3RSwrRUFBNEU7QUFDNUUsNkVBQXNHO0FBQ3RHLDZFQUFzRztBQUN0RyxxRkFBa0g7QUFFbEgsNEVBQXdGO0FBQ3hGLHNEQUF1RDtBQUN2RCxpREFBOEM7QUFFOUMsOERBQTZKO0FBQzdKLG9FQUF1SDtBQUl2SCxxREFBa0Q7QUFDbEQsdURBQXlGO0FBQ3pGLCtCQUE0RTtBQUU1RSwrQ0FBK0M7QUFDL0MsOENBQThDO0FBRTlDLE1BQU0sR0FBRyxHQUFHLElBQUksZUFBTSxDQUFDLDRCQUE0QixDQUFDLENBQUM7QUFtSHJEOztHQUVHO0FBQ0gsTUFBYSxnQ0FBZ0M7Q0F5RDVDO0FBekRELDRFQXlEQztBQUVEOzs7R0FHRztBQUNILE1BQWEsc0JBQXNCO0NBVWxDO0FBVkQsd0RBVUM7QUFFRDs7R0FFRztBQUNILE1BQWEsbUJBQW1CO0NBa0IvQjtBQWxCRCxrREFrQkM7QUFFRDs7R0FFRztBQUNILE1BQWEsZ0JBQWdCO0lBQTdCO1FBMEJJOztXQUVHO1FBQ0gscUJBQWdCLEdBQVksS0FBSyxDQUFDO0lBV3RDLENBQUM7Q0FBQTtBQXhDRCw0Q0F3Q0M7QUFFRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBMkJHO0FBQ0gsTUFBYSxXQUFZLFNBQVEsaUJBQU87SUFTcEMsWUFBWSxLQUF1QjtRQUMvQixLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBUnBCLFVBQUssR0FBcUIsSUFBSSxnQkFBZ0IsRUFBRSxDQUFDO1FBVTdDLElBQUksS0FBSyxDQUFDLFFB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QUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDdEYsU0FBUyxDQUFDLGdCQUFnQixDQUFDLElBQUksMkNBQW9CLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUMvRCxTQUFTLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztRQUUvQixJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxpQkFBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUMvRCxTQUFTLENBQUMsbUJBQW1CLENBQUMsMkJBQWMsQ0FBQyxNQUFNLEVBQUUsaUJBQU8sQ0FBQyxDQUFDLENBQUMsZ0RBQWdELEVBQUUsRUFBRSxhQUFhLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQzlJO1FBRUQsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLGlCQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBQ25FLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQywyQkFBYyxDQUFDLE1BQU0sRUFBRSxpQkFBTyxDQUFDLENBQUMsQ0FBQyxnREFBZ0QsRUFBRSxFQUFFLGFBQWEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDOUk7SUFDTCxDQUFDO0lBRUQsMENBQTBDO0lBQzFDLFlBQVk7UUFDUixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDO0lBQy9DLENBQUM7Q0FHSjtBQTVrQkQsa0NBNGtCQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgMjAyMCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS5cbiAqIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIG9yIGluIHRoZSBcImxpY2Vuc2VcIiBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZFxuICogb24gYW4gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyXG4gKiBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZ1xuICogcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IGdldFN1cHBvcnRlZEludGVyZmFjZXMgfSBmcm9tICdhc2stc2RrLWNvcmUnO1xuaW1wb3J0IHsgSW50ZW50LCBJbnRlbnRSZXF1ZXN0LCBpbnRlcmZhY2VzIH0gZnJvbSBcImFzay1zZGstbW9kZWxcIjtcbmltcG9ydCBpMThuZXh0IGZyb20gJ2kxOG5leHQnO1xuaW1wb3J0IF8gZnJvbSBcImxvZGFzaFwiO1xuaW1wb3J0IHsgU3RyaW5ncyBhcyAkIH0gZnJvbSBcIi4uLy4uL2NvbnN0YW50cy9TdHJpbmdzXCI7XG5pbXBvcnQgeyBDb250cm9sLCBDb250cm9sUHJvcHMsIENvbnRyb2xTdGF0ZSB9IGZyb20gJy4uLy4uL2NvbnRyb2xzL0NvbnRyb2wnO1xuaW1wb3J0IHsgQ29udHJvbElucHV0IH0gZnJvbSAnLi4vLi4vY29udHJvbHMvQ29udHJvbElucHV0JztcbmltcG9ydCB7IENvbnRyb2xSZXN1bHRCdWlsZGVyIH0gZnJvbSAnLi4vLi4vY29udHJvbHMvQ29udHJvbFJlc3VsdCc7XG5pbXBvcnQgeyBJbnRlcmFjdGlvbk1vZGVsQ29udHJpYnV0b3IgfSBmcm9tICcuLi8uLi9jb250cm9scy9taXhpbnMvSW50ZXJhY3Rpb25Nb2RlbENvbnRyaWJ1dG9yJztcbmltcG9ydCB7IFZhbGlkYXRpb25SZXN1bHQgfSBmcm9tICcuLi8uLi9jb250cm9scy9WYWxpZGF0aW9uUmVzdWx0JztcbmltcG9ydCB7IEFtYXpvbkJ1aWx0SW5TbG90VHlwZSB9IGZyb20gJy4uLy4uL2ludGVudHMvQW1hem9uQnVpbHRJblNsb3RUeXBlJztcbmltcG9ydCB7IEdlbmVyYWxDb250cm9sSW50ZW50LCB1bnBhY2tHZW5lcmFsQ29udHJvbEludGVudCB9IGZyb20gJy4uLy4uL2ludGVudHMvR2VuZXJhbENvbnRyb2xJbnRlbnQnO1xuaW1wb3J0IHsgT3JkaW5hbENvbnRyb2xJbnRlbnQsIHVucGFja09yZGluYWxDb250cm9sSW50ZW50IH0gZnJvbSBcIi4uLy4uL2ludGVudHMvT3JkaW5hbENvbnRyb2xJbnRlbnRcIjtcbmltcG9ydCB7IFNpbmdsZVZhbHVlQ29udHJvbEludGVudCwgdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50IH0gZnJvbSAnLi4vLi4vaW50ZW50cy9TaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQnO1xuaW1wb3J0IHsgQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3IgfSBmcm9tICcuLi8uLi9pbnRlcmFjdGlvbk1vZGVsR2VuZXJhdGlvbi9Db250cm9sSW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvcic7XG5pbXBvcnQgeyBNb2RlbERhdGEsIFNoYXJlZFNsb3RUeXBlIH0gZnJvbSAnLi4vLi4vaW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRpb24vTW9kZWxUeXBlcyc7XG5pbXBvcnQgeyBMaXN0Rm9ybWF0dGluZyB9IGZyb20gJy4uLy4uL2ludGwvTGlzdEZvcm1hdCc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tIFwiLi4vLi4vbG9nZ2luZy9Mb2dnZXJcIjtcbmltcG9ydCB7IENvbnRyb2xSZXNwb25zZUJ1aWxkZXIgfSBmcm9tICcuLi8uLi9yZXNwb25zZUdlbmVyYXRpb24vQ29udHJvbFJlc3BvbnNlQnVpbGRlcic7XG5pbXBvcnQgeyBJbnZhbGlkVmFsdWVBY3QsIFVudXNhYmxlSW5wdXRWYWx1ZUFjdCwgVmFsdWVDaGFuZ2VkQWN0LCBWYWx1ZUNvbmZpcm1lZEFjdCwgVmFsdWVEaXNjb25maXJtZWRBY3QsIFZhbHVlU2V0QWN0IH0gZnJvbSBcIi4uLy4uL3N5c3RlbUFjdHMvQ29udGVudEFjdHNcIjtcbmltcG9ydCB7IENvbmZpcm1WYWx1ZUFjdCwgUmVxdWVzdENoYW5nZWRWYWx1ZUJ5TGlzdEFjdCwgUmVxdWVzdFZhbHVlQnlMaXN0QWN0IH0gZnJvbSBcIi4uLy4uL3N5c3RlbUFjdHMvSW5pdGlhdGl2ZUFjdHNcIjtcbmltcG9ydCB7IFN5c3RlbUFjdCB9IGZyb20gJy4uLy4uL3N5c3RlbUFjdHMvU3lzdGVtQWN0JztcbmltcG9ydCB7IFN0cmluZ09yTGlzdCB9IGZyb20gJy4uLy4uL3V0aWxzL0Jhc2ljVHlwZXMnO1xuaW1wb3J0IHsgRGVlcFJlcXVpcmVkIH0gZnJvbSAnLi4vLi4vdXRpbHMvRGVlcFJlcXVpcmVkJztcbmltcG9ydCB7IElucHV0VXRpbCB9IGZyb20gXCIuLi8uLi91dGlscy9JbnB1dFV0aWxcIjtcbmltcG9ydCB7IGZhbHNlSWZHdWFyZEZhaWxlZCwgb2tJZiwgU3RhdGVDb25zaXN0ZW5jeUVycm9yIH0gZnJvbSAnLi4vLi4vdXRpbHMvUHJlZGljYXRlcyc7XG5pbXBvcnQgeyBBUExMaXN0SXRlbSwgZ2VuZXJhdGVUZXh0TGlzdERvY3VtZW50Rm9yTGlzdENvbnRyb2wgfSBmcm9tICcuL0FQTCc7XG5cbi8vIFRPRE86IGZlYXR1cmU6IHN1cHBvcnQgXCJ3aGF0IGFyZSBteSBjaG9pY2VzXCJcbi8vIFRPRE86IGZlYXR1cmU6IHZvaWNlIHBhZ2luYXRpb24gb2YgY2hvaWNlcy5cblxuY29uc3QgbG9nID0gbmV3IExvZ2dlcignQXNrU2RrQ29udHJvbHM6TGlzdENvbnRyb2wnKTtcblxuLyoqXG4gKiBQcm9wcyBmb3IgYSBMaXN0Q29udHJvbC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBMaXN0Q29udHJvbFByb3BzIGV4dGVuZHMgQ29udHJvbFByb3BzIHtcblxuICAgIC8qKlxuICAgICAqIFVuaXF1ZSBpZGVudGlmaWVyIGZvciBjb250cm9sIGluc3RhbmNlXG4gICAgICovXG4gICAgaWQ6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFNsb3QgdHlwZSBmb3IgdGhlIHZhbHVlIHRoYXQgdGhpcyBjb250cm9sIGNvbGxlY3RzLlxuICAgICAqXG4gICAgICogVXNhZ2U6XG4gICAgICogLSBUaGUgc2xvdCB0eXBlIGRlZmluZXMgdGhlIHNldCBvZiBleHBlY3RlZCB2YWx1ZSBpdGVtcy5cbiAgICAgKiAtIE5MVSB3aWxsLCBvbiBvY2Nhc2lvbiwgYWNjZXB0IG5vdmVsIHNsb3QgdmFsdWUgYW5kIG1hcmsgdGhlbSBhc1xuICAgICAqICAgRVJfTk9fTUFUQ0guICBJZiB5b3Ugb25seSB3YW50IHRvIGFjY2VwdCB2YWx1ZXMgdGhhdCBhcmUgZXhwbGljaXRseVxuICAgICAqICAgZGVmaW5lZCBhZGQgYSB2YWxpZGF0aW9uIGZ1bmN0aW9uIHRvIHRlc3QgYHRoaXMuc3RhdGUuZXJNYXRjaGBcbiAgICAgKi9cbiAgICBzbG90VHlwZTogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24ocykgdGhhdCBkZXRlcm1pbmUgaWYgdGhlIHZhbHVlIGlzIHZhbGlkLlxuICAgICAqXG4gICAgICogRGVmYXVsdDogYHRydWVgLCBpLmUuIGFueSB2YWx1ZSBpcyB2YWxpZC5cbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqIC0gVmFsaWRhdGlvbiBmdW5jdGlvbnMgcmV0dXJuIGVpdGhlciBgdHJ1ZWAgb3IgYSBgVmFsaWRhdGlvblJlc3VsdGAgdG9cbiAgICAgKiAgIGRlc2NyaWJlIHdoYXQgdmFsaWRhdGlvbiBmYWlsZWQuXG4gICAgICovXG4gICAgdmFsaWRhdGlvbj86IFNsb3RWYWxpZGF0aW9uRnVuY3Rpb24gfCBTbG90VmFsaWRhdGlvbkZ1bmN0aW9uW107XG5cbiAgICAvKipcbiAgICAgKiBMaXN0IG9mIHNsb3QtdmFsdWUgSURzIHRoYXQgd2lsbCBiZSBwcmVzZW50ZWQgdG8gdGhlIHVzZXIgYXMgYSBsaXN0LlxuICAgICAqL1xuICAgIGxpc3RJdGVtSURzOiBzdHJpbmdbXSB8ICgoaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gc3RyaW5nW10pO1xuXG4gICAgLyoqXG4gICAgICogVGhlIG1heGltdW0gbnVtYmVyIG9mIGl0ZW1zIHNwb2tlbiBwZXIgdHVybi5cbiAgICAgKi9cbiAgICBwYWdlU2l6ZT86IG51bWJlcjtcblxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgaWYgdGhlIENvbnRyb2wgbXVzdCBvYnRhaW4gYSB2YWx1ZS5cbiAgICAgKlxuICAgICAqIElmIGB0cnVlYDpcbiAgICAgKiAgLSB0aGUgQ29udHJvbCByZXBvcnQgaXNSZWFkeSgpID0gZmFsc2UgaWYgbm8gdmFsdWUgaGFzIGJlZW4gb2J0YWluZWQuXG4gICAgICogIC0gdGhlIGNvbnRyb2wgd2lsbCB0YWtlIHRoZSBpbml0aWF0aXZlIHdoZW4gZ2l2ZW4gdGhlIG9wcG9ydHVuaXR5LlxuICAgICAqL1xuICAgIHJlcXVpcmVkPzogYm9vbGVhbiB8ICgoaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gYm9vbGVhbik7XG5cbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRoZSBDb250cm9sIGhhcyB0byBvYnRhaW4gZXhwbGljaXQgY29uZmlybWF0aW9uIG9mIHRoZSB2YWx1ZS5cbiAgICAgKlxuICAgICAqIElmIGB0cnVlYDpcbiAgICAgKiAgLSB0aGUgQ29udHJvbCB3aWxsIHJlcG9ydCBgaXNSZWFkeSgpID0gZmFsc2VgIGlmIHRoZSB2YWx1ZSBoYXMgbm90IGJlZW5cbiAgICAgKiAgICBleHBsaWNpdGx5IGNvbmZpcm1lZCBhcyBjb3JyZWN0IGJ5IHVzZXIuXG4gICAgICogIC0gdGhlIENvbnRyb2wgd2lsbCB0YWtlIHRoZSBpbml0aWF0aXZlIHdoZW4gZ2l2ZW4gdGhlIG9wcG9ydHVuaXR5LlxuICAgICAqL1xuICAgIGNvbmZpcm1hdGlvblJlcXVpcmVkPzogYm9vbGVhbiB8ICgoaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gYm9vbGVhbik7XG5cbiAgICAvKipcbiAgICAgKiBQcm9wcyB0byBjdXN0b21pemUgdGhlIHByb21wdCBmcmFnbWVudHMgdGhhdCB3aWxsIGJlIGFkZGVkIGJ5XG4gICAgICogYHRoaXMucmVuZGVyQWN0KClgLlxuICAgICAqL1xuICAgIHByb21wdHM/OiBMaXN0Q29udHJvbFByb21wdFByb3BzO1xuXG4gICAgLyoqXG4gICAgICogUHJvcHMgdG8gY3VzdG9taXplIHRoZSByZXByb21wdCBmcmFnbWVudHMgdGhhdCB3aWxsIGJlIGFkZGVkIGJ5XG4gICAgICogYHRoaXMucmVuZGVyQWN0KClgLlxuICAgICAqL1xuICAgIHJlcHJvbXB0cz86IExpc3RDb250cm9sUHJvbXB0UHJvcHM7XG5cbiAgICAvKipcbiAgICAgKiBQcm9wcyB0byBjdXN0b21pemUgdGhlIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIHRoZSBjb250cm9sIGFuZCB0aGVcbiAgICAgKiBpbnRlcmFjdGlvbiBtb2RlbC5cbiAgICAgKi9cbiAgICBpbnRlcmFjdGlvbk1vZGVsPzogTGlzdENvbnRyb2xJbnRlcmFjdGlvbk1vZGVsUHJvcHM7XG5cbiAgICAvKipcbiAgICAgKiBQcm9wcyB0byBjdXN0b21pemUgdGhlIEFQTCBnZW5lcmF0ZWQgYnkgdGhpcyBjb250cm9sLlxuICAgICAqL1xuICAgIGFwbD86IExpc3RDb250cm9sQVBMUHJvcHM7XG59XG5cbi8qKlxuICogTGlzdENvbnRyb2wgdmFsaWRhdGlvbiBmdW5jdGlvblxuICovXG5leHBvcnQgdHlwZSBTbG90VmFsaWRhdGlvbkZ1bmN0aW9uID0gKHN0YXRlOiBMaXN0Q29udHJvbFN0YXRlLCBpbnB1dDogQ29udHJvbElucHV0KSA9PiB0cnVlIHwgVmFsaWRhdGlvblJlc3VsdDtcblxuLyoqXG4gKiBNYXBwaW5nIG9mIGFjdGlvbiBzbG90IHZhbHVlcyB0byB0aGUgYmVoYXZpb3JzIHRoYXQgdGhpcyBjb250cm9sIHN1cHBvcnRzLlxuICpcbiAqIEJlaGF2aW9yOlxuICogLSBUaGlzIGNvbnRyb2wgd2lsbCBub3QgaGFuZGxlIGFuIGlucHV0IGlmIHRoZSBhY3Rpb24tc2xvdCBpcyBmaWxsZWQgd2l0aCBhblxuICogICB2YWx1ZSB3aG9zZSBJRCBpcyBub3QgYXNzb2NpYXRlZCB3aXRoIGEgY2FwYWJpbGl0eS5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBMaXN0Q29udHJvbEFjdGlvblByb3BzIHtcbiAgICAvKipcbiAgICAgKiBBY3Rpb24gc2xvdCB2YWx1ZSBJRHMgdGhhdCBhcmUgYXNzb2NpYXRlZCB3aXRoIHRoZSBcInNldCB2YWx1ZVwiIGNhcGFiaWxpdHkuXG4gICAgICpcbiAgICAgKiBEZWZhdWx0OiBbJ2J1aWx0aW5fc2V0JywgJ2J1aWx0aW5fc2VsZWN0J11cbiAgICAgKi9cbiAgICBzZXQ/OiBzdHJpbmdbXSxcblxuICAgIC8qKlxuICAgICAqIEFjdGlvbiBzbG90IHZhbHVlIElEcyB0aGF0IGFyZSBhc3NvY2lhdGVkIHdpdGggdGhlIFwiY2hhbmdlIHZhbHVlXCIgY2FwYWJpbGl0eS5cbiAgICAgKlxuICAgICAqIERlZmF1bHQgWydidWlsdGluX2NoYW5nZSddXG4gICAgICovXG4gICAgY2hhbmdlPzogc3RyaW5nW11cbn1cblxuLyoqXG4gKiBQcm9wcyBhc3NvY2lhdGVkIHdpdGggdGhlIGludGVyYWN0aW9uIG1vZGVsLlxuICovXG5leHBvcnQgY2xhc3MgTGlzdENvbnRyb2xJbnRlcmFjdGlvbk1vZGVsUHJvcHMge1xuICAgIC8qKlxuICAgICAqIFRhcmdldC1zbG90IHZhbHVlcyBhc3NvY2lhdGVkIHdpdGggdGhpcyBDb250cm9sLlxuICAgICAqXG4gICAgICogVGFyZ2V0cyBhc3NvY2lhdGUgdXR0ZXJhbmNlcyB0byBhIGNvbnRyb2wuIEZvciBleGFtcGxlLCBpZiB0aGUgdXNlciBzYXlzXG4gICAgICogXCJjaGFuZ2UgdGhlIHRpbWVcIiwgaXQgaXMgcGFyc2VkIGFzIGEgYEdlbmVyYWxDb250cm9sSW50ZW50YCB3aXRoIHNsb3RcbiAgICAgKiB2YWx1ZXMgYGFjdGlvbiA9IGNoYW5nZWAgYW5kIGB0YXJnZXQgPSB0aW1lYC4gIE9ubHkgY29udHJvbHMgdGhhdCBhcmVcbiAgICAgKiByZWdpc3RlcmVkIHdpdGggdGhlIGB0aW1lYCB0YXJnZXQgc2hvdWxkIG9mZmVyIHRvIGhhbmRsZSB0aGlzIGludGVudC5cbiAgICAgKlxuICAgICAqIERlZmF1bHQ6IFsnYnVpbHRpbl9pdCddXG4gICAgICpcbiAgICAgKiBVc2FnZTpcbiAgICAgKiAtIElmIHRoaXMgcHJvcCBpcyBkZWZpbmVkLCBpdCByZXBsYWNlcyB0aGUgZGVmYXVsdDsgaXQgaXMgbm90IGFkZGl0aXZlXG4gICAgICogICB0aGUgZGVmYXVsdHMuICBUbyBhZGQgYW4gYWRkaXRpb25hbCB0YXJnZXQgdG8gdGhlIGRlZmF1bHRzLCBjb3B5IHRoZVxuICAgICAqICAgZGVmYXVsdHMgYW5kIGFtZW5kLlxuICAgICAqIC0gQSBjb250cm9sIGNhbiBiZSBhc3NvY2lhdGVkIHdpdGggbWFueSB0YXJnZXQtc2xvdC12YWx1ZXMsIGVnIFsnZGF0ZScsXG4gICAgICogICAnc3RhcnREYXRlJywgJ2V2ZW50U3RhcnREYXRlJywgJ3ZhY2F0aW9uU3RhcnQnXVxuICAgICAqIC0gSXQgaXMgYSBnb29kIGlkZWEgdG8gYXNzb2NpYXRlIHdpdGggZ2VuZXJhbCB0YXJnZXRzIChlLmcuIGRhdGUpIGFuZFxuICAgICAqICAgYWxzbyB3aXRoIHNwZWNpZmljIHRhcmdldHMgKGUuZy4gdmFjYXRpb25TdGFydCkgc28gdGhhdCB0aGUgdXNlciBjYW5cbiAgICAgKiAgIHNheSBlaXRoZXIgZ2VuZXJhbCBvciBzcGVjaWZpYyB0aGluZ3MuICBlLmcuICdjaGFuZ2UgdGhlIGRhdGUgdG9cbiAgICAgKiAgIFR1ZXNkYXknLCBvciAnSSB3YW50IG15IHZhY2F0aW9uIHRvIHN0YXJ0IG9uIFR1ZXNkYXknLlxuICAgICAqIC0gVGhlIGFzc29jaWF0aW9uIGRvZXMgbm90IGhhdmUgdG8gYmUgZXhjbHVzaXZlLCBhbmQgZ2VuZXJhbCB0YXJnZXQgc2xvdFxuICAgICAqICAgdmFsdWVzIHdpbGwgb2Z0ZW4gYmUgYXNzb2NpYXRlZCB3aXRoIG1hbnkgY29udHJvbHMuIEluIHNpdHVhdGlvbnMgd2hlcmVcbiAgICAgKiAgIHRoZXJlIGlzIGFtYmlndWl0eSBhYm91dCB3aGF0IHRoZSB1c2VyIGlzIHJlZmVycmluZyB0bywgdGhlIHBhcmVudFxuICAgICAqICAgY29udHJvbHMgbXVzdCByZXNvbHZlIHRoZSBjb25mdXNpb24uXG4gICAgICogLSBUaGUgJ2J1aWx0aW5fKicgSURzIGFyZSBhc3NvY2lhdGVkIHdpdGggZGVmYXVsdCBpbnRlcmFjdGlvbiBtb2RlbCBkYXRhXG4gICAgICogICAod2hpY2ggY2FuIGJlIGV4dGVuZGVkIGFzIGRlc2lyZWQpLiBBbnkgb3RoZXIgSURzIHdpbGwgcmVxdWlyZSBhIGZ1bGxcbiAgICAgKiAgIGRlZmluaXRpb24gb2YgdGhlIGFsbG93ZWQgc3lub255bXMgaW4gdGhlIGludGVyYWN0aW9uIG1vZGVsLlxuICAgICAqXG4gICAgICogQ29udHJvbCBiZWhhdmlvcjpcbiAgICAgKiAtIEEgY29udHJvbCB3aWxsIG5vdCBoYW5kbGUgYW4gaW5wdXQgdGhhdCBtZW50aW9ucyBhIHRhcmdldCB0aGF0IGlzIG5vdFxuICAgICAqICAgcmVnaXN0ZXJlZCBieSB0aGlzIHByb3AuXG4gICAgICpcbiAgICAgKi9cbiAgICB0YXJnZXRzPzogc3RyaW5nW107XG5cbiAgICAvKipcbiAgICAgKiBBY3Rpb24gc2xvdC12YWx1ZXMgYXNzb2NpYXRlZCB0byB0aGUgY29udHJvbCdzIGNhcGFiaWxpdGllcy5cbiAgICAgKlxuICAgICAqIEFjdGlvbiBzbG90LXZhbHVlcyBhc3NvY2lhdGUgdXR0ZXJhbmNlcyB0byBhIGNvbnRyb2wuIEZvciBleGFtcGxlLCBpZiB0aGVcbiAgICAgKiB1c2VyIHNheXMgXCJjaGFuZ2UgdGhlIHRpbWVcIiwgaXQgaXMgcGFyc2VkIGFzIGEgYEdlbmVyYWxDb250cm9sSW50ZW50YFxuICAgICAqIHdpdGggc2xvdCB2YWx1ZXMgYGFjdGlvbiA9IGNoYW5nZWAgYW5kIGB0YXJnZXQgPSB0aW1lYC4gIE9ubHkgY29udHJvbHNcbiAgICAgKiB0aGF0IGFyZSByZWdpc3RlcmVkIHdpdGggdGhlIGBjaGFuZ2VgIGFjdGlvbiBzaG91bGQgb2ZmZXIgdG8gaGFuZGxlIHRoaXNcbiAgICAgKiBpbnRlbnQuXG4gICAgICpcbiAgICAgKiBVc2FnZTpcbiAgICAgKiAgLSBUaGlzIGFsbG93cyB1c2VycyB0byByZWZlciB0byBhbiBhY3Rpb24gdXNpbmcgbW9yZSBkb21haW4tYXBwcm9wcmlhdGVcbiAgICAgKiAgICB3b3Jkcy4gRm9yIGV4YW1wbGUsIGEgdXNlciBtaWdodCBsaWtlIHRvIHNheSAnc2hvdyB0d28gaXRlbXMnIHJhdGhlclxuICAgICAqICAgIHRoYXQgJ3NldCBpdGVtIGNvdW50IHRvIHR3bycuICBUbyBhY2hpZXZlIHRoaXMsIGluY2x1ZGUgdGhlXG4gICAgICogICAgc2xvdC12YWx1ZS1pZCAnc2hvdycgaW4gdGhlIGxpc3QgYXNzb2NpYXRlZCB3aXRoIHRoZSAnc2V0JyBjYXBhYmlsaXR5XG4gICAgICogICAgYW5kIGVuc3VyZSB0aGUgaW50ZXJhY3Rpb24tbW9kZWwgaW5jbHVkZXMgYW4gYWN0aW9uIHNsb3QgdmFsdWUgd2l0aFxuICAgICAqICAgIGlkPXNob3cgYW5kIGFwcHJvcHJpYXRlIHN5bm9ueW1zLlxuICAgICAqICAtIFRoZSAnYnVpbHRpbl8qJyBJRHMgYXJlIGFzc29jaWF0ZWQgd2l0aCBkZWZhdWx0IGludGVyYWN0aW9uIG1vZGVsIGRhdGFcbiAgICAgKiAgICAod2hpY2ggY2FuIGJlIGV4dGVuZGVkIGFzIGRlc2lyZWQpLiBBbnkgb3RoZXIgSURzIHdpbGwgcmVxdWlyZSBhIGZ1bGxcbiAgICAgKiAgICBkZWZpbml0aW9uIG9mIHRoZSBhbGxvd2VkIHN5bm9ueW1zIGluIHRoZSBpbnRlcmFjdGlvbiBtb2RlbC5cbiAgICAgKi9cbiAgICBhY3Rpb25zPzogTGlzdENvbnRyb2xBY3Rpb25Qcm9wcztcbn1cblxuLyoqXG4gKiBQcm9wcyB0byBjdXN0b21pemUgdGhlIHByb21wdCBmcmFnbWVudHMgdGhhdCB3aWxsIGJlIGFkZGVkIGJ5XG4gKiBgdGhpcy5yZW5kZXJBY3QoKWAuXG4gKi9cbmV4cG9ydCBjbGFzcyBMaXN0Q29udHJvbFByb21wdFByb3BzIHtcbiAgICB2YWx1ZVNldD86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBWYWx1ZVNldEFjdDxhbnk+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIHZhbHVlQ2hhbmdlZD86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBWYWx1ZUNoYW5nZWRBY3Q8YW55PiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICBpbnZhbGlkVmFsdWU/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogSW52YWxpZFZhbHVlQWN0PGFueT4sIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG4gICAgdW51c2FibGVJbnB1dFZhbHVlPzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IFVudXNhYmxlSW5wdXRWYWx1ZUFjdDxzdHJpbmc+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIHJlcXVlc3RWYWx1ZT86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBSZXF1ZXN0VmFsdWVCeUxpc3RBY3QsIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG4gICAgcmVxdWVzdENoYW5nZWRWYWx1ZT86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBSZXF1ZXN0Q2hhbmdlZFZhbHVlQnlMaXN0QWN0LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIGNvbmZpcm1WYWx1ZT86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBDb25maXJtVmFsdWVBY3Q8YW55PiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICB2YWx1ZUNvbmZpcm1lZD86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBWYWx1ZUNvbmZpcm1lZEFjdDxhbnk+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIHZhbHVlRGlzY29uZmlybWVkPzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IFZhbHVlRGlzY29uZmlybWVkQWN0PGFueT4sIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG59XG5cbi8qKlxuICogUHJvcHMgYXNzb2NpYXRlZCB3aXRoIHRoZSBBUEwgcHJvZHVjZWQgYnkgTGlzdENvbnRyb2wuXG4gKi9cbmV4cG9ydCBjbGFzcyBMaXN0Q29udHJvbEFQTFByb3BzIHtcbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIGlmIEFQTCBzaG91bGQgYmUgcHJvZHVjZWQuXG4gICAgICpcbiAgICAgKiBEZWZhdWx0OiB0cnVlXG4gICAgICovXG4gICAgZW5hYmxlZD86IGJvb2xlYW4gfCAoKGlucHV0OiBDb250cm9sSW5wdXQpID0+IGJvb2xlYW4pO1xuXG4gICAgLyoqXG4gICAgICogVGhlIEFQTCBkb2N1bWVudCB0byB1c2Ugd2hlbiByZXF1ZXN0aW5nIGEgdmFsdWVcbiAgICAgKlxuICAgICAqIERlZmF1bHQ6IEEgVGV4dExpc3RMYXlvdXQgZG9jdW1lbnQgd2l0aCBzY3JvbGxhYmxlIGFuZCBjbGlja2FibGUgbGlzdC5cbiAgICAgKiBTZWVcbiAgICAgKiBodHRwczovL2RldmVsb3Blci5hbWF6b24uY29tL2VuLVVTL2RvY3MvYWxleGEvYWxleGEtcHJlc2VudGF0aW9uLWxhbmd1YWdlL2FwbC1hbGV4YS10ZXh0LWxpc3QtbGF5b3V0Lmh0bWxcbiAgICAgKi9cbiAgICByZXF1ZXN0QVBMRG9jdW1lbnQ/OiB7IFtrZXk6IHN0cmluZ106IGFueTsgfSB8ICgoYWN0OiBSZXF1ZXN0VmFsdWVCeUxpc3RBY3QsIGlucHV0OiBDb250cm9sSW5wdXQpID0+IHsgW2tleTogc3RyaW5nXTogYW55OyB9KTtcblxuXG59XG5cbi8qKlxuICogU3RhdGUgdHJhY2tlZCBieSBhIExpc3RDb250cm9sLlxuICovXG5leHBvcnQgY2xhc3MgTGlzdENvbnRyb2xTdGF0ZSBpbXBsZW1lbnRzIENvbnRyb2xTdGF0ZSB7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgdmFsdWUuXG4gICAgICpcbiAgICAgKiBJZiBgZXJNYXRjaCA9IHRydWVgIHRoZSB2YWx1ZSBpcyBhIHNsb3QgdmFsdWUgSUQgZm9yIHRoZSBzbG90IHR5cGUgYHRoaXMuc2xvdFR5cGVgLlxuICAgICAqIElmIGBlck1hdGNoID0gZmFsc2VgIHRoZSB2YWx1ZSBtYXkgYmUgYW4gYXJiaXRyYXJ5IHN0cmluZy5cbiAgICAgKi9cbiAgICB2YWx1ZT86IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFRyYWNrcyB3aGV0aGVyIHRoZSB2YWx1ZSBpcyBhbiBFbnRpdHkgUmVzb2x1dGlvbiBtYXRjaC5cbiAgICAgKi9cbiAgICBlck1hdGNoPzogYm9vbGVhbjtcblxuICAgIC8qKlxuICAgICAqIFRyYWNrcyBpZiB0aGUgY29udHJvbCBpcyBhY3RpdmVseSBhc2tpbmcgdGhlIHVzZXIgdG8gc2V0IG9yIGNoYW5nZSB0aGUgdmFsdWUuXG4gICAgICovXG4gICAgZWxpY2l0YXRpb25BY3Rpb24/OiBzdHJpbmc7XG5cbiAgICAvLyBUT0RPOiByZWZhY3Rvci4gdHJhY2tpbmcgdGhlIHJlcXVlc3RBY3QgaXRzZWxmIGlzIGxpa2VseSBzaW1wbGVyLlxuICAgIC8qKlxuICAgICAqIEluZGV4IG9mIHRoZSBwYWdlIG9mIGl0ZW1zIG1vc3QgcmVjZW50bHkgc3Bva2VuLlxuICAgICAqL1xuICAgIHNwb2tlbkl0ZW1zUGFnZUluZGV4PzogbnVtYmVyO1xuXG4gICAgLyoqXG4gICAgICogVHJhY2tzIHdoZXRoZXIgdGhlIHZhbHVlIGhhcyBiZWVuIGV4cGxpY2l0bHkgY29uZmlybWVkIGJ5IHRoZSB1c2VyLlxuICAgICAqL1xuICAgIGlzVmFsdWVDb25maXJtZWQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBwcmV2aW91cyB2YWx1ZS5cbiAgICAgKi9cbiAgICBwcmV2aW91c1ZhbHVlPzogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogVHJhY2tzIHRoZSBsYXN0IGluaXRpYXRpdmUgYWN0IGZyb20gdGhlIGNvbnRyb2xcbiAgICAgKi9cbiAgICBhY3RpdmVJbml0aWF0aXZlQWN0Pzogc3RyaW5nOyAvLyBUT0RPOiBTdG9yZSBhY3R1YWwgYWN0XG59XG5cbi8qKlxuICogQSBDb250cm9sIHRoYXQgb2J0YWlucyBhIHNpbmdsZSB2YWx1ZSBmcm9tIHRoZSB1c2VyIGJ5IHByZXNlbnRpbmcgYSBsaXN0IG9mXG4gKiBhdmFpbGFibGUgb3B0aW9ucyB1c2luZyB2b2ljZSBhbmQvb3IgQVBMLlxuICpcbiAqIFRoZSB0eXBlIG9mIHZhbHVlIHRvIG9idGFpbiBpcyBkZWZpbmVkIGJ5IGB0aGlzLnNsb3RUeXBlYC5cbiAqXG4gKiBDYXBhYmlsaXRpZXM6XG4gKiAtIFJlcXVlc3QgYSB2YWx1ZVxuICogLSBDaGFuZ2UgYSB2YWx1ZVxuICogLSBWYWxpZGF0ZSB0aGUgdmFsdWVcbiAqIC0gQ29uZmlybSB0aGUgdmFsdWVcbiAqIC0gU3BlYWsgdGhlIGZpcnN0IGZldyBvcHRpb25zXG4gKiAtIFNob3cgYWxsIHRoZSBvcHRpb25zIG9uIEFQTCBlbmFibGVkIGRldmljZXNcbiAqIC0gU2VsZWN0aW9uIG9mIGEgdmFsdWUgdXNpbmcgYSBzcG9rZW4gb3JkaW5hbCwgZS5nLiBcIlRoZSBmaXJzdCBvbmVcIi5cbiAqIC0gU2VsZWN0aW9uIG9mIGEgdmFsdWUgdXNpbmcgdG91Y2ggc2NyZWVuLlxuICpcbiAqIEludGVudHMgdGhhdCBjYW4gYmUgaGFuZGxlZDpcbiAqIC0gYEdlbmVyYWxDb250cm9sSW50ZW50YDogRS5nLiBgXCJ5ZXMsIHVwZGF0ZSBteSBuYW1lXCJgXG4gKiAtIGB7VmFsdWVUeXBlfV9WYWx1ZUNvbnRyb2xJbnRlbnRgOiBFLmcuIFwibm8gY2hhbmdlIGl0IHRvIEVsdmlzXCIuXG4gKiAtIGBBTUFaT05fT1JESU5BTF9WYWx1ZUNvbnRyb2xJbnRlbnRgOiBFLmcuIFwibm8gY2hhbmdlIGl0IHRvIEVsdmlzXCIuXG4gKiAtIGBBTUFaT04uWWVzSW50ZW50YCwgYEFNQVpPTi5Ob0ludGVudGBcbiAqXG4gKiBBUEwgZXZlbnRzIHRoYXQgY2FuIGJlIGhhbmRsZWQ6XG4gKiAgLSB0b3VjaCBldmVudHMgaW5kaWNhdGluZyBzZWxlY3Rpb24gb2YgYW4gaXRlbSBvbiBzY3JlZW4uXG4gKlxuICogTGltaXRhdGlvbnM6XG4gKiAtIFRoaXMgY29udHJvbCBpcyBub3QgY29tcGF0aWJsZSB3aXRoIHRoZSBgQU1BWk9OLlNlYXJjaFF1ZXJ5YCBzbG90IHR5cGUuXG4gKi9cbmV4cG9ydCBjbGFzcyBMaXN0Q29udHJvbCBleHRlbmRzIENvbnRyb2wgaW1wbGVtZW50cyBJbnRlcmFjdGlvbk1vZGVsQ29udHJpYnV0b3Ige1xuXG4gICAgc3RhdGU6IExpc3RDb250cm9sU3RhdGUgPSBuZXcgTGlzdENvbnRyb2xTdGF0ZSgpO1xuXG4gICAgcHJpdmF0ZSByYXdQcm9wczogTGlzdENvbnRyb2xQcm9wcztcbiAgICBwcml2YXRlIHByb3BzOiBEZWVwUmVxdWlyZWQ8TGlzdENvbnRyb2xQcm9wcz47XG4gICAgcHJpdmF0ZSBoYW5kbGVGdW5jPzogKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKSA9PiB2b2lkO1xuICAgIHByaXZhdGUgaW5pdGlhdGl2ZUZ1bmM/OiAoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpID0+IHZvaWQ7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogTGlzdENvbnRyb2xQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcy5pZCk7XG5cbiAgICAgICAgaWYgKHByb3BzLnNsb3RUeXBlID09PSBBbWF6b25CdWlsdEluU2xvdFR5cGUuU0VBUkNIX1FVRVJZKXtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQU1BWk9OLlNlYXJjaFF1ZXJ5IGNhbm5vdCBiZSB1c2VkIHdpdGggTGlzdENvbnRyb2wgZHVlIHRvIHRoZSBzcGVjaWFsIHJ1bGVzIHJlZ2FyZGluZyBpdHMgdXNlLiAnXG4gICAgICAgICAgICAgKyAnU3BlY2lmaWNhbGx5LCB1dHRlcmFuY2VzIHRoYXQgaW5jbHVkZSBTZWFyY2hRdWVyeSBtdXN0IGhhdmUgYSBjYXJyaWVyIHBocmFzZSBhbmQgbm90IGJlIGNvbXByaXNlZCBlbnRpcmVseSBvZiBzbG90IHJlZmVyZW5jZXMuICdcbiAgICAgICAgICAgICArICdVc2UgYSBjdXN0b20gaW50ZW50IHRvIG1hbmFnZSBTZWFyY2hRdWVyeSBzbG90cyBvciBjcmVhdGUgYSByZWd1bGFyIHNsb3QgZm9yIHVzZSB3aXRoIExpc3RDb250cm9sLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yYXdQcm9wcyA9IHByb3BzO1xuICAgICAgICB0aGlzLnByb3BzID0gTGlzdENvbnRyb2wubWVyZ2VXaXRoRGVmYXVsdFByb3BzKHByb3BzKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgbWVyZ2VXaXRoRGVmYXVsdFByb3BzKHByb3BzOiBMaXN0Q29udHJvbFByb3BzKTogRGVlcFJlcXVpcmVkPExpc3RDb250cm9sUHJvcHM+IHtcblxuICAgICAgICBjb25zdCBkZWZhdWx0czogRGVlcFJlcXVpcmVkPExpc3RDb250cm9sUHJvcHM+ID1cbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6ICdkdW1teScsXG4gICAgICAgICAgICBzbG90VHlwZTogJ2R1bW15JyxcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgdmFsaWRhdGlvbjogW10sXG4gICAgICAgICAgICBwYWdlU2l6ZTogMyxcbiAgICAgICAgICAgIGxpc3RJdGVtSURzOiBbXSxcbiAgICAgICAgICAgIGNvbmZpcm1hdGlvblJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgICAgIGludGVyYWN0aW9uTW9kZWw6IHtcbiAgICAgICAgICAgICAgICBhY3Rpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgIHNldDogWyQuQWN0aW9uLlNldCwgJC5BY3Rpb24uU2VsZWN0XSxcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlOiBbJC5BY3Rpb24uQ2hhbmdlXSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRhcmdldHM6IFskLlRhcmdldC5DaG9pY2UsICQuVGFyZ2V0Lkl0XVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHByb21wdHM6IHtcbiAgICAgICAgICAgICAgICBjb25maXJtVmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnTElTVF9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX0NPTkZJUk1fVkFMVUUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICB2YWx1ZUNvbmZpcm1lZDogaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfVkFMVUVfQUZGSVJNRUQnKSxcbiAgICAgICAgICAgICAgICB2YWx1ZURpc2NvbmZpcm1lZDogaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfVkFMVUVfRElTQUZGSVJNRUQnKSxcbiAgICAgICAgICAgICAgICB2YWx1ZVNldDogKGFjdCkgPT4gaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfVkFMVUVfU0VUJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgdmFsdWVDaGFuZ2VkOiAoYWN0KSA9PiBpMThuZXh0LnQoJ0xJU1RfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9WQUxVRV9DSEFOR0VEJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgaW52YWxpZFZhbHVlOiAoYWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3QucGF5bG9hZC5yZW5kZXJlZFJlYXNvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfSU5WQUxJRF9WQUxVRV9XSVRIX1JFQVNPTicsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlLCByZWFzb246IGFjdC5wYXlsb2FkLnJlbmRlcmVkUmVhc29uIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ0xJU1RfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9HRU5FUkFMX0lOVkFMSURfVkFMVUUnKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHVudXNhYmxlSW5wdXRWYWx1ZTogKGFjdCkgPT4gaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfVU5VU0FCTEVfSU5QVVRfVkFMVUUnKSxcbiAgICAgICAgICAgICAgICByZXF1ZXN0VmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnTElTVF9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1JFUVVFU1RfVkFMVUUnLCB7IHN1Z2dlc3Rpb25zOiBMaXN0Rm9ybWF0dGluZy5mb3JtYXQoYWN0LnBheWxvYWQuY2hvaWNlc0Zyb21BY3RpdmVQYWdlKX0pLFxuICAgICAgICAgICAgICAgIHJlcXVlc3RDaGFuZ2VkVmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnTElTVF9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1JFUVVFU1RfQ0hBTkdFRF9WQUxVRScsIHsgc3VnZ2VzdGlvbnM6IExpc3RGb3JtYXR0aW5nLmZvcm1hdChhY3QucGF5bG9hZC5jaG9pY2VzRnJvbUFjdGl2ZVBhZ2UpfSksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVwcm9tcHRzOiB7XG4gICAgICAgICAgICAgICAgY29uZmlybVZhbHVlOiAoYWN0KSA9PiBpMThuZXh0LnQoJ0xJU1RfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX0NPTkZJUk1fVkFMVUUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICB2YWx1ZUNvbmZpcm1lZDogaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9WQUxVRV9BRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgIHZhbHVlRGlzY29uZmlybWVkOiBpMThuZXh0LnQoJ0xJU1RfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX1ZBTFVFX0RJU0FGRklSTUVEJyksXG4gICAgICAgICAgICAgICAgdmFsdWVTZXQ6IChhY3QpID0+IGkxOG5leHQudCgnTElTVF9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfVkFMVUVfU0VUJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgdmFsdWVDaGFuZ2VkOiAoYWN0KSA9PiBpMThuZXh0LnQoJ0xJU1RfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX1ZBTFVFX0NIQU5HRUQnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICBpbnZhbGlkVmFsdWU6IChhY3QpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdC5wYXlsb2FkLnJlbmRlcmVkUmVhc29uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ0xJU1RfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX0lOVkFMSURfVkFMVUVfV0lUSF9SRUFTT04nLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSwgcmVhc29uOiBhY3QucGF5bG9hZC5yZW5kZXJlZFJlYXNvbiB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfR0VORVJBTF9JTlZBTElEX1ZBTFVFJyk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB1bnVzYWJsZUlucHV0VmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnTElTVF9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfVU5VU0FCTEVfSU5QVVRfVkFMVUUnKSxcbiAgICAgICAgICAgICAgICByZXF1ZXN0VmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnTElTVF9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfUkVRVUVTVF9WQUxVRScsIHsgc3VnZ2VzdGlvbnM6IExpc3RGb3JtYXR0aW5nLmZvcm1hdChhY3QucGF5bG9hZC5jaG9pY2VzRnJvbUFjdGl2ZVBhZ2UpfSksXG4gICAgICAgICAgICAgICAgcmVxdWVzdENoYW5nZWRWYWx1ZTogKGFjdCkgPT4gaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9SRVFVRVNUX0NIQU5HRURfVkFMVUUnLCB7IHN1Z2dlc3Rpb25zOiBMaXN0Rm9ybWF0dGluZy5mb3JtYXQoYWN0LnBheWxvYWQuY2hvaWNlc0Zyb21BY3RpdmVQYWdlKX0pLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFwbDoge1xuICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgcmVxdWVzdEFQTERvY3VtZW50OiBnZW5lcmF0ZVRleHRMaXN0RG9jdW1lbnRGb3JMaXN0Q29udHJvbCgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIF8ubWVyZ2UoZGVmYXVsdHMsIHByb3BzKTtcbiAgICB9XG5cbiAgICAvLyB0c0RvYyAtIHNlZSBDb250cm9sXG4gICAgY2FuSGFuZGxlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNTZXRXaXRoVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmlzQ2hhbmdlV2l0aFZhbHVlKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc1NldFdpdGhvdXRWYWx1ZShpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaXNDaGFuZ2VXaXRob3V0VmFsdWUoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmlzQmFyZVZhbHVlKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc0NvbmZpcm1hdGlvbkFmZmlybWVkKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc0NvbmZpcm1hdGlvbkRpc0FmZmlybWVkKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc09yZGluYWxTY3JlZW5FdmVudChpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaXNPcmRpbmFsU2VsZWN0aW9uKGlucHV0KTtcbiAgICB9XG5cbiAgICAvLyB0c0RvYyAtIHNlZSBDb250cm9sXG4gICAgYXN5bmMgaGFuZGxlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmICh0aGlzLmhhbmRsZUZ1bmMgPT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICBsb2cuZXJyb3IoJ0xpc3RDb250cm9sOiBoYW5kbGUgY2FsbGVkIGJ1dCBubyBjbGF1c2UgbWF0Y2hlZC4gIGFyZSBjYW5IYW5kbGUvaGFuZGxlIG91dCBvZiBzeW5jPycpO1xuICAgICAgICAgICAgY29uc3QgaW50ZW50OiBJbnRlbnQgPSAoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQ7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7aW50ZW50Lm5hbWV9IGNhbiBub3QgYmUgaGFuZGxlZCBieSAke3RoaXMuY29uc3RydWN0b3IubmFtZX0uYCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmhhbmRsZUZ1bmMoaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgICAgICBpZiAocmVzdWx0QnVpbGRlci5oYXNJbml0aWF0aXZlQWN0KCkgIT09IHRydWUgJiYgdGhpcy5jYW5UYWtlSW5pdGlhdGl2ZShpbnB1dCkgPT09IHRydWUpe1xuICAgICAgICAgICAgYXdhaXQgdGhpcy50YWtlSW5pdGlhdGl2ZShpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGlzU2V0V2l0aFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzSW50ZW50KGlucHV0LCBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQuaW50ZW50TmFtZSh0aGlzLnByb3BzLnNsb3RUeXBlKSkpO1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQsIHZhbHVlU3RyLCB2YWx1ZVR5cGUgfSA9IHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHRhcmdldCwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnZhbHVlVHlwZU1hdGNoKHZhbHVlVHlwZSwgdGhpcy5wcm9wcy5zbG90VHlwZSkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudmFsdWVTdHJEZWZpbmVkKHZhbHVlU3RyKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzTWF0Y2hPclVuZGVmaW5lZChmZWVkYmFjaywgWyQuRmVlZGJhY2suQWZmaXJtLCAkLkZlZWRiYWNrLkRpc2FmZmlybV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2goYWN0aW9uLCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQpKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlU2V0V2l0aFZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTsgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlU2V0V2l0aFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKSB7XG4gICAgICAgIGNvbnN0IHsgdmFsdWVTdHIsIGVyTWF0Y2ggfSA9IElucHV0VXRpbC5nZXRWYWx1ZVJlc29sdXRpb24oaW5wdXQpO1xuICAgICAgICB0aGlzLnNldFZhbHVlKHZhbHVlU3RyLCBlck1hdGNoKTtcbiAgICAgICAgdGhpcy52YWxpZGF0ZUFuZEFkZEFjdHMoaW5wdXQsIHJlc3VsdEJ1aWxkZXIsICQuQWN0aW9uLlNldCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzU2V0V2l0aG91dFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzSW50ZW50KGlucHV0LCBHZW5lcmFsQ29udHJvbEludGVudC5uYW1lKSk7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCB9ID0gdW5wYWNrR2VuZXJhbENvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzTWF0Y2hPclVuZGVmaW5lZChmZWVkYmFjaywgWyQuRmVlZGJhY2suQWZmaXJtLCAkLkZlZWRiYWNrLkRpc2FmZmlybV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2goYWN0aW9uLCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQpKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlU2V0V2l0aG91dFZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTsgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlU2V0V2l0aG91dFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMuYXNrRWxpY2l0YXRpb25RdWVzdGlvbihpbnB1dCwgcmVzdWx0QnVpbGRlciwgJC5BY3Rpb24uU2V0KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNDaGFuZ2VXaXRoVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNJbnRlbnQoaW5wdXQsIFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5pbnRlbnROYW1lKHRoaXMucHJvcHMuc2xvdFR5cGUpKSk7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCwgdmFsdWVTdHIsIHZhbHVlVHlwZSB9ID0gdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cykpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudmFsdWVUeXBlTWF0Y2godmFsdWVUeXBlLCB0aGlzLnByb3BzLnNsb3RUeXBlKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC52YWx1ZVN0ckRlZmluZWQodmFsdWVTdHIpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmZlZWRiYWNrSXNNYXRjaE9yVW5kZWZpbmVkKGZlZWRiYWNrLCBbJC5GZWVkYmFjay5BZmZpcm0sICQuRmVlZGJhY2suRGlzYWZmaXJtXSkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuYWN0aW9uSXNNYXRjaChhY3Rpb24sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZSkpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVDaGFuZ2VXaXRoVmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZUNoYW5nZVdpdGhWYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB7IHZhbHVlU3RyLCBlck1hdGNoIH0gPSBJbnB1dFV0aWwuZ2V0VmFsdWVSZXNvbHV0aW9uKGlucHV0KTtcbiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZVN0ciwgZXJNYXRjaCk7XG4gICAgICAgIHRoaXMudmFsaWRhdGVBbmRBZGRBY3RzKGlucHV0LCByZXN1bHRCdWlsZGVyLCAkLkFjdGlvbi5DaGFuZ2UpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0NoYW5nZVdpdGhvdXRWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0ludGVudChpbnB1dCwgR2VuZXJhbENvbnRyb2xJbnRlbnQubmFtZSkpO1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQgfSA9IHVucGFja0dlbmVyYWxDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cykpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuZmVlZGJhY2tJc01hdGNoT3JVbmRlZmluZWQoZmVlZGJhY2ssIFskLkZlZWRiYWNrLkFmZmlybSwgJC5GZWVkYmFjay5EaXNhZmZpcm1dKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5hY3Rpb25Jc01hdGNoKGFjdGlvbiwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuY2hhbmdlKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUNoYW5nZVdpdGhvdXRWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZUNoYW5nZVdpdGhvdXRWYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICB0aGlzLmFza0VsaWNpdGF0aW9uUXVlc3Rpb24oaW5wdXQsIHJlc3VsdEJ1aWxkZXIsICQuQWN0aW9uLkNoYW5nZSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzQmFyZVZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBhbnkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNJbnRlbnQoaW5wdXQsIFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5pbnRlbnROYW1lKHRoaXMucHJvcHMuc2xvdFR5cGUpKSk7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCwgdmFsdWVTdHIsIHZhbHVlVHlwZSB9ID0gdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzVW5kZWZpbmVkKGZlZWRiYWNrKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5hY3Rpb25Jc1VuZGVmaW5lZChhY3Rpb24pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC52YWx1ZVN0ckRlZmluZWQodmFsdWVTdHIpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnZhbHVlVHlwZU1hdGNoKHZhbHVlVHlwZSwgdGhpcy5wcm9wcy5zbG90VHlwZSkpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVCYXJlVmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpOyB9XG4gICAgfVxuXG5cbiAgICBwcml2YXRlIGhhbmRsZUJhcmVWYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB7IHZhbHVlU3RyLCBlck1hdGNoIH0gPSBJbnB1dFV0aWwuZ2V0VmFsdWVSZXNvbHV0aW9uKGlucHV0KTtcbiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZVN0ciwgZXJNYXRjaCk7XG4gICAgICAgIHRoaXMudmFsaWRhdGVBbmRBZGRBY3RzKGlucHV0LCByZXN1bHRCdWlsZGVyLCB0aGlzLnN0YXRlLmVsaWNpdGF0aW9uQWN0aW9uID8/ICQuQWN0aW9uLlNldCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzQ29uZmlybWF0aW9uQWZmaXJtZWQoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGFueSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0JhcmVZZXMoaW5wdXQpKTtcbiAgICAgICAgICAgIG9rSWYodGhpcy5zdGF0ZS5hY3RpdmVJbml0aWF0aXZlQWN0ID09PSAnQ29uZmlybVZhbHVlQWN0Jyk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUNvbmZpcm1hdGlvbkFmZmlybWVkO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZUNvbmZpcm1hdGlvbkFmZmlybWVkKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3RhdGUuYWN0aXZlSW5pdGlhdGl2ZUFjdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zdGF0ZS5pc1ZhbHVlQ29uZmlybWVkID0gdHJ1ZTtcbiAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QoXG4gICAgICAgICAgICBuZXcgVmFsdWVDb25maXJtZWRBY3QodGhpcywgeyB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSB9KVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNDb25maXJtYXRpb25EaXNBZmZpcm1lZChpbnB1dDogQ29udHJvbElucHV0KTogYW55IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzQmFyZU5vKGlucHV0KSk7XG4gICAgICAgICAgICBva0lmKHRoaXMuc3RhdGUuYWN0aXZlSW5pdGlhdGl2ZUFjdCA9PT0gJ0NvbmZpcm1WYWx1ZUFjdCcpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVDb25maXJtYXRpb25EaXNBZmZpcm1lZDtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVDb25maXJtYXRpb25EaXNBZmZpcm1lZChpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICB0aGlzLnN0YXRlLmlzVmFsdWVDb25maXJtZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zdGF0ZS5hY3RpdmVJbml0aWF0aXZlQWN0ID0gdW5kZWZpbmVkO1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgVmFsdWVEaXNjb25maXJtZWRBY3QodGhpcywge3ZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlfSkpO1xuXG4gICAgICAgIGNvbnN0IGFsbENob2ljZXMgPSB0aGlzLmdldENob2ljZXNMaXN0KGlucHV0KTtcbiAgICAgICAgaWYgKGFsbENob2ljZXMgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTGlzdENvbnRyb2wubGlzdEl0ZW1JRHMgaXMgbnVsbCcpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNob2ljZXNGcm9tQWN0aXZlUGFnZSA9IHRoaXMuZ2V0Q2hvaWNlc0Zyb21BY3RpdmVQYWdlKGFsbENob2ljZXMpO1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgUmVxdWVzdFZhbHVlQnlMaXN0QWN0KHRoaXMsIHtjaG9pY2VzRnJvbUFjdGl2ZVBhZ2UsIGFsbENob2ljZXN9KSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc09yZGluYWxTY3JlZW5FdmVudChpbnB1dDogQ29udHJvbElucHV0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0FQTFVzZXJFdmVudFdpdGhNYXRjaGluZ0NvbnRyb2xJZChpbnB1dCwgdGhpcy5pZCkpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVPcmRpbmFsU2NyZWVuRXZlbnQ7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpOyB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVPcmRpbmFsU2NyZWVuRXZlbnQoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3Qgb25TY3JlZW5DaG9pY2VzID0gdGhpcy5nZXRDaG9pY2VzTGlzdChpbnB1dCk7XG4gICAgICAgIGlmIChvblNjcmVlbkNob2ljZXMgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBTdGF0ZUNvbnNpc3RlbmN5RXJyb3IoJ09yZGluYWxTY3JlZW5FdmVudCByZWNlaXZlZCBidXQgbm8ga25vd24gbGlzdCB2YWx1ZXMuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBvcmRpbmFsID0gKGlucHV0LnJlcXVlc3QgYXMgaW50ZXJmYWNlcy5hbGV4YS5wcmVzZW50YXRpb24uYXBsLlVzZXJFdmVudCkuYXJndW1lbnRzIVsxXTtcbiAgICAgICAgaWYgKG9yZGluYWwgPCAwIHx8IG9yZGluYWwgPiBvblNjcmVlbkNob2ljZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgU3RhdGVDb25zaXN0ZW5jeUVycm9yKGBBUEwgT3JkaW5hbCBvdXQgb2YgcmFuZ2UuIG9yZGluYWw9JHtvcmRpbmFsfSB2YWx1ZUxpc3Q9JHtvblNjcmVlbkNob2ljZXN9YCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdmFsdWUgPSBvblNjcmVlbkNob2ljZXNbb3JkaW5hbCAtIDFdO1xuICAgICAgICB0aGlzLnNldFZhbHVlKHZhbHVlLCB0cnVlKTtcblxuICAgICAgICAvLyBmZWVkYmFja1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgVmFsdWVTZXRBY3QodGhpcywgeyB2YWx1ZSB9KSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzT3JkaW5hbFNlbGVjdGlvbihpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0ludGVudChpbnB1dCwgT3JkaW5hbENvbnRyb2xJbnRlbnQubmFtZSkpO1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQsICdBTUFaT04uT3JkaW5hbCc6IHZhbHVlfSA9IHVucGFja09yZGluYWxDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzTWF0Y2hPclVuZGVmaW5lZChmZWVkYmFjaywgWyQuRmVlZGJhY2suQWZmaXJtLCAkLkZlZWRiYWNrLkRpc2FmZmlybV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2hPclVuZGVmaW5lZChhY3Rpb24sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHRhcmdldCwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnZhbHVlU3RyRGVmaW5lZCh2YWx1ZSkpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVPcmRpbmFsU2VsZWN0aW9uO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTsgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlT3JkaW5hbFNlbGVjdGlvbihpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCBhbGxDaG9pY2VzID0gdGhpcy5nZXRDaG9pY2VzTGlzdChpbnB1dCk7XG4gICAgICAgIGNvbnN0IHNwb2tlbkNob2ljZXMgPSB0aGlzLmdldENob2ljZXNGcm9tQWN0aXZlUGFnZShhbGxDaG9pY2VzKTtcbiAgICAgICAgY29uc3QgeydBTUFaT04uT3JkaW5hbCc6IHZhbHVlU3RyfSA9IHVucGFja09yZGluYWxDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG5cbiAgICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZVN0ciAhPT0gdW5kZWZpbmVkID8gTnVtYmVyLnBhcnNlSW50KHZhbHVlU3RyISwgMTApIDogdW5kZWZpbmVkO1xuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSA8PSBzcG9rZW5DaG9pY2VzLmxlbmd0aCl7XG4gICAgICAgICAgICB0aGlzLnNldFZhbHVlKHNwb2tlbkNob2ljZXNbdmFsdWUgLSAxXSwgdHJ1ZSk7XG4gICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgVmFsdWVTZXRBY3QodGhpcywgeyB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSB9KSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QoXG4gICAgICAgICAgICBuZXcgVW51c2FibGVJbnB1dFZhbHVlQWN0KHRoaXMsIHt2YWx1ZSwgcmVhc29uQ29kZTogJ09yZGluYWxPdXRPZlJhbmdlJywgcmVuZGVyZWRSZWFzb246ICdJIGRvblxcJ3Qga25vdyB3aGljaCB5b3UgbWVhbi4nIH0pXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEaXJlY3RseSBzZXQgdGhlIHZhbHVlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHZhbHVlIC0gVmFsdWVcbiAgICAgKiBAcGFyYW0gZXJNYXRjaCAtIFdoZXRoZXIgdGhlIHZhbHVlIGlzIGFuIElEIGRlZmluZWQgZm9yIGB0aGlzLnNsb3RUeXBlYFxuICAgICAqIGluIHRoZSBpbnRlcmFjdGlvbiBtb2RlbFxuICAgICAqL1xuICAgIHNldFZhbHVlKHZhbHVlOiBzdHJpbmcsIGVyTWF0Y2g6IGJvb2xlYW4gPSB0cnVlKSB7XG4gICAgICAgIHRoaXMuc3RhdGUucHJldmlvdXNWYWx1ZSA9IHRoaXMuc3RhdGUudmFsdWU7XG4gICAgICAgIHRoaXMuc3RhdGUudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5zdGF0ZS5lck1hdGNoID0gZXJNYXRjaDtcbiAgICAgICAgdGhpcy5zdGF0ZS5pc1ZhbHVlQ29uZmlybWVkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xlYXIgdGhlIHN0YXRlIG9mIHRoaXMgY29udHJvbC5cbiAgICAgKi9cbiAgICBjbGVhcigpIHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IG5ldyBMaXN0Q29udHJvbFN0YXRlKCk7XG4gICAgfVxuXG4gICAgLy8gdHNEb2MgLSBzZWUgQ29udHJvbFxuICAgIGNhblRha2VJbml0aWF0aXZlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2FudHNUb0NvbmZpcm1WYWx1ZShpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMud2FudHNUb0ZpeEludmFsaWRWYWx1ZShpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMud2FudHNUb0VsaWNpdFZhbHVlKGlucHV0KTtcbiAgICB9XG5cbiAgICAvLyB0c0RvYyAtIHNlZSBDb250cm9sXG4gICAgYXN5bmMgdGFrZUluaXRpYXRpdmUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKHRoaXMuaW5pdGlhdGl2ZUZ1bmMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29uc3QgZXJyb3JNc2cgPSAnTGlzdENvbnRyb2w6IHRha2VJbml0aWF0aXZlIGNhbGxlZCBidXQgdGhpcy5pbml0aWF0aXZlRnVuYyBpcyBub3Qgc2V0LiBjYW5UYWtlSW5pdGlhdGl2ZSgpIHNob3VsZCBiZSBjYWxsZWQgZmlyc3QgdG8gc2V0IHRoaXMuaW5pdGlhdGl2ZUZ1bmMuJztcbiAgICAgICAgICAgIGxvZy5lcnJvcihlcnJvck1zZyk7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JNc2cpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW5pdGlhdGl2ZUZ1bmMoaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB3YW50c1RvQ29uZmlybVZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUudmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnN0YXRlLmlzVmFsdWVDb25maXJtZWQgPT09IGZhbHNlICYmIHRoaXMuZXZhbHVhdGVCb29sZWFuUHJvcCh0aGlzLnByb3BzLmNvbmZpcm1hdGlvblJlcXVpcmVkLCBpbnB1dCkpe1xuICAgICAgICAgICAgdGhpcy5pbml0aWF0aXZlRnVuYyA9IHRoaXMuY29uZmlybVZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHByaXZhdGUgY29uZmlybVZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3RhdGUuYWN0aXZlSW5pdGlhdGl2ZUFjdCA9ICdDb25maXJtVmFsdWVBY3QnO1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgQ29uZmlybVZhbHVlQWN0KHRoaXMsIHsgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUgfSkpO1xuICAgIH1cblxuICAgIHByaXZhdGUgd2FudHNUb0ZpeEludmFsaWRWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnZhbHVlICE9PSB1bmRlZmluZWQgJiYgdGhpcy52YWxpZGF0ZShpbnB1dCkgIT09IHRydWUpe1xuICAgICAgICAgICAgdGhpcy5pbml0aWF0aXZlRnVuYyA9IHRoaXMuZml4SW52YWxpZFZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHByaXZhdGUgZml4SW52YWxpZFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMudmFsaWRhdGVBbmRBZGRBY3RzKGlucHV0LCByZXN1bHRCdWlsZGVyLCAkLkFjdGlvbi5DaGFuZ2UpO1xuICAgIH1cblxuICAgIHByaXZhdGUgd2FudHNUb0VsaWNpdFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUudmFsdWUgPT09IHVuZGVmaW5lZCAmJiB0aGlzLmV2YWx1YXRlQm9vbGVhblByb3AodGhpcy5wcm9wcy5yZXF1aXJlZCwgaW5wdXQpKXtcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhdGl2ZUZ1bmMgPSB0aGlzLmVsaWNpdFZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHByaXZhdGUgZWxpY2l0VmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5hc2tFbGljaXRhdGlvblF1ZXN0aW9uKGlucHV0LCByZXN1bHRCdWlsZGVyLCAkLkFjdGlvbi5TZXQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgdmFsaWRhdGVBbmRBZGRBY3RzKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyLCBlbGljaXRhdGlvbkFjdGlvbjogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3RhdGUuZWxpY2l0YXRpb25BY3Rpb24gPSBlbGljaXRhdGlvbkFjdGlvbjtcbiAgICAgICAgY29uc3QgdmFsaWRhdGlvblJlc3VsdDogdHJ1ZSB8IFZhbGlkYXRpb25SZXN1bHQgPSB0aGlzLnZhbGlkYXRlKGlucHV0KTtcbiAgICAgICAgaWYgKHZhbGlkYXRpb25SZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICAgIGlmIChlbGljaXRhdGlvbkFjdGlvbiA9PT0gJC5BY3Rpb24uQ2hhbmdlKSB7XG4gICAgICAgICAgICAgICAgLy8gaWYgZWxpY2l0YXRpb25BY3Rpb24gPT0gJ2NoYW5nZScsIHRoZW4gdGhlIHByZXZpb3VzVmFsdWUgbXVzdCBiZSBkZWZpbmVkLlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLnByZXZpb3VzVmFsdWUgIT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFZhbHVlQ2hhbmdlZEFjdDxzdHJpbmc+KHRoaXMsIHtwcmV2aW91c1ZhbHVlOiB0aGlzLnN0YXRlLnByZXZpb3VzVmFsdWUsIHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlISB9KVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdWYWx1ZUNoYW5nZWRBY3Qgc2hvdWxkIG9ubHkgYmUgdXNlZCBpZiB0aGVyZSBpcyBhbiBhY3R1YWwgcHJldmlvdXMgdmFsdWUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgVmFsdWVTZXRBY3QodGhpcywgeyB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBmZWVkYmFja1xuICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IEludmFsaWRWYWx1ZUFjdDxzdHJpbmc+KFxuICAgICAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSEsXG4gICAgICAgICAgICAgICAgICAgIHJlYXNvbkNvZGU6IHZhbGlkYXRpb25SZXN1bHQucmVhc29uQ29kZSxcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZWRSZWFzb246IHZhbGlkYXRpb25SZXN1bHQucmVuZGVyZWRSZWFzb25cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRoaXMuYXNrRWxpY2l0YXRpb25RdWVzdGlvbihpbnB1dCwgcmVzdWx0QnVpbGRlciwgZWxpY2l0YXRpb25BY3Rpb24pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHZhbGlkYXRlKGlucHV0OiBDb250cm9sSW5wdXQpOiB0cnVlIHwgVmFsaWRhdGlvblJlc3VsdCB7XG4gICAgICAgIGNvbnN0IGxpc3RPZlZhbGlkYXRpb25GdW5jOiBTbG90VmFsaWRhdGlvbkZ1bmN0aW9uW10gPSB0eXBlb2YodGhpcy5wcm9wcy52YWxpZGF0aW9uKSA9PT0gJ2Z1bmN0aW9uJyA/IFt0aGlzLnByb3BzLnZhbGlkYXRpb25dIDogdGhpcy5wcm9wcy52YWxpZGF0aW9uO1xuICAgICAgICBmb3IgKGNvbnN0IHZhbGlkYXRpb25GdW5jdGlvbiBvZiBsaXN0T2ZWYWxpZGF0aW9uRnVuYykge1xuICAgICAgICAgICAgY29uc3QgdmFsaWRhdGlvblJlc3VsdDogdHJ1ZSB8IFZhbGlkYXRpb25SZXN1bHQgPSB2YWxpZGF0aW9uRnVuY3Rpb24odGhpcy5zdGF0ZSwgaW5wdXQpO1xuICAgICAgICAgICAgaWYgKHZhbGlkYXRpb25SZXN1bHQgIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBsb2cuZGVidWcoYExpc3RDb250cm9sLnZhbGlkYXRlKCk6IHZhbGlkYXRpb24gZmFpbGVkLiBSZWFzb246ICR7SlNPTi5zdHJpbmdpZnkodmFsaWRhdGlvblJlc3VsdCwgbnVsbCwgMil9LmApO1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZGF0aW9uUmVzdWx0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXNrRWxpY2l0YXRpb25RdWVzdGlvbihpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlciwgZWxpY2l0YXRpb25BY3Rpb246IHN0cmluZykge1xuICAgICAgICB0aGlzLnN0YXRlLmVsaWNpdGF0aW9uQWN0aW9uID0gZWxpY2l0YXRpb25BY3Rpb247XG4gICAgICAgIGNvbnN0IGFsbENob2ljZXMgPSB0aGlzLmdldENob2ljZXNMaXN0KGlucHV0KTtcbiAgICAgICAgaWYgKGFsbENob2ljZXMgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTGlzdENvbnRyb2wubGlzdEl0ZW1JRHMgaXMgbnVsbCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY2hvaWNlc0Zyb21BY3RpdmVQYWdlID0gdGhpcy5nZXRDaG9pY2VzRnJvbUFjdGl2ZVBhZ2UoYWxsQ2hvaWNlcyk7XG4gICAgICAgIHN3aXRjaCAoZWxpY2l0YXRpb25BY3Rpb24pIHtcbiAgICAgICAgICAgIGNhc2UgJC5BY3Rpb24uU2V0OlxuICAgICAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBSZXF1ZXN0VmFsdWVCeUxpc3RBY3QodGhpcywge2Nob2ljZXNGcm9tQWN0aXZlUGFnZSwgYWxsQ2hvaWNlc30pKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBjYXNlICQuQWN0aW9uLkNoYW5nZTpcbiAgICAgICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgICAgICAgICAgbmV3IFJlcXVlc3RDaGFuZ2VkVmFsdWVCeUxpc3RBY3QodGhpcywge2N1cnJlbnRWYWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSEsIGNob2ljZXNGcm9tQWN0aXZlUGFnZSwgYWxsQ2hvaWNlc30pXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5oYW5kbGVkLiBVbmtub3duIGVsaWNpdGF0aW9uQWN0aW9uOiAke2VsaWNpdGF0aW9uQWN0aW9uIH1gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIHRzRG9jIC0gc2VlIENvbnRyb2xTdGF0ZURpYWdyYW1taW5nXG4gICAgc3RyaW5naWZ5U3RhdGVGb3JEaWFncmFtKCk6IHN0cmluZyB7XG4gICAgICAgIGxldCB0ZXh0ID0gdGhpcy5zdGF0ZS52YWx1ZSA/PyAnPG5vbmU+JztcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuZWxpY2l0YXRpb25BY3Rpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGV4dCArPSBgW2VsaWNpdGluZywgJHt0aGlzLnN0YXRlLmVsaWNpdGF0aW9uQWN0aW9ufV1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0ZXh0O1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0Q2hvaWNlc0xpc3QoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IHN0cmluZ1tdIHtcbiAgICAgICAgY29uc3Qgc2xvdElkczogc3RyaW5nW10gPSAodHlwZW9mIHRoaXMucHJvcHMubGlzdEl0ZW1JRHMgPT09ICdmdW5jdGlvbicpXG4gICAgICAgICAgICA/IHRoaXMucHJvcHMubGlzdEl0ZW1JRHMuY2FsbCh0aGlzLCBpbnB1dClcbiAgICAgICAgICAgIDogdGhpcy5wcm9wcy5saXN0SXRlbUlEcztcbiAgICAgICAgcmV0dXJuIHNsb3RJZHM7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRDaG9pY2VzRnJvbUFjdGl2ZVBhZ2UoYWxsQ2hvaWNlczogc3RyaW5nW10pOiBzdHJpbmdbXSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy5nZXRQYWdlSW5kZXgoKTtcbiAgICAgICAgY29uc3QgZW5kID0gc3RhcnQgKyB0aGlzLnByb3BzLnBhZ2VTaXplO1xuICAgICAgICByZXR1cm4gYWxsQ2hvaWNlcy5zbGljZShzdGFydCwgZW5kKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFBhZ2VJbmRleCgpOiBudW1iZXIge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5zcG9rZW5JdGVtc1BhZ2VJbmRleCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnNwb2tlbkl0ZW1zUGFnZUluZGV4ID0gMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5zcG9rZW5JdGVtc1BhZ2VJbmRleDtcbiAgICB9XG5cbiAgICAvLyB0c0RvYyAtIHNlZSBDb250cm9sXG4gICAgcmVuZGVyQWN0KGFjdDogU3lzdGVtQWN0LCBpbnB1dDogQ29udHJvbElucHV0LCBidWlsZGVyOiBDb250cm9sUmVzcG9uc2VCdWlsZGVyKTogdm9pZCB7XG5cbiAgICAgICAgaWYgKGFjdCBpbnN0YW5jZW9mIFJlcXVlc3RWYWx1ZUJ5TGlzdEFjdCB8fCBhY3QgaW5zdGFuY2VvZiBSZXF1ZXN0Q2hhbmdlZFZhbHVlQnlMaXN0QWN0KSB7XG5cbiAgICAgICAgICAgIGNvbnN0IHByb21wdCA9IGFjdCBpbnN0YW5jZW9mIFJlcXVlc3RWYWx1ZUJ5TGlzdEFjdFxuICAgICAgICAgICAgICAgID8gdGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMucmVxdWVzdFZhbHVlLCBpbnB1dClcbiAgICAgICAgICAgICAgICA6IHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnJlcXVlc3RDaGFuZ2VkVmFsdWUsIGlucHV0KTtcbiAgICAgICAgICAgIGNvbnN0IHJlcHJvbXB0ID0gYWN0IGluc3RhbmNlb2YgUmVxdWVzdFZhbHVlQnlMaXN0QWN0XG4gICAgICAgICAgICAgICAgPyB0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnJlcXVlc3RWYWx1ZSwgaW5wdXQpXG4gICAgICAgICAgICAgICAgOiB0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnJlcXVlc3RDaGFuZ2VkVmFsdWUsIGlucHV0KTtcblxuICAgICAgICAgICAgYnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHByb21wdCwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHJlcHJvbXB0LCBpbnB1dCkpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5ldmFsdWF0ZUJvb2xlYW5Qcm9wKHRoaXMucHJvcHMuYXBsLmVuYWJsZWQsIGlucHV0KSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1zQXJyYXk6IEFQTExpc3RJdGVtW10gPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNob2ljZSBvZiBhY3QucGF5bG9hZC5hbGxDaG9pY2VzKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zQXJyYXkucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmltYXJ5VGV4dDogY2hvaWNlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIElmIEFQTCBpcyBkZWZpbmVkIGluIGFjdCAmIHVzZXJzJyBkZXZpY2Ugc3VwcG9ydCBBUExcbiAgICAgICAgICAgICAgICBpZiAoZ2V0U3VwcG9ydGVkSW50ZXJmYWNlcyhpbnB1dC5oYW5kbGVySW5wdXQucmVxdWVzdEVudmVsb3BlKVsnQWxleGEuUHJlc2VudGF0aW9uLkFQTCddKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFwbERhdGFTb3VyY2UgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0TGlzdERhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sSWQ6IHRoaXMuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyVGl0bGU6IGkxOG5leHQudCgnTElTVF9DT05UUk9MX0RFRkFVTFRfQVBMX0hFQURFUl9USVRMRScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBpdGVtc0FycmF5LFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBhcGwgbWVyZ2luZyAvIGNvbWJpbmF0aW9uIHN0cmF0ZWd5XG4gICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuYWRkQVBMUmVuZGVyRG9jdW1lbnREaXJlY3RpdmUoJ1Rva2VuJywgdGhpcy5wcm9wcy5hcGwucmVxdWVzdEFQTERvY3VtZW50LCBhcGxEYXRhU291cmNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBVbnVzYWJsZUlucHV0VmFsdWVBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMudW51c2FibGVJbnB1dFZhbHVlLCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMudW51c2FibGVJbnB1dFZhbHVlLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgSW52YWxpZFZhbHVlQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLmludmFsaWRWYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLmludmFsaWRWYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGFjdCBpbnN0YW5jZW9mIFZhbHVlU2V0QWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnZhbHVlU2V0LCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMudmFsdWVTZXQsIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBWYWx1ZUNoYW5nZWRBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMudmFsdWVDaGFuZ2VkLCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMudmFsdWVDaGFuZ2VkLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgQ29uZmlybVZhbHVlQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLmNvbmZpcm1WYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLmNvbmZpcm1WYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGFjdCBpbnN0YW5jZW9mIFZhbHVlQ29uZmlybWVkQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnZhbHVlQ29uZmlybWVkLCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMudmFsdWVDb25maXJtZWQsIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBWYWx1ZURpc2NvbmZpcm1lZEFjdCkge1xuICAgICAgICAgICAgYnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucHJvbXB0cy52YWx1ZURpc2NvbmZpcm1lZCwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnZhbHVlRGlzY29uZmlybWVkLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRocm93VW5oYW5kbGVkQWN0RXJyb3IoYWN0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIHRzRG9jIC0gc2VlIENvbnRyb2xcbiAgICB1cGRhdGVJbnRlcmFjdGlvbk1vZGVsKGdlbmVyYXRvcjogQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3IsIGltRGF0YTogTW9kZWxEYXRhKSB7XG4gICAgICAgIGdlbmVyYXRvci5hZGRDb250cm9sSW50ZW50KG5ldyBHZW5lcmFsQ29udHJvbEludGVudCgpLCBpbURhdGEpO1xuICAgICAgICBnZW5lcmF0b3IuYWRkQ29udHJvbEludGVudChuZXcgU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KHRoaXMucHJvcHMuc2xvdFR5cGUpLCBpbURhdGEpO1xuICAgICAgICBnZW5lcmF0b3IuYWRkQ29udHJvbEludGVudChuZXcgT3JkaW5hbENvbnRyb2xJbnRlbnQoKSwgaW1EYXRhKTtcbiAgICAgICAgZ2VuZXJhdG9yLmFkZFllc0FuZE5vSW50ZW50cygpO1xuXG4gICAgICAgIGlmICh0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cy5pbmNsdWRlcygkLlRhcmdldC5DaG9pY2UpKSB7XG4gICAgICAgICAgICBnZW5lcmF0b3IuYWRkVmFsdWVzVG9TbG90VHlwZShTaGFyZWRTbG90VHlwZS5UQVJHRVQsIGkxOG5leHQudCgnTElTVF9DT05UUk9MX0RFRkFVTFRfU0xPVF9WQUxVRVNfVEFSR0VUX0NIT0lDRScsIHsgcmV0dXJuT2JqZWN0czogdHJ1ZSB9KSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuc2V0LmluY2x1ZGVzKCQuQWN0aW9uLlNlbGVjdCkpIHtcbiAgICAgICAgICAgIGdlbmVyYXRvci5hZGRWYWx1ZXNUb1Nsb3RUeXBlKFNoYXJlZFNsb3RUeXBlLkFDVElPTiwgaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9TTE9UX1ZBTFVFU19BQ1RJT05fU0VMRUNUJywgeyByZXR1cm5PYmplY3RzOiB0cnVlIH0pKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIHRzRG9jIC0gc2VlIEludGVyYWN0aW9uTW9kZWxDb250cmlidXRvclxuICAgIGdldFRhcmdldElkcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzO1xuICAgIH1cblxuICAgIC8vIFRPRE86IGZlYXR1cmU6IHVzZSBzbG90IGVsaWNpdGF0aW9uIHdoZW4gcmVxdWVzdGluZy5cbn1cbiJdfQ==