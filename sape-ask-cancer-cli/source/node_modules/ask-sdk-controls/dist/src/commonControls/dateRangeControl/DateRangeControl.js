"use strict";
/*
 * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.DateRangeControl = exports.DateControlTarget = exports.TargetCategory = exports.DateRangeControlState = exports.DateRangeControlValidations = exports.DateRangeValidationFailReasonCode = void 0;
const tslib_1 = require("tslib");
const i18next_1 = tslib_1.__importDefault(require("i18next"));
const lodash_1 = tslib_1.__importDefault(require("lodash"));
const __1 = require("../..");
const Strings_1 = require("../../constants/Strings");
const ContainerControl_1 = require("../../controls/ContainerControl");
const AmazonBuiltInSlotType_1 = require("../../intents/AmazonBuiltInSlotType");
const ConjunctionControlIntent_1 = require("../../intents/ConjunctionControlIntent");
const DateRangeControlIntent_1 = require("../../intents/DateRangeControlIntent");
const GeneralControlIntent_1 = require("../../intents/GeneralControlIntent");
const SingleValueControlIntent_1 = require("../../intents/SingleValueControlIntent");
const ModelTypes_1 = require("../../interactionModelGeneration/ModelTypes");
const Logger_1 = require("../../logging/Logger");
const ContentActs_1 = require("../../systemActs/ContentActs");
const InitiativeActs_1 = require("../../systemActs/InitiativeActs");
const Predicates_1 = require("../../utils/Predicates");
const DateControl_1 = require("../DateControl");
const DateHelper_1 = require("./DateHelper");
const DateRangeNLUHelper_1 = require("./DateRangeNLUHelper");
const log = new Logger_1.Logger('AskSdkControls:DateRangeControl');
/**
 * Reason codes for built-in validation rules.
 */
var DateRangeValidationFailReasonCode;
(function (DateRangeValidationFailReasonCode) {
    /**
     * The start date must precede the end date.
     */
    DateRangeValidationFailReasonCode["START_BEFORE_END"] = "startBeforeEnd";
})(DateRangeValidationFailReasonCode = exports.DateRangeValidationFailReasonCode || (exports.DateRangeValidationFailReasonCode = {}));
/**
 * Built-in validation functions for use with DateControl
 */
var DateRangeControlValidations;
(function (DateRangeControlValidations) {
    DateRangeControlValidations.START_BEFORE_END = (state, input) => {
        const startDate = DateHelper_1.alexaDateFormatToDate(state.startDate);
        const endDate = DateHelper_1.alexaDateFormatToDate(state.endDate);
        if (startDate > endDate) {
            return { reasonCode: DateRangeValidationFailReasonCode.START_BEFORE_END, renderedReason: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_VALIDATION_FAIL_START_AFTER_END') };
        }
        return true;
    };
})(DateRangeControlValidations = exports.DateRangeControlValidations || (exports.DateRangeControlValidations = {}));
/**
 * State tracked by a DateRangeControl.
 */
class DateRangeControlState extends ContainerControl_1.ContainerControlState {
    constructor() {
        // TODO: refactor: collate startDate/endDate into .value
        super(...arguments);
        /**
         * Tracks whether the dateRangeControl is requesting a change to the whole range.
         */
        this.isChangingRange = false;
        /**
         * Tracks whether the dateRangeControl is confirming the whole range.
         */
        this.isConfirmingRange = false;
        /**
         * Tracks whether the topic of conversation is the whole range.
         */
        this.onFocus = true;
        /**
         * Tracks whether the range has been explicitly confirmed by the user.
         */
        this.isValueConfirmed = false;
    }
}
exports.DateRangeControlState = DateRangeControlState;
/**
 * Categorization of "what seems to be the target" of a utterance.
 */
var TargetCategory;
(function (TargetCategory) {
    TargetCategory["StartDate"] = "startDate";
    TargetCategory["EndDate"] = "endDate";
    TargetCategory["Both"] = "both";
    TargetCategory["Neither"] = "neither";
    TargetCategory["Either"] = "either";
})(TargetCategory = exports.TargetCategory || (exports.TargetCategory = {}));
/**
 * Categorization of "what seems to be the target" of a utterance.
 */
var DateControlTarget;
(function (DateControlTarget) {
    DateControlTarget["StartDate"] = "startDate";
    DateControlTarget["EndDate"] = "endDate";
})(DateControlTarget = exports.DateControlTarget || (exports.DateControlTarget = {}));
/**
 * A Control that obtains a date range from the user.
 *
 * Capabilities:
 * - Request a range, or just the start/end date
 * - Change the range, or just the start/end date
 * - Validate the range or just the start/end date
 * - Confirm the range or just the start/end date
 * - Infer specific date(s) for a partially specified date(s).
 *
 * Intents that can be handled:
 * - `GeneralControlIntent`: E.g. `"yes, update my birth date"`
 * - `ConjunctionControlIntent`: E.g. `"yes, change the start and end dates"`
 * - `DateRangeControlIntent`: E.g. "no Tuesday to Saturday".
 * - `AMAZON_DATE_ValueControlIntent`: E.g. "no change it to Tuesday".
 * - `AMAZON.YesIntent`, `AMAZON.NoIntent`
 */
class DateRangeControl extends ContainerControl_1.ContainerControl {
    constructor(props) {
        super(props);
        this.state = new DateRangeControlState();
        this.props = DateRangeControl.mergeWithDefaultProps(props);
        this.startDateControl = new DateControl_1.DateControl({
            id: `${this.props.id}_startDate`,
            interactionModel: {
                targets: this.props.interactionModel.targets.startDate
            },
            prompts: this.props.prompts.startDate,
            validation: this.props.validation.startDateValid,
            required: this.props.required,
            confirmationRequired: this.props.confirmationRequired
        });
        this.endDateControl = new DateControl_1.DateControl({
            id: `${this.props.id}_endDate`,
            interactionModel: {
                targets: this.props.interactionModel.targets.endDate
            },
            prompts: this.props.prompts.endDate,
            validation: this.props.validation.endDateValid,
            required: this.props.required,
            confirmationRequired: this.props.confirmationRequired
        });
        this.addChild(this.startDateControl)
            .addChild(this.endDateControl);
    }
    static mergeWithDefaultProps(props) {
        const defaults = {
            id: 'uninitialized',
            validation: {
                startDateValid: [],
                endDateValid: [],
                rangeValid: []
            },
            required: true,
            confirmationRequired: false,
            interactionModel: {
                targets: {
                    startDate: [Strings_1.Strings.Target.StartDate, Strings_1.Strings.Target.Date, Strings_1.Strings.Target.It],
                    endDate: [Strings_1.Strings.Target.EndDate, Strings_1.Strings.Target.Date, Strings_1.Strings.Target.It],
                    self: [Strings_1.Strings.Target.Date, Strings_1.Strings.Target.DateRange, Strings_1.Strings.Target.It]
                },
                actions: {
                    set: [Strings_1.Strings.Action.Set],
                    change: [Strings_1.Strings.Action.Change]
                },
            },
            prompts: {
                startDate: {
                    confirmValue: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_CONFIRM_START_DATE', { value: act.payload.value }),
                    valueAffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_START_DATE_AFFIRMED'),
                    valueDisaffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_START_DATE_DISAFFIRMED'),
                    valueSet: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_START_DATE_SET', { value: act.payload.value }),
                    valueChanged: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_START_DATE_CHANGED', { value: act.payload.value }),
                    invalidValue: (act) => {
                        if (act.payload.renderedReason !== undefined) {
                            return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_INVALID_START_WITH_REASON', { reason: act.payload.renderedReason });
                        }
                        return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_GENERAL_INVALID_DATE');
                    },
                    requestValue: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_REQUEST_START_DATE'),
                    requestChangedValue: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_REQUEST_CHANGED_START_DATE'),
                },
                endDate: {
                    confirmValue: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_CONFIRM_END_DATE', { value: act.payload.value }),
                    valueAffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_END_DATE_AFFIRMED'),
                    valueDisaffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_END_DATE_DISAFFIRMED'),
                    valueSet: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_END_DATE_SET', { value: act.payload.value }),
                    valueChanged: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_END_DATE_CHANGED', { value: act.payload.value }),
                    invalidValue: (act) => {
                        if (act.payload.renderedReason !== undefined) {
                            return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_INVALID_END_WITH_REASON', { reason: act.payload.renderedReason });
                        }
                        return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_GENERAL_INVALID_DATE');
                    },
                    requestValue: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_REQUEST_END_DATE'),
                    requestChangedValue: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_REQUEST_CHANGED_END_DATE'),
                },
                requestValue: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_REQUEST_VALUE'),
                valueSet: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_VALUE_SET', { start: act.startDate, end: act.endDate }),
                valueChanged: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_VALUE_CHANGED', { start: act.startDate, end: act.endDate }),
                invalidValue: (act) => {
                    if (act.payload.renderedReason !== undefined) {
                        return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_INVALID_VALUE_WITH_REASON', { reason: act.payload.renderedReason });
                    }
                    return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_GENERAL_INVALID_VALUE');
                },
                valueAffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_VALUE_AFFIRMED'),
                valueDisaffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_VALUE_DISAFFIRMED'),
                confirmValue: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_CONFIRM_VALUE', { value: act.payload.value }),
            },
            reprompts: {
                startDate: {
                    confirmValue: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_CONFIRM_START_DATE', { value: act.payload.value }),
                    valueAffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_START_DATE_AFFIRMED'),
                    valueDisaffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_START_DATE_DISAFFIRMED'),
                    valueSet: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_START_DATE_SET', { value: act.payload.value }),
                    valueChanged: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_START_DATE_CHANGED', { value: act.payload.value }),
                    invalidValue: (act) => {
                        if (act.payload.reasonCode !== undefined) {
                            return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_INVALID_START_WITH_REASON', { reason: act.payload.reasonCode });
                        }
                        return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_GENERAL_INVALID_DATE');
                    },
                    requestValue: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_REQUEST_START_DATE'),
                    requestChangedValue: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_REQUEST_CHANGED_START_DATE'),
                },
                endDate: {
                    confirmValue: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_CONFIRM_END_DATE', { value: act.payload.value }),
                    valueAffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_END_DATE_AFFIRMED'),
                    valueDisaffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_END_DATE_DISAFFIRMED'),
                    valueSet: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_END_DATE_SET', { value: act.payload.value }),
                    valueChanged: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_END_DATE_CHANGED', { value: act.payload.value }),
                    invalidValue: (act) => {
                        if (act.payload.reasonCode !== undefined) {
                            return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_INVALID_END_WITH_REASON', { reason: act.payload.reasonCode });
                        }
                        return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_GENERAL_INVALID_DATE');
                    },
                    requestValue: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_REQUEST_END_DATE'),
                    requestChangedValue: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_REQUEST_CHANGED_END_DATE'),
                },
                requestValue: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_REQUEST_VALUE'),
                valueSet: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_VALUE_SET', { start: act.startDate, end: act.endDate }),
                valueChanged: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_VALUE_CHANGED', { start: act.startDate, end: act.endDate }),
                invalidValue: (act) => {
                    if (act.payload.reasonCode !== undefined) {
                        return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_INVALID_VALUE_WITH_REASON', { reason: act.payload.reasonCode });
                    }
                    return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_GENERAL_INVALID_VALUE');
                },
                valueAffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_VALUE_AFFIRMED'),
                valueDisaffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_VALUE_DISAFFIRMED'),
                confirmValue: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_CONFIRM_VALUE', { value: act.payload.value }),
            },
        };
        return lodash_1.default.mergeWith(defaults, props);
    }
    // tsDoc - see Control
    async canHandle(input) {
        return await this.canHandleForFocus(input) || this.canHandleForNoFocus(input);
    }
    // tsDoc - see Control
    async handle(input, resultBuilder) {
        log.debug(`DateRangeControl[${this.id}]: handle(). Entering`);
        // update the priorStartDate and priorEndDate before new operation
        this.updatePrior();
        // Calling handle function to make changes to state values
        if (this.handleFunc) {
            return this.handleFunc(input, resultBuilder);
        }
        // If can't handle by DateRangeControl itself, let children handle it and update state values
        await this.handleByChild(input, resultBuilder);
        const newStartDate = this.getStartDateFromChild();
        const newEndDate = this.getEndDateFromChild();
        this.setStartDate(newStartDate);
        this.setEndDate(newEndDate);
        this.state.onFocus = false;
        // After child handle the request and child has no question
        // ask DateRangeControl whether the value is ready
        if (!resultBuilder.hasInitiativeAct() && await this.canTakeInitiative(input)) {
            if (this.takeInitiativeFunc !== undefined) {
                this.takeInitiativeFunc(input, resultBuilder);
            }
        }
    }
    // tsDoc - see Control
    updateInteractionModel(generator, imData) {
        generator.addControlIntent(new GeneralControlIntent_1.GeneralControlIntent(), imData);
        generator.addControlIntent(new ConjunctionControlIntent_1.ConjunctionControlIntent(), imData);
        generator.addControlIntent(new DateRangeControlIntent_1.DateRangeControlIntent(), imData);
        generator.addControlIntent(new __1.SingleValueControlIntent(AmazonBuiltInSlotType_1.AmazonBuiltInSlotType.DATE), imData);
        generator.addYesAndNoIntents();
        if (this.props.interactionModel.targets.self.includes(Strings_1.Strings.Target.Date)) {
            generator.addValuesToSlotType(ModelTypes_1.SharedSlotType.TARGET, i18next_1.default.t('DATE_CONTROL_DEFAULT_SLOT_VALUES_TARGET_DATE', { returnObjects: true }));
        }
        if (this.props.interactionModel.targets.self.includes(Strings_1.Strings.Target.DateRange)) {
            generator.addValuesToSlotType(ModelTypes_1.SharedSlotType.TARGET, i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_SLOT_VALUES_TARGET_DATE_RANGE', { returnObjects: true }));
        }
        if (this.props.interactionModel.targets.startDate.includes(Strings_1.Strings.Target.StartDate)) {
            generator.addValuesToSlotType(ModelTypes_1.SharedSlotType.TARGET, i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_SLOT_VALUES_TARGET_START_DATE', { returnObjects: true }));
        }
        if (this.props.interactionModel.targets.endDate.includes(Strings_1.Strings.Target.EndDate)) {
            generator.addValuesToSlotType(ModelTypes_1.SharedSlotType.TARGET, i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_SLOT_VALUES_TARGET_END_DATE', { returnObjects: true }));
        }
    }
    // tsDoc - see InteractionModelContributor
    getTargetIds() {
        return this.props.interactionModel.targets.self;
    }
    getStartDateFromChild() {
        return this.startDateControl.state.value;
    }
    getEndDateFromChild() {
        return this.endDateControl.state.value;
    }
    setStartDate(date) {
        this.startDateControl.state.value = date;
        this.state.startDate = date;
        // Clean open question once a value set
        this.state.isChangingRange = false;
    }
    setEndDate(date) {
        this.endDateControl.state.value = date;
        this.state.endDate = date;
        // Clean open question once a value set
        this.state.isChangingRange = false;
    }
    async canHandleForFocus(input) {
        try {
            Predicates_1.okIf(this.state.onFocus === true);
            // When the focus is on parent itself
            // give the parent priority to handle the request
            return this.isTwoValueInput(input)
                || this.isDateInterpretedAsDateRange(input)
                || this.isChangeBoth(input)
                || this.isChangeRange(input)
                || this.isConfirmationAffirmed(input)
                || this.isConfirmationDisAffirmed(input)
                || this.canHandleByChild(input);
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    async canHandleForNoFocus(input) {
        try {
            Predicates_1.okIf(this.state.onFocus === false);
            // When the focus is on children
            // give children priority to handle the request
            return await this.canHandleByChild(input)
                || this.isTwoValueInput(input)
                || this.isDateInterpretedAsDateRange(input)
                || this.isChangeBoth(input)
                || this.isChangeRange(input)
                || this.isConfirmationAffirmed(input)
                || this.isConfirmationDisAffirmed(input);
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    /**
     * Test if the input has both start date and end date provided
     */
    isTwoValueInput(input) {
        try {
            Predicates_1.okIf(__1.InputUtil.isIntent(input, DateRangeControlIntent_1.DateRangeControlIntent.name));
            const intent = input.request.intent;
            const unpackedSlots = DateRangeControlIntent_1.unpackDateRangeControlIntent(intent);
            if (unpackedSlots.target !== undefined) {
                Predicates_1.okIf(__1.InputUtil.targetIsMatchOrUndefined(unpackedSlots.target, this.props.interactionModel.targets.self));
            }
            else {
                Predicates_1.okIf(__1.InputUtil.targetIsMatchOrUndefined(unpackedSlots["target.a"], this.props.interactionModel.targets.startDate) || __1.InputUtil.targetIsMatchOrUndefined(unpackedSlots["target.a"], this.props.interactionModel.targets.endDate));
                Predicates_1.okIf(__1.InputUtil.targetIsMatchOrUndefined(unpackedSlots["target.b"], this.props.interactionModel.targets.startDate) || __1.InputUtil.targetIsMatchOrUndefined(unpackedSlots["target.b"], this.props.interactionModel.targets.endDate));
            }
            const inputGroups = DateRangeNLUHelper_1.generateDatesInputGroups(this.props, unpackedSlots);
            for (const inputGroup of inputGroups) {
                Predicates_1.okIf(__1.InputUtil.valueStrDefined(inputGroup.value));
                Predicates_1.okIf(__1.InputUtil.actionIsSetOrUndefined(inputGroup.action, this.props.interactionModel.actions.set) || __1.InputUtil.actionIsMatch(inputGroup.action, this.props.interactionModel.actions.change));
                Predicates_1.okIf(inputGroup.target === TargetCategory.StartDate || inputGroup.target === TargetCategory.EndDate);
            }
            this.handleFunc = this.handleTwoValueInput;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleTwoValueInput(input, resultBuilder) {
        const intent = input.request.intent;
        const unpackedSlots = DateRangeControlIntent_1.unpackDateRangeControlIntent(intent);
        const inputGroups = DateRangeNLUHelper_1.generateDatesInputGroups(this.props, unpackedSlots);
        for (const inputGroup of inputGroups) {
            if (inputGroup.target === TargetCategory.StartDate) {
                this.setStartDate(DateHelper_1.findEdgeDateOfDateRange(inputGroup.value, true));
            }
            else if (inputGroup.target === TargetCategory.EndDate) {
                this.setEndDate(DateHelper_1.findEdgeDateOfDateRange(inputGroup.value, false));
            }
        }
        // reset the confirmation flag to false
        this.state.isValueConfirmed = false;
        this.state.onFocus = true;
        if (this.wantsToConfirmRange(input)) {
            this.confirmValue(input, resultBuilder);
            return;
        }
        this.ackDateRangeValueChanged(resultBuilder);
        if (this.wantsToCorrectRange(input)) {
            this.correctRange(input, resultBuilder);
        }
    }
    /**
     * Determine whether the input single date value should be considered as date range
     *
     * The DateRangeControl will regard a single value input as date range when there's no clear target and
     * when the DateRangeControl itself is under focus
     * E.G. 'set range to 2018', where 2018 will be regarded as a range and both start date and end date will be set to 2018
     */
    isDateInterpretedAsDateRange(input) {
        try {
            Predicates_1.okIf(__1.InputUtil.isSingleValueControlIntent(input, AmazonBuiltInSlotType_1.AmazonBuiltInSlotType.DATE));
            const intent = input.request.intent;
            const unpackedSlots = SingleValueControlIntent_1.unpackSingleValueControlIntent(intent);
            Predicates_1.okIf(__1.InputUtil.targetIsMatchOrUndefined(unpackedSlots.target, this.props.interactionModel.targets.self));
            Predicates_1.okIf(__1.InputUtil.actionIsMatchOrUndefined(unpackedSlots.action, this.props.interactionModel.actions.set) || __1.InputUtil.actionIsMatchOrUndefined(unpackedSlots.action, this.props.interactionModel.actions.change));
            this.handleFunc = this.handleDateRangeInput;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleDateRangeInput(input, resultBuilder) {
        const intent = input.request.intent;
        const { valueStr } = SingleValueControlIntent_1.unpackSingleValueControlIntent(intent);
        this.setStartDate(DateHelper_1.findEdgeDateOfDateRange(valueStr, true));
        this.setEndDate(DateHelper_1.findEdgeDateOfDateRange(valueStr, false));
        this.state.isValueConfirmed = false;
        this.state.onFocus = true;
        if (this.wantsToConfirmRange(input)) {
            this.confirmValue(input, resultBuilder);
            return;
        }
        this.ackDateRangeValueChanged(resultBuilder);
        if (this.wantsToCorrectRange(input)) {
            this.correctRange(input, resultBuilder);
        }
    }
    /**
     * Determine whether the input action is targeting both start date and end date
     *
     * E.G. 'Change start date and end date'
     */
    isChangeBoth(input) {
        try {
            Predicates_1.okIf(__1.InputUtil.isIntent(input, ConjunctionControlIntent_1.ConjunctionControlIntent.name));
            const intent = input.request.intent;
            const unpackedSlots = ConjunctionControlIntent_1.unpackConjunctionControlIntent(intent);
            Predicates_1.okIf(__1.InputUtil.feedbackIsMatchOrUndefined(unpackedSlots.feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            const inputs = ConjunctionControlIntent_1.generateActionTaskPairs(unpackedSlots);
            for (const input of inputs) {
                Predicates_1.okIf(__1.InputUtil.targetIsMatchOrUndefined(input.target, this.props.interactionModel.targets.startDate) || __1.InputUtil.targetIsMatchOrUndefined(input.target, this.props.interactionModel.targets.endDate));
                Predicates_1.okIf(__1.InputUtil.actionIsSetOrUndefined(input.action, this.props.interactionModel.actions.set) || __1.InputUtil.actionIsMatch(input.action, this.props.interactionModel.actions.change));
            }
            this.handleFunc = this.handleChangeValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    /**
     * Determine whether the input action is targeting date range
     *
     * E.G. 'Change', 'Change date'
     */
    isChangeRange(input) {
        try {
            Predicates_1.okIf(__1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const intent = input.request.intent;
            const unpackedSlots = GeneralControlIntent_1.unpackGeneralControlIntent(intent);
            Predicates_1.okIf(__1.InputUtil.feedbackIsMatchOrUndefined(unpackedSlots.feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(__1.InputUtil.targetIsMatchOrUndefined(unpackedSlots.target, this.props.interactionModel.targets.self));
            this.handleFunc = this.handleChangeValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    isConfirmationAffirmed(input) {
        try {
            Predicates_1.okIf(__1.InputUtil.isBareYes(input));
            Predicates_1.okIf(this.state.isConfirmingRange);
            this.handleFunc = this.handleConfirmationAffirmed;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleConfirmationAffirmed(input, resultBuilder) {
        this.state.isValueConfirmed = true;
        this.state.isConfirmingRange = false;
        // If the date range is confirmed in parent
        // update children's status to avoid duplicate confirmation
        this.startDateControl.state.isValueConfirmed = true;
        this.endDateControl.state.isValueConfirmed = true;
        const actPayload = i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_STATE_VALUE_FOR_START_AND_END', { start: this.state.startDate, end: this.state.endDate });
        if (this.wantsToCorrectRange(input)) {
            this.correctRange(input, resultBuilder);
            return;
        }
        resultBuilder.addAct(new ContentActs_1.ValueConfirmedAct(this, { value: actPayload }));
        this.ackDateRangeValueChanged(resultBuilder);
    }
    isConfirmationDisAffirmed(input) {
        try {
            Predicates_1.okIf(__1.InputUtil.isBareNo(input));
            Predicates_1.okIf(this.state.isConfirmingRange === true);
            this.handleFunc = this.handleConfirmationDisAffirmed;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleConfirmationDisAffirmed(input, resultBuilder) {
        this.state.isValueConfirmed = false;
        this.state.isConfirmingRange = false;
        const actPayload = i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_STATE_VALUE_FOR_START_AND_END', { start: this.state.startDate, end: this.state.endDate });
        resultBuilder.addAct(new ContentActs_1.ValueDisconfirmedAct(this, { value: actPayload }));
        resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
    }
    handleChangeValue(input, resultBuilder) {
        this.state.isChangingRange = true;
        this.state.onFocus = true;
        resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
    }
    // Update priorEndDate & priorStartDate
    updatePrior() {
        // Only update prior if it's not in confirming range status
        if (!this.state.isConfirmingRange) {
            this.state.previousEndDate = this.state.endDate;
            this.state.previousStartDate = this.state.startDate;
        }
    }
    ackDateRangeValueChanged(resultBuilder) {
        // The DateRangeControl only ack date range changes
        // Only start date change or end date change will be handled by Child controls
        if (this.state.startDate !== undefined && this.state.endDate !== undefined && (this.state.startDate !== this.state.previousStartDate && this.state.endDate !== this.state.previousEndDate)) {
            // If it's the first time to set the value, DateRangeControl will send DateRangeSetAct
            // And when there's an old value exist, DateRangeControl will send DateRangeChangedAct
            this.state.previousStartDate !== undefined && this.state.previousEndDate !== undefined ?
                resultBuilder.addAct(new ContentActs_1.DateRangeChangedAct(this, this.state.startDate, this.state.endDate, this.state.previousStartDate, this.state.previousEndDate)) :
                resultBuilder.addAct(new ContentActs_1.DateRangeSetAct(this, this.state.startDate, this.state.endDate));
        }
    }
    validateDateRange(input) {
        const listOfValidationFunc = typeof (this.props.validation.rangeValid) === 'function' ? [this.props.validation.rangeValid] : this.props.validation.rangeValid;
        for (const validationFunction of listOfValidationFunc) {
            const validationResult = validationFunction(this.state, input);
            if (validationResult !== true) {
                log.debug(`DateRangeControl.validate(): validation failed. Reason: ${JSON.stringify(validationResult, null, 2)}.`);
                return validationResult;
            }
        }
        return true;
    }
    // tsDoc - see Control
    renderAct(act, input, builder) {
        if (act instanceof InitiativeActs_1.RequestValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.requestValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.requestValue, input));
        }
        else if (act instanceof ContentActs_1.DateRangeSetAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueSet, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueSet, input));
        }
        else if (act instanceof ContentActs_1.DateRangeChangedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueChanged, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueChanged, input));
        }
        else if (act instanceof ContentActs_1.InvalidValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.invalidValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.invalidValue, input));
        }
        else if (act instanceof InitiativeActs_1.ConfirmValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.confirmValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.confirmValue, input));
        }
        else if (act instanceof ContentActs_1.ValueConfirmedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueAffirmed, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueAffirmed, input));
        }
        else if (act instanceof ContentActs_1.ValueDisconfirmedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueDisaffirmed, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueDisaffirmed, input));
        }
        else {
            this.throwUnhandledActError(act);
        }
    }
    // tsDoc - see Control
    async canTakeInitiative(input) {
        return this.needsValue(input)
            || await this.canTakeInitiativeByChild(input)
            || this.isChangingRange()
            || this.wantsToCorrectRange(input)
            || this.wantsToConfirmRange(input);
    }
    // tsDoc - see Control
    async takeInitiative(input, resultBuilder) {
        log.debug(`DateRangeControl[${this.id}]: takeInitiative(). Entering`);
        if (this.takeInitiativeFunc !== undefined) {
            this.takeInitiativeFunc(input, resultBuilder);
        }
    }
    needsValue(input) {
        try {
            Predicates_1.okIf(this.evaluateBooleanProp(this.props.required, input));
            Predicates_1.okIf(this.state.startDate === undefined && this.state.endDate === undefined);
            this.takeInitiativeFunc = this.requestDateRange;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    requestDateRange(input, resultBuilder) {
        this.state.onFocus = true;
        resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
    }
    isChangingRange() {
        try {
            Predicates_1.okIf(this.state.isChangingRange === true);
            this.takeInitiativeFunc = this.requestDateRange;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    wantsToCorrectRange(input) {
        try {
            // Only fix range when range is set and there's no open question
            Predicates_1.okIf(!this.needsValue(input) && !this.state.isChangingRange);
            const rangeValidationResult = this.validateDateRange(input);
            Predicates_1.okIf(rangeValidationResult !== true);
            this.takeInitiativeFunc = this.correctRange;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    correctRange(input, resultBuilder) {
        const rangeValidationResult = this.validateDateRange(input);
        this.state.onFocus = true;
        if (rangeValidationResult !== true) {
            const actPayload = i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_STATE_VALUE_FOR_START_AND_END', { start: this.state.startDate, end: this.state.endDate });
            resultBuilder.addAct(new ContentActs_1.InvalidValueAct(this, { value: actPayload, reasonCode: rangeValidationResult.reasonCode, renderedReason: rangeValidationResult.renderedReason }));
            // if the range-validation failure is due to one date changing, only request that one
            if (this.state.startDate !== this.state.previousStartDate && this.state.endDate !== this.state.previousEndDate) {
                resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
            }
            else if (this.state.startDate !== this.state.previousStartDate) {
                resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this.startDateControl));
            }
            else {
                resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this.endDateControl));
            }
            return;
        }
    }
    wantsToConfirmRange(input) {
        try {
            Predicates_1.okIf(this.props.confirmationRequired === true);
            Predicates_1.okIf(this.state.isValueConfirmed === false);
            this.takeInitiativeFunc = this.confirmValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    confirmValue(input, resultBuilder) {
        this.state.isConfirmingRange = true;
        const actPayload = i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_STATE_VALUE_FOR_START_AND_END', { start: this.state.startDate, end: this.state.endDate });
        resultBuilder.addAct(new InitiativeActs_1.ConfirmValueAct(this, { value: actPayload }));
    }
    // tsDoc - see ContainerControl
    async canTakeInitiativeByChild(input) {
        try {
            Predicates_1.okIf(await super.canTakeInitiativeByChild(input));
            this.state.onFocus = false;
            this.takeInitiativeFunc = this.takeInitiativeByChild;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
}
exports.DateRangeControl = DateRangeControl;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGF0ZVJhbmdlQ29udHJvbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21tb25Db250cm9scy9kYXRlUmFuZ2VDb250cm9sL0RhdGVSYW5nZUNvbnRyb2wudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7OztHQVdHOzs7O0FBSUgsOERBQThCO0FBQzlCLDREQUF1QjtBQUN2Qiw2QkFBMEU7QUFDMUUscURBQXVEO0FBQ3ZELHNFQUFpSDtBQUtqSCwrRUFBNEU7QUFDNUUscUZBQTBKO0FBQzFKLGlGQUE0RztBQUM1Ryw2RUFBc0c7QUFDdEcscUZBQXdGO0FBRXhGLDRFQUF3RjtBQUN4RixpREFBOEM7QUFFOUMsOERBQThJO0FBQzlJLG9FQUFtRjtBQUduRix1REFBa0U7QUFDbEUsZ0RBQTZGO0FBQzdGLDZDQUE4RTtBQUM5RSw2REFBNkY7QUFFN0YsTUFBTSxHQUFHLEdBQUcsSUFBSSxlQUFNLENBQUMsaUNBQWlDLENBQUMsQ0FBQztBQXVSMUQ7O0dBRUc7QUFDSCxJQUFZLGlDQUtYO0FBTEQsV0FBWSxpQ0FBaUM7SUFDekM7O09BRUc7SUFDSCx3RUFBbUMsQ0FBQTtBQUN2QyxDQUFDLEVBTFcsaUNBQWlDLEdBQWpDLHlDQUFpQyxLQUFqQyx5Q0FBaUMsUUFLNUM7QUFFRDs7R0FFRztBQUNILElBQWlCLDJCQUEyQixDQVMzQztBQVRELFdBQWlCLDJCQUEyQjtJQUMzQiw0Q0FBZ0IsR0FBZ0MsQ0FBQyxLQUE0QixFQUFFLEtBQW1CLEVBQTJCLEVBQUU7UUFDeEksTUFBTSxTQUFTLEdBQUcsa0NBQXFCLENBQUMsS0FBSyxDQUFDLFNBQVUsQ0FBQyxDQUFDO1FBQzFELE1BQU0sT0FBTyxHQUFHLGtDQUFxQixDQUFDLEtBQUssQ0FBQyxPQUFRLENBQUMsQ0FBQztRQUN0RCxJQUFJLFNBQVMsR0FBRyxPQUFPLEVBQUU7WUFDckIsT0FBTyxFQUFFLFVBQVUsRUFBRSxpQ0FBaUMsQ0FBQyxnQkFBZ0Is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QkMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMjAgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuXG4gKiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBvciBpbiB0aGUgXCJsaWNlbnNlXCIgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWRcbiAqIG9uIGFuIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlclxuICogZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmdcbiAqIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5cbmltcG9ydCB7IEludGVudFJlcXVlc3QgfSBmcm9tIFwiYXNrLXNkay1tb2RlbFwiO1xuaW1wb3J0IGkxOG5leHQgZnJvbSAnaTE4bmV4dCc7XG5pbXBvcnQgXyBmcm9tIFwibG9kYXNoXCI7XG5pbXBvcnQgeyBJbnB1dFV0aWwsIFNpbmdsZVZhbHVlQ29udHJvbEludGVudCwgU3RyaW5nT3JMaXN0IH0gZnJvbSAnLi4vLi4nO1xuaW1wb3J0IHsgU3RyaW5ncyBhcyAkIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzL1N0cmluZ3MnO1xuaW1wb3J0IHsgQ29udGFpbmVyQ29udHJvbCwgQ29udGFpbmVyQ29udHJvbFByb3BzLCBDb250YWluZXJDb250cm9sU3RhdGUgfSBmcm9tICcuLi8uLi9jb250cm9scy9Db250YWluZXJDb250cm9sJztcbmltcG9ydCB7IENvbnRyb2xJbnB1dCB9IGZyb20gJy4uLy4uL2NvbnRyb2xzL0NvbnRyb2xJbnB1dCc7XG5pbXBvcnQgeyBDb250cm9sUmVzdWx0QnVpbGRlciB9IGZyb20gJy4uLy4uL2NvbnRyb2xzL0NvbnRyb2xSZXN1bHQnO1xuaW1wb3J0IHsgSW50ZXJhY3Rpb25Nb2RlbENvbnRyaWJ1dG9yIH0gZnJvbSAnLi4vLi4vY29udHJvbHMvbWl4aW5zL0ludGVyYWN0aW9uTW9kZWxDb250cmlidXRvcic7XG5pbXBvcnQgeyBWYWxpZGF0aW9uUmVzdWx0IH0gZnJvbSAnLi4vLi4vY29udHJvbHMvVmFsaWRhdGlvblJlc3VsdCc7XG5pbXBvcnQgeyBBbWF6b25CdWlsdEluU2xvdFR5cGUgfSBmcm9tICcuLi8uLi9pbnRlbnRzL0FtYXpvbkJ1aWx0SW5TbG90VHlwZSc7XG5pbXBvcnQgeyBBY3Rpb25BbmRUYXNrLCBDb25qdW5jdGlvbkNvbnRyb2xJbnRlbnQsIGdlbmVyYXRlQWN0aW9uVGFza1BhaXJzLCB1bnBhY2tDb25qdW5jdGlvbkNvbnRyb2xJbnRlbnQgfSBmcm9tICcuLi8uLi9pbnRlbnRzL0Nvbmp1bmN0aW9uQ29udHJvbEludGVudCc7XG5pbXBvcnQgeyBEYXRlUmFuZ2VDb250cm9sSW50ZW50LCB1bnBhY2tEYXRlUmFuZ2VDb250cm9sSW50ZW50IH0gZnJvbSAnLi4vLi4vaW50ZW50cy9EYXRlUmFuZ2VDb250cm9sSW50ZW50JztcbmltcG9ydCB7IEdlbmVyYWxDb250cm9sSW50ZW50LCB1bnBhY2tHZW5lcmFsQ29udHJvbEludGVudCB9IGZyb20gJy4uLy4uL2ludGVudHMvR2VuZXJhbENvbnRyb2xJbnRlbnQnO1xuaW1wb3J0IHsgdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50IH0gZnJvbSAnLi4vLi4vaW50ZW50cy9TaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQnO1xuaW1wb3J0IHsgQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3IgfSBmcm9tICcuLi8uLi9pbnRlcmFjdGlvbk1vZGVsR2VuZXJhdGlvbi9Db250cm9sSW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvcic7XG5pbXBvcnQgeyBNb2RlbERhdGEsIFNoYXJlZFNsb3RUeXBlIH0gZnJvbSAnLi4vLi4vaW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRpb24vTW9kZWxUeXBlcyc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi8uLi9sb2dnaW5nL0xvZ2dlcic7XG5pbXBvcnQgeyBDb250cm9sUmVzcG9uc2VCdWlsZGVyIH0gZnJvbSAnLi4vLi4vcmVzcG9uc2VHZW5lcmF0aW9uL0NvbnRyb2xSZXNwb25zZUJ1aWxkZXInO1xuaW1wb3J0IHsgRGF0ZVJhbmdlQ2hhbmdlZEFjdCwgRGF0ZVJhbmdlU2V0QWN0LCBJbnZhbGlkVmFsdWVBY3QsIFZhbHVlQ29uZmlybWVkQWN0LCBWYWx1ZURpc2NvbmZpcm1lZEFjdCB9IGZyb20gXCIuLi8uLi9zeXN0ZW1BY3RzL0NvbnRlbnRBY3RzXCI7XG5pbXBvcnQgeyBDb25maXJtVmFsdWVBY3QsIFJlcXVlc3RWYWx1ZUFjdCB9IGZyb20gJy4uLy4uL3N5c3RlbUFjdHMvSW5pdGlhdGl2ZUFjdHMnO1xuaW1wb3J0IHsgU3lzdGVtQWN0IH0gZnJvbSAnLi4vLi4vc3lzdGVtQWN0cy9TeXN0ZW1BY3QnO1xuaW1wb3J0IHsgRGVlcFJlcXVpcmVkIH0gZnJvbSAnLi4vLi4vdXRpbHMvRGVlcFJlcXVpcmVkJztcbmltcG9ydCB7IGZhbHNlSWZHdWFyZEZhaWxlZCwgb2tJZiB9IGZyb20gJy4uLy4uL3V0aWxzL1ByZWRpY2F0ZXMnO1xuaW1wb3J0IHsgRGF0ZUNvbnRyb2wsIERhdGVDb250cm9sUHJvbXB0UHJvcHMsIERhdGVWYWxpZGF0aW9uRnVuY3Rpb24gfSBmcm9tICcuLi9EYXRlQ29udHJvbCc7XG5pbXBvcnQgeyBhbGV4YURhdGVGb3JtYXRUb0RhdGUsIGZpbmRFZGdlRGF0ZU9mRGF0ZVJhbmdlIH0gZnJvbSAnLi9EYXRlSGVscGVyJztcbmltcG9ydCB7IERhdGVSYW5nZUNvbnRyb2xJbnRlbnRJbnB1dCwgZ2VuZXJhdGVEYXRlc0lucHV0R3JvdXBzIH0gZnJvbSAnLi9EYXRlUmFuZ2VOTFVIZWxwZXInO1xuXG5jb25zdCBsb2cgPSBuZXcgTG9nZ2VyKCdBc2tTZGtDb250cm9sczpEYXRlUmFuZ2VDb250cm9sJyk7XG5cbi8qKlxuICogUHJvcHMgZm9yIGEgVmFsdWVDb250cm9sLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIERhdGVSYW5nZUNvbnRyb2xQcm9wcyBleHRlbmRzIENvbnRhaW5lckNvbnRyb2xQcm9wcyB7XG5cbiAgICAvKipcbiAgICAgKiBVbmlxdWUgaWRlbnRpZmllciBmb3IgY29udHJvbCBpbnN0YW5jZVxuICAgICAqL1xuICAgIGlkOiBzdHJpbmc7XG5cblxuICAgIC8qKlxuICAgICAqIFByb3BzIGZvciBkZXRlcm1pbmluZyBpZiB0aGUgZGF0ZShzKSBhcmUgdmFsaWQuXG4gICAgICovXG4gICAgdmFsaWRhdGlvbj86IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZ1bmN0aW9uKHMpIHRvIGRldGVybWluZSBpZiB0aGUgc3RhdGUgZGF0ZSAoaW4gaXNvbGF0aW9uKSBpcyB2YWxpZC5cbiAgICAgICAgICpcbiAgICAgICAgICogRGVmYXVsdDogYHRydWVgLCBpLmUuIGFueSB2YWx1ZSBpcyB2YWxpZC5cbiAgICAgICAgICpcbiAgICAgICAgICogVXNhZ2U6XG4gICAgICAgICAqIC0gVmFsaWRhdGlvbiBmdW5jdGlvbnMgcmV0dXJuIGVpdGhlciBgdHJ1ZWAgb3IgYSBgVmFsaWRhdGlvblJlc3VsdGBcbiAgICAgICAgICogICB0byBkZXNjcmliZSB3aGF0IHZhbGlkYXRpb24gZmFpbGVkLlxuICAgICAgICAgKiAtIENvbW1vbiB2YWxpZGF0aW9uIGZ1bmN0aW9ucyBmb3IgdGhlIHN0YXJ0LWRhdGUgKGluIGlzb2xhdGlvbikgYXJlXG4gICAgICAgICAqICAgZGVmaW5lZCBpbiB0aGUgYERhdGVDb250cm9sVmFsaWRhdGlvbnNgIG5hbWVzcGFjZSB3aGljaCBjYW4gYmVcbiAgICAgICAgICogICBhZGRlZCBkaXJlY3RseSB0byB0aGlzIHByb3AuIGUuZy46XG4gICAgICAgICAqIGBgYFxuICAgICAgICAgKiB2YWxpZDogRGF0ZUNvbnRyb2xWYWxpZGF0aW9ucy5GVVRVUkVfREFURV9PTkxZLFxuICAgICAgICAgKiBgYGBcbiAgICAgICAgICovXG4gICAgICAgIHN0YXJ0RGF0ZVZhbGlkPzogRGF0ZVZhbGlkYXRpb25GdW5jdGlvbiB8IERhdGVWYWxpZGF0aW9uRnVuY3Rpb25bXSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogRnVuY3Rpb24ocykgdGhhdCBkZXRlcm1pbmUgaWYgdGhlIGVuZCBkYXRlIChpbiBpc29sYXRpb24pIGlzIHZhbGlkLlxuICAgICAgICAgKlxuICAgICAgICAgKiBEZWZhdWx0OiBgdHJ1ZWAsIGkuZS4gYW55IHZhbHVlIGlzIHZhbGlkLlxuICAgICAgICAgKlxuICAgICAgICAgKiBVc2FnZTpcbiAgICAgICAgICogLSBWYWxpZGF0aW9uIGZ1bmN0aW9ucyByZXR1cm4gZWl0aGVyIGB0cnVlYCBvciBhIGBWYWxpZGF0aW9uUmVzdWx0YFxuICAgICAgICAgKiAgIHRvIGRlc2NyaWJlIHdoYXQgdmFsaWRhdGlvbiBmYWlsZWQuXG4gICAgICAgICAqIC0gQ29tbW9uIHZhbGlkYXRpb24gZnVuY3Rpb25zIGZvciB0aGUgZW5kLWRhdGUgKGluIGlzb2xhdGlvbikgYXJlXG4gICAgICAgICAqICAgZGVmaW5lZCBpbiB0aGUgYERhdGVDb250cm9sVmFsaWRhdGlvbnNgIG5hbWVzcGFjZSB3aGljaCBjYW4gYmVcbiAgICAgICAgICogICBhZGRlZCBkaXJlY3RseSB0byB0aGlzIHByb3AuIGUuZy46XG4gICAgICAgICAqIGBgYFxuICAgICAgICAgKiB2YWxpZDogRGF0ZUNvbnRyb2xWYWxpZGF0aW9ucy5GVVRVUkVfREFURV9PTkxZLFxuICAgICAgICAgKiBgYGBcbiAgICAgICAgICovXG4gICAgICAgIGVuZERhdGVWYWxpZD86IERhdGVWYWxpZGF0aW9uRnVuY3Rpb24gfCBEYXRlVmFsaWRhdGlvbkZ1bmN0aW9uW10sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZ1bmN0aW9uKHMpIHRoYXQgZGV0ZXJtaW5lIGlmIHRoZSBkYXRlLXJhbmdlIGlzIHZhbGlkLlxuICAgICAgICAgKlxuICAgICAgICAgKiBEZWZhdWx0OiBgdHJ1ZWAsIGkuZS4gYW55IHZhbHVlIGlzIHZhbGlkLlxuICAgICAgICAgKlxuICAgICAgICAgKiBVc2FnZTpcbiAgICAgICAgICogLSBWYWxpZGF0aW9uIGZ1bmN0aW9ucyByZXR1cm4gZWl0aGVyIGB0cnVlYCBvciBhIGBWYWxpZGF0aW9uUmVzdWx0YFxuICAgICAgICAgKiAgIHRvIGRlc2NyaWJlIHdoYXQgdmFsaWRhdGlvbiBmYWlsZWQuXG4gICAgICAgICAqIC0gQ29tbW9uIHZhbGlkYXRpb24gZnVuY3Rpb25zIGZvciB0aGUgXCJkYXRlIHJhbmdlXCIgYXJlIGRlZmluZWQgaW4gdGhlXG4gICAgICAgICAqICAgYERhdGVSYW5nZUNvbnRyb2xWYWxpZGF0aW9uc2AgbmFtZXNwYWNlIHdoaWNoIGNhbiBiZSBhZGRlZCBkaXJlY3RseVxuICAgICAgICAgKiAgIHRvIHRoaXMgcHJvcC4gZS5nLjpcbiAgICAgICAgICogYGBgXG4gICAgICAgICAqIHZhbGlkOiBEYXRlUmFuZ2VDb250cm9sVmFsaWRhdGlvbnMuU1RBUlRfQkVGT1JFX0VORCxcbiAgICAgICAgICogYGBgXG4gICAgICAgICAqL1xuICAgICAgICByYW5nZVZhbGlkPzogRGF0ZVJhbmdlVmFsaWRhdGlvbkZ1bmN0aW9uIHwgRGF0ZVJhbmdlVmFsaWRhdGlvbkZ1bmN0aW9uW11cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyBpZiB0aGUgQ29udHJvbCBtdXN0IG9idGFpbiBhIHZhbHVlLlxuICAgICAqXG4gICAgICogSWYgYHRydWVgOlxuICAgICAqICAtIHRoZSBDb250cm9sIHJlcG9ydCBpc1JlYWR5KCkgPSBmYWxzZSBpZiBubyB2YWx1ZSBoYXMgYmVlbiBvYnRhaW5lZC5cbiAgICAgKiAgLSB0aGUgY29udHJvbCB3aWxsIHRha2UgdGhlIGluaXRpYXRpdmUgd2hlbiBnaXZlbiB0aGUgb3Bwb3J0dW5pdHkuXG4gICAgICovXG4gICAgcmVxdWlyZWQ/OiBib29sZWFuIHwgKChpbnB1dDogQ29udHJvbElucHV0KSA9PiBib29sZWFuKTtcblxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdGhlIENvbnRyb2wgaGFzIHRvIG9idGFpbiBleHBsaWNpdCBjb25maXJtYXRpb24gb2YgdGhlIHZhbHVlLlxuICAgICAqXG4gICAgICogSWYgYHRydWVgOlxuICAgICAqICAtIHRoZSBDb250cm9sIHdpbGwgcmVwb3J0IGBpc1JlYWR5KCkgPSBmYWxzZWAgaWYgdGhlIHZhbHVlIGhhcyBub3QgYmVlblxuICAgICAqICAgIGV4cGxpY2l0bHkgY29uZmlybWVkIGFzIGNvcnJlY3QgYnkgdXNlci5cbiAgICAgKiAgLSB0aGUgQ29udHJvbCB3aWxsIHRha2UgdGhlIGluaXRpYXRpdmUgd2hlbiBnaXZlbiB0aGUgb3Bwb3J0dW5pdHkuXG4gICAgICovXG4gICAgY29uZmlybWF0aW9uUmVxdWlyZWQ/OiBib29sZWFuIHwgKChpbnB1dDogQ29udHJvbElucHV0KSA9PiBib29sZWFuKTtcblxuICAgIC8qKlxuICAgICAqIFByb3BzIHRvIGN1c3RvbWl6ZSB0aGUgcHJvbXB0IGZyYWdtZW50cyB0aGF0IHdpbGwgYmUgYWRkZWQgYnlcbiAgICAgKiBgdGhpcy5yZW5kZXJBY3QoKWAuXG4gICAgICovXG4gICAgcHJvbXB0cz86IERhdGVSYW5nZUNvbnRyb2xQcm9tcHRQcm9wcztcblxuICAgIC8qKlxuICAgICAqIFByb3BzIHRvIGN1c3RvbWl6ZSB0aGUgcmVwcm9tcHQgZnJhZ21lbnRzIHRoYXQgd2lsbCBiZSBhZGRlZCBieVxuICAgICAqIGB0aGlzLnJlbmRlckFjdCgpYC5cbiAgICAgKi9cbiAgICByZXByb21wdHM/OiBEYXRlUmFuZ2VDb250cm9sUHJvbXB0UHJvcHM7XG5cblxuICAgIC8qKlxuICAgICAqIFByb3BzIHRvIGN1c3RvbWl6ZSB0aGUgcmVsYXRpb25zaGlwIGJldHdlZW4gdGhlIGNvbnRyb2wgYW5kIHRoZVxuICAgICAqIGludGVyYWN0aW9uIG1vZGVsLlxuICAgICAqL1xuICAgIGludGVyYWN0aW9uTW9kZWw/OiBEYXRlUmFuZ2VDb250cm9sSW50ZXJhY3Rpb25Nb2RlbFByb3BzO1xufVxuXG5cbi8qKlxuICogRGF0ZSByYW5nZSB2YWxpZGF0aW9uIGZ1bmN0aW9uXG4gKi9cbmV4cG9ydCB0eXBlIERhdGVSYW5nZVZhbGlkYXRpb25GdW5jdGlvbiA9ICgoc3RhdGU6IERhdGVSYW5nZUNvbnRyb2xTdGF0ZSwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gdHJ1ZSB8IFZhbGlkYXRpb25SZXN1bHQpO1xuXG4vKipcbiAqIE1hcHBpbmcgb2YgYWN0aW9uIHNsb3QgdmFsdWVzIHRvIHRoZSBiZWhhdmlvcnMgdGhhdCB0aGlzIGNvbnRyb2wgc3VwcG9ydHMuXG4gKlxuICogQmVoYXZpb3I6XG4gKiAtIFRoaXMgY29udHJvbCB3aWxsIG5vdCBoYW5kbGUgYW4gaW5wdXQgaWYgdGhlIGFjdGlvbi1zbG90IGlzIGZpbGxlZCB3aXRoIGFuXG4gKiAgIHZhbHVlIHdob3NlIElEIGlzIG5vdCBhc3NvY2lhdGVkIHdpdGggYSBjYXBhYmlsaXR5LlxuICovXG5leHBvcnQgaW50ZXJmYWNlIERhdGVSYW5nZUNvbnRyb2xBY3Rpb25Qcm9wcyB7XG4gICAgLyoqXG4gICAgICogQWN0aW9uIHNsb3QgdmFsdWUgSURzIHRoYXQgYXJlIGFzc29jaWF0ZWQgd2l0aCB0aGUgXCJzZXQgdmFsdWVcIiBjYXBhYmlsaXR5LlxuICAgICAqXG4gICAgICogRGVmYXVsdDogWydidWlsdGluX3NldCddXG4gICAgICovXG4gICAgc2V0Pzogc3RyaW5nW10sXG5cbiAgICAvKipcbiAgICAgKiBBY3Rpb24gc2xvdCB2YWx1ZSBJRHMgdGhhdCBhcmUgYXNzb2NpYXRlZCB3aXRoIHRoZSBcImNoYW5nZSB2YWx1ZVwiIGNhcGFiaWxpdHkuXG4gICAgICpcbiAgICAgKiBEZWZhdWx0IFsnYnVpbHRpbl9jaGFuZ2UnXVxuICAgICAqL1xuICAgIGNoYW5nZT86IHN0cmluZ1tdXG59XG5cblxuLyoqXG4gKiBQcm9wcyBhc3NvY2lhdGVkIHdpdGggdGhlIGludGVyYWN0aW9uIG1vZGVsLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIERhdGVSYW5nZUNvbnRyb2xJbnRlcmFjdGlvbk1vZGVsUHJvcHMge1xuICAgIC8qKlxuICAgICAqIFRhcmdldC1zbG90IHZhbHVlcyBhc3NvY2lhdGVkIHdpdGggdGhpcyBDb250cm9sLlxuICAgICAqXG4gICAgICogU3BlY2lmaWMgdGFyZ2V0cyBjYW4gYmUgc3BlY2lmaWVkIGZvciB0aGUgc3RhcnQtZGF0ZSwgdGhlIGVuZC1kYXRlIGFuZFxuICAgICAqIHRoZSByYW5nZSBhcyBhIHdob2xlLlxuICAgICAqL1xuICAgIHRhcmdldHM/OiBEYXRlUmFuZ2VDb250cm9sVGFyZ2V0UHJvcHM7XG5cbiAgICAvKipcbiAgICAgKiBBY3Rpb24gc2xvdC12YWx1ZXMgYXNzb2NpYXRlZCB0byB0aGUgY29udHJvbCdzIGNhcGFiaWxpdGllcy5cbiAgICAgKlxuICAgICAqIEFjdGlvbiBzbG90LXZhbHVlcyBhc3NvY2lhdGUgdXR0ZXJhbmNlcyB0byBhIGNvbnRyb2wuIEZvciBleGFtcGxlLCBpZiB0aGVcbiAgICAgKiB1c2VyIHNheXMgXCJjaGFuZ2UgdGhlIHRpbWVcIiwgaXQgaXMgcGFyc2VkIGFzIGEgYEdlbmVyYWxDb250cm9sSW50ZW50YFxuICAgICAqIHdpdGggc2xvdCB2YWx1ZXMgYGFjdGlvbiA9IGNoYW5nZWAgYW5kIGB0YXJnZXQgPSB0aW1lYC4gIE9ubHkgY29udHJvbHNcbiAgICAgKiB0aGF0IGFyZSByZWdpc3RlcmVkIHdpdGggdGhlIGBjaGFuZ2VgIGFjdGlvbiBzaG91bGQgb2ZmZXIgdG8gaGFuZGxlIHRoaXNcbiAgICAgKiBpbnRlbnQuXG4gICAgICpcbiAgICAgKiBVc2FnZTpcbiAgICAgKiAgLSBUaGlzIGFsbG93cyB1c2VycyB0byByZWZlciB0byBhbiBhY3Rpb24gdXNpbmcgbW9yZSBkb21haW4tYXBwcm9wcmlhdGVcbiAgICAgKiAgICB3b3Jkcy4gRm9yIGV4YW1wbGUsIGEgdXNlciBtaWdodCBsaWtlIHRvIHNheSAnc2hvdyB0d28gaXRlbXMnIHJhdGhlclxuICAgICAqICAgIHRoYXQgJ3NldCBpdGVtIGNvdW50IHRvIHR3bycuICBUbyBhY2hpZXZlIHRoaXMsIGluY2x1ZGUgdGhlXG4gICAgICogICAgc2xvdC12YWx1ZS1pZCAnc2hvdycgaW4gdGhlIGxpc3QgYXNzb2NpYXRlZCB3aXRoIHRoZSAnc2V0JyBjYXBhYmlsaXR5XG4gICAgICogICAgYW5kIGVuc3VyZSB0aGUgaW50ZXJhY3Rpb24tbW9kZWwgaW5jbHVkZXMgYW4gYWN0aW9uIHNsb3QgdmFsdWUgd2l0aFxuICAgICAqICAgIGlkPXNob3cgYW5kIGFwcHJvcHJpYXRlIHN5bm9ueW1zLlxuICAgICAqICAtIFRoZSAnYnVpbHRpbl8qJyBJRHMgYXJlIGFzc29jaWF0ZWQgd2l0aCBkZWZhdWx0IGludGVyYWN0aW9uIG1vZGVsIGRhdGFcbiAgICAgKiAgICAod2hpY2ggY2FuIGJlIGV4dGVuZGVkIGFzIGRlc2lyZWQpLiBBbnkgb3RoZXIgSURzIHdpbGwgcmVxdWlyZSBhIGZ1bGxcbiAgICAgKiAgICBkZWZpbml0aW9uIG9mIHRoZSBhbGxvd2VkIHN5bm9ueW1zIGluIHRoZSBpbnRlcmFjdGlvbiBtb2RlbC5cbiAgICAgKi9cbiAgICBhY3Rpb25zPzogRGF0ZVJhbmdlQ29udHJvbEFjdGlvblByb3BzO1xufVxuXG5leHBvcnQgdHlwZSBEYXRlUmFuZ2VDb250cm9sVGFyZ2V0UHJvcHMgPSB7XG5cbiAgICAvKipcbiAgICAgKiBUYXJnZXQtc2xvdCB2YWx1ZXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBjb250cm9sIGFzIGEgd2hvbGUsIGkuZS4gdGhlIGRhdGVcbiAgICAgKiByYW5nZS5cbiAgICAgKlxuICAgICAqIFRhcmdldHMgYXNzb2NpYXRlIHV0dGVyYW5jZXMgdG8gYSBjb250cm9sLiBGb3IgZXhhbXBsZSwgaWYgdGhlIHVzZXIgc2F5c1xuICAgICAqIFwiY2hhbmdlIHRoZSB0aW1lXCIsIGl0IGlzIHBhcnNlZCBhcyBhIGBHZW5lcmFsQ29udHJvbEludGVudGAgd2l0aCBzbG90XG4gICAgICogdmFsdWVzIGBhY3Rpb24gPSBjaGFuZ2VgIGFuZCBgdGFyZ2V0ID0gdGltZWAuICBPbmx5IGNvbnRyb2xzIHRoYXQgYXJlXG4gICAgICogcmVnaXN0ZXJlZCB3aXRoIHRoZSBgdGltZWAgdGFyZ2V0IHNob3VsZCBvZmZlciB0byBoYW5kbGUgdGhpcyBpbnRlbnQuXG4gICAgICpcbiAgICAgKiBEZWZhdWx0OiBbJ2J1aWx0aW5fZGF0ZV9yYW5nZScsICdidWlsdGluX2RhdGUnLCAnYnVpbHRpbl9pdCddXG4gICAgICpcbiAgICAgKiBVc2FnZTpcbiAgICAgKiAtIElmIHRoaXMgcHJvcCBpcyBkZWZpbmVkLCBpdCByZXBsYWNlcyB0aGUgZGVmYXVsdDsgaXQgaXMgbm90IGFkZGl0aXZlXG4gICAgICogICB0aGUgZGVmYXVsdHMuICBUbyBhZGQgYW4gYWRkaXRpb25hbCB0YXJnZXQgdG8gdGhlIGRlZmF1bHRzLCBjb3B5IHRoZVxuICAgICAqICAgZGVmYXVsdHMgYW5kIGFtZW5kLlxuICAgICAqIC0gQSBjb250cm9sIGNhbiBiZSBhc3NvY2lhdGVkIHdpdGggbWFueSB0YXJnZXQtc2xvdC12YWx1ZXMsIGVnIFsnZGF0ZScsXG4gICAgICogICAnc3RhcnREYXRlJywgJ2V2ZW50U3RhcnREYXRlJywgJ3ZhY2F0aW9uU3RhcnQnXVxuICAgICAqIC0gSXQgaXMgYSBnb29kIGlkZWEgdG8gYXNzb2NpYXRlIHdpdGggZ2VuZXJhbCB0YXJnZXRzIChlLmcuIGRhdGUpIGFuZFxuICAgICAqICAgYWxzbyB3aXRoIHNwZWNpZmljIHRhcmdldHMgKGUuZy4gdmFjYXRpb25TdGFydCkgc28gdGhhdCB0aGUgdXNlciBjYW5cbiAgICAgKiAgIHNheSBlaXRoZXIgZ2VuZXJhbCBvciBzcGVjaWZpYyB0aGluZ3MuICBlLmcuICdjaGFuZ2UgdGhlIGRhdGUgdG9cbiAgICAgKiAgIFR1ZXNkYXknLCBvciAnSSB3YW50IG15IHZhY2F0aW9uIHRvIHN0YXJ0IG9uIFR1ZXNkYXknLlxuICAgICAqIC0gVGhlIGFzc29jaWF0aW9uIGRvZXMgbm90IGhhdmUgdG8gYmUgZXhjbHVzaXZlLCBhbmQgZ2VuZXJhbCB0YXJnZXQgc2xvdFxuICAgICAqICAgdmFsdWVzIHdpbGwgb2Z0ZW4gYmUgYXNzb2NpYXRlZCB3aXRoIG1hbnkgY29udHJvbHMuIEluIHNpdHVhdGlvbnMgd2hlcmVcbiAgICAgKiAgIHRoZXJlIGlzIGFtYmlndWl0eSBhYm91dCB3aGF0IHRoZSB1c2VyIGlzIHJlZmVycmluZyB0bywgdGhlIHBhcmVudFxuICAgICAqICAgY29udHJvbHMgbXVzdCByZXNvbHZlIHRoZSBjb25mdXNpb24uXG4gICAgICogLSBUaGUgJ2J1aWx0aW5fKicgSURzIGFyZSBhc3NvY2lhdGVkIHdpdGggZGVmYXVsdCBpbnRlcmFjdGlvbiBtb2RlbCBkYXRhXG4gICAgICogICAod2hpY2ggY2FuIGJlIGV4dGVuZGVkIGFzIGRlc2lyZWQpLiBBbnkgb3RoZXIgSURzIHdpbGwgcmVxdWlyZSBhIGZ1bGxcbiAgICAgKiAgIGRlZmluaXRpb24gb2YgdGhlIGFsbG93ZWQgc3lub255bXMgaW4gdGhlIGludGVyYWN0aW9uIG1vZGVsLlxuICAgICAqXG4gICAgICogQ29udHJvbCBiZWhhdmlvcjpcbiAgICAgKiAtIEEgY29udHJvbCB3aWxsIG5vdCBoYW5kbGUgYW4gaW5wdXQgdGhhdCBtZW50aW9ucyBhIHRhcmdldCB0aGF0IGlzIG5vdFxuICAgICAqICAgcmVnaXN0ZXJlZCBieSB0aGlzIHByb3AuXG4gICAgICovXG4gICAgc2VsZj86IHN0cmluZ1tdXG5cbiAgICAvKipcbiAgICAgKiBUYXJnZXQtc2xvdCB2YWx1ZXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBzdGFydCBkYXRlIGluIGlzb2xhdGlvbi5cbiAgICAgKlxuICAgICAqIFRhcmdldHMgYXNzb2NpYXRlIHV0dGVyYW5jZXMgdG8gYSBjb250cm9sLiBGb3IgZXhhbXBsZSwgaWYgdGhlIHVzZXIgc2F5c1xuICAgICAqIFwiY2hhbmdlIHRoZSB0aW1lXCIsIGl0IGlzIHBhcnNlZCBhcyBhIGBHZW5lcmFsQ29udHJvbEludGVudGAgd2l0aCBzbG90XG4gICAgICogdmFsdWVzIGBhY3Rpb24gPSBjaGFuZ2VgIGFuZCBgdGFyZ2V0ID0gdGltZWAuICBPbmx5IGNvbnRyb2xzIHRoYXQgYXJlXG4gICAgICogcmVnaXN0ZXJlZCB3aXRoIHRoZSBgdGltZWAgdGFyZ2V0IHNob3VsZCBvZmZlciB0byBoYW5kbGUgdGhpcyBpbnRlbnQuXG4gICAgICpcbiAgICAgKiBEZWZhdWx0OiBbJ2J1aWx0aW5fc3RhcnRfZGF0ZScsICdidWlsdGluX2RhdGUnLCAnYnVpbHRpbl9pdCddXG4gICAgICpcbiAgICAgKiBVc2FnZTpcbiAgICAgKiAtIElmIHRoaXMgcHJvcCBpcyBkZWZpbmVkLCBpdCByZXBsYWNlcyB0aGUgZGVmYXVsdDsgaXQgaXMgbm90IGFkZGl0aXZlXG4gICAgICogICB0aGUgZGVmYXVsdHMuICBUbyBhZGQgYW4gYWRkaXRpb25hbCB0YXJnZXQgdG8gdGhlIGRlZmF1bHRzLCBjb3B5IHRoZVxuICAgICAqICAgZGVmYXVsdHMgYW5kIGFtZW5kLlxuICAgICAqIC0gQSBjb250cm9sIGNhbiBiZSBhc3NvY2lhdGVkIHdpdGggbWFueSB0YXJnZXQtc2xvdC12YWx1ZXMsIGVnIFsnZGF0ZScsXG4gICAgICogICAnc3RhcnREYXRlJywgJ2V2ZW50U3RhcnREYXRlJywgJ3ZhY2F0aW9uU3RhcnQnXVxuICAgICAqIC0gSXQgaXMgYSBnb29kIGlkZWEgdG8gYXNzb2NpYXRlIHdpdGggZ2VuZXJhbCB0YXJnZXRzIChlLmcuIGRhdGUpIGFuZFxuICAgICAqICAgYWxzbyB3aXRoIHNwZWNpZmljIHRhcmdldHMgKGUuZy4gdmFjYXRpb25TdGFydCkgc28gdGhhdCB0aGUgdXNlciBjYW5cbiAgICAgKiAgIHNheSBlaXRoZXIgZ2VuZXJhbCBvciBzcGVjaWZpYyB0aGluZ3MuICBlLmcuICdjaGFuZ2UgdGhlIGRhdGUgdG9cbiAgICAgKiAgIFR1ZXNkYXknLCBvciAnSSB3YW50IG15IHZhY2F0aW9uIHRvIHN0YXJ0IG9uIFR1ZXNkYXknLlxuICAgICAqIC0gVGhlIGFzc29jaWF0aW9uIGRvZXMgbm90IGhhdmUgdG8gYmUgZXhjbHVzaXZlLCBhbmQgZ2VuZXJhbCB0YXJnZXQgc2xvdFxuICAgICAqICAgdmFsdWVzIHdpbGwgb2Z0ZW4gYmUgYXNzb2NpYXRlZCB3aXRoIG1hbnkgY29udHJvbHMuIEluIHNpdHVhdGlvbnMgd2hlcmVcbiAgICAgKiAgIHRoZXJlIGlzIGFtYmlndWl0eSBhYm91dCB3aGF0IHRoZSB1c2VyIGlzIHJlZmVycmluZyB0bywgdGhlIHBhcmVudFxuICAgICAqICAgY29udHJvbHMgbXVzdCByZXNvbHZlIHRoZSBjb25mdXNpb24uXG4gICAgICogLSBUaGUgJ2J1aWx0aW5fKicgSURzIGFyZSBhc3NvY2lhdGVkIHdpdGggZGVmYXVsdCBpbnRlcmFjdGlvbiBtb2RlbCBkYXRhXG4gICAgICogICAod2hpY2ggY2FuIGJlIGV4dGVuZGVkIGFzIGRlc2lyZWQpLiBBbnkgb3RoZXIgSURzIHdpbGwgcmVxdWlyZSBhIGZ1bGxcbiAgICAgKiAgIGRlZmluaXRpb24gb2YgdGhlIGFsbG93ZWQgc3lub255bXMgaW4gdGhlIGludGVyYWN0aW9uIG1vZGVsLlxuICAgICAqXG4gICAgICogQ29udHJvbCBiZWhhdmlvcjpcbiAgICAgKiAtIEEgY29udHJvbCB3aWxsIG5vdCBoYW5kbGUgYW4gaW5wdXQgdGhhdCBtZW50aW9ucyBhIHRhcmdldCB0aGF0IGlzIG5vdFxuICAgICAqICAgcmVnaXN0ZXJlZCBieSB0aGlzIHByb3AuXG4gICAgICovXG4gICAgc3RhcnREYXRlPzogc3RyaW5nW10sXG5cbiAgICAvKipcbiAgICAgKiBUYXJnZXQtc2xvdCB2YWx1ZXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBlbmQgZGF0ZSBpbiBpc29sYXRpb24uXG4gICAgICpcbiAgICAgKiBUYXJnZXRzIGFzc29jaWF0ZSB1dHRlcmFuY2VzIHRvIGEgY29udHJvbC4gRm9yIGV4YW1wbGUsIGlmIHRoZSB1c2VyIHNheXNcbiAgICAgKiBcImNoYW5nZSB0aGUgdGltZVwiLCBpdCBpcyBwYXJzZWQgYXMgYSBgR2VuZXJhbENvbnRyb2xJbnRlbnRgIHdpdGggc2xvdFxuICAgICAqIHZhbHVlcyBgYWN0aW9uID0gY2hhbmdlYCBhbmQgYHRhcmdldCA9IHRpbWVgLiAgT25seSBjb250cm9scyB0aGF0IGFyZVxuICAgICAqIHJlZ2lzdGVyZWQgd2l0aCB0aGUgYHRpbWVgIHRhcmdldCBzaG91bGQgb2ZmZXIgdG8gaGFuZGxlIHRoaXMgaW50ZW50LlxuICAgICAqXG4gICAgICogRGVmYXVsdDogWydidWlsdGluX2VuZF9kYXRlJywgJ2J1aWx0aW5fZGF0ZScsICdidWlsdGluX2l0J11cbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqIC0gSWYgdGhpcyBwcm9wIGlzIGRlZmluZWQsIGl0IHJlcGxhY2VzIHRoZSBkZWZhdWx0OyBpdCBpcyBub3QgYWRkaXRpdmVcbiAgICAgKiAgIHRoZSBkZWZhdWx0cy4gIFRvIGFkZCBhbiBhZGRpdGlvbmFsIHRhcmdldCB0byB0aGUgZGVmYXVsdHMsIGNvcHkgdGhlXG4gICAgICogICBkZWZhdWx0cyBhbmQgYW1lbmQuXG4gICAgICogLSBBIGNvbnRyb2wgY2FuIGJlIGFzc29jaWF0ZWQgd2l0aCBtYW55IHRhcmdldC1zbG90LXZhbHVlcywgZWcgWydkYXRlJyxcbiAgICAgKiAgICdzdGFydERhdGUnLCAnZXZlbnRTdGFydERhdGUnLCAndmFjYXRpb25TdGFydCddXG4gICAgICogLSBJdCBpcyBhIGdvb2QgaWRlYSB0byBhc3NvY2lhdGUgd2l0aCBnZW5lcmFsIHRhcmdldHMgKGUuZy4gZGF0ZSkgYW5kXG4gICAgICogICBhbHNvIHdpdGggc3BlY2lmaWMgdGFyZ2V0cyAoZS5nLiB2YWNhdGlvblN0YXJ0KSBzbyB0aGF0IHRoZSB1c2VyIGNhblxuICAgICAqICAgc2F5IGVpdGhlciBnZW5lcmFsIG9yIHNwZWNpZmljIHRoaW5ncy4gIGUuZy4gJ2NoYW5nZSB0aGUgZGF0ZSB0b1xuICAgICAqICAgVHVlc2RheScsIG9yICdJIHdhbnQgbXkgdmFjYXRpb24gdG8gc3RhcnQgb24gVHVlc2RheScuXG4gICAgICogLSBUaGUgYXNzb2NpYXRpb24gZG9lcyBub3QgaGF2ZSB0byBiZSBleGNsdXNpdmUsIGFuZCBnZW5lcmFsIHRhcmdldCBzbG90XG4gICAgICogICB2YWx1ZXMgd2lsbCBvZnRlbiBiZSBhc3NvY2lhdGVkIHdpdGggbWFueSBjb250cm9scy4gSW4gc2l0dWF0aW9ucyB3aGVyZVxuICAgICAqICAgdGhlcmUgaXMgYW1iaWd1aXR5IGFib3V0IHdoYXQgdGhlIHVzZXIgaXMgcmVmZXJyaW5nIHRvLCB0aGUgcGFyZW50XG4gICAgICogICBjb250cm9scyBtdXN0IHJlc29sdmUgdGhlIGNvbmZ1c2lvbi5cbiAgICAgKiAtIFRoZSAnYnVpbHRpbl8qJyBJRHMgYXJlIGFzc29jaWF0ZWQgd2l0aCBkZWZhdWx0IGludGVyYWN0aW9uIG1vZGVsIGRhdGFcbiAgICAgKiAgICh3aGljaCBjYW4gYmUgZXh0ZW5kZWQgYXMgZGVzaXJlZCkuIEFueSBvdGhlciBJRHMgd2lsbCByZXF1aXJlIGEgZnVsbFxuICAgICAqICAgZGVmaW5pdGlvbiBvZiB0aGUgYWxsb3dlZCBzeW5vbnltcyBpbiB0aGUgaW50ZXJhY3Rpb24gbW9kZWwuXG4gICAgICpcbiAgICAgKiBDb250cm9sIGJlaGF2aW9yOlxuICAgICAqIC0gQSBjb250cm9sIHdpbGwgbm90IGhhbmRsZSBhbiBpbnB1dCB0aGF0IG1lbnRpb25zIGEgdGFyZ2V0IHRoYXQgaXMgbm90XG4gICAgICogICByZWdpc3RlcmVkIGJ5IHRoaXMgcHJvcC5cbiAgICAgKi9cbiAgICBlbmREYXRlPzogc3RyaW5nW10sXG59O1xuXG4vKipcbiAqIFJlYXNvbiBjb2RlcyBmb3IgYnVpbHQtaW4gdmFsaWRhdGlvbiBydWxlcy5cbiAqL1xuZXhwb3J0IGVudW0gRGF0ZVJhbmdlVmFsaWRhdGlvbkZhaWxSZWFzb25Db2RlIHtcbiAgICAvKipcbiAgICAgKiBUaGUgc3RhcnQgZGF0ZSBtdXN0IHByZWNlZGUgdGhlIGVuZCBkYXRlLlxuICAgICAqL1xuICAgIFNUQVJUX0JFRk9SRV9FTkQgPSAnc3RhcnRCZWZvcmVFbmQnLFxufVxuXG4vKipcbiAqIEJ1aWx0LWluIHZhbGlkYXRpb24gZnVuY3Rpb25zIGZvciB1c2Ugd2l0aCBEYXRlQ29udHJvbFxuICovXG5leHBvcnQgbmFtZXNwYWNlIERhdGVSYW5nZUNvbnRyb2xWYWxpZGF0aW9ucyB7XG4gICAgZXhwb3J0IGNvbnN0IFNUQVJUX0JFRk9SRV9FTkQ6IERhdGVSYW5nZVZhbGlkYXRpb25GdW5jdGlvbiA9IChzdGF0ZTogRGF0ZVJhbmdlQ29udHJvbFN0YXRlLCBpbnB1dDogQ29udHJvbElucHV0KTogdHJ1ZSB8IFZhbGlkYXRpb25SZXN1bHQgPT4ge1xuICAgICAgICBjb25zdCBzdGFydERhdGUgPSBhbGV4YURhdGVGb3JtYXRUb0RhdGUoc3RhdGUuc3RhcnREYXRlISk7XG4gICAgICAgIGNvbnN0IGVuZERhdGUgPSBhbGV4YURhdGVGb3JtYXRUb0RhdGUoc3RhdGUuZW5kRGF0ZSEpO1xuICAgICAgICBpZiAoc3RhcnREYXRlID4gZW5kRGF0ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgcmVhc29uQ29kZTogRGF0ZVJhbmdlVmFsaWRhdGlvbkZhaWxSZWFzb25Db2RlLlNUQVJUX0JFRk9SRV9FTkQsIHJlbmRlcmVkUmVhc29uOiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9WQUxJREFUSU9OX0ZBSUxfU1RBUlRfQUZURVJfRU5EJykgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xufVxuXG5cbi8qKlxuICogUHJvcHMgdG8gY3VzdG9taXplIHRoZSBwcm9tcHQgZnJhZ21lbnRzIHRoYXQgd2lsbCBiZSBhZGRlZCBieVxuICogYHRoaXMucmVuZGVyQWN0KClgLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIERhdGVSYW5nZUNvbnRyb2xQcm9tcHRQcm9wcyB7XG4gICAgc3RhcnREYXRlPzogRGF0ZUNvbnRyb2xQcm9tcHRQcm9wcyxcbiAgICBlbmREYXRlPzogRGF0ZUNvbnRyb2xQcm9tcHRQcm9wcyxcbiAgICByZXF1ZXN0VmFsdWU/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogUmVxdWVzdFZhbHVlQWN0LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpLFxuICAgIHZhbHVlU2V0PzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IERhdGVSYW5nZVNldEFjdCwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcblxuICAgIHZhbHVlQ2hhbmdlZD86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBEYXRlUmFuZ2VDaGFuZ2VkQWN0LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIGludmFsaWRWYWx1ZT86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBJbnZhbGlkVmFsdWVBY3Q8c3RyaW5nPiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KSxcbiAgICB2YWx1ZURpc2FmZmlybWVkPzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IFZhbHVlRGlzY29uZmlybWVkQWN0PHN0cmluZz4sIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG4gICAgdmFsdWVBZmZpcm1lZD86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBWYWx1ZUNvbmZpcm1lZEFjdDxzdHJpbmc+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIGNvbmZpcm1WYWx1ZT86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBDb25maXJtVmFsdWVBY3Q8c3RyaW5nPiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbn1cblxuXG4vKipcbiAqIFN0YXRlIHRyYWNrZWQgYnkgYSBEYXRlUmFuZ2VDb250cm9sLlxuICovXG5leHBvcnQgY2xhc3MgRGF0ZVJhbmdlQ29udHJvbFN0YXRlIGV4dGVuZHMgQ29udGFpbmVyQ29udHJvbFN0YXRlIHtcblxuICAgIC8vIFRPRE86IHJlZmFjdG9yOiBjb2xsYXRlIHN0YXJ0RGF0ZS9lbmREYXRlIGludG8gLnZhbHVlXG5cbiAgICAvKipcbiAgICAgKiBUaGUgc3RhcnQgZGF0ZVxuICAgICAqL1xuICAgIHN0YXJ0RGF0ZT86IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFRoZSBlbmQgZGF0ZVxuICAgICAqL1xuICAgIGVuZERhdGU/OiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgcHJldmlvdXMgc3RhcnQgZGF0ZVxuICAgICAqL1xuICAgIHByZXZpb3VzU3RhcnREYXRlPzogc3RyaW5nIDtcblxuICAgIC8qKlxuICAgICAqIFRoZSBwcmV2aW91cyBlbmQgZGF0ZVxuICAgICAqL1xuICAgIHByZXZpb3VzRW5kRGF0ZT86IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFRyYWNrcyB3aGV0aGVyIHRoZSBkYXRlUmFuZ2VDb250cm9sIGlzIHJlcXVlc3RpbmcgYSBjaGFuZ2UgdG8gdGhlIHdob2xlIHJhbmdlLlxuICAgICAqL1xuICAgIGlzQ2hhbmdpbmdSYW5nZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyoqXG4gICAgICogVHJhY2tzIHdoZXRoZXIgdGhlIGRhdGVSYW5nZUNvbnRyb2wgaXMgY29uZmlybWluZyB0aGUgd2hvbGUgcmFuZ2UuXG4gICAgICovXG4gICAgaXNDb25maXJtaW5nUmFuZ2U6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIC8qKlxuICAgICAqIFRyYWNrcyB3aGV0aGVyIHRoZSB0b3BpYyBvZiBjb252ZXJzYXRpb24gaXMgdGhlIHdob2xlIHJhbmdlLlxuICAgICAqL1xuICAgIG9uRm9jdXM6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqXG4gICAgICogVHJhY2tzIHdoZXRoZXIgdGhlIHJhbmdlIGhhcyBiZWVuIGV4cGxpY2l0bHkgY29uZmlybWVkIGJ5IHRoZSB1c2VyLlxuICAgICAqL1xuICAgIGlzVmFsdWVDb25maXJtZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbn1cblxuLyoqXG4gKiBDYXRlZ29yaXphdGlvbiBvZiBcIndoYXQgc2VlbXMgdG8gYmUgdGhlIHRhcmdldFwiIG9mIGEgdXR0ZXJhbmNlLlxuICovXG5leHBvcnQgZW51bSBUYXJnZXRDYXRlZ29yeSB7XG4gICAgU3RhcnREYXRlID0gJ3N0YXJ0RGF0ZScsXG4gICAgRW5kRGF0ZSA9ICdlbmREYXRlJyxcbiAgICBCb3RoID0gJ2JvdGgnLFxuICAgIE5laXRoZXIgPSAnbmVpdGhlcicsXG4gICAgRWl0aGVyID0gJ2VpdGhlcidcbn1cblxuLyoqXG4gKiBDYXRlZ29yaXphdGlvbiBvZiBcIndoYXQgc2VlbXMgdG8gYmUgdGhlIHRhcmdldFwiIG9mIGEgdXR0ZXJhbmNlLlxuICovXG5leHBvcnQgZW51bSBEYXRlQ29udHJvbFRhcmdldCB7XG4gICAgU3RhcnREYXRlID0gJ3N0YXJ0RGF0ZScsXG4gICAgRW5kRGF0ZSA9ICdlbmREYXRlJ1xufVxuXG4vKipcbiAqIEEgQ29udHJvbCB0aGF0IG9idGFpbnMgYSBkYXRlIHJhbmdlIGZyb20gdGhlIHVzZXIuXG4gKlxuICogQ2FwYWJpbGl0aWVzOlxuICogLSBSZXF1ZXN0IGEgcmFuZ2UsIG9yIGp1c3QgdGhlIHN0YXJ0L2VuZCBkYXRlXG4gKiAtIENoYW5nZSB0aGUgcmFuZ2UsIG9yIGp1c3QgdGhlIHN0YXJ0L2VuZCBkYXRlXG4gKiAtIFZhbGlkYXRlIHRoZSByYW5nZSBvciBqdXN0IHRoZSBzdGFydC9lbmQgZGF0ZVxuICogLSBDb25maXJtIHRoZSByYW5nZSBvciBqdXN0IHRoZSBzdGFydC9lbmQgZGF0ZVxuICogLSBJbmZlciBzcGVjaWZpYyBkYXRlKHMpIGZvciBhIHBhcnRpYWxseSBzcGVjaWZpZWQgZGF0ZShzKS5cbiAqXG4gKiBJbnRlbnRzIHRoYXQgY2FuIGJlIGhhbmRsZWQ6XG4gKiAtIGBHZW5lcmFsQ29udHJvbEludGVudGA6IEUuZy4gYFwieWVzLCB1cGRhdGUgbXkgYmlydGggZGF0ZVwiYFxuICogLSBgQ29uanVuY3Rpb25Db250cm9sSW50ZW50YDogRS5nLiBgXCJ5ZXMsIGNoYW5nZSB0aGUgc3RhcnQgYW5kIGVuZCBkYXRlc1wiYFxuICogLSBgRGF0ZVJhbmdlQ29udHJvbEludGVudGA6IEUuZy4gXCJubyBUdWVzZGF5IHRvIFNhdHVyZGF5XCIuXG4gKiAtIGBBTUFaT05fREFURV9WYWx1ZUNvbnRyb2xJbnRlbnRgOiBFLmcuIFwibm8gY2hhbmdlIGl0IHRvIFR1ZXNkYXlcIi5cbiAqIC0gYEFNQVpPTi5ZZXNJbnRlbnRgLCBgQU1BWk9OLk5vSW50ZW50YFxuICovXG5leHBvcnQgY2xhc3MgRGF0ZVJhbmdlQ29udHJvbCBleHRlbmRzIENvbnRhaW5lckNvbnRyb2wgaW1wbGVtZW50cyBJbnRlcmFjdGlvbk1vZGVsQ29udHJpYnV0b3Ige1xuXG4gICAgc3RhdGU6IERhdGVSYW5nZUNvbnRyb2xTdGF0ZTtcbiAgICBjaGlsZHJlbjogRGF0ZUNvbnRyb2xbXTtcblxuICAgIC8vIFRPRE86IEFQSTogdGhlIGZvbGxvd2luZyBzaG91bGQgYmUgcHJpdmF0ZS4gUmVxdWlyZXMgc29tZSBjb25zb2xpZGF0aW9uIHdpdGggQ29udGFpbmVyQ29udHJvbFxuICAgIHByb3BzOiBEZWVwUmVxdWlyZWQ8RGF0ZVJhbmdlQ29udHJvbFByb3BzPjtcblxuICAgIHByaXZhdGUgc3RhcnREYXRlQ29udHJvbDogRGF0ZUNvbnRyb2w7XG4gICAgcHJpdmF0ZSBlbmREYXRlQ29udHJvbDogRGF0ZUNvbnRyb2w7XG4gICAgcHJpdmF0ZSBoYW5kbGVGdW5jOiAoKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKSA9PiB2b2lkKSB8IHVuZGVmaW5lZDtcbiAgICBwcml2YXRlIHRha2VJbml0aWF0aXZlRnVuYzogKChpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcikgPT4gdm9pZCkgfCB1bmRlZmluZWQ7XG5cbiAgICBzdGF0aWMgbWVyZ2VXaXRoRGVmYXVsdFByb3BzKHByb3BzOiBEYXRlUmFuZ2VDb250cm9sUHJvcHMpOiBEZWVwUmVxdWlyZWQ8RGF0ZVJhbmdlQ29udHJvbFByb3BzPiB7XG4gICAgICAgIGNvbnN0IGRlZmF1bHRzOiBEZWVwUmVxdWlyZWQ8RGF0ZVJhbmdlQ29udHJvbFByb3BzPiA9IHtcbiAgICAgICAgICAgIGlkOiAndW5pbml0aWFsaXplZCcsXG4gICAgICAgICAgICB2YWxpZGF0aW9uOiB7XG4gICAgICAgICAgICAgICAgc3RhcnREYXRlVmFsaWQ6IFtdLFxuICAgICAgICAgICAgICAgIGVuZERhdGVWYWxpZDogW10sXG4gICAgICAgICAgICAgICAgcmFuZ2VWYWxpZDogW11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpcm1hdGlvblJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgICAgIGludGVyYWN0aW9uTW9kZWw6IHtcbiAgICAgICAgICAgICAgICB0YXJnZXRzOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZTogWyQuVGFyZ2V0LlN0YXJ0RGF0ZSwgJC5UYXJnZXQuRGF0ZSwgJC5UYXJnZXQuSXRdLFxuICAgICAgICAgICAgICAgICAgICBlbmREYXRlOiBbJC5UYXJnZXQuRW5kRGF0ZSwgJC5UYXJnZXQuRGF0ZSwgJC5UYXJnZXQuSXRdLFxuICAgICAgICAgICAgICAgICAgICBzZWxmOiBbJC5UYXJnZXQuRGF0ZSwgJC5UYXJnZXQuRGF0ZVJhbmdlLCAkLlRhcmdldC5JdF1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGFjdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgc2V0OiBbJC5BY3Rpb24uU2V0XSxcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlOiBbJC5BY3Rpb24uQ2hhbmdlXVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcHJvbXB0czoge1xuICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZToge1xuICAgICAgICAgICAgICAgICAgICBjb25maXJtVmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX0NPTkZJUk1fU1RBUlRfREFURScsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZUFmZmlybWVkOiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9TVEFSVF9EQVRFX0FGRklSTUVEJyksXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlRGlzYWZmaXJtZWQ6IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1NUQVJUX0RBVEVfRElTQUZGSVJNRUQnKSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVTZXQ6IChhY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1NUQVJUX0RBVEVfU0VUJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlQ2hhbmdlZDogKGFjdCkgPT4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfU1RBUlRfREFURV9DSEFOR0VEJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgICAgIGludmFsaWRWYWx1ZTogKGFjdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdC5wYXlsb2FkLnJlbmRlcmVkUmVhc29uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfSU5WQUxJRF9TVEFSVF9XSVRIX1JFQVNPTicsIHsgcmVhc29uOiBhY3QucGF5bG9hZC5yZW5kZXJlZFJlYXNvbiB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9HRU5FUkFMX0lOVkFMSURfREFURScpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0VmFsdWU6IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1JFUVVFU1RfU1RBUlRfREFURScpLFxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0Q2hhbmdlZFZhbHVlOiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9SRVFVRVNUX0NIQU5HRURfU1RBUlRfREFURScpLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZW5kRGF0ZToge1xuICAgICAgICAgICAgICAgICAgICBjb25maXJtVmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX0NPTkZJUk1fRU5EX0RBVEUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVBZmZpcm1lZDogaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfRU5EX0RBVEVfQUZGSVJNRUQnKSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVEaXNhZmZpcm1lZDogaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfRU5EX0RBVEVfRElTQUZGSVJNRUQnKSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVTZXQ6IChhY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX0VORF9EQVRFX1NFVCcsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZUNoYW5nZWQ6IChhY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX0VORF9EQVRFX0NIQU5HRUQnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICAgICAgaW52YWxpZFZhbHVlOiAoYWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0LnBheWxvYWQucmVuZGVyZWRSZWFzb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9JTlZBTElEX0VORF9XSVRIX1JFQVNPTicsIHsgcmVhc29uOiBhY3QucGF5bG9hZC5yZW5kZXJlZFJlYXNvbiB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9HRU5FUkFMX0lOVkFMSURfREFURScpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0VmFsdWU6IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1JFUVVFU1RfRU5EX0RBVEUnKSxcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdENoYW5nZWRWYWx1ZTogaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfUkVRVUVTVF9DSEFOR0VEX0VORF9EQVRFJyksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICByZXF1ZXN0VmFsdWU6IChhY3Q6IFJlcXVlc3RWYWx1ZUFjdCkgPT4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfUkVRVUVTVF9WQUxVRScpLFxuICAgICAgICAgICAgICAgIHZhbHVlU2V0OiAoYWN0OiBEYXRlUmFuZ2VTZXRBY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1ZBTFVFX1NFVCcsIHsgc3RhcnQ6IGFjdC5zdGFydERhdGUsIGVuZDogYWN0LmVuZERhdGUgfSksXG4gICAgICAgICAgICAgICAgdmFsdWVDaGFuZ2VkOiAoYWN0OiBEYXRlUmFuZ2VDaGFuZ2VkQWN0KSA9PiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9WQUxVRV9DSEFOR0VEJywgeyBzdGFydDogYWN0LnN0YXJ0RGF0ZSwgZW5kOiBhY3QuZW5kRGF0ZSB9KSxcbiAgICAgICAgICAgICAgICBpbnZhbGlkVmFsdWU6IChhY3Q6IEludmFsaWRWYWx1ZUFjdDxzdHJpbmc+KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3QucGF5bG9hZC5yZW5kZXJlZFJlYXNvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfSU5WQUxJRF9WQUxVRV9XSVRIX1JFQVNPTicsIHsgcmVhc29uOiBhY3QucGF5bG9hZC5yZW5kZXJlZFJlYXNvbiB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfR0VORVJBTF9JTlZBTElEX1ZBTFVFJyk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB2YWx1ZUFmZmlybWVkOiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9WQUxVRV9BRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgIHZhbHVlRGlzYWZmaXJtZWQ6IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1ZBTFVFX0RJU0FGRklSTUVEJyksXG4gICAgICAgICAgICAgICAgY29uZmlybVZhbHVlOiAoYWN0KSA9PiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9DT05GSVJNX1ZBTFVFJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVwcm9tcHRzOiB7XG4gICAgICAgICAgICAgICAgc3RhcnREYXRlOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1WYWx1ZTogKGFjdCkgPT4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9DT05GSVJNX1NUQVJUX0RBVEUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVBZmZpcm1lZDogaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9TVEFSVF9EQVRFX0FGRklSTUVEJyksXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlRGlzYWZmaXJtZWQ6IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfU1RBUlRfREFURV9ESVNBRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZVNldDogKGFjdCkgPT4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9TVEFSVF9EQVRFX1NFVCcsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZUNoYW5nZWQ6IChhY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfU1RBUlRfREFURV9DSEFOR0VEJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgICAgIGludmFsaWRWYWx1ZTogKGFjdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdC5wYXlsb2FkLnJlYXNvbkNvZGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX0lOVkFMSURfU1RBUlRfV0lUSF9SRUFTT04nLCB7IHJlYXNvbjogYWN0LnBheWxvYWQucmVhc29uQ29kZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX0dFTkVSQUxfSU5WQUxJRF9EQVRFJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RWYWx1ZTogaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9SRVFVRVNUX1NUQVJUX0RBVEUnKSxcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdENoYW5nZWRWYWx1ZTogaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9SRVFVRVNUX0NIQU5HRURfU1RBUlRfREFURScpLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZW5kRGF0ZToge1xuICAgICAgICAgICAgICAgICAgICBjb25maXJtVmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfQ09ORklSTV9FTkRfREFURScsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZUFmZmlybWVkOiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX0VORF9EQVRFX0FGRklSTUVEJyksXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlRGlzYWZmaXJtZWQ6IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfRU5EX0RBVEVfRElTQUZGSVJNRUQnKSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVTZXQ6IChhY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfRU5EX0RBVEVfU0VUJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlQ2hhbmdlZDogKGFjdCkgPT4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9FTkRfREFURV9DSEFOR0VEJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgICAgIGludmFsaWRWYWx1ZTogKGFjdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdC5wYXlsb2FkLnJlYXNvbkNvZGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX0lOVkFMSURfRU5EX1dJVEhfUkVBU09OJywgeyByZWFzb246IGFjdC5wYXlsb2FkLnJlYXNvbkNvZGUgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9HRU5FUkFMX0lOVkFMSURfREFURScpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0VmFsdWU6IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfUkVRVUVTVF9FTkRfREFURScpLFxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0Q2hhbmdlZFZhbHVlOiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX1JFUVVFU1RfQ0hBTkdFRF9FTkRfREFURScpLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcmVxdWVzdFZhbHVlOiAoYWN0OiBSZXF1ZXN0VmFsdWVBY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfUkVRVUVTVF9WQUxVRScpLFxuICAgICAgICAgICAgICAgIHZhbHVlU2V0OiAoYWN0OiBEYXRlUmFuZ2VTZXRBY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfVkFMVUVfU0VUJywgeyBzdGFydDogYWN0LnN0YXJ0RGF0ZSwgZW5kOiBhY3QuZW5kRGF0ZSB9KSxcbiAgICAgICAgICAgICAgICB2YWx1ZUNoYW5nZWQ6IChhY3Q6IERhdGVSYW5nZUNoYW5nZWRBY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfVkFMVUVfQ0hBTkdFRCcsIHsgc3RhcnQ6IGFjdC5zdGFydERhdGUsIGVuZDogYWN0LmVuZERhdGUgfSksXG4gICAgICAgICAgICAgICAgaW52YWxpZFZhbHVlOiAoYWN0OiBJbnZhbGlkVmFsdWVBY3Q8c3RyaW5nPikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0LnBheWxvYWQucmVhc29uQ29kZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9JTlZBTElEX1ZBTFVFX1dJVEhfUkVBU09OJywgeyByZWFzb246IGFjdC5wYXlsb2FkLnJlYXNvbkNvZGUgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfR0VORVJBTF9JTlZBTElEX1ZBTFVFJyk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB2YWx1ZUFmZmlybWVkOiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX1ZBTFVFX0FGRklSTUVEJyksXG4gICAgICAgICAgICAgICAgdmFsdWVEaXNhZmZpcm1lZDogaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9WQUxVRV9ESVNBRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgIGNvbmZpcm1WYWx1ZTogKGFjdCkgPT4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9DT05GSVJNX1ZBTFVFJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICB9LFxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBfLm1lcmdlV2l0aChkZWZhdWx0cywgcHJvcHMpO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBEYXRlUmFuZ2VDb250cm9sUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICB0aGlzLnN0YXRlID0gbmV3IERhdGVSYW5nZUNvbnRyb2xTdGF0ZSgpO1xuICAgICAgICB0aGlzLnByb3BzID0gRGF0ZVJhbmdlQ29udHJvbC5tZXJnZVdpdGhEZWZhdWx0UHJvcHMocHJvcHMpO1xuICAgICAgICB0aGlzLnN0YXJ0RGF0ZUNvbnRyb2wgPSBuZXcgRGF0ZUNvbnRyb2woe1xuICAgICAgICAgICAgaWQ6IGAke3RoaXMucHJvcHMuaWR9X3N0YXJ0RGF0ZWAsXG4gICAgICAgICAgICBpbnRlcmFjdGlvbk1vZGVsOiB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0czogdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMuc3RhcnREYXRlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcHJvbXB0czogdGhpcy5wcm9wcy5wcm9tcHRzLnN0YXJ0RGF0ZSxcbiAgICAgICAgICAgIHZhbGlkYXRpb246IHRoaXMucHJvcHMudmFsaWRhdGlvbi5zdGFydERhdGVWYWxpZCxcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0aGlzLnByb3BzLnJlcXVpcmVkLFxuICAgICAgICAgICAgY29uZmlybWF0aW9uUmVxdWlyZWQ6IHRoaXMucHJvcHMuY29uZmlybWF0aW9uUmVxdWlyZWRcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZW5kRGF0ZUNvbnRyb2wgPSBuZXcgRGF0ZUNvbnRyb2woe1xuICAgICAgICAgICAgaWQ6IGAke3RoaXMucHJvcHMuaWR9X2VuZERhdGVgLFxuICAgICAgICAgICAgaW50ZXJhY3Rpb25Nb2RlbDoge1xuICAgICAgICAgICAgICAgIHRhcmdldHM6IHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzLmVuZERhdGVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcm9tcHRzOiB0aGlzLnByb3BzLnByb21wdHMuZW5kRGF0ZSxcbiAgICAgICAgICAgIHZhbGlkYXRpb246IHRoaXMucHJvcHMudmFsaWRhdGlvbi5lbmREYXRlVmFsaWQsXG4gICAgICAgICAgICByZXF1aXJlZDogdGhpcy5wcm9wcy5yZXF1aXJlZCxcbiAgICAgICAgICAgIGNvbmZpcm1hdGlvblJlcXVpcmVkOiB0aGlzLnByb3BzLmNvbmZpcm1hdGlvblJlcXVpcmVkXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMuc3RhcnREYXRlQ29udHJvbClcbiAgICAgICAgICAgIC5hZGRDaGlsZCh0aGlzLmVuZERhdGVDb250cm9sKTtcbiAgICB9XG5cbiAgICAvLyB0c0RvYyAtIHNlZSBDb250cm9sXG4gICAgYXN5bmMgY2FuSGFuZGxlKGlucHV0OiBDb250cm9sSW5wdXQpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY2FuSGFuZGxlRm9yRm9jdXMoaW5wdXQpIHx8IHRoaXMuY2FuSGFuZGxlRm9yTm9Gb2N1cyhpbnB1dCk7XG4gICAgfVxuXG4gICAgLy8gdHNEb2MgLSBzZWUgQ29udHJvbFxuICAgIGFzeW5jIGhhbmRsZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IFByb21pc2U8dm9pZD4ge1xuXG4gICAgICAgIGxvZy5kZWJ1ZyhgRGF0ZVJhbmdlQ29udHJvbFske3RoaXMuaWR9XTogaGFuZGxlKCkuIEVudGVyaW5nYCk7XG5cbiAgICAgICAgLy8gdXBkYXRlIHRoZSBwcmlvclN0YXJ0RGF0ZSBhbmQgcHJpb3JFbmREYXRlIGJlZm9yZSBuZXcgb3BlcmF0aW9uXG4gICAgICAgIHRoaXMudXBkYXRlUHJpb3IoKTtcblxuICAgICAgICAvLyBDYWxsaW5nIGhhbmRsZSBmdW5jdGlvbiB0byBtYWtlIGNoYW5nZXMgdG8gc3RhdGUgdmFsdWVzXG4gICAgICAgIGlmICh0aGlzLmhhbmRsZUZ1bmMpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZUZ1bmMoaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgY2FuJ3QgaGFuZGxlIGJ5IERhdGVSYW5nZUNvbnRyb2wgaXRzZWxmLCBsZXQgY2hpbGRyZW4gaGFuZGxlIGl0IGFuZCB1cGRhdGUgc3RhdGUgdmFsdWVzXG4gICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlQnlDaGlsZChpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgICAgIGNvbnN0IG5ld1N0YXJ0RGF0ZSA9IHRoaXMuZ2V0U3RhcnREYXRlRnJvbUNoaWxkKCk7XG4gICAgICAgIGNvbnN0IG5ld0VuZERhdGUgPSB0aGlzLmdldEVuZERhdGVGcm9tQ2hpbGQoKTtcbiAgICAgICAgdGhpcy5zZXRTdGFydERhdGUobmV3U3RhcnREYXRlKTtcbiAgICAgICAgdGhpcy5zZXRFbmREYXRlKG5ld0VuZERhdGUpO1xuICAgICAgICB0aGlzLnN0YXRlLm9uRm9jdXMgPSBmYWxzZTtcblxuICAgICAgICAvLyBBZnRlciBjaGlsZCBoYW5kbGUgdGhlIHJlcXVlc3QgYW5kIGNoaWxkIGhhcyBubyBxdWVzdGlvblxuICAgICAgICAvLyBhc2sgRGF0ZVJhbmdlQ29udHJvbCB3aGV0aGVyIHRoZSB2YWx1ZSBpcyByZWFkeVxuICAgICAgICBpZiAoIXJlc3VsdEJ1aWxkZXIuaGFzSW5pdGlhdGl2ZUFjdCgpICYmIGF3YWl0IHRoaXMuY2FuVGFrZUluaXRpYXRpdmUoaW5wdXQpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy50YWtlSW5pdGlhdGl2ZUZ1bmMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMudGFrZUluaXRpYXRpdmVGdW5jKGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIHRzRG9jIC0gc2VlIENvbnRyb2xcbiAgICB1cGRhdGVJbnRlcmFjdGlvbk1vZGVsKGdlbmVyYXRvcjogQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3IsIGltRGF0YTogTW9kZWxEYXRhKSB7XG4gICAgICAgIGdlbmVyYXRvci5hZGRDb250cm9sSW50ZW50KG5ldyBHZW5lcmFsQ29udHJvbEludGVudCgpLCBpbURhdGEpO1xuICAgICAgICBnZW5lcmF0b3IuYWRkQ29udHJvbEludGVudChuZXcgQ29uanVuY3Rpb25Db250cm9sSW50ZW50KCksIGltRGF0YSk7XG4gICAgICAgIGdlbmVyYXRvci5hZGRDb250cm9sSW50ZW50KG5ldyBEYXRlUmFuZ2VDb250cm9sSW50ZW50KCksIGltRGF0YSk7XG4gICAgICAgIGdlbmVyYXRvci5hZGRDb250cm9sSW50ZW50KG5ldyBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoQW1hem9uQnVpbHRJblNsb3RUeXBlLkRBVEUpLCBpbURhdGEpO1xuICAgICAgICBnZW5lcmF0b3IuYWRkWWVzQW5kTm9JbnRlbnRzKCk7XG5cbiAgICAgICAgaWYgKHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzLnNlbGYuaW5jbHVkZXMoJC5UYXJnZXQuRGF0ZSkpIHtcbiAgICAgICAgICAgIGdlbmVyYXRvci5hZGRWYWx1ZXNUb1Nsb3RUeXBlKFNoYXJlZFNsb3RUeXBlLlRBUkdFVCwgaTE4bmV4dC50KCdEQVRFX0NPTlRST0xfREVGQVVMVF9TTE9UX1ZBTFVFU19UQVJHRVRfREFURScsIHsgcmV0dXJuT2JqZWN0czogdHJ1ZSB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzLnNlbGYuaW5jbHVkZXMoJC5UYXJnZXQuRGF0ZVJhbmdlKSkge1xuICAgICAgICAgICAgZ2VuZXJhdG9yLmFkZFZhbHVlc1RvU2xvdFR5cGUoU2hhcmVkU2xvdFR5cGUuVEFSR0VULCBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1NMT1RfVkFMVUVTX1RBUkdFVF9EQVRFX1JBTkdFJywgeyByZXR1cm5PYmplY3RzOiB0cnVlIH0pKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMuc3RhcnREYXRlLmluY2x1ZGVzKCQuVGFyZ2V0LlN0YXJ0RGF0ZSkpIHtcbiAgICAgICAgICAgIGdlbmVyYXRvci5hZGRWYWx1ZXNUb1Nsb3RUeXBlKFNoYXJlZFNsb3RUeXBlLlRBUkdFVCwgaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9TTE9UX1ZBTFVFU19UQVJHRVRfU1RBUlRfREFURScsIHsgcmV0dXJuT2JqZWN0czogdHJ1ZSB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzLmVuZERhdGUuaW5jbHVkZXMoJC5UYXJnZXQuRW5kRGF0ZSkpIHtcbiAgICAgICAgICAgIGdlbmVyYXRvci5hZGRWYWx1ZXNUb1Nsb3RUeXBlKFNoYXJlZFNsb3RUeXBlLlRBUkdFVCwgaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9TTE9UX1ZBTFVFU19UQVJHRVRfRU5EX0RBVEUnLCB7IHJldHVybk9iamVjdHM6IHRydWUgfSkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gdHNEb2MgLSBzZWUgSW50ZXJhY3Rpb25Nb2RlbENvbnRyaWJ1dG9yXG4gICAgZ2V0VGFyZ2V0SWRzKCk6IHN0cmluZ1tdIHtcblxuICAgICAgICByZXR1cm4gdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMuc2VsZjtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFN0YXJ0RGF0ZUZyb21DaGlsZCgpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuXG4gICAgICAgIHJldHVybiB0aGlzLnN0YXJ0RGF0ZUNvbnRyb2wuc3RhdGUudmFsdWU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRFbmREYXRlRnJvbUNoaWxkKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZW5kRGF0ZUNvbnRyb2wuc3RhdGUudmFsdWU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRTdGFydERhdGUoZGF0ZTogc3RyaW5nIHwgdW5kZWZpbmVkKTogdm9pZCB7XG5cbiAgICAgICAgdGhpcy5zdGFydERhdGVDb250cm9sLnN0YXRlLnZhbHVlID0gZGF0ZTtcbiAgICAgICAgdGhpcy5zdGF0ZS5zdGFydERhdGUgPSBkYXRlO1xuXG4gICAgICAgIC8vIENsZWFuIG9wZW4gcXVlc3Rpb24gb25jZSBhIHZhbHVlIHNldFxuICAgICAgICB0aGlzLnN0YXRlLmlzQ2hhbmdpbmdSYW5nZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2V0RW5kRGF0ZShkYXRlOiBzdHJpbmcgfCB1bmRlZmluZWQpOiB2b2lkIHtcblxuICAgICAgICB0aGlzLmVuZERhdGVDb250cm9sLnN0YXRlLnZhbHVlID0gZGF0ZTtcbiAgICAgICAgdGhpcy5zdGF0ZS5lbmREYXRlID0gZGF0ZTtcblxuICAgICAgICAvLyBDbGVhbiBvcGVuIHF1ZXN0aW9uIG9uY2UgYSB2YWx1ZSBzZXRcbiAgICAgICAgdGhpcy5zdGF0ZS5pc0NoYW5naW5nUmFuZ2UgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIGNhbkhhbmRsZUZvckZvY3VzKGlucHV0OiBDb250cm9sSW5wdXQpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYodGhpcy5zdGF0ZS5vbkZvY3VzID09PSB0cnVlKTtcblxuICAgICAgICAgICAgLy8gV2hlbiB0aGUgZm9jdXMgaXMgb24gcGFyZW50IGl0c2VsZlxuICAgICAgICAgICAgLy8gZ2l2ZSB0aGUgcGFyZW50IHByaW9yaXR5IHRvIGhhbmRsZSB0aGUgcmVxdWVzdFxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNUd29WYWx1ZUlucHV0KGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc0RhdGVJbnRlcnByZXRlZEFzRGF0ZVJhbmdlKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc0NoYW5nZUJvdGgoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmlzQ2hhbmdlUmFuZ2UoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmlzQ29uZmlybWF0aW9uQWZmaXJtZWQoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmlzQ29uZmlybWF0aW9uRGlzQWZmaXJtZWQoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmNhbkhhbmRsZUJ5Q2hpbGQoaW5wdXQpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIGNhbkhhbmRsZUZvck5vRm9jdXMoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLm9uRm9jdXMgPT09IGZhbHNlKTtcblxuICAgICAgICAgICAgLy8gV2hlbiB0aGUgZm9jdXMgaXMgb24gY2hpbGRyZW5cbiAgICAgICAgICAgIC8vIGdpdmUgY2hpbGRyZW4gcHJpb3JpdHkgdG8gaGFuZGxlIHRoZSByZXF1ZXN0XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5jYW5IYW5kbGVCeUNoaWxkKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc1R3b1ZhbHVlSW5wdXQoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmlzRGF0ZUludGVycHJldGVkQXNEYXRlUmFuZ2UoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmlzQ2hhbmdlQm90aChpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaXNDaGFuZ2VSYW5nZShpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaXNDb25maXJtYXRpb25BZmZpcm1lZChpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaXNDb25maXJtYXRpb25EaXNBZmZpcm1lZChpbnB1dCk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlc3QgaWYgdGhlIGlucHV0IGhhcyBib3RoIHN0YXJ0IGRhdGUgYW5kIGVuZCBkYXRlIHByb3ZpZGVkXG4gICAgICovXG4gICAgcHJpdmF0ZSBpc1R3b1ZhbHVlSW5wdXQoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNJbnRlbnQoaW5wdXQsIERhdGVSYW5nZUNvbnRyb2xJbnRlbnQubmFtZSkpO1xuICAgICAgICAgICAgY29uc3QgaW50ZW50ID0gKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50O1xuICAgICAgICAgICAgY29uc3QgdW5wYWNrZWRTbG90cyA9IHVucGFja0RhdGVSYW5nZUNvbnRyb2xJbnRlbnQoaW50ZW50KTtcbiAgICAgICAgICAgIGlmICh1bnBhY2tlZFNsb3RzLnRhcmdldCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHVucGFja2VkU2xvdHMudGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cy5zZWxmKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh1bnBhY2tlZFNsb3RzW1widGFyZ2V0LmFcIl0sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzLnN0YXJ0RGF0ZSkgfHwgSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh1bnBhY2tlZFNsb3RzW1widGFyZ2V0LmFcIl0sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzLmVuZERhdGUpKTtcbiAgICAgICAgICAgICAgICBva0lmKElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodW5wYWNrZWRTbG90c1tcInRhcmdldC5iXCJdLCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cy5zdGFydERhdGUpIHx8IElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodW5wYWNrZWRTbG90c1tcInRhcmdldC5iXCJdLCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cy5lbmREYXRlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBpbnB1dEdyb3VwczogRGF0ZVJhbmdlQ29udHJvbEludGVudElucHV0W10gPSBnZW5lcmF0ZURhdGVzSW5wdXRHcm91cHModGhpcy5wcm9wcywgdW5wYWNrZWRTbG90cyk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGlucHV0R3JvdXAgb2YgaW5wdXRHcm91cHMpIHtcbiAgICAgICAgICAgICAgICBva0lmKElucHV0VXRpbC52YWx1ZVN0ckRlZmluZWQoaW5wdXRHcm91cC52YWx1ZSkpO1xuICAgICAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzU2V0T3JVbmRlZmluZWQoaW5wdXRHcm91cC5hY3Rpb24sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCkgfHwgSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2goaW5wdXRHcm91cC5hY3Rpb24sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZSkpO1xuICAgICAgICAgICAgICAgIG9rSWYoaW5wdXRHcm91cC50YXJnZXQgPT09IFRhcmdldENhdGVnb3J5LlN0YXJ0RGF0ZSB8fCBpbnB1dEdyb3VwLnRhcmdldCA9PT0gVGFyZ2V0Q2F0ZWdvcnkuRW5kRGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZVR3b1ZhbHVlSW5wdXQ7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlVHdvVmFsdWVJbnB1dChpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCBpbnRlbnQgPSAoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQ7XG4gICAgICAgIGNvbnN0IHVucGFja2VkU2xvdHMgPSB1bnBhY2tEYXRlUmFuZ2VDb250cm9sSW50ZW50KGludGVudCk7XG4gICAgICAgIGNvbnN0IGlucHV0R3JvdXBzOiBEYXRlUmFuZ2VDb250cm9sSW50ZW50SW5wdXRbXSA9IGdlbmVyYXRlRGF0ZXNJbnB1dEdyb3Vwcyh0aGlzLnByb3BzLCB1bnBhY2tlZFNsb3RzKTtcbiAgICAgICAgZm9yIChjb25zdCBpbnB1dEdyb3VwIG9mIGlucHV0R3JvdXBzKSB7XG4gICAgICAgICAgICBpZiAoaW5wdXRHcm91cC50YXJnZXQgPT09IFRhcmdldENhdGVnb3J5LlN0YXJ0RGF0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhcnREYXRlKGZpbmRFZGdlRGF0ZU9mRGF0ZVJhbmdlKGlucHV0R3JvdXAudmFsdWUsIHRydWUpKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5wdXRHcm91cC50YXJnZXQgPT09IFRhcmdldENhdGVnb3J5LkVuZERhdGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEVuZERhdGUoZmluZEVkZ2VEYXRlT2ZEYXRlUmFuZ2UoaW5wdXRHcm91cC52YWx1ZSwgZmFsc2UpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyByZXNldCB0aGUgY29uZmlybWF0aW9uIGZsYWcgdG8gZmFsc2VcbiAgICAgICAgdGhpcy5zdGF0ZS5pc1ZhbHVlQ29uZmlybWVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3RhdGUub25Gb2N1cyA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLndhbnRzVG9Db25maXJtUmFuZ2UoaW5wdXQpKSB7XG4gICAgICAgICAgICB0aGlzLmNvbmZpcm1WYWx1ZShpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hY2tEYXRlUmFuZ2VWYWx1ZUNoYW5nZWQocmVzdWx0QnVpbGRlcik7XG4gICAgICAgIGlmICh0aGlzLndhbnRzVG9Db3JyZWN0UmFuZ2UoaW5wdXQpKSB7XG4gICAgICAgICAgICB0aGlzLmNvcnJlY3RSYW5nZShpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmUgd2hldGhlciB0aGUgaW5wdXQgc2luZ2xlIGRhdGUgdmFsdWUgc2hvdWxkIGJlIGNvbnNpZGVyZWQgYXMgZGF0ZSByYW5nZVxuICAgICAqXG4gICAgICogVGhlIERhdGVSYW5nZUNvbnRyb2wgd2lsbCByZWdhcmQgYSBzaW5nbGUgdmFsdWUgaW5wdXQgYXMgZGF0ZSByYW5nZSB3aGVuIHRoZXJlJ3Mgbm8gY2xlYXIgdGFyZ2V0IGFuZFxuICAgICAqIHdoZW4gdGhlIERhdGVSYW5nZUNvbnRyb2wgaXRzZWxmIGlzIHVuZGVyIGZvY3VzXG4gICAgICogRS5HLiAnc2V0IHJhbmdlIHRvIDIwMTgnLCB3aGVyZSAyMDE4IHdpbGwgYmUgcmVnYXJkZWQgYXMgYSByYW5nZSBhbmQgYm90aCBzdGFydCBkYXRlIGFuZCBlbmQgZGF0ZSB3aWxsIGJlIHNldCB0byAyMDE4XG4gICAgICovXG4gICAgcHJpdmF0ZSBpc0RhdGVJbnRlcnByZXRlZEFzRGF0ZVJhbmdlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KGlucHV0LCBBbWF6b25CdWlsdEluU2xvdFR5cGUuREFURSkpO1xuICAgICAgICAgICAgY29uc3QgaW50ZW50ID0gKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50O1xuICAgICAgICAgICAgY29uc3QgdW5wYWNrZWRTbG90cyA9IHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudChpbnRlbnQpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHVucGFja2VkU2xvdHMudGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cy5zZWxmKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5hY3Rpb25Jc01hdGNoT3JVbmRlZmluZWQodW5wYWNrZWRTbG90cy5hY3Rpb24sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCkgfHwgSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2hPclVuZGVmaW5lZCh1bnBhY2tlZFNsb3RzLmFjdGlvbiwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuY2hhbmdlKSk7XG5cbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlRGF0ZVJhbmdlSW5wdXQ7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlRGF0ZVJhbmdlSW5wdXQoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgaW50ZW50ID0gKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50O1xuICAgICAgICBjb25zdCB7IHZhbHVlU3RyIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoaW50ZW50KTtcbiAgICAgICAgdGhpcy5zZXRTdGFydERhdGUoZmluZEVkZ2VEYXRlT2ZEYXRlUmFuZ2UodmFsdWVTdHIsIHRydWUpKTtcbiAgICAgICAgdGhpcy5zZXRFbmREYXRlKGZpbmRFZGdlRGF0ZU9mRGF0ZVJhbmdlKHZhbHVlU3RyLCBmYWxzZSkpO1xuICAgICAgICB0aGlzLnN0YXRlLmlzVmFsdWVDb25maXJtZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zdGF0ZS5vbkZvY3VzID0gdHJ1ZTtcbiAgICAgICAgaWYgKHRoaXMud2FudHNUb0NvbmZpcm1SYW5nZShpbnB1dCkpIHtcbiAgICAgICAgICAgIHRoaXMuY29uZmlybVZhbHVlKGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFja0RhdGVSYW5nZVZhbHVlQ2hhbmdlZChyZXN1bHRCdWlsZGVyKTtcbiAgICAgICAgaWYgKHRoaXMud2FudHNUb0NvcnJlY3RSYW5nZShpbnB1dCkpIHtcbiAgICAgICAgICAgIHRoaXMuY29ycmVjdFJhbmdlKGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERldGVybWluZSB3aGV0aGVyIHRoZSBpbnB1dCBhY3Rpb24gaXMgdGFyZ2V0aW5nIGJvdGggc3RhcnQgZGF0ZSBhbmQgZW5kIGRhdGVcbiAgICAgKlxuICAgICAqIEUuRy4gJ0NoYW5nZSBzdGFydCBkYXRlIGFuZCBlbmQgZGF0ZSdcbiAgICAgKi9cbiAgICBwcml2YXRlIGlzQ2hhbmdlQm90aChpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0ludGVudChpbnB1dCwgQ29uanVuY3Rpb25Db250cm9sSW50ZW50Lm5hbWUpKTtcbiAgICAgICAgICAgIGNvbnN0IGludGVudCA9IChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudDtcbiAgICAgICAgICAgIGNvbnN0IHVucGFja2VkU2xvdHMgPSB1bnBhY2tDb25qdW5jdGlvbkNvbnRyb2xJbnRlbnQoaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmZlZWRiYWNrSXNNYXRjaE9yVW5kZWZpbmVkKHVucGFja2VkU2xvdHMuZmVlZGJhY2ssIFskLkZlZWRiYWNrLkFmZmlybSwgJC5GZWVkYmFjay5EaXNhZmZpcm1dKSk7XG4gICAgICAgICAgICBjb25zdCBpbnB1dHM6IEFjdGlvbkFuZFRhc2tbXSA9IGdlbmVyYXRlQWN0aW9uVGFza1BhaXJzKHVucGFja2VkU2xvdHMpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBpbnB1dCBvZiBpbnB1dHMpIHtcbiAgICAgICAgICAgICAgICBva0lmKElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQoaW5wdXQudGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cy5zdGFydERhdGUpIHx8IElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQoaW5wdXQudGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cy5lbmREYXRlKSk7XG4gICAgICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuYWN0aW9uSXNTZXRPclVuZGVmaW5lZChpbnB1dC5hY3Rpb24sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCkgfHwgSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2goaW5wdXQuYWN0aW9uLCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5jaGFuZ2UpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlQ2hhbmdlVmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpOyB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lIHdoZXRoZXIgdGhlIGlucHV0IGFjdGlvbiBpcyB0YXJnZXRpbmcgZGF0ZSByYW5nZVxuICAgICAqXG4gICAgICogRS5HLiAnQ2hhbmdlJywgJ0NoYW5nZSBkYXRlJ1xuICAgICAqL1xuICAgIHByaXZhdGUgaXNDaGFuZ2VSYW5nZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0ludGVudChpbnB1dCwgR2VuZXJhbENvbnRyb2xJbnRlbnQubmFtZSkpO1xuICAgICAgICAgICAgY29uc3QgaW50ZW50ID0gKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50O1xuICAgICAgICAgICAgY29uc3QgdW5wYWNrZWRTbG90cyA9IHVucGFja0dlbmVyYWxDb250cm9sSW50ZW50KGludGVudCk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzTWF0Y2hPclVuZGVmaW5lZCh1bnBhY2tlZFNsb3RzLmZlZWRiYWNrLCBbJC5GZWVkYmFjay5BZmZpcm0sICQuRmVlZGJhY2suRGlzYWZmaXJtXSkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHVucGFja2VkU2xvdHMudGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cy5zZWxmKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUNoYW5nZVZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTsgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaXNDb25maXJtYXRpb25BZmZpcm1lZChpbnB1dDogQ29udHJvbElucHV0KTogYW55IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzQmFyZVllcyhpbnB1dCkpO1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLmlzQ29uZmlybWluZ1JhbmdlKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlQ29uZmlybWF0aW9uQWZmaXJtZWQ7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlQ29uZmlybWF0aW9uQWZmaXJtZWQoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5pc1ZhbHVlQ29uZmlybWVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdGF0ZS5pc0NvbmZpcm1pbmdSYW5nZSA9IGZhbHNlO1xuICAgICAgICAvLyBJZiB0aGUgZGF0ZSByYW5nZSBpcyBjb25maXJtZWQgaW4gcGFyZW50XG4gICAgICAgIC8vIHVwZGF0ZSBjaGlsZHJlbidzIHN0YXR1cyB0byBhdm9pZCBkdXBsaWNhdGUgY29uZmlybWF0aW9uXG4gICAgICAgIHRoaXMuc3RhcnREYXRlQ29udHJvbC5zdGF0ZS5pc1ZhbHVlQ29uZmlybWVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5lbmREYXRlQ29udHJvbC5zdGF0ZS5pc1ZhbHVlQ29uZmlybWVkID0gdHJ1ZTtcbiAgICAgICAgY29uc3QgYWN0UGF5bG9hZCA9IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfU1RBVEVfVkFMVUVfRk9SX1NUQVJUX0FORF9FTkQnLCB7IHN0YXJ0OiB0aGlzLnN0YXRlLnN0YXJ0RGF0ZSwgZW5kOiB0aGlzLnN0YXRlLmVuZERhdGUgfSk7XG4gICAgICAgIGlmICh0aGlzLndhbnRzVG9Db3JyZWN0UmFuZ2UoaW5wdXQpKSB7XG4gICAgICAgICAgICB0aGlzLmNvcnJlY3RSYW5nZShpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QoXG4gICAgICAgICAgICBuZXcgVmFsdWVDb25maXJtZWRBY3QodGhpcywgeyB2YWx1ZTogYWN0UGF5bG9hZCB9KVxuICAgICAgICApO1xuICAgICAgICB0aGlzLmFja0RhdGVSYW5nZVZhbHVlQ2hhbmdlZChyZXN1bHRCdWlsZGVyKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzQ29uZmlybWF0aW9uRGlzQWZmaXJtZWQoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGFueSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0JhcmVObyhpbnB1dCkpO1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLmlzQ29uZmlybWluZ1JhbmdlID09PSB0cnVlKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlQ29uZmlybWF0aW9uRGlzQWZmaXJtZWQ7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlQ29uZmlybWF0aW9uRGlzQWZmaXJtZWQoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5pc1ZhbHVlQ29uZmlybWVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3RhdGUuaXNDb25maXJtaW5nUmFuZ2UgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgYWN0UGF5bG9hZCA9IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfU1RBVEVfVkFMVUVfRk9SX1NUQVJUX0FORF9FTkQnLCB7IHN0YXJ0OiB0aGlzLnN0YXRlLnN0YXJ0RGF0ZSwgZW5kOiB0aGlzLnN0YXRlLmVuZERhdGUgfSk7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBWYWx1ZURpc2NvbmZpcm1lZEFjdCh0aGlzLCB7dmFsdWU6IGFjdFBheWxvYWR9KSk7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBSZXF1ZXN0VmFsdWVBY3QodGhpcykpO1xuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlQ2hhbmdlVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcblxuICAgICAgICB0aGlzLnN0YXRlLmlzQ2hhbmdpbmdSYW5nZSA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RhdGUub25Gb2N1cyA9IHRydWU7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBSZXF1ZXN0VmFsdWVBY3QodGhpcykpO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBwcmlvckVuZERhdGUgJiBwcmlvclN0YXJ0RGF0ZVxuICAgIHByaXZhdGUgdXBkYXRlUHJpb3IoKTogdm9pZCB7XG4gICAgICAgIC8vIE9ubHkgdXBkYXRlIHByaW9yIGlmIGl0J3Mgbm90IGluIGNvbmZpcm1pbmcgcmFuZ2Ugc3RhdHVzXG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5pc0NvbmZpcm1pbmdSYW5nZSkge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS5wcmV2aW91c0VuZERhdGUgPSB0aGlzLnN0YXRlLmVuZERhdGU7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnByZXZpb3VzU3RhcnREYXRlID0gdGhpcy5zdGF0ZS5zdGFydERhdGU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGFja0RhdGVSYW5nZVZhbHVlQ2hhbmdlZChyZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICAvLyBUaGUgRGF0ZVJhbmdlQ29udHJvbCBvbmx5IGFjayBkYXRlIHJhbmdlIGNoYW5nZXNcbiAgICAgICAgLy8gT25seSBzdGFydCBkYXRlIGNoYW5nZSBvciBlbmQgZGF0ZSBjaGFuZ2Ugd2lsbCBiZSBoYW5kbGVkIGJ5IENoaWxkIGNvbnRyb2xzXG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnN0YXJ0RGF0ZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMuc3RhdGUuZW5kRGF0ZSAhPT0gdW5kZWZpbmVkICYmICh0aGlzLnN0YXRlLnN0YXJ0RGF0ZSAhPT0gdGhpcy5zdGF0ZS5wcmV2aW91c1N0YXJ0RGF0ZSAmJiB0aGlzLnN0YXRlLmVuZERhdGUgIT09IHRoaXMuc3RhdGUucHJldmlvdXNFbmREYXRlKSkge1xuICAgICAgICAgICAgLy8gSWYgaXQncyB0aGUgZmlyc3QgdGltZSB0byBzZXQgdGhlIHZhbHVlLCBEYXRlUmFuZ2VDb250cm9sIHdpbGwgc2VuZCBEYXRlUmFuZ2VTZXRBY3RcbiAgICAgICAgICAgIC8vIEFuZCB3aGVuIHRoZXJlJ3MgYW4gb2xkIHZhbHVlIGV4aXN0LCBEYXRlUmFuZ2VDb250cm9sIHdpbGwgc2VuZCBEYXRlUmFuZ2VDaGFuZ2VkQWN0XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnByZXZpb3VzU3RhcnREYXRlICE9PSB1bmRlZmluZWQgJiYgdGhpcy5zdGF0ZS5wcmV2aW91c0VuZERhdGUgIT09IHVuZGVmaW5lZCA/XG4gICAgICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IERhdGVSYW5nZUNoYW5nZWRBY3QodGhpcywgdGhpcy5zdGF0ZS5zdGFydERhdGUsIHRoaXMuc3RhdGUuZW5kRGF0ZSwgdGhpcy5zdGF0ZS5wcmV2aW91c1N0YXJ0RGF0ZSwgdGhpcy5zdGF0ZS5wcmV2aW91c0VuZERhdGUpKSA6XG4gICAgICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IERhdGVSYW5nZVNldEFjdCh0aGlzLCB0aGlzLnN0YXRlLnN0YXJ0RGF0ZSwgdGhpcy5zdGF0ZS5lbmREYXRlKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHZhbGlkYXRlRGF0ZVJhbmdlKGlucHV0OiBDb250cm9sSW5wdXQpOiB0cnVlIHwgVmFsaWRhdGlvblJlc3VsdCB7XG4gICAgICAgIGNvbnN0IGxpc3RPZlZhbGlkYXRpb25GdW5jOiBEYXRlUmFuZ2VWYWxpZGF0aW9uRnVuY3Rpb25bXSA9IHR5cGVvZih0aGlzLnByb3BzLnZhbGlkYXRpb24ucmFuZ2VWYWxpZCkgPT09ICdmdW5jdGlvbicgPyBbdGhpcy5wcm9wcy52YWxpZGF0aW9uLnJhbmdlVmFsaWRdIDogdGhpcy5wcm9wcy52YWxpZGF0aW9uLnJhbmdlVmFsaWQ7XG4gICAgICAgIGZvciAoY29uc3QgdmFsaWRhdGlvbkZ1bmN0aW9uIG9mIGxpc3RPZlZhbGlkYXRpb25GdW5jKSB7XG4gICAgICAgICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0OiB0cnVlIHwgVmFsaWRhdGlvblJlc3VsdCA9IHZhbGlkYXRpb25GdW5jdGlvbih0aGlzLnN0YXRlLCBpbnB1dCk7XG4gICAgICAgICAgICBpZiAodmFsaWRhdGlvblJlc3VsdCAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyhgRGF0ZVJhbmdlQ29udHJvbC52YWxpZGF0ZSgpOiB2YWxpZGF0aW9uIGZhaWxlZC4gUmVhc29uOiAke0pTT04uc3RyaW5naWZ5KHZhbGlkYXRpb25SZXN1bHQsIG51bGwsIDIpfS5gKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsaWRhdGlvblJlc3VsdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cblxuICAgIC8vIHRzRG9jIC0gc2VlIENvbnRyb2xcbiAgICByZW5kZXJBY3QoYWN0OiBTeXN0ZW1BY3QsIGlucHV0OiBDb250cm9sSW5wdXQsIGJ1aWxkZXI6IENvbnRyb2xSZXNwb25zZUJ1aWxkZXIpOiB2b2lkIHtcblxuICAgICAgICBpZiAoYWN0IGluc3RhbmNlb2YgUmVxdWVzdFZhbHVlQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnJlcXVlc3RWYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnJlcXVlc3RWYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGFjdCBpbnN0YW5jZW9mIERhdGVSYW5nZVNldEFjdCkge1xuICAgICAgICAgICAgYnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucHJvbXB0cy52YWx1ZVNldCwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnZhbHVlU2V0LCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgRGF0ZVJhbmdlQ2hhbmdlZEFjdCkge1xuICAgICAgICAgICAgYnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucHJvbXB0cy52YWx1ZUNoYW5nZWQsIGlucHV0KSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnJlcHJvbXB0cy52YWx1ZUNoYW5nZWQsIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBJbnZhbGlkVmFsdWVBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMuaW52YWxpZFZhbHVlLCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMuaW52YWxpZFZhbHVlLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgQ29uZmlybVZhbHVlQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLmNvbmZpcm1WYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLmNvbmZpcm1WYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGFjdCBpbnN0YW5jZW9mIFZhbHVlQ29uZmlybWVkQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnZhbHVlQWZmaXJtZWQsIGlucHV0KSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnJlcHJvbXB0cy52YWx1ZUFmZmlybWVkLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgVmFsdWVEaXNjb25maXJtZWRBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMudmFsdWVEaXNhZmZpcm1lZCwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnZhbHVlRGlzYWZmaXJtZWQsIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudGhyb3dVbmhhbmRsZWRBY3RFcnJvcihhY3QpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gdHNEb2MgLSBzZWUgQ29udHJvbFxuICAgIGFzeW5jIGNhblRha2VJbml0aWF0aXZlKGlucHV0OiBDb250cm9sSW5wdXQpOiBQcm9taXNlPGJvb2xlYW4+IHtcblxuICAgICAgICByZXR1cm4gdGhpcy5uZWVkc1ZhbHVlKGlucHV0KVxuICAgICAgICAgICAgfHwgYXdhaXQgdGhpcy5jYW5UYWtlSW5pdGlhdGl2ZUJ5Q2hpbGQoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmlzQ2hhbmdpbmdSYW5nZSgpXG4gICAgICAgICAgICB8fCB0aGlzLndhbnRzVG9Db3JyZWN0UmFuZ2UoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLndhbnRzVG9Db25maXJtUmFuZ2UoaW5wdXQpO1xuICAgIH1cblxuICAgIC8vIHRzRG9jIC0gc2VlIENvbnRyb2xcbiAgICBhc3luYyB0YWtlSW5pdGlhdGl2ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBsb2cuZGVidWcoYERhdGVSYW5nZUNvbnRyb2xbJHt0aGlzLmlkfV06IHRha2VJbml0aWF0aXZlKCkuIEVudGVyaW5nYCk7XG4gICAgICAgIGlmICh0aGlzLnRha2VJbml0aWF0aXZlRnVuYyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnRha2VJbml0aWF0aXZlRnVuYyhpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIG5lZWRzVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZih0aGlzLmV2YWx1YXRlQm9vbGVhblByb3AodGhpcy5wcm9wcy5yZXF1aXJlZCwgaW5wdXQpKTtcbiAgICAgICAgICAgIG9rSWYodGhpcy5zdGF0ZS5zdGFydERhdGUgPT09IHVuZGVmaW5lZCAmJiB0aGlzLnN0YXRlLmVuZERhdGUgPT09IHVuZGVmaW5lZCk7XG4gICAgICAgICAgICB0aGlzLnRha2VJbml0aWF0aXZlRnVuYyA9IHRoaXMucmVxdWVzdERhdGVSYW5nZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHJlcXVlc3REYXRlUmFuZ2UoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5vbkZvY3VzID0gdHJ1ZTtcbiAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IFJlcXVlc3RWYWx1ZUFjdCh0aGlzKSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0NoYW5naW5nUmFuZ2UoKTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKHRoaXMuc3RhdGUuaXNDaGFuZ2luZ1JhbmdlID09PSB0cnVlKTtcbiAgICAgICAgICAgIHRoaXMudGFrZUluaXRpYXRpdmVGdW5jID0gdGhpcy5yZXF1ZXN0RGF0ZVJhbmdlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTsgfVxuICAgIH1cblxuICAgIHByaXZhdGUgd2FudHNUb0NvcnJlY3RSYW5nZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBPbmx5IGZpeCByYW5nZSB3aGVuIHJhbmdlIGlzIHNldCBhbmQgdGhlcmUncyBubyBvcGVuIHF1ZXN0aW9uXG4gICAgICAgICAgICBva0lmKCF0aGlzLm5lZWRzVmFsdWUoaW5wdXQpICYmICF0aGlzLnN0YXRlLmlzQ2hhbmdpbmdSYW5nZSk7XG4gICAgICAgICAgICBjb25zdCByYW5nZVZhbGlkYXRpb25SZXN1bHQ6IHRydWUgfCBWYWxpZGF0aW9uUmVzdWx0ID0gdGhpcy52YWxpZGF0ZURhdGVSYW5nZShpbnB1dCk7XG4gICAgICAgICAgICBva0lmKHJhbmdlVmFsaWRhdGlvblJlc3VsdCAhPT0gdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLnRha2VJbml0aWF0aXZlRnVuYyA9IHRoaXMuY29ycmVjdFJhbmdlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTsgfVxuICAgIH1cblxuICAgIHByaXZhdGUgY29ycmVjdFJhbmdlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHJhbmdlVmFsaWRhdGlvblJlc3VsdDogdHJ1ZSB8IFZhbGlkYXRpb25SZXN1bHQgPSB0aGlzLnZhbGlkYXRlRGF0ZVJhbmdlKGlucHV0KTtcbiAgICAgICAgdGhpcy5zdGF0ZS5vbkZvY3VzID0gdHJ1ZTtcbiAgICAgICAgaWYgKHJhbmdlVmFsaWRhdGlvblJlc3VsdCAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgY29uc3QgYWN0UGF5bG9hZCA9IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfU1RBVEVfVkFMVUVfRk9SX1NUQVJUX0FORF9FTkQnLCB7IHN0YXJ0OiB0aGlzLnN0YXRlLnN0YXJ0RGF0ZSwgZW5kOiB0aGlzLnN0YXRlLmVuZERhdGUgfSk7XG4gICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgSW52YWxpZFZhbHVlQWN0PHN0cmluZz4odGhpcywge3ZhbHVlOiBhY3RQYXlsb2FkLCByZWFzb25Db2RlOiByYW5nZVZhbGlkYXRpb25SZXN1bHQucmVhc29uQ29kZSwgcmVuZGVyZWRSZWFzb246IHJhbmdlVmFsaWRhdGlvblJlc3VsdC5yZW5kZXJlZFJlYXNvbiB9KSk7XG4gICAgICAgICAgICAvLyBpZiB0aGUgcmFuZ2UtdmFsaWRhdGlvbiBmYWlsdXJlIGlzIGR1ZSB0byBvbmUgZGF0ZSBjaGFuZ2luZywgb25seSByZXF1ZXN0IHRoYXQgb25lXG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5zdGFydERhdGUgIT09IHRoaXMuc3RhdGUucHJldmlvdXNTdGFydERhdGUgJiYgdGhpcy5zdGF0ZS5lbmREYXRlICE9PSB0aGlzLnN0YXRlLnByZXZpb3VzRW5kRGF0ZSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBSZXF1ZXN0VmFsdWVBY3QodGhpcykpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnN0YXRlLnN0YXJ0RGF0ZSAhPT0gdGhpcy5zdGF0ZS5wcmV2aW91c1N0YXJ0RGF0ZSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBSZXF1ZXN0VmFsdWVBY3QodGhpcy5zdGFydERhdGVDb250cm9sKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBSZXF1ZXN0VmFsdWVBY3QodGhpcy5lbmREYXRlQ29udHJvbCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB3YW50c1RvQ29uZmlybVJhbmdlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYodGhpcy5wcm9wcy5jb25maXJtYXRpb25SZXF1aXJlZCA9PT0gdHJ1ZSk7XG4gICAgICAgICAgICBva0lmKHRoaXMuc3RhdGUuaXNWYWx1ZUNvbmZpcm1lZCA9PT0gZmFsc2UpO1xuICAgICAgICAgICAgdGhpcy50YWtlSW5pdGlhdGl2ZUZ1bmMgPSB0aGlzLmNvbmZpcm1WYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGNvbmZpcm1WYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICB0aGlzLnN0YXRlLmlzQ29uZmlybWluZ1JhbmdlID0gdHJ1ZTtcbiAgICAgICAgY29uc3QgYWN0UGF5bG9hZCA9IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfU1RBVEVfVkFMVUVfRk9SX1NUQVJUX0FORF9FTkQnLCB7IHN0YXJ0OiB0aGlzLnN0YXRlLnN0YXJ0RGF0ZSwgZW5kOiB0aGlzLnN0YXRlLmVuZERhdGUgfSk7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBDb25maXJtVmFsdWVBY3QodGhpcywgeyB2YWx1ZTogYWN0UGF5bG9hZCB9KSk7XG4gICAgfVxuXG4gICAgLy8gdHNEb2MgLSBzZWUgQ29udGFpbmVyQ29udHJvbFxuICAgIGFzeW5jIGNhblRha2VJbml0aWF0aXZlQnlDaGlsZChpbnB1dDogQ29udHJvbElucHV0KTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKGF3YWl0IHN1cGVyLmNhblRha2VJbml0aWF0aXZlQnlDaGlsZChpbnB1dCkpO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS5vbkZvY3VzID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnRha2VJbml0aWF0aXZlRnVuYyA9IHRoaXMudGFrZUluaXRpYXRpdmVCeUNoaWxkO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTsgfVxuICAgIH1cbn1cbiJdfQ==