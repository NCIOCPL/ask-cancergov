"use strict";
/*
 * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.SingleValueControlIntent = exports.unpackSingleValueControlIntent = void 0;
const ModelTypes_1 = require("../interactionModelGeneration/ModelTypes");
const IntentUtils_1 = require("../utils/IntentUtils");
const BaseControlIntent_1 = require("./BaseControlIntent");
/**
 * Unpacks the complete intent object into a simpler representation.
 *
 * Note re "empty slots":
 * - Slots in the intent with no value appear in the intent object as "".
 *   However, these are unpacked as **`undefined`** to be more explicit and ease
 *   the implementation of predicates.
 * @param intent - Intent
 */
function unpackSingleValueControlIntent(intent) {
    if (!intent.name.endsWith('ControlIntent')) {
        throw new Error(`Not a ControlIntent: ${intent.name}`);
    }
    let action;
    let feedback;
    let target;
    let valueStr;
    let valueType;
    let erMatch;
    for (const [name, slot] of Object.entries(intent.slots)) {
        const slotObject = IntentUtils_1.getSlotResolutions(slot);
        const slotValue = slotObject !== undefined ? slotObject.slotValue : undefined;
        switch (name) {
            case 'action':
                action = slotValue;
                break;
            case 'feedback':
                feedback = slotValue;
                break;
            case 'target':
                target = slotValue;
                break;
            case 'head': break;
            case 'tail': break;
            case 'preposition': break;
            default:
                // did we already capture a value?
                if (valueType !== undefined) {
                    throw new Error('a SingleValueControlIntent should only have one value slot');
                }
                // treat it as a slot whose name is an NLU slot type.
                valueStr = slotValue;
                valueType = name;
                erMatch = slotObject !== undefined ? slotObject.isEntityResolutionMatch : undefined;
        }
    }
    if (valueStr === undefined) {
        throw new Error(`SingleValueControlIntent did not have value slot filled.  This should have mapped to GeneralControlIntent. intent: ${JSON.stringify(intent)}`);
    }
    return {
        feedback,
        action,
        target,
        valueStr,
        valueType,
        erMatch
    };
}
exports.unpackSingleValueControlIntent = unpackSingleValueControlIntent;
/**
 * Intent that conveys feedback, action, target and an AMAZON.Ordinal value
 *
 * The value slot will be named according to the Slot type.
 * - For example `{'AMAZON.NUMBER': '2'}` or  `{ 'AMAZON.Ordinal': 'first' }`
 *
 * Every sample utterance for a SingleValueControlIntent includes the value
 * slot.  Utterances that do not include a value slot are handled by
 * `GeneralControlIntent`.
 *
 * Limitations
 *  - `AMAZON.SearchQuery` cannot be used due to restrictions in NLU. Custom
 *    intents should be defined instead.
 */
class SingleValueControlIntent extends BaseControlIntent_1.BaseControlIntent {
    constructor(valueSlotType) {
        super();
        if (valueSlotType === 'AMAZON.SearchQuery') {
            throw new Error('AMAZON.SearchQuery cannot be used with SingleValueControlIntent due to the special rules regarding its use. '
                + 'Specifically, utterances that include SearchQuery must have a carrier phrase and not be comprised entirely of slot references.');
        }
        this.valueSlotType = valueSlotType;
        this.name = SingleValueControlIntent.intentName(valueSlotType);
    }
    /**
     * Generates the intent name of a specialized `SingleValueControlIntent`.
     *
     * Example:
     * - The intent name for a `SingleValueControlIntent` that conveys an
     *   `AMAZON.NUMBER` is `AMAZON_NUMBER_ValueControlIntent`.
     *
     * @param slotTypeId - Specific slot type id.
     */
    static intentName(slotTypeId) {
        return `${slotTypeId}_ValueControlIntent`.replace('.', '_');
    }
    /**
     * Create Intent from specification of the slots
     *
     * Usage:
     *  * the value should be provided as a property with name = <SlotType>
     *
     * Examples:
     * - AMAZON.NUMBER:
     * ```
     * {
     *    name: AMAZON_NUMBER_ValueControlIntent
     *    slots: { target: 'count', 'AMAZON.NUMBER': '2' }
     *    confirmationStatus: 'NONE'
     * }
     * ```
     * - AMAZON.Ordinal:
     * ```
     * {
     *    name: AMAZON_ORDINAL_ValueControlIntent
     *    slots: { action: 'set', 'AMAZON.Ordinal': 'first'}
     *    confirmationStatus: 'NONE'
     * }
     * ```
     */
    static of(slotType, slots) {
        return IntentUtils_1.IntentBuilder.of(SingleValueControlIntent.intentName(slotType), slots);
    }
    // tsDoc: see BaseControlIntent
    generateIntent() {
        return {
            name: this.name,
            slots: this.generateSlots(),
            samples: [],
        };
    }
    generateSlots() {
        const slots = [
            {
                name: 'feedback',
                type: ModelTypes_1.SharedSlotType.FEEDBACK
            },
            {
                name: 'action',
                type: ModelTypes_1.SharedSlotType.ACTION
            },
            {
                name: 'target',
                type: ModelTypes_1.SharedSlotType.TARGET
            },
            {
                name: 'preposition',
                type: ModelTypes_1.SharedSlotType.PREPOSITION
            },
            {
                name: 'head',
                type: ModelTypes_1.SharedSlotType.HEAD
            },
            {
                name: 'tail',
                type: ModelTypes_1.SharedSlotType.TAIL
            },
            {
                name: `${this.valueSlotType}`,
                type: `${this.valueSlotType}`
            }
        ];
        return slots;
    }
}
exports.SingleValueControlIntent = SingleValueControlIntent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2luZ2xlVmFsdWVDb250cm9sSW50ZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2ludGVudHMvU2luZ2xlVmFsdWVDb250cm9sSW50ZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7R0FXRzs7O0FBSUgseUVBQTBFO0FBQzFFLHNEQUF5RTtBQUN6RSwyREFBd0Q7QUFzQnhEOzs7Ozs7OztHQVFHO0FBQ0gsU0FBZ0IsOEJBQThCLENBQUMsTUFBYztJQUN6RCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLEVBQUU7UUFDeEMsTUFBTSxJQUFJLEtBQUssQ0FBQyx3QkFBd0IsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7S0FDMUQ7SUFFRCxJQUFJLE1BQTBCLENBQUM7SUFDL0IsSUFBSSxRQUE0QixDQUFDO0lBQ2pDLElBQUksTUFBMEIsQ0FBQztJQUMvQixJQUFJLFFBQTRCLENBQUM7SUFDakMsSUFBSSxTQUE2QixDQUFDO0lBQ2xDLElBQUksT0FBNEIsQ0FBQztJQUVqQyxLQUFLLE1BQU0sQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBTSxDQUFDLEVBQUU7UUFDdEQsTUFBTSxVQUFVLEdBQUcsZ0NBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUMsTUFBTSxTQUFTLEdBQUcsVUFBVSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO1FBRTlFLFFBQVEsSUFBSSxFQUFFO1lBQ1YsS0FBSyxRQUFRO2dCQUFFLE1BQU0sR0FBRyxTQUFTLENBQUM7Z0JBQUMsTUFBTTtZQUN6QyxLQUFLLFVBQVU7Z0JBQUUsUUFBUSxHQUFHLFNBQVMsQ0FBQztnQkFBQyxNQUFNO1lBQzdDLEtBQUssUUFBUTtnQkFBRSxN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QUFFO2dCQUM3QixJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFO2FBQ2hDO1NBQ0osQ0FBQztRQUVGLE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7Q0FDSjtBQXRHRCw0REFzR0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMjAgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuXG4gKiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBvciBpbiB0aGUgXCJsaWNlbnNlXCIgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWRcbiAqIG9uIGFuIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlclxuICogZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmdcbiAqIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBJbnRlbnQgfSBmcm9tIFwiYXNrLXNkay1tb2RlbFwiO1xuaW1wb3J0IHsgdjEgfSBmcm9tICdhc2stc21hcGktbW9kZWwnO1xuaW1wb3J0IHsgU2hhcmVkU2xvdFR5cGUgfSBmcm9tICcuLi9pbnRlcmFjdGlvbk1vZGVsR2VuZXJhdGlvbi9Nb2RlbFR5cGVzJztcbmltcG9ydCB7IGdldFNsb3RSZXNvbHV0aW9ucywgSW50ZW50QnVpbGRlciB9IGZyb20gJy4uL3V0aWxzL0ludGVudFV0aWxzJztcbmltcG9ydCB7IEJhc2VDb250cm9sSW50ZW50IH0gZnJvbSAnLi9CYXNlQ29udHJvbEludGVudCc7XG5cblxuLyoqXG4gKiBTbG90IHZhbHVlcyBjb252ZXllZCBieSBhIFNpbmdsZVZhbHVlQ29udHJvbEludGVudFxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNpbmdsZVZhbHVlQ29udHJvbEludGVudFNsb3RzIHtcbiAgICBmZWVkYmFjaz86IHN0cmluZztcbiAgICBhY3Rpb24/OiBzdHJpbmc7XG4gICAgdGFyZ2V0Pzogc3RyaW5nO1xuICAgIFtrZXk6IHN0cmluZ106IHN0cmluZyB8IHVuZGVmaW5lZDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTaW5nbGVWYWx1ZVBheWxvYWQge1xuICAgIGZlZWRiYWNrPzogc3RyaW5nO1xuICAgIGFjdGlvbj86IHN0cmluZztcbiAgICB0YXJnZXQ/OiBzdHJpbmc7XG4gICAgdmFsdWVTdHI6IHN0cmluZztcbiAgICB2YWx1ZVR5cGU/OiBzdHJpbmc7XG4gICAgZXJNYXRjaD86IGJvb2xlYW47XG59XG5cbi8qKlxuICogVW5wYWNrcyB0aGUgY29tcGxldGUgaW50ZW50IG9iamVjdCBpbnRvIGEgc2ltcGxlciByZXByZXNlbnRhdGlvbi5cbiAqXG4gKiBOb3RlIHJlIFwiZW1wdHkgc2xvdHNcIjpcbiAqIC0gU2xvdHMgaW4gdGhlIGludGVudCB3aXRoIG5vIHZhbHVlIGFwcGVhciBpbiB0aGUgaW50ZW50IG9iamVjdCBhcyBcIlwiLlxuICogICBIb3dldmVyLCB0aGVzZSBhcmUgdW5wYWNrZWQgYXMgKipgdW5kZWZpbmVkYCoqIHRvIGJlIG1vcmUgZXhwbGljaXQgYW5kIGVhc2VcbiAqICAgdGhlIGltcGxlbWVudGF0aW9uIG9mIHByZWRpY2F0ZXMuXG4gKiBAcGFyYW0gaW50ZW50IC0gSW50ZW50XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoaW50ZW50OiBJbnRlbnQpOiBTaW5nbGVWYWx1ZVBheWxvYWQge1xuICAgIGlmICghaW50ZW50Lm5hbWUuZW5kc1dpdGgoJ0NvbnRyb2xJbnRlbnQnKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vdCBhIENvbnRyb2xJbnRlbnQ6ICR7aW50ZW50Lm5hbWV9YCk7XG4gICAgfVxuXG4gICAgbGV0IGFjdGlvbjogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgIGxldCBmZWVkYmFjazogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgIGxldCB0YXJnZXQ6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICBsZXQgdmFsdWVTdHI6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICBsZXQgdmFsdWVUeXBlOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgbGV0IGVyTWF0Y2g6IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG5cbiAgICBmb3IgKGNvbnN0IFtuYW1lLCBzbG90XSBvZiBPYmplY3QuZW50cmllcyhpbnRlbnQuc2xvdHMhKSkge1xuICAgICAgICBjb25zdCBzbG90T2JqZWN0ID0gZ2V0U2xvdFJlc29sdXRpb25zKHNsb3QpO1xuICAgICAgICBjb25zdCBzbG90VmFsdWUgPSBzbG90T2JqZWN0ICE9PSB1bmRlZmluZWQgPyBzbG90T2JqZWN0LnNsb3RWYWx1ZSA6IHVuZGVmaW5lZDtcblxuICAgICAgICBzd2l0Y2ggKG5hbWUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2FjdGlvbic6IGFjdGlvbiA9IHNsb3RWYWx1ZTsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdmZWVkYmFjayc6IGZlZWRiYWNrID0gc2xvdFZhbHVlOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RhcmdldCc6IHRhcmdldCA9IHNsb3RWYWx1ZTsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdoZWFkJzogYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd0YWlsJzogYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdwcmVwb3NpdGlvbic6IGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAvLyBkaWQgd2UgYWxyZWFkeSBjYXB0dXJlIGEgdmFsdWU/XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlVHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignYSBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQgc2hvdWxkIG9ubHkgaGF2ZSBvbmUgdmFsdWUgc2xvdCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyB0cmVhdCBpdCBhcyBhIHNsb3Qgd2hvc2UgbmFtZSBpcyBhbiBOTFUgc2xvdCB0eXBlLlxuICAgICAgICAgICAgICAgIHZhbHVlU3RyID0gc2xvdFZhbHVlO1xuICAgICAgICAgICAgICAgIHZhbHVlVHlwZSA9IG5hbWU7XG4gICAgICAgICAgICAgICAgZXJNYXRjaCA9IHNsb3RPYmplY3QgIT09IHVuZGVmaW5lZCA/IHNsb3RPYmplY3QuaXNFbnRpdHlSZXNvbHV0aW9uTWF0Y2ggOiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodmFsdWVTdHIgPT09IHVuZGVmaW5lZCl7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgU2luZ2xlVmFsdWVDb250cm9sSW50ZW50IGRpZCBub3QgaGF2ZSB2YWx1ZSBzbG90IGZpbGxlZC4gIFRoaXMgc2hvdWxkIGhhdmUgbWFwcGVkIHRvIEdlbmVyYWxDb250cm9sSW50ZW50LiBpbnRlbnQ6ICR7SlNPTi5zdHJpbmdpZnkoaW50ZW50KX1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBmZWVkYmFjayxcbiAgICAgICAgYWN0aW9uLFxuICAgICAgICB0YXJnZXQsXG4gICAgICAgIHZhbHVlU3RyLFxuICAgICAgICB2YWx1ZVR5cGUsXG4gICAgICAgIGVyTWF0Y2hcbiAgICB9O1xufVxuXG4vKipcbiAqIEludGVudCB0aGF0IGNvbnZleXMgZmVlZGJhY2ssIGFjdGlvbiwgdGFyZ2V0IGFuZCBhbiBBTUFaT04uT3JkaW5hbCB2YWx1ZVxuICpcbiAqIFRoZSB2YWx1ZSBzbG90IHdpbGwgYmUgbmFtZWQgYWNjb3JkaW5nIHRvIHRoZSBTbG90IHR5cGUuXG4gKiAtIEZvciBleGFtcGxlIGB7J0FNQVpPTi5OVU1CRVInOiAnMid9YCBvciAgYHsgJ0FNQVpPTi5PcmRpbmFsJzogJ2ZpcnN0JyB9YFxuICpcbiAqIEV2ZXJ5IHNhbXBsZSB1dHRlcmFuY2UgZm9yIGEgU2luZ2xlVmFsdWVDb250cm9sSW50ZW50IGluY2x1ZGVzIHRoZSB2YWx1ZVxuICogc2xvdC4gIFV0dGVyYW5jZXMgdGhhdCBkbyBub3QgaW5jbHVkZSBhIHZhbHVlIHNsb3QgYXJlIGhhbmRsZWQgYnlcbiAqIGBHZW5lcmFsQ29udHJvbEludGVudGAuXG4gKlxuICogTGltaXRhdGlvbnNcbiAqICAtIGBBTUFaT04uU2VhcmNoUXVlcnlgIGNhbm5vdCBiZSB1c2VkIGR1ZSB0byByZXN0cmljdGlvbnMgaW4gTkxVLiBDdXN0b21cbiAqICAgIGludGVudHMgc2hvdWxkIGJlIGRlZmluZWQgaW5zdGVhZC5cbiAqL1xuZXhwb3J0IGNsYXNzIFNpbmdsZVZhbHVlQ29udHJvbEludGVudCBleHRlbmRzIEJhc2VDb250cm9sSW50ZW50IHtcbiAgICB2YWx1ZVNsb3RUeXBlOiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3Rvcih2YWx1ZVNsb3RUeXBlOiBzdHJpbmcpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICBpZiAodmFsdWVTbG90VHlwZSA9PT0gJ0FNQVpPTi5TZWFyY2hRdWVyeScpe1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBTUFaT04uU2VhcmNoUXVlcnkgY2Fubm90IGJlIHVzZWQgd2l0aCBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQgZHVlIHRvIHRoZSBzcGVjaWFsIHJ1bGVzIHJlZ2FyZGluZyBpdHMgdXNlLiAnXG4gICAgICAgICAgICAgKyAnU3BlY2lmaWNhbGx5LCB1dHRlcmFuY2VzIHRoYXQgaW5jbHVkZSBTZWFyY2hRdWVyeSBtdXN0IGhhdmUgYSBjYXJyaWVyIHBocmFzZSBhbmQgbm90IGJlIGNvbXByaXNlZCBlbnRpcmVseSBvZiBzbG90IHJlZmVyZW5jZXMuJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnZhbHVlU2xvdFR5cGUgPSB2YWx1ZVNsb3RUeXBlO1xuICAgICAgICB0aGlzLm5hbWUgPSBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQuaW50ZW50TmFtZSh2YWx1ZVNsb3RUeXBlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZW5lcmF0ZXMgdGhlIGludGVudCBuYW1lIG9mIGEgc3BlY2lhbGl6ZWQgYFNpbmdsZVZhbHVlQ29udHJvbEludGVudGAuXG4gICAgICpcbiAgICAgKiBFeGFtcGxlOlxuICAgICAqIC0gVGhlIGludGVudCBuYW1lIGZvciBhIGBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnRgIHRoYXQgY29udmV5cyBhblxuICAgICAqICAgYEFNQVpPTi5OVU1CRVJgIGlzIGBBTUFaT05fTlVNQkVSX1ZhbHVlQ29udHJvbEludGVudGAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gc2xvdFR5cGVJZCAtIFNwZWNpZmljIHNsb3QgdHlwZSBpZC5cbiAgICAgKi9cbiAgICBzdGF0aWMgaW50ZW50TmFtZShzbG90VHlwZUlkOiBzdHJpbmcpe1xuICAgICAgICByZXR1cm4gYCR7c2xvdFR5cGVJZH1fVmFsdWVDb250cm9sSW50ZW50YC5yZXBsYWNlKCcuJywgJ18nKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgSW50ZW50IGZyb20gc3BlY2lmaWNhdGlvbiBvZiB0aGUgc2xvdHNcbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqICAqIHRoZSB2YWx1ZSBzaG91bGQgYmUgcHJvdmlkZWQgYXMgYSBwcm9wZXJ0eSB3aXRoIG5hbWUgPSA8U2xvdFR5cGU+XG4gICAgICpcbiAgICAgKiBFeGFtcGxlczpcbiAgICAgKiAtIEFNQVpPTi5OVU1CRVI6XG4gICAgICogYGBgXG4gICAgICoge1xuICAgICAqICAgIG5hbWU6IEFNQVpPTl9OVU1CRVJfVmFsdWVDb250cm9sSW50ZW50XG4gICAgICogICAgc2xvdHM6IHsgdGFyZ2V0OiAnY291bnQnLCAnQU1BWk9OLk5VTUJFUic6ICcyJyB9XG4gICAgICogICAgY29uZmlybWF0aW9uU3RhdHVzOiAnTk9ORSdcbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICogLSBBTUFaT04uT3JkaW5hbDpcbiAgICAgKiBgYGBcbiAgICAgKiB7XG4gICAgICogICAgbmFtZTogQU1BWk9OX09SRElOQUxfVmFsdWVDb250cm9sSW50ZW50XG4gICAgICogICAgc2xvdHM6IHsgYWN0aW9uOiAnc2V0JywgJ0FNQVpPTi5PcmRpbmFsJzogJ2ZpcnN0J31cbiAgICAgKiAgICBjb25maXJtYXRpb25TdGF0dXM6ICdOT05FJ1xuICAgICAqIH1cbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBzdGF0aWMgb2Yoc2xvdFR5cGU6IHN0cmluZywgc2xvdHM6IFNpbmdsZVZhbHVlQ29udHJvbEludGVudFNsb3RzKTogSW50ZW50IHtcbiAgICAgICAgcmV0dXJuIEludGVudEJ1aWxkZXIub2YoXG4gICAgICAgICAgICBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQuaW50ZW50TmFtZShzbG90VHlwZSksIHNsb3RzXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gdHNEb2M6IHNlZSBCYXNlQ29udHJvbEludGVudFxuICAgIGdlbmVyYXRlSW50ZW50KCk6IHYxLnNraWxsLmludGVyYWN0aW9uTW9kZWwuSW50ZW50IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG5hbWU6IHRoaXMubmFtZSxcbiAgICAgICAgICAgIHNsb3RzOiB0aGlzLmdlbmVyYXRlU2xvdHMoKSxcbiAgICAgICAgICAgIHNhbXBsZXM6IFtdLFxuICAgICAgICB9O1xuICAgIH1cblxuXG4gICAgcHJpdmF0ZSBnZW5lcmF0ZVNsb3RzKCk6IHYxLnNraWxsLmludGVyYWN0aW9uTW9kZWwuU2xvdERlZmluaXRpb25bXSB7XG4gICAgICAgIGNvbnN0IHNsb3RzOiB2MS5za2lsbC5pbnRlcmFjdGlvbk1vZGVsLlNsb3REZWZpbml0aW9uW10gPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ2ZlZWRiYWNrJyxcbiAgICAgICAgICAgICAgICB0eXBlOiBTaGFyZWRTbG90VHlwZS5GRUVEQkFDS1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnYWN0aW9uJyxcbiAgICAgICAgICAgICAgICB0eXBlOiBTaGFyZWRTbG90VHlwZS5BQ1RJT05cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3RhcmdldCcsXG4gICAgICAgICAgICAgICAgdHlwZTogU2hhcmVkU2xvdFR5cGUuVEFSR0VUXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdwcmVwb3NpdGlvbicsXG4gICAgICAgICAgICAgICAgdHlwZTogU2hhcmVkU2xvdFR5cGUuUFJFUE9TSVRJT05cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ2hlYWQnLFxuICAgICAgICAgICAgICAgIHR5cGU6IFNoYXJlZFNsb3RUeXBlLkhFQURcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3RhaWwnLFxuICAgICAgICAgICAgICAgIHR5cGU6IFNoYXJlZFNsb3RUeXBlLlRBSUxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7dGhpcy52YWx1ZVNsb3RUeXBlfWAsXG4gICAgICAgICAgICAgICAgdHlwZTogYCR7dGhpcy52YWx1ZVNsb3RUeXBlfWBcbiAgICAgICAgICAgIH1cbiAgICAgICAgXTtcblxuICAgICAgICByZXR1cm4gc2xvdHM7XG4gICAgfVxufVxuIl19