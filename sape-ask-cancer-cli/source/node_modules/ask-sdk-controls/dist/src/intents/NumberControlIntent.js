"use strict";
/*
 * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.NumberControlIntent = exports.unpackNumberControlIntent = void 0;
const ModelTypes_1 = require("../interactionModelGeneration/ModelTypes");
const IntentUtils_1 = require("../utils/IntentUtils");
const AmazonBuiltInSlotType_1 = require("./AmazonBuiltInSlotType");
const BaseControlIntent_1 = require("./BaseControlIntent");
/**
 *
 *
 * empty slots are unpacked as 'undefined' to be more explicit about what is going on.
 * (this helps makes boolean tests in Controls more obvious and consistent)
 */
function unpackNumberControlIntent(intent) {
    if (!intent.name.startsWith('GeneralControlIntent') && !intent.name.startsWith('NumberControlIntent')) {
        throw new Error(`Not a compatible intent: ${intent.name}`);
    }
    let action;
    let feedback;
    let target;
    let valueStr;
    for (const [name, slot] of Object.entries(intent.slots)) {
        const slotObject = IntentUtils_1.getSlotResolutions(slot);
        const slotValue = slotObject ? slotObject.slotValue : undefined;
        switch (name) {
            case 'feedback':
                feedback = slotValue !== undefined ? slotValue : undefined;
                break;
            case 'action':
                action = slotValue !== undefined ? slotValue : undefined;
                break;
            case 'target':
                target = slotValue !== undefined ? slotValue : undefined;
                break;
            case 'AMAZON.NUMBER':
                valueStr = slotValue !== undefined ? slotValue : undefined;
                break;
            // default: ignore content-free slots
        }
    }
    return {
        feedback,
        action,
        target,
        'AMAZON.NUMBER': valueStr
    };
}
exports.unpackNumberControlIntent = unpackNumberControlIntent;
/**
 * Intent to capture an AMAZON.NUMBER, following the "ControlIntent" conventions
 */
class NumberControlIntent extends BaseControlIntent_1.BaseControlIntent {
    static of(slots) {
        return IntentUtils_1.IntentBuilder.of(this.prototype.constructor.name, slots);
    }
    generateIntent() {
        return {
            name: this.name,
            slots: this.generateSlots(),
            samples: [],
        };
    }
    generateSlots() {
        const slots = [
            {
                name: 'feedback',
                type: ModelTypes_1.SharedSlotType.FEEDBACK
            },
            {
                name: 'action',
                type: ModelTypes_1.SharedSlotType.ACTION
            },
            {
                name: 'target',
                type: ModelTypes_1.SharedSlotType.TARGET
            },
            {
                name: 'AMAZON.NUMBER',
                type: AmazonBuiltInSlotType_1.AmazonBuiltInSlotType.NUMBER
            },
            {
                name: 'preposition',
                type: ModelTypes_1.SharedSlotType.PREPOSITION
            },
            {
                name: 'head',
                type: ModelTypes_1.SharedSlotType.HEAD
            },
            {
                name: 'tail',
                type: ModelTypes_1.SharedSlotType.TAIL
            }
        ];
        return slots;
    }
    generateSlotTypes() {
        return [];
    }
}
exports.NumberControlIntent = NumberControlIntent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTnVtYmVyQ29udHJvbEludGVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9pbnRlbnRzL051bWJlckNvbnRyb2xJbnRlbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7OztHQVdHOzs7QUFJSCx5RUFBMEU7QUFDMUUsc0RBQXlFO0FBQ3pFLG1FQUFnRTtBQUNoRSwyREFBd0Q7QUFXeEQ7Ozs7O0dBS0c7QUFDSCxTQUFnQix5QkFBeUIsQ0FBQyxNQUFjO0lBQ3BELElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMscUJBQXFCLENBQUMsRUFBRTtRQUNuRyxNQUFNLElBQUksS0FBSyxDQUFDLDRCQUE0QixNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztLQUM5RDtJQUVELElBQUksTUFBMEIsQ0FBQztJQUMvQixJQUFJLFFBQTRCLENBQUM7SUFDakMsSUFBSSxNQUEwQixDQUFDO0lBQy9CLElBQUksUUFBNEIsQ0FBQztJQUVqQyxLQUFLLE1BQU0sQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBTSxDQUFDLEVBQUU7UUFDdEQsTUFBTSxVQUFVLEdBQUcsZ0NBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUMsTUFBTSxTQUFTLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7UUFFaEUsUUFBUSxJQUFJLEVBQUU7WUFDVixLQUFLLFVBQVU7Z0JBQUUsUUFBUSxHQUFHLFNBQVMsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO2dCQUFDLE1BQU07WUFDbkYsS0FBSyxRQUFRO2dCQUFFLE1BQU0sR0FBRyxTQUFTLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztnQkFBQyxNQUFNO1lBQy9FLEtBQUssUUFBUTtnQkFBRSxNQUFNLEdBQUcsU0FBUyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7Z0JBQUMsTUFBTTtZQUMvRSxLQUFLLGVBQWU7Z0JBQUUsUUFBUSxHQUFHLFNBQVMsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO2dCQUFDLE1BQU07WUFDeEYscUNBQXFDO1NBQ3hDO0tBQ0o7SUFFRCxPQUFPO1FBQ0gsUUFBUTtRQUNSLE1BQU07UUFDTixNQUFNO1FBQ04sZUFBZSxFQUFFLFFBQVE7S0FDNUIsQ0FBQztBQUNOLENBQUM7QUE3QkQsOERBNkJDO0FBRUQ7O0dBRUc7QUFDSCxNQUFhLG1CQUFvQixTQUFRLHFDQUFpQjtJQUV0RCxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQStCO1FBQ3JDLE9BQU8sMkJBQWEsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3BFLENBQUM7SUFFRCxjQUFjO1FBQ1YsT0FBTztZQUNILElBQUksRUFBRSxJQUFJLENBQUMsSUFBSTtZQUNmLEtBQUssRUFBRSxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQzNCLE9BQU8sRUFBRSxFQUFFO1NBQ2QsQ0FBQztJQUNOLENBQUM7SUFFRCxhQUFhO1FBQ1QsTUFBTSxLQUFLLEdBQStDO1lBQ3REO2dCQUNJLElBQUksRUFBRSxVQUFVO2dCQUNoQixJQUFJLEVBQUUsMkJBQWMsQ0FBQyxRQUFRO2FBQ2hDO1lBQ0Q7Z0JBQ0ksSUFBSSxFQUFFLFFBQVE7Z0JBQ2QsSUFBSSxFQUFFLDJCQUFjLENBQUMsTUFBTTthQUM5QjtZQUNEO2dCQUNJLElBQUksRUFBRSxRQUFRO2dCQUNkLElBQUksRUFBRSwyQkFBYyxDQUFDLE1BQU07YUFDOUI7WUFDRDtnQkFDSSxJQUFJLEVBQUUsZUFBZTtnQkFDckIsSUFBSSxFQUFFLDZDQUFxQixDQUFDLE1BQU07YUFDckM7WUFDRDtnQkFDSSxJQUFJLEVBQUUsYUFBYTtnQkFDbkIsSUFBSSxFQUFFLDJCQUFjLENBQUMsV0FBVzthQUNuQztZQUNEO2dCQUNJLElBQUksRUFBRSxNQUFNO2dCQUNaLElBQUksRUFBRSwyQkFBYyxDQUFDLElBQUk7YUFDNUI7WUFDRDtnQkFDSSxJQUFJLEVBQUUsTUFBTTtnQkFDWixJQUFJLEVBQUUsMkJBQWMsQ0FBQyxJQUFJO2FBQzVCO1NBQ0osQ0FBQztRQUVGLE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFFRCxpQkFBaUI7UUFDYixPQUFPLEVBQUUsQ0FBQztJQUNkLENBQUM7Q0FDSjtBQXBERCxrREFvREMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMTkgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuXG4gKiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBvciBpbiB0aGUgXCJsaWNlbnNlXCIgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWRcbiAqIG9uIGFuIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlclxuICogZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmdcbiAqIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBJbnRlbnQgfSBmcm9tIFwiYXNrLXNkay1tb2RlbFwiO1xuaW1wb3J0IHsgdjEgfSBmcm9tICdhc2stc21hcGktbW9kZWwnO1xuaW1wb3J0IHsgU2hhcmVkU2xvdFR5cGUgfSBmcm9tICcuLi9pbnRlcmFjdGlvbk1vZGVsR2VuZXJhdGlvbi9Nb2RlbFR5cGVzJztcbmltcG9ydCB7IGdldFNsb3RSZXNvbHV0aW9ucywgSW50ZW50QnVpbGRlciB9IGZyb20gJy4uL3V0aWxzL0ludGVudFV0aWxzJztcbmltcG9ydCB7IEFtYXpvbkJ1aWx0SW5TbG90VHlwZSB9IGZyb20gJy4vQW1hem9uQnVpbHRJblNsb3RUeXBlJztcbmltcG9ydCB7IEJhc2VDb250cm9sSW50ZW50IH0gZnJvbSAnLi9CYXNlQ29udHJvbEludGVudCc7XG5pbXBvcnQgU2xvdFR5cGUgPSB2MS5za2lsbC5pbnRlcmFjdGlvbk1vZGVsLlNsb3RUeXBlO1xuXG5cbmV4cG9ydCBpbnRlcmZhY2UgTnVtYmVyQ29udHJvbEludGVudFNsb3RzIHtcbiAgICBmZWVkYmFjaz86IHN0cmluZztcbiAgICBhY3Rpb24/OiBzdHJpbmc7XG4gICAgdGFyZ2V0Pzogc3RyaW5nO1xuICAgICdBTUFaT04uTlVNQkVSJz86IHN0cmluZztcbn1cblxuLyoqXG4gKiBcbiAqIFxuICogZW1wdHkgc2xvdHMgYXJlIHVucGFja2VkIGFzICd1bmRlZmluZWQnIHRvIGJlIG1vcmUgZXhwbGljaXQgYWJvdXQgd2hhdCBpcyBnb2luZyBvbi5cbiAqICh0aGlzIGhlbHBzIG1ha2VzIGJvb2xlYW4gdGVzdHMgaW4gQ29udHJvbHMgbW9yZSBvYnZpb3VzIGFuZCBjb25zaXN0ZW50KVxuICovXG5leHBvcnQgZnVuY3Rpb24gdW5wYWNrTnVtYmVyQ29udHJvbEludGVudChpbnRlbnQ6IEludGVudCk6IE51bWJlckNvbnRyb2xJbnRlbnRTbG90cyB7XG4gICAgaWYgKCFpbnRlbnQubmFtZS5zdGFydHNXaXRoKCdHZW5lcmFsQ29udHJvbEludGVudCcpICYmICFpbnRlbnQubmFtZS5zdGFydHNXaXRoKCdOdW1iZXJDb250cm9sSW50ZW50JykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBOb3QgYSBjb21wYXRpYmxlIGludGVudDogJHtpbnRlbnQubmFtZX1gKTtcbiAgICB9XG5cbiAgICBsZXQgYWN0aW9uOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgbGV0IGZlZWRiYWNrOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgbGV0IHRhcmdldDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgIGxldCB2YWx1ZVN0cjogc3RyaW5nIHwgdW5kZWZpbmVkO1xuXG4gICAgZm9yIChjb25zdCBbbmFtZSwgc2xvdF0gb2YgT2JqZWN0LmVudHJpZXMoaW50ZW50LnNsb3RzISkpIHtcbiAgICAgICAgY29uc3Qgc2xvdE9iamVjdCA9IGdldFNsb3RSZXNvbHV0aW9ucyhzbG90KTtcbiAgICAgICAgY29uc3Qgc2xvdFZhbHVlID0gc2xvdE9iamVjdCA/IHNsb3RPYmplY3Quc2xvdFZhbHVlIDogdW5kZWZpbmVkO1xuXG4gICAgICAgIHN3aXRjaCAobmFtZSkge1xuICAgICAgICAgICAgY2FzZSAnZmVlZGJhY2snOiBmZWVkYmFjayA9IHNsb3RWYWx1ZSAhPT0gdW5kZWZpbmVkID8gc2xvdFZhbHVlIDogdW5kZWZpbmVkOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2FjdGlvbic6IGFjdGlvbiA9IHNsb3RWYWx1ZSAhPT0gdW5kZWZpbmVkID8gc2xvdFZhbHVlIDogdW5kZWZpbmVkOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RhcmdldCc6IHRhcmdldCA9IHNsb3RWYWx1ZSAhPT0gdW5kZWZpbmVkID8gc2xvdFZhbHVlIDogdW5kZWZpbmVkOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ0FNQVpPTi5OVU1CRVInOiB2YWx1ZVN0ciA9IHNsb3RWYWx1ZSAhPT0gdW5kZWZpbmVkID8gc2xvdFZhbHVlIDogdW5kZWZpbmVkOyBicmVhaztcbiAgICAgICAgICAgIC8vIGRlZmF1bHQ6IGlnbm9yZSBjb250ZW50LWZyZWUgc2xvdHNcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGZlZWRiYWNrLFxuICAgICAgICBhY3Rpb24sXG4gICAgICAgIHRhcmdldCxcbiAgICAgICAgJ0FNQVpPTi5OVU1CRVInOiB2YWx1ZVN0clxuICAgIH07XG59XG5cbi8qKlxuICogSW50ZW50IHRvIGNhcHR1cmUgYW4gQU1BWk9OLk5VTUJFUiwgZm9sbG93aW5nIHRoZSBcIkNvbnRyb2xJbnRlbnRcIiBjb252ZW50aW9uc1xuICovXG5leHBvcnQgY2xhc3MgTnVtYmVyQ29udHJvbEludGVudCBleHRlbmRzIEJhc2VDb250cm9sSW50ZW50IHtcblxuICAgIHN0YXRpYyBvZihzbG90czogTnVtYmVyQ29udHJvbEludGVudFNsb3RzKTogSW50ZW50IHtcbiAgICAgICAgcmV0dXJuIEludGVudEJ1aWxkZXIub2YodGhpcy5wcm90b3R5cGUuY29uc3RydWN0b3IubmFtZSwgc2xvdHMpO1xuICAgIH1cblxuICAgIGdlbmVyYXRlSW50ZW50KCk6IHYxLnNraWxsLmludGVyYWN0aW9uTW9kZWwuSW50ZW50IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG5hbWU6IHRoaXMubmFtZSxcbiAgICAgICAgICAgIHNsb3RzOiB0aGlzLmdlbmVyYXRlU2xvdHMoKSxcbiAgICAgICAgICAgIHNhbXBsZXM6IFtdLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGdlbmVyYXRlU2xvdHMoKTogdjEuc2tpbGwuaW50ZXJhY3Rpb25Nb2RlbC5TbG90RGVmaW5pdGlvbltdIHtcbiAgICAgICAgY29uc3Qgc2xvdHM6IHYxLnNraWxsLmludGVyYWN0aW9uTW9kZWwuU2xvdERlZmluaXRpb25bXSA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnZmVlZGJhY2snLFxuICAgICAgICAgICAgICAgIHR5cGU6IFNoYXJlZFNsb3RUeXBlLkZFRURCQUNLXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdhY3Rpb24nLFxuICAgICAgICAgICAgICAgIHR5cGU6IFNoYXJlZFNsb3RUeXBlLkFDVElPTlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAndGFyZ2V0JyxcbiAgICAgICAgICAgICAgICB0eXBlOiBTaGFyZWRTbG90VHlwZS5UQVJHRVRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ0FNQVpPTi5OVU1CRVInLFxuICAgICAgICAgICAgICAgIHR5cGU6IEFtYXpvbkJ1aWx0SW5TbG90VHlwZS5OVU1CRVJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3ByZXBvc2l0aW9uJyxcbiAgICAgICAgICAgICAgICB0eXBlOiBTaGFyZWRTbG90VHlwZS5QUkVQT1NJVElPTlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnaGVhZCcsXG4gICAgICAgICAgICAgICAgdHlwZTogU2hhcmVkU2xvdFR5cGUuSEVBRFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAndGFpbCcsXG4gICAgICAgICAgICAgICAgdHlwZTogU2hhcmVkU2xvdFR5cGUuVEFJTFxuICAgICAgICAgICAgfVxuICAgICAgICBdO1xuXG4gICAgICAgIHJldHVybiBzbG90cztcbiAgICB9XG5cbiAgICBnZW5lcmF0ZVNsb3RUeXBlcygpOiBTbG90VHlwZVtdIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cbiJdfQ==