"use strict";
/*
 * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.ControlResponseBuilder = void 0;
/**
 * A specialized ResponseBuilder for use with Controls framework
 *
 * This differs from the the regular @see ResponseBuilder in a couple of ways:
 * 1. The prompt and reprompt can be built up incrementally via
 *    `addPromptFragment()` and `addRepromptFragment()`
 * 2. `.withShouldEndSession()` is disabled as the information should be
 *    provided via see `ControlResultBuilder` during `Control.handle()` and
 *    `Control.takeInitiative()`
 */
class ControlResponseBuilder {
    constructor(responseBuilder) {
        this.promptFragments = [];
        this.repromptFragments = [];
        this.coreBuilder = responseBuilder;
    }
    /**
     * Determines if a 'display or APL' directive has been added to the response.
     */
    isDisplayUsed() {
        return this.displayUsed;
    }
    /**
     * Sets the displayUsed flag to indicate if the Response includes content
     * for the device display.
     *
     * Note: calling `.withSimpleCard()`, `.withStandardCard()`,
     * `.addAPLRenderDocumentDirective()` or
     * `.addDirective(type=Alexa.Presentation)` sets this to `true`
     * automatically.
     *
     * Usage:
     *  * If you wish to keep existing APL active on device without resending,
     *    call this to communicate that the screen remains 'in use'.
     *  * Use this if the auto-detection does not work for some directive.
     */
    setDisplayUsed(used = true) {
        this.displayUsed = used;
    }
    /**
     * Build the response.
     */
    build() {
        const prompt = this.getPrompt();
        const reprompt = this.getReprompt();
        this.coreBuilder
            .speak(prompt, this.promptPlayBehavior)
            .reprompt(reprompt, this.repromptPlayBehavior);
        return this.coreBuilder.getResponse();
    }
    /**
     * Get the complete prompt.
     *
     * Concatenates the fragments with a single space between each.
     */
    getPrompt() {
        return this.promptFragments.join(' ');
    }
    /**
     * Get the complete reprompt.
     *
     * Concatenates the fragments with a single space between each.
     */
    getReprompt() {
        return this.repromptFragments.join(' ');
    }
    /**
     * Add a fragment to the prompt.
     * @param promptFragment - Prompt fragment
     */
    addPromptFragment(promptFragment) {
        this.promptFragments.push(promptFragment);
        return this;
    }
    /**
     * Add a fragment to the reprompt.
     * @param repromptFragment - Reprompt fragment
     */
    addRepromptFragment(repromptFragment) {
        this.repromptFragments.push(repromptFragment);
        return this;
    }
    /**
     * Set the prompt play behavior to associate with the complete prompt.
     */
    withPromptPlayBehavior(playBehavior) {
        if (this.promptPlayBehavior !== undefined) {
            throw new Error("Play behavior is already set");
        }
        this.promptPlayBehavior = playBehavior;
        return this;
    }
    /**
     * Set the reprompt play behavior to associate with the complete prompt.
     */
    withRepromptPlayBehavior(playBehavior) {
        if (this.repromptPlayBehavior !== undefined) {
            throw new Error("Play behavior is already set");
        }
        this.repromptPlayBehavior = playBehavior;
        return this;
    }
    // --------------------------------------
    // pass through methods
    /**
     * Disabled.  Use addPromptFragment and withPromptPlayBehavior.
     */
    speak(speechOutput, playBehavior) {
        throw new Error("Use addPromptFragment and withPromptPlayBehavior instead.");
    }
    /**
     * Disabled.  Use addRepromptFragment and withRepromptPlayBehavior.
     */
    reprompt(repromptSpeechOutput, playBehavior) {
        throw new Error("Use addRepromptFragment and withRepromptPlayBehavior instead.");
    }
    withSimpleCard(cardTitle, cardContent) {
        this.coreBuilder.withSimpleCard(cardTitle, cardContent);
        this.displayUsed = true;
        return this;
    }
    withStandardCard(cardTitle, cardContent, smallImageUrl, largeImageUrl) {
        this.coreBuilder.withStandardCard(cardTitle, cardContent, smallImageUrl, largeImageUrl);
        this.displayUsed = true;
        return this;
    }
    withLinkAccountCard() {
        this.coreBuilder.withLinkAccountCard();
        return this;
    }
    withAskForPermissionsConsentCard(permissionArray) {
        this.coreBuilder.withAskForPermissionsConsentCard(permissionArray);
        return this;
    }
    addDelegateDirective(updatedIntent) {
        this.coreBuilder.addDelegateDirective(updatedIntent);
        return this;
    }
    addElicitSlotDirective(slotToElicit, updatedIntent) {
        this.coreBuilder.addElicitSlotDirective(slotToElicit, updatedIntent);
        return this;
    }
    addConfirmSlotDirective(slotToConfirm, updatedIntent) {
        this.coreBuilder.addConfirmSlotDirective(slotToConfirm, updatedIntent);
        return this;
    }
    addConfirmIntentDirective(updatedIntent) {
        this.coreBuilder.addConfirmIntentDirective(updatedIntent);
        return this;
    }
    addAudioPlayerPlayDirective(playBehavior, url, token, offsetInMilliseconds, expectedPreviousToken, audioItemMetadata) {
        this.coreBuilder.addAudioPlayerPlayDirective(playBehavior, url, token, offsetInMilliseconds, expectedPreviousToken);
        return this;
    }
    addAudioPlayerStopDirective() {
        this.coreBuilder.addAudioPlayerStopDirective();
        return this;
    }
    addAudioPlayerClearQueueDirective(clearBehavior) {
        this.coreBuilder.addAudioPlayerClearQueueDirective(clearBehavior);
        return this;
    }
    addRenderTemplateDirective(template) {
        this.coreBuilder.addRenderTemplateDirective(template);
        this.displayUsed = true;
        return this;
    }
    addHintDirective(text) {
        this.coreBuilder.addHintDirective(text);
        return this;
    }
    addVideoAppLaunchDirective(source, title, subtitle) {
        this.coreBuilder.addVideoAppLaunchDirective(source, title, subtitle);
        return this;
    }
    withCanFulfillIntent(canFulfillIntent) {
        this.coreBuilder.withCanFulfillIntent(canFulfillIntent);
        return this;
    }
    withShouldEndSession(val) {
        throw new Error('Do not set this here.. use methods on ControlResultBuilder instead.');
    }
    addDirective(directive) {
        if (directive.type.startsWith('Alexa.Presentation')) {
            this.displayUsed = true;
        }
        this.coreBuilder.addDirective(directive);
        return this;
    }
    // helpers for common directives (incomplete)
    addDynamicEntitiesDirective(dynamicEntitiesDirective) {
        this.coreBuilder.addDirective(dynamicEntitiesDirective);
    }
    addAPLRenderDocumentDirective(token, document, datasources, packages) {
        this.coreBuilder.addDirective({
            type: 'Alexa.Presentation.APL.RenderDocument',
            token,
            document,
            datasources,
            packages
        });
        this.displayUsed = true;
    }
    /**
     * Builds and returns the complete response.
     */
    getResponse() {
        return this.build();
    }
}
exports.ControlResponseBuilder = ControlResponseBuilder;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29udHJvbFJlc3BvbnNlQnVpbGRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9yZXNwb25zZUdlbmVyYXRpb24vQ29udHJvbFJlc3BvbnNlQnVpbGRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7OztBQU1IOzs7Ozs7Ozs7R0FTRztBQUNILE1BQWEsc0JBQXNCO0lBVS9CLFlBQVksZUFBZ0M7UUFQcEMsb0JBQWUsR0FBYSxFQUFFLENBQUM7UUFFL0Isc0JBQWlCLEdBQWEsRUFBRSxDQUFDO1FBTXJDLElBQUksQ0FBQyxXQUFXLEdBQUcsZUFBZSxDQUFDO0lBQ3ZDLENBQUM7SUFFRDs7T0FFRztJQUNILGFBQWE7UUFDVCxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUM7SUFDNUIsQ0FBQztJQUVEOzs7Ozs7Ozs7Ozs7O09BYUc7SUFDSCxjQUFjLENBQUMsT0FBZ0IsSUFBSTtRQUMvQixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztJQUM1QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLO1FBQ0QsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ2hDLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUVwQyxJQUFJLENBQUMsV0FBVzthQUNYLEtBQUssQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixDQUFDO2FBQ3RDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFFbkQsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQzFDLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsU0FBUztRQUNMLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDMUMsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxXQUFXO1FBQ1As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SW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuXG4gKiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBvciBpbiB0aGUgXCJsaWNlbnNlXCIgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWRcbiAqIG9uIGFuIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlclxuICogZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmdcbiAqIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyB1aSwgSW50ZW50LCBpbnRlcmZhY2VzLCBEaXJlY3RpdmUsIFJlc3BvbnNlLCBkaWFsb2csIGNhbmZ1bGZpbGwgfSBmcm9tIFwiYXNrLXNkay1tb2RlbFwiO1xuaW1wb3J0IHsgUmVzcG9uc2VCdWlsZGVyLCBSZXNwb25zZUZhY3RvcnkgfSBmcm9tICdhc2stc2RrLWNvcmUnO1xuXG5cbi8qKlxuICogQSBzcGVjaWFsaXplZCBSZXNwb25zZUJ1aWxkZXIgZm9yIHVzZSB3aXRoIENvbnRyb2xzIGZyYW1ld29ya1xuICpcbiAqIFRoaXMgZGlmZmVycyBmcm9tIHRoZSB0aGUgcmVndWxhciBAc2VlIFJlc3BvbnNlQnVpbGRlciBpbiBhIGNvdXBsZSBvZiB3YXlzOlxuICogMS4gVGhlIHByb21wdCBhbmQgcmVwcm9tcHQgY2FuIGJlIGJ1aWx0IHVwIGluY3JlbWVudGFsbHkgdmlhXG4gKiAgICBgYWRkUHJvbXB0RnJhZ21lbnQoKWAgYW5kIGBhZGRSZXByb21wdEZyYWdtZW50KClgXG4gKiAyLiBgLndpdGhTaG91bGRFbmRTZXNzaW9uKClgIGlzIGRpc2FibGVkIGFzIHRoZSBpbmZvcm1hdGlvbiBzaG91bGQgYmVcbiAqICAgIHByb3ZpZGVkIHZpYSBzZWUgYENvbnRyb2xSZXN1bHRCdWlsZGVyYCBkdXJpbmcgYENvbnRyb2wuaGFuZGxlKClgIGFuZFxuICogICAgYENvbnRyb2wudGFrZUluaXRpYXRpdmUoKWBcbiAqL1xuZXhwb3J0IGNsYXNzIENvbnRyb2xSZXNwb25zZUJ1aWxkZXIgaW1wbGVtZW50cyBSZXNwb25zZUJ1aWxkZXIge1xuICAgIGNvcmVCdWlsZGVyOiBSZXNwb25zZUJ1aWxkZXI7XG5cbiAgICBwcml2YXRlIHByb21wdEZyYWdtZW50czogc3RyaW5nW10gPSBbXTtcbiAgICBwcml2YXRlIHByb21wdFBsYXlCZWhhdmlvcj86IHVpLlBsYXlCZWhhdmlvcjtcbiAgICBwcml2YXRlIHJlcHJvbXB0RnJhZ21lbnRzOiBzdHJpbmdbXSA9IFtdO1xuICAgIHByaXZhdGUgcmVwcm9tcHRQbGF5QmVoYXZpb3I/OiB1aS5QbGF5QmVoYXZpb3I7XG5cbiAgICBwcml2YXRlIGRpc3BsYXlVc2VkOiBib29sZWFuO1xuXG4gICAgY29uc3RydWN0b3IocmVzcG9uc2VCdWlsZGVyOiBSZXNwb25zZUJ1aWxkZXIpIHtcbiAgICAgICAgdGhpcy5jb3JlQnVpbGRlciA9IHJlc3BvbnNlQnVpbGRlcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIGlmIGEgJ2Rpc3BsYXkgb3IgQVBMJyBkaXJlY3RpdmUgaGFzIGJlZW4gYWRkZWQgdG8gdGhlIHJlc3BvbnNlLlxuICAgICAqL1xuICAgIGlzRGlzcGxheVVzZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmRpc3BsYXlVc2VkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGRpc3BsYXlVc2VkIGZsYWcgdG8gaW5kaWNhdGUgaWYgdGhlIFJlc3BvbnNlIGluY2x1ZGVzIGNvbnRlbnRcbiAgICAgKiBmb3IgdGhlIGRldmljZSBkaXNwbGF5LlxuICAgICAqXG4gICAgICogTm90ZTogY2FsbGluZyBgLndpdGhTaW1wbGVDYXJkKClgLCBgLndpdGhTdGFuZGFyZENhcmQoKWAsXG4gICAgICogYC5hZGRBUExSZW5kZXJEb2N1bWVudERpcmVjdGl2ZSgpYCBvclxuICAgICAqIGAuYWRkRGlyZWN0aXZlKHR5cGU9QWxleGEuUHJlc2VudGF0aW9uKWAgc2V0cyB0aGlzIHRvIGB0cnVlYFxuICAgICAqIGF1dG9tYXRpY2FsbHkuXG4gICAgICpcbiAgICAgKiBVc2FnZTpcbiAgICAgKiAgKiBJZiB5b3Ugd2lzaCB0byBrZWVwIGV4aXN0aW5nIEFQTCBhY3RpdmUgb24gZGV2aWNlIHdpdGhvdXQgcmVzZW5kaW5nLFxuICAgICAqICAgIGNhbGwgdGhpcyB0byBjb21tdW5pY2F0ZSB0aGF0IHRoZSBzY3JlZW4gcmVtYWlucyAnaW4gdXNlJy5cbiAgICAgKiAgKiBVc2UgdGhpcyBpZiB0aGUgYXV0by1kZXRlY3Rpb24gZG9lcyBub3Qgd29yayBmb3Igc29tZSBkaXJlY3RpdmUuXG4gICAgICovXG4gICAgc2V0RGlzcGxheVVzZWQodXNlZDogYm9vbGVhbiA9IHRydWUpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5kaXNwbGF5VXNlZCA9IHVzZWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQnVpbGQgdGhlIHJlc3BvbnNlLlxuICAgICAqL1xuICAgIGJ1aWxkKCk6IFJlc3BvbnNlIHtcbiAgICAgICAgY29uc3QgcHJvbXB0ID0gdGhpcy5nZXRQcm9tcHQoKTtcbiAgICAgICAgY29uc3QgcmVwcm9tcHQgPSB0aGlzLmdldFJlcHJvbXB0KCk7XG5cbiAgICAgICAgdGhpcy5jb3JlQnVpbGRlclxuICAgICAgICAgICAgLnNwZWFrKHByb21wdCwgdGhpcy5wcm9tcHRQbGF5QmVoYXZpb3IpXG4gICAgICAgICAgICAucmVwcm9tcHQocmVwcm9tcHQsIHRoaXMucmVwcm9tcHRQbGF5QmVoYXZpb3IpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmNvcmVCdWlsZGVyLmdldFJlc3BvbnNlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBjb21wbGV0ZSBwcm9tcHQuXG4gICAgICpcbiAgICAgKiBDb25jYXRlbmF0ZXMgdGhlIGZyYWdtZW50cyB3aXRoIGEgc2luZ2xlIHNwYWNlIGJldHdlZW4gZWFjaC5cbiAgICAgKi9cbiAgICBnZXRQcm9tcHQoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvbXB0RnJhZ21lbnRzLmpvaW4oJyAnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIGNvbXBsZXRlIHJlcHJvbXB0LlxuICAgICAqXG4gICAgICogQ29uY2F0ZW5hdGVzIHRoZSBmcmFnbWVudHMgd2l0aCBhIHNpbmdsZSBzcGFjZSBiZXR3ZWVuIGVhY2guXG4gICAgICovXG4gICAgZ2V0UmVwcm9tcHQoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVwcm9tcHRGcmFnbWVudHMuam9pbignICcpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkZCBhIGZyYWdtZW50IHRvIHRoZSBwcm9tcHQuXG4gICAgICogQHBhcmFtIHByb21wdEZyYWdtZW50IC0gUHJvbXB0IGZyYWdtZW50XG4gICAgICovXG4gICAgYWRkUHJvbXB0RnJhZ21lbnQocHJvbXB0RnJhZ21lbnQ6IHN0cmluZyk6IHRoaXMge1xuICAgICAgICB0aGlzLnByb21wdEZyYWdtZW50cy5wdXNoKHByb21wdEZyYWdtZW50KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkIGEgZnJhZ21lbnQgdG8gdGhlIHJlcHJvbXB0LlxuICAgICAqIEBwYXJhbSByZXByb21wdEZyYWdtZW50IC0gUmVwcm9tcHQgZnJhZ21lbnRcbiAgICAgKi9cbiAgICBhZGRSZXByb21wdEZyYWdtZW50KHJlcHJvbXB0RnJhZ21lbnQ6IHN0cmluZyk6IHRoaXMge1xuICAgICAgICB0aGlzLnJlcHJvbXB0RnJhZ21lbnRzLnB1c2gocmVwcm9tcHRGcmFnbWVudCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgcHJvbXB0IHBsYXkgYmVoYXZpb3IgdG8gYXNzb2NpYXRlIHdpdGggdGhlIGNvbXBsZXRlIHByb21wdC5cbiAgICAgKi9cbiAgICB3aXRoUHJvbXB0UGxheUJlaGF2aW9yKHBsYXlCZWhhdmlvcj86IHVpLlBsYXlCZWhhdmlvcik6IHRoaXMge1xuICAgICAgICBpZiAodGhpcy5wcm9tcHRQbGF5QmVoYXZpb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUGxheSBiZWhhdmlvciBpcyBhbHJlYWR5IHNldFwiKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnByb21wdFBsYXlCZWhhdmlvciA9IHBsYXlCZWhhdmlvcjtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0IHRoZSByZXByb21wdCBwbGF5IGJlaGF2aW9yIHRvIGFzc29jaWF0ZSB3aXRoIHRoZSBjb21wbGV0ZSBwcm9tcHQuXG4gICAgICovXG4gICAgd2l0aFJlcHJvbXB0UGxheUJlaGF2aW9yKHBsYXlCZWhhdmlvcj86IHVpLlBsYXlCZWhhdmlvcik6IHRoaXMge1xuICAgICAgICBpZiAodGhpcy5yZXByb21wdFBsYXlCZWhhdmlvciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQbGF5IGJlaGF2aW9yIGlzIGFscmVhZHkgc2V0XCIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVwcm9tcHRQbGF5QmVoYXZpb3IgPSBwbGF5QmVoYXZpb3I7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBwYXNzIHRocm91Z2ggbWV0aG9kc1xuXG4gICAgLyoqXG4gICAgICogRGlzYWJsZWQuICBVc2UgYWRkUHJvbXB0RnJhZ21lbnQgYW5kIHdpdGhQcm9tcHRQbGF5QmVoYXZpb3IuXG4gICAgICovXG4gICAgc3BlYWsoc3BlZWNoT3V0cHV0OiBzdHJpbmcsIHBsYXlCZWhhdmlvcj86IFwiRU5RVUVVRVwiIHwgXCJSRVBMQUNFX0FMTFwiIHwgXCJSRVBMQUNFX0VOUVVFVUVEXCIgfCB1bmRlZmluZWQpOiB0aGlzIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVXNlIGFkZFByb21wdEZyYWdtZW50IGFuZCB3aXRoUHJvbXB0UGxheUJlaGF2aW9yIGluc3RlYWQuXCIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERpc2FibGVkLiAgVXNlIGFkZFJlcHJvbXB0RnJhZ21lbnQgYW5kIHdpdGhSZXByb21wdFBsYXlCZWhhdmlvci5cbiAgICAgKi9cbiAgICByZXByb21wdChyZXByb21wdFNwZWVjaE91dHB1dDogc3RyaW5nLCBwbGF5QmVoYXZpb3I/OiBcIkVOUVVFVUVcIiB8IFwiUkVQTEFDRV9BTExcIiB8IFwiUkVQTEFDRV9FTlFVRVVFRFwiIHwgdW5kZWZpbmVkKTogdGhpcyB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVzZSBhZGRSZXByb21wdEZyYWdtZW50IGFuZCB3aXRoUmVwcm9tcHRQbGF5QmVoYXZpb3IgaW5zdGVhZC5cIik7XG4gICAgfVxuICAgIHdpdGhTaW1wbGVDYXJkKGNhcmRUaXRsZTogc3RyaW5nLCBjYXJkQ29udGVudDogc3RyaW5nKTogdGhpcyB7XG4gICAgICAgIHRoaXMuY29yZUJ1aWxkZXIud2l0aFNpbXBsZUNhcmQoY2FyZFRpdGxlLCBjYXJkQ29udGVudCk7XG4gICAgICAgIHRoaXMuZGlzcGxheVVzZWQgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgd2l0aFN0YW5kYXJkQ2FyZChjYXJkVGl0bGU6IHN0cmluZywgY2FyZENvbnRlbnQ6IHN0cmluZywgc21hbGxJbWFnZVVybD86IHN0cmluZyB8IHVuZGVmaW5lZCwgbGFyZ2VJbWFnZVVybD86IHN0cmluZyB8IHVuZGVmaW5lZCk6IHRoaXMge1xuICAgICAgICB0aGlzLmNvcmVCdWlsZGVyLndpdGhTdGFuZGFyZENhcmQoY2FyZFRpdGxlLCBjYXJkQ29udGVudCwgc21hbGxJbWFnZVVybCwgbGFyZ2VJbWFnZVVybCk7XG4gICAgICAgIHRoaXMuZGlzcGxheVVzZWQgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgd2l0aExpbmtBY2NvdW50Q2FyZCgpOiB0aGlzIHtcbiAgICAgICAgdGhpcy5jb3JlQnVpbGRlci53aXRoTGlua0FjY291bnRDYXJkKCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICB3aXRoQXNrRm9yUGVybWlzc2lvbnNDb25zZW50Q2FyZChwZXJtaXNzaW9uQXJyYXk6IHN0cmluZ1tdKTogdGhpcyB7XG4gICAgICAgIHRoaXMuY29yZUJ1aWxkZXIud2l0aEFza0ZvclBlcm1pc3Npb25zQ29uc2VudENhcmQocGVybWlzc2lvbkFycmF5KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIGFkZERlbGVnYXRlRGlyZWN0aXZlKHVwZGF0ZWRJbnRlbnQ/OiBJbnRlbnQgfCB1bmRlZmluZWQpOiB0aGlzIHtcbiAgICAgICAgdGhpcy5jb3JlQnVpbGRlci5hZGREZWxlZ2F0ZURpcmVjdGl2ZSh1cGRhdGVkSW50ZW50KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIGFkZEVsaWNpdFNsb3REaXJlY3RpdmUoc2xvdFRvRWxpY2l0OiBzdHJpbmcsIHVwZGF0ZWRJbnRlbnQ/OiBJbnRlbnQgfCB1bmRlZmluZWQpOiB0aGlzIHtcbiAgICAgICAgdGhpcy5jb3JlQnVpbGRlci5hZGRFbGljaXRTbG90RGlyZWN0aXZlKHNsb3RUb0VsaWNpdCwgdXBkYXRlZEludGVudCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBhZGRDb25maXJtU2xvdERpcmVjdGl2ZShzbG90VG9Db25maXJtOiBzdHJpbmcsIHVwZGF0ZWRJbnRlbnQ/OiBJbnRlbnQgfCB1bmRlZmluZWQpOiB0aGlzIHtcbiAgICAgICAgdGhpcy5jb3JlQnVpbGRlci5hZGRDb25maXJtU2xvdERpcmVjdGl2ZShzbG90VG9Db25maXJtLCB1cGRhdGVkSW50ZW50KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIGFkZENvbmZpcm1JbnRlbnREaXJlY3RpdmUodXBkYXRlZEludGVudD86IEludGVudCB8IHVuZGVmaW5lZCk6IHRoaXMge1xuICAgICAgICB0aGlzLmNvcmVCdWlsZGVyLmFkZENvbmZpcm1JbnRlbnREaXJlY3RpdmUodXBkYXRlZEludGVudCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBhZGRBdWRpb1BsYXllclBsYXlEaXJlY3RpdmUocGxheUJlaGF2aW9yOiB1aS5QbGF5QmVoYXZpb3IsIHVybDogc3RyaW5nLCB0b2tlbjogc3RyaW5nLCBvZmZzZXRJbk1pbGxpc2Vjb25kczogbnVtYmVyLCBleHBlY3RlZFByZXZpb3VzVG9rZW4/OiBzdHJpbmcgfCB1bmRlZmluZWQsIGF1ZGlvSXRlbU1ldGFkYXRhPzogaW50ZXJmYWNlcy5hdWRpb3BsYXllci5BdWRpb0l0ZW1NZXRhZGF0YSB8IHVuZGVmaW5lZCk6IHRoaXMge1xuICAgICAgICB0aGlzLmNvcmVCdWlsZGVyLmFkZEF1ZGlvUGxheWVyUGxheURpcmVjdGl2ZShwbGF5QmVoYXZpb3IsIHVybCwgdG9rZW4sIG9mZnNldEluTWlsbGlzZWNvbmRzLCBleHBlY3RlZFByZXZpb3VzVG9rZW4pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgYWRkQXVkaW9QbGF5ZXJTdG9wRGlyZWN0aXZlKCk6IHRoaXMge1xuICAgICAgICB0aGlzLmNvcmVCdWlsZGVyLmFkZEF1ZGlvUGxheWVyU3RvcERpcmVjdGl2ZSgpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgYWRkQXVkaW9QbGF5ZXJDbGVhclF1ZXVlRGlyZWN0aXZlKGNsZWFyQmVoYXZpb3I6IGludGVyZmFjZXMuYXVkaW9wbGF5ZXIuQ2xlYXJCZWhhdmlvcik6IHRoaXMge1xuICAgICAgICB0aGlzLmNvcmVCdWlsZGVyLmFkZEF1ZGlvUGxheWVyQ2xlYXJRdWV1ZURpcmVjdGl2ZShjbGVhckJlaGF2aW9yKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIGFkZFJlbmRlclRlbXBsYXRlRGlyZWN0aXZlKHRlbXBsYXRlOiBpbnRlcmZhY2VzLmRpc3BsYXkuVGVtcGxhdGUpOiB0aGlzIHtcbiAgICAgICAgdGhpcy5jb3JlQnVpbGRlci5hZGRSZW5kZXJUZW1wbGF0ZURpcmVjdGl2ZSh0ZW1wbGF0ZSk7XG4gICAgICAgIHRoaXMuZGlzcGxheVVzZWQgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgYWRkSGludERpcmVjdGl2ZSh0ZXh0OiBzdHJpbmcpOiB0aGlzIHtcbiAgICAgICAgdGhpcy5jb3JlQnVpbGRlci5hZGRIaW50RGlyZWN0aXZlKHRleHQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgYWRkVmlkZW9BcHBMYXVuY2hEaXJlY3RpdmUoc291cmNlOiBzdHJpbmcsIHRpdGxlPzogc3RyaW5nIHwgdW5kZWZpbmVkLCBzdWJ0aXRsZT86IHN0cmluZyB8IHVuZGVmaW5lZCk6IHRoaXMge1xuICAgICAgICB0aGlzLmNvcmVCdWlsZGVyLmFkZFZpZGVvQXBwTGF1bmNoRGlyZWN0aXZlKHNvdXJjZSwgdGl0bGUsIHN1YnRpdGxlKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIHdpdGhDYW5GdWxmaWxsSW50ZW50KGNhbkZ1bGZpbGxJbnRlbnQ6IGNhbmZ1bGZpbGwuQ2FuRnVsZmlsbEludGVudCk6IHRoaXMge1xuICAgICAgICB0aGlzLmNvcmVCdWlsZGVyLndpdGhDYW5GdWxmaWxsSW50ZW50KGNhbkZ1bGZpbGxJbnRlbnQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgd2l0aFNob3VsZEVuZFNlc3Npb24odmFsOiBib29sZWFuKTogdGhpcyB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRG8gbm90IHNldCB0aGlzIGhlcmUuLiB1c2UgbWV0aG9kcyBvbiBDb250cm9sUmVzdWx0QnVpbGRlciBpbnN0ZWFkLicpO1xuICAgIH1cbiAgICBhZGREaXJlY3RpdmUoZGlyZWN0aXZlOiBEaXJlY3RpdmUpOiB0aGlzIHtcbiAgICAgICAgaWYgKGRpcmVjdGl2ZS50eXBlLnN0YXJ0c1dpdGgoJ0FsZXhhLlByZXNlbnRhdGlvbicpKSB7XG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlVc2VkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNvcmVCdWlsZGVyLmFkZERpcmVjdGl2ZShkaXJlY3RpdmUpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvLyBoZWxwZXJzIGZvciBjb21tb24gZGlyZWN0aXZlcyAoaW5jb21wbGV0ZSlcbiAgICBhZGREeW5hbWljRW50aXRpZXNEaXJlY3RpdmUoZHluYW1pY0VudGl0aWVzRGlyZWN0aXZlOiBkaWFsb2cuRHluYW1pY0VudGl0aWVzRGlyZWN0aXZlKSB7XG4gICAgICAgIHRoaXMuY29yZUJ1aWxkZXIuYWRkRGlyZWN0aXZlKGR5bmFtaWNFbnRpdGllc0RpcmVjdGl2ZSk7XG4gICAgfVxuICAgIGFkZEFQTFJlbmRlckRvY3VtZW50RGlyZWN0aXZlKHRva2VuPzogc3RyaW5nLCBkb2N1bWVudD86IHsgW2tleTogc3RyaW5nXTogYW55IH0sIGRhdGFzb3VyY2VzPzogeyBba2V5OiBzdHJpbmddOiBhbnk7IH0sIHBhY2thZ2VzPzogYW55W10pIHtcbiAgICAgICAgdGhpcy5jb3JlQnVpbGRlci5hZGREaXJlY3RpdmUoXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ0FsZXhhLlByZXNlbnRhdGlvbi5BUEwuUmVuZGVyRG9jdW1lbnQnLFxuICAgICAgICAgICAgICAgIHRva2VuLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50LFxuICAgICAgICAgICAgICAgIGRhdGFzb3VyY2VzLFxuICAgICAgICAgICAgICAgIHBhY2thZ2VzXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuZGlzcGxheVVzZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJ1aWxkcyBhbmQgcmV0dXJucyB0aGUgY29tcGxldGUgcmVzcG9uc2UuXG4gICAgICovXG4gICAgZ2V0UmVzcG9uc2UoKTogUmVzcG9uc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5idWlsZCgpO1xuICAgIH1cbn0iXX0=