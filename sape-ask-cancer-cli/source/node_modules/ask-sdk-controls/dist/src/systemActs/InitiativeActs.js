"use strict";
/*
 * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.SuggestValueAct = exports.LiteralInitiativeAct = exports.ConfirmValueAct = exports.RequestChangedValueByListAct = exports.RequestValueByListAct = exports.RequestChangedValueAct = exports.RequestValueAct = exports.InitiativeAct = void 0;
const ListFormat_1 = require("../intl/ListFormat");
const SystemAct_1 = require("./SystemAct");
/**
 * Base type for System Acts that 'take the initiative'.
 *
 * An act is 'taking the initiative' if it represents a direct question or otherwise encourages the user to continue the conversation.
 *
 * Examples:
 *   * RequestValueAct  is-a  InitiativeAct.  Sample prompt: "How many ducks?"       (an explicit question requesting a response)
 *   * NextTaskAct      is-a  InitiativeAct.  Sample prompt: "Next task please."     (this is explicit encouragement to continue)
 *
 * Usage:
 *  * Introduce a new InitiativeAct for any behavior that is not precisely captured by existing acts.
 *    The is no restriction on creating as many act types as necessary for a new control or skill
 *
 *  * An InitiativeAct is not restricted to only represent initiative.  It is valid
 *    to represent both initiative and some content if they are fundamentally connected.
 *    However, it is usual to define separate acts if they can reasonably be used in isolation.
 *
 * Framework behavior:
 *  * The framework requires that every turn includes exactly one InitiativeAct except for
 *    terminal turns that stop the user's session. (by setting ControlResult.sessionBehavior)
 *
 * Remarks:
 *  * Alexa certification policy requires that each turn that leaves the microphone open clearly prompts
 *    the user to reply or continue. Hence an initiative act must always be present and rendered clearly.
 *  * If Alexa's reply doesn't not explicitly encourage the user to continue the conversation, the session must be closed.
 */
class InitiativeAct extends SystemAct_1.SystemAct {
    constructor(control) {
        super(control, { takesInitiative: true });
    }
}
exports.InitiativeAct = InitiativeAct;
/**
 * Asks the user to provide a value.
 *
 * Default rendering (en-US): "What value for (renderedTarget)?"
 *
 * Usage:
 *  * If the system already has a value from the user it may be preferable to issue a `RequestChangedValueAct`
 *    which is more specific to that case.
 *  * Typically issued when a Control gains the initiative for the first time and requests a value for the first time.
 */
class RequestValueAct extends InitiativeAct {
    constructor(control, payload) {
        super(control);
        this.payload = payload !== null && payload !== void 0 ? payload : {};
    }
    render(input, controlResponseBuilder) {
        if (this.payload.renderedTarget !== undefined) {
            controlResponseBuilder.addPromptFragment(`What value for ${this.payload.renderedTarget}.`);
        }
        else {
            throw new Error(`Cannot directly render RequestValueAct as payload.renderedTarget is undefined. ${this.toString()}. `
                + `Either provide a renderedTarget when creating the act, or render the act in control.render() or controlManager.render()`);
        }
    }
}
exports.RequestValueAct = RequestValueAct;
/**
 * Asks the user to provide a new/updated value.
 *
 * Default rendering (en-US): "What is the new value for (renderedTarget)?"
 *
 * Usage:
 *  * Typically issued in response to the user saying they want to change a value, e.g. "U: Please change the event date."
 */
class RequestChangedValueAct extends InitiativeAct {
    constructor(control, payload) {
        super(control);
        this.payload = payload;
    }
    render(input, controlResponseBuilder) {
        if (this.payload.renderedTarget !== undefined) {
            controlResponseBuilder.addPromptFragment(`What is the new value for ${this.payload.renderedTarget}.`);
        }
        else {
            throw new Error(`Cannot directly render RequestChangedValueAct as payload.renderedTarget is undefined. ${this.toString()}. `
                + `Either provide a renderedTarget when creating the act, or render the act in control.render() or controlManager.render()`);
        }
    }
}
exports.RequestChangedValueAct = RequestChangedValueAct;
/**
 * Asks the user to provide a value by speaking and showing items in the form of a list.
 *
 * Default rendering (en-US): "What value for (renderedTarget)? Choices include (renderedChoices)."
 *
 * Usage:
 *  * Typically issued when a Control gains the initiative for the first time and requests a value for the first time.
 *  * If the system already has a value from the user it may be preferable to issue a `RequestChangedValueAct`
 *    which is more specific to that case.
 */
class RequestValueByListAct extends InitiativeAct {
    constructor(control, payload) {
        super(control);
        this.payload = payload;
    }
    render(input, controlResponseBuilder) {
        if (this.payload.renderedTarget !== undefined && this.payload.renderedChoices !== undefined) {
            controlResponseBuilder.addPromptFragment(`What value for ${this.payload.renderedTarget}? Choices include ${this.payload.renderedChoices}.`);
        }
        else {
            throw new Error(`Cannot directly render RequestValueByList as payload.renderedTarget and/or payload.renderedChoices is undefined. ${this.toString()}. `
                + `Either provide a renderedTarget when creating the act, or render the act in control.render() or controlManager.render()`);
        }
    }
}
exports.RequestValueByListAct = RequestValueByListAct;
/**
 * Asks the user to provide a new/updated value by speaking and showing items in the form of a list.
 *
 * Default rendering (en-US): "What is the new value for (renderedTarget)? Choices include (renderedChoices)."
 *
 * Usage:
 *  * Typically issued when a Control gains the initiative for the first time and requests a value for the first time.
 *  * If the system already has a value from the user it may be preferable to issue a `RequestChangedValueAct`
 *    which is more specific to that case.
 */
class RequestChangedValueByListAct extends InitiativeAct {
    constructor(control, payload) {
        super(control);
        this.payload = payload;
    }
    render(input, controlResponseBuilder) {
        if (this.payload.renderedTarget !== undefined) {
            controlResponseBuilder.addPromptFragment(`What is the new value for ${this.payload.renderedTarget}? Choices include ${ListFormat_1.ListFormatting.format(this.payload.choicesFromActivePage)}.`);
        }
        else {
            throw new Error(`Cannot directly render RequestChangeValueByList as payload.renderedTarget is undefined. ${this.toString()}. `
                + `Either provide a renderedTarget when creating the act, or render the act in control.render() or controlManager.render()`);
        }
    }
}
exports.RequestChangedValueByListAct = RequestChangedValueByListAct;
/**
 * An initiative act that asks the user if a value is correct.
 *
 * Defaults:
 *  * The repromptFragment defaults to be identical to promptFragment.
 *
 */
class ConfirmValueAct extends InitiativeAct {
    constructor(control, payload) {
        super(control);
        this.payload = payload;
    }
    render(input, controlResponseBuilder) {
        controlResponseBuilder.addPromptFragment(`Was that ${this.payload.value}?`);
    }
}
exports.ConfirmValueAct = ConfirmValueAct;
/**
 * An initiative act that defines literal prompt and reprompt fragments.
 *
 * Defaults:
 *  * The repromptFragment defaults to be identical to promptFragment.
 *
 * Usage:
 *  * Use LiteralInitiativeAct only in simple situations where it would be annoying
 *    to create a new custom act only to have a single way to render it.
 *  * In contrast, specific initiative acts convey information more clearly,
 *    maintain controller/view separation and can often be reused in additional scenarios.
 */
class LiteralInitiativeAct extends InitiativeAct {
    constructor(control, payload) {
        var _a;
        super(control);
        this.payload = {
            promptFragment: payload.promptFragment,
            repromptFragment: (_a = payload.repromptFragment) !== null && _a !== void 0 ? _a : payload.promptFragment
        };
    }
    render(input, controlResponseBuilder) {
        controlResponseBuilder.addPromptFragment(this.payload.promptFragment);
        controlResponseBuilder.addRepromptFragment(this.payload.repromptFragment);
    }
}
exports.LiteralInitiativeAct = LiteralInitiativeAct;
/**
 * An initiative act that suggests a specific value with a asks yes/no question.
 *
 * Defaults:
 *  * The repromptFragment defaults to be identical to promptFragment.
 *
 *
 */
class SuggestValueAct extends InitiativeAct {
    constructor(control, payload) {
        super(control);
        this.payload = payload;
    }
    render(input, controlResponseBuilder) {
        // TODO: bug: change the message to i18n
        controlResponseBuilder.addPromptFragment(`Did you perhaps mean ${this.payload.value}?`);
    }
}
exports.SuggestValueAct = SuggestValueAct;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW5pdGlhdGl2ZUFjdHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvc3lzdGVtQWN0cy9Jbml0aWF0aXZlQWN0cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7OztBQUtILG1EQUFvRDtBQUdwRCwyQ0FBd0M7QUFFeEM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F5Qkc7QUFDSCxNQUFzQixhQUFjLFNBQVEscUJBQVM7SUFDakQsWUFBWSxPQUFnQjtRQUN4QixLQUFLLENBQUMsT0FBTyxFQUFFLEVBQUMsZUFBZSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7SUFDNUMsQ0FBQztDQUNKO0FBSkQsc0NBSUM7QUFFRDs7Ozs7Ozs7O0dBU0c7QUFDSCxNQUFhLGVBQWdCLFNBQVEsYUFBYTtJQUc5QyxZQUFZLE9BQWdCLEVBQUUsT0FBNkI7UUFDdkQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2YsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLGFBQVAsT0FBTyxjQUFQLE9BQU8sR0FBSSxFQUFFLENBQUM7SUFFakMsQ0FBQztJQUNELE1BQU0sQ0FBQyxLQUFtQixFQUFFLHNCQUE4QztRQUN0RSxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsY0FBYyxLQUFLLFNBQVMsRUFBQztZQUMxQyxzQkFBc0IsQ0FBQyxpQkFBaUIsQ0FBQyxrQkFBa0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLEdBQUcsQ0FBQyxDQUFDO1NBQzlGO2FBQ0k7WUFDRCxNQUFNLElBQUksS0FBSyxDQUFDLGtGQUFrRixJQUFJLENBQUMsUUFBUSxFQUFFLElBQUk7a0JBQ25ILHlIQUF5SCxDQUFDLENBQUM7U0FDaEk7SUFDTCxDQUFDO0NBQ0o7QUFqQkQsMENBaUJDO0FBRUQ7Ozs7Ozs7R0FPRztBQUNILE1BQWEsc0JBQXVCLFNBQVEsYUFBYTtJQUdyRCxZQUFZLE9BQWdCLEVBQUUsT0FBbUM7UUFDN0QsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2YsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7SUFDM0IsQ0FBQztJQUNELE1BQU0sQ0FBQyxLQUFtQixFQUFFLHNCQUE4QztRQUN0RSxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsY0FBYyxLQUFLLFNBQVMsRUFBQztZQUMxQyxzQkFBc0IsQ0FBQyxpQkFBaUIsQ0FBQyw2QkFBNkIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLEdBQUcsQ0FBQyxDQUFDO1NBQ3pHO2FBQ0k7WUFDRCxNQUFNLElBQUksS0FBSyxDQUFDLHlGQUF5RixJQUFJLENBQUMsUUFBUSxFQUFFLElBQUk7a0JBQzFILHlIQUF5SCxDQUFDLENBQUM7U0FDaEk7SUFDTCxDQUFDO0NBQ0o7QUFoQkQsd0RBZ0JDO0FBR0Q7Ozs7Ozs7OztHQVNHO0FBQ0gsTUFBYSxxQkFBc0IsU0FBUSxhQUFhO0lBR3BELFlBQVksT0FBZ0IsRUFBRSxPQUFrQztRQUM1RCxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDZixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztJQUMzQixDQUFDO0lBQ0QsTUFBTSxDQUFDLEtBQW1CLEVBQUUsc0JBQThDO1FBQ3RFLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLEtBQUssU0FBUyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsZUFBZSxLQUFLLFNBQVMsRUFBQztZQUN4RixzQkFBc0IsQ0FBQyxpQkFBaUIsQ0FBQyxrQkFBa0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLHFCQUFxQixJQUFJLENBQUMsT0FBTyxDQUFDLGVBQWUsR0FBRyxDQUFDLENBQUM7U0FDL0k7YUFDSTtZQUNELE1BQU0sSUFBSSxLQUFLLENBQUMsb0hBQW9ILElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSTtrQkFDckoseUhBQXlILENBQUMsQ0FBQztTQUNoSTtJQUNMLENBQUM7Q0FDSjtBQWhCRCxzREFnQkM7QUFFRDs7Ozs7Ozs7O0dBU0c7QUFDSCxNQUFhLDRCQUE2QixTQUFRLGFBQWE7SUFHM0QsWUFBWSxPQUFnQixFQUFFLE9BQXlDO1FBQ25FLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNmLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO0lBQzNCLENBQUM7SUFDRCxNQUFNLENBQUMsS0FBbUIsRUFBRSxzQkFBOEM7UUFDdEUsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLGNBQWMsS0FBSyxTQUFTLEVBQUM7WUFDMUMsc0JBQXNCLENBQUMsaUJBQWlCLENBQUMsNkJBQTZCLElBQUksQ0FBQyxPQUFPLENBQUMsY0FBYyxxQkFBcUIsMkJBQWMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUN2TDthQUNJO1lBQ0QsTUFBTSxJQUFJLEtBQUssQ0FBQywyRkFBMkYsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJO2tCQUM1SCx5SEFBeUgsQ0FBQyxDQUFDO1NBQ2hJO0lBQ0wsQ0FBQztDQUNKO0FBaEJELG9FQWdCQztBQUVEOzs7Ozs7R0FNRztBQUNILE1BQWEsZUFBbUIsU0FBUSxhQUFhO0lBR2pELFlBQVksT0FBZ0IsRUFBRSxPQUEyQjtRQUNyRCxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDZixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztJQUMzQixDQUFDO0lBQ0QsTUFBTSxDQUFDLEtBQW1CLEVBQUUsc0JBQThDO1FBQ3RFLHNCQUFzQixDQUFDLGlCQUFpQixDQUFDLFlBQVksSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBQ2hGLENBQUM7Q0FDSjtBQVZELDBDQVVDO0FBRUQ7Ozs7Ozs7Ozs7O0dBV0c7QUFDSCxNQUFhLG9CQUFxQixTQUFRLGFBQWE7SUFHbkQsWUFBWSxPQUFnQixFQUFFLE9BQThCOztRQUN4RCxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDZixJQUFJLENBQUMsT0FBTyxHQUFHO1lBQ1gsY0FBYyxFQUFFLE9BQU8sQ0FBQyxjQUFjO1lBQ3RDLGdCQUFnQixRQUFFLE9BQU8sQ0FBQyxnQkFBZ0IsbUNBQUksT0FBTyxDQUFDLGNBQWM7U0FDdkUsQ0FBQztJQUNOLENBQUM7SUFDRCxNQUFNLENBQUMsS0FBbUIsRUFBRSxzQkFBOEM7UUFDdEUsc0JBQXNCLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUN0RSxzQkFBc0IsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGdCQUFpQixDQUFDLENBQUM7SUFDL0UsQ0FBQztDQUNKO0FBZEQsb0RBY0M7QUFFRDs7Ozs7OztHQU9HO0FBQ0gsTUFBYSxlQUFtQixTQUFRLGFBQWE7SUFHakQsWUFBWSxPQUFnQixFQUFFLE9BQTJCO1FBQ3JELEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNmLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO0lBQzNCLENBQUM7SUFDRCxNQUFNLENBQUMsS0FBbUIsRUFBRSxzQkFBOEM7UUFDdEUsd0NBQXdDO1FBQ3hDLHNCQUFzQixDQUFDLGlCQUFpQixDQUFDLHdCQUF3QixJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7SUFDNUYsQ0FBQztDQUNKO0FBWEQsMENBV0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMjAgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuXG4gKiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBvciBpbiB0aGUgXCJsaWNlbnNlXCIgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWRcbiAqIG9uIGFuIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlclxuICogZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmdcbiAqIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5cbmltcG9ydCB7IENvbnRyb2wgfSBmcm9tICcuLi9jb250cm9scy9Db250cm9sJztcbmltcG9ydCB7IENvbnRyb2xJbnB1dCB9IGZyb20gJy4uL2NvbnRyb2xzL0NvbnRyb2xJbnB1dCc7XG5pbXBvcnQgeyBMaXN0Rm9ybWF0dGluZyB9IGZyb20gJy4uL2ludGwvTGlzdEZvcm1hdCc7XG5pbXBvcnQgeyBDb250cm9sUmVzcG9uc2VCdWlsZGVyIH0gZnJvbSAnLi4vcmVzcG9uc2VHZW5lcmF0aW9uL0NvbnRyb2xSZXNwb25zZUJ1aWxkZXInO1xuaW1wb3J0IHsgTGl0ZXJhbENvbnRlbnRQYXlsb2FkLCBSZXF1ZXN0Q2hhbmdlZFZhbHVlQnlMaXN0UGF5bG9hZCwgUmVxdWVzdENoYW5nZWRWYWx1ZVBheWxvYWQsIFJlcXVlc3RWYWx1ZUJ5TGlzdFBheWxvYWQsIFJlcXVlc3RWYWx1ZVBheWxvYWQsIFZhbHVlU2V0UGF5bG9hZCB9IGZyb20gJy4vUGF5bG9hZFR5cGVzJztcbmltcG9ydCB7IFN5c3RlbUFjdCB9IGZyb20gJy4vU3lzdGVtQWN0JztcblxuLyoqXG4gKiBCYXNlIHR5cGUgZm9yIFN5c3RlbSBBY3RzIHRoYXQgJ3Rha2UgdGhlIGluaXRpYXRpdmUnLlxuICpcbiAqIEFuIGFjdCBpcyAndGFraW5nIHRoZSBpbml0aWF0aXZlJyBpZiBpdCByZXByZXNlbnRzIGEgZGlyZWN0IHF1ZXN0aW9uIG9yIG90aGVyd2lzZSBlbmNvdXJhZ2VzIHRoZSB1c2VyIHRvIGNvbnRpbnVlIHRoZSBjb252ZXJzYXRpb24uXG4gKlxuICogRXhhbXBsZXM6XG4gKiAgICogUmVxdWVzdFZhbHVlQWN0ICBpcy1hICBJbml0aWF0aXZlQWN0LiAgU2FtcGxlIHByb21wdDogXCJIb3cgbWFueSBkdWNrcz9cIiAgICAgICAoYW4gZXhwbGljaXQgcXVlc3Rpb24gcmVxdWVzdGluZyBhIHJlc3BvbnNlKVxuICogICAqIE5leHRUYXNrQWN0ICAgICAgaXMtYSAgSW5pdGlhdGl2ZUFjdC4gIFNhbXBsZSBwcm9tcHQ6IFwiTmV4dCB0YXNrIHBsZWFzZS5cIiAgICAgKHRoaXMgaXMgZXhwbGljaXQgZW5jb3VyYWdlbWVudCB0byBjb250aW51ZSlcbiAqXG4gKiBVc2FnZTpcbiAqICAqIEludHJvZHVjZSBhIG5ldyBJbml0aWF0aXZlQWN0IGZvciBhbnkgYmVoYXZpb3IgdGhhdCBpcyBub3QgcHJlY2lzZWx5IGNhcHR1cmVkIGJ5IGV4aXN0aW5nIGFjdHMuXG4gKiAgICBUaGUgaXMgbm8gcmVzdHJpY3Rpb24gb24gY3JlYXRpbmcgYXMgbWFueSBhY3QgdHlwZXMgYXMgbmVjZXNzYXJ5IGZvciBhIG5ldyBjb250cm9sIG9yIHNraWxsXG4gKlxuICogICogQW4gSW5pdGlhdGl2ZUFjdCBpcyBub3QgcmVzdHJpY3RlZCB0byBvbmx5IHJlcHJlc2VudCBpbml0aWF0aXZlLiAgSXQgaXMgdmFsaWRcbiAqICAgIHRvIHJlcHJlc2VudCBib3RoIGluaXRpYXRpdmUgYW5kIHNvbWUgY29udGVudCBpZiB0aGV5IGFyZSBmdW5kYW1lbnRhbGx5IGNvbm5lY3RlZC5cbiAqICAgIEhvd2V2ZXIsIGl0IGlzIHVzdWFsIHRvIGRlZmluZSBzZXBhcmF0ZSBhY3RzIGlmIHRoZXkgY2FuIHJlYXNvbmFibHkgYmUgdXNlZCBpbiBpc29sYXRpb24uXG4gKlxuICogRnJhbWV3b3JrIGJlaGF2aW9yOlxuICogICogVGhlIGZyYW1ld29yayByZXF1aXJlcyB0aGF0IGV2ZXJ5IHR1cm4gaW5jbHVkZXMgZXhhY3RseSBvbmUgSW5pdGlhdGl2ZUFjdCBleGNlcHQgZm9yXG4gKiAgICB0ZXJtaW5hbCB0dXJucyB0aGF0IHN0b3AgdGhlIHVzZXIncyBzZXNzaW9uLiAoYnkgc2V0dGluZyBDb250cm9sUmVzdWx0LnNlc3Npb25CZWhhdmlvcilcbiAqXG4gKiBSZW1hcmtzOlxuICogICogQWxleGEgY2VydGlmaWNhdGlvbiBwb2xpY3kgcmVxdWlyZXMgdGhhdCBlYWNoIHR1cm4gdGhhdCBsZWF2ZXMgdGhlIG1pY3JvcGhvbmUgb3BlbiBjbGVhcmx5IHByb21wdHNcbiAqICAgIHRoZSB1c2VyIHRvIHJlcGx5IG9yIGNvbnRpbnVlLiBIZW5jZSBhbiBpbml0aWF0aXZlIGFjdCBtdXN0IGFsd2F5cyBiZSBwcmVzZW50IGFuZCByZW5kZXJlZCBjbGVhcmx5LlxuICogICogSWYgQWxleGEncyByZXBseSBkb2Vzbid0IG5vdCBleHBsaWNpdGx5IGVuY291cmFnZSB0aGUgdXNlciB0byBjb250aW51ZSB0aGUgY29udmVyc2F0aW9uLCB0aGUgc2Vzc2lvbiBtdXN0IGJlIGNsb3NlZC5cbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEluaXRpYXRpdmVBY3QgZXh0ZW5kcyBTeXN0ZW1BY3Qge1xuICAgIGNvbnN0cnVjdG9yKGNvbnRyb2w6IENvbnRyb2wpe1xuICAgICAgICBzdXBlcihjb250cm9sLCB7dGFrZXNJbml0aWF0aXZlOiB0cnVlfSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEFza3MgdGhlIHVzZXIgdG8gcHJvdmlkZSBhIHZhbHVlLlxuICpcbiAqIERlZmF1bHQgcmVuZGVyaW5nIChlbi1VUyk6IFwiV2hhdCB2YWx1ZSBmb3IgKHJlbmRlcmVkVGFyZ2V0KT9cIlxuICpcbiAqIFVzYWdlOlxuICogICogSWYgdGhlIHN5c3RlbSBhbHJlYWR5IGhhcyBhIHZhbHVlIGZyb20gdGhlIHVzZXIgaXQgbWF5IGJlIHByZWZlcmFibGUgdG8gaXNzdWUgYSBgUmVxdWVzdENoYW5nZWRWYWx1ZUFjdGBcbiAqICAgIHdoaWNoIGlzIG1vcmUgc3BlY2lmaWMgdG8gdGhhdCBjYXNlLlxuICogICogVHlwaWNhbGx5IGlzc3VlZCB3aGVuIGEgQ29udHJvbCBnYWlucyB0aGUgaW5pdGlhdGl2ZSBmb3IgdGhlIGZpcnN0IHRpbWUgYW5kIHJlcXVlc3RzIGEgdmFsdWUgZm9yIHRoZSBmaXJzdCB0aW1lLlxuICovXG5leHBvcnQgY2xhc3MgUmVxdWVzdFZhbHVlQWN0IGV4dGVuZHMgSW5pdGlhdGl2ZUFjdCB7XG4gICAgcGF5bG9hZDogUmVxdWVzdFZhbHVlUGF5bG9hZDtcblxuICAgIGNvbnN0cnVjdG9yKGNvbnRyb2w6IENvbnRyb2wsIHBheWxvYWQ/OiBSZXF1ZXN0VmFsdWVQYXlsb2FkKSB7XG4gICAgICAgIHN1cGVyKGNvbnRyb2wpO1xuICAgICAgICB0aGlzLnBheWxvYWQgPSBwYXlsb2FkID8/IHt9O1xuXG4gICAgfVxuICAgIHJlbmRlcihpbnB1dDogQ29udHJvbElucHV0LCBjb250cm9sUmVzcG9uc2VCdWlsZGVyOiBDb250cm9sUmVzcG9uc2VCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnBheWxvYWQucmVuZGVyZWRUYXJnZXQgIT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICBjb250cm9sUmVzcG9uc2VCdWlsZGVyLmFkZFByb21wdEZyYWdtZW50KGBXaGF0IHZhbHVlIGZvciAke3RoaXMucGF5bG9hZC5yZW5kZXJlZFRhcmdldH0uYCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBkaXJlY3RseSByZW5kZXIgUmVxdWVzdFZhbHVlQWN0IGFzIHBheWxvYWQucmVuZGVyZWRUYXJnZXQgaXMgdW5kZWZpbmVkLiAke3RoaXMudG9TdHJpbmcoKX0uIGBcbiAgICAgICAgICAgICsgYEVpdGhlciBwcm92aWRlIGEgcmVuZGVyZWRUYXJnZXQgd2hlbiBjcmVhdGluZyB0aGUgYWN0LCBvciByZW5kZXIgdGhlIGFjdCBpbiBjb250cm9sLnJlbmRlcigpIG9yIGNvbnRyb2xNYW5hZ2VyLnJlbmRlcigpYCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogQXNrcyB0aGUgdXNlciB0byBwcm92aWRlIGEgbmV3L3VwZGF0ZWQgdmFsdWUuXG4gKlxuICogRGVmYXVsdCByZW5kZXJpbmcgKGVuLVVTKTogXCJXaGF0IGlzIHRoZSBuZXcgdmFsdWUgZm9yIChyZW5kZXJlZFRhcmdldCk/XCJcbiAqXG4gKiBVc2FnZTpcbiAqICAqIFR5cGljYWxseSBpc3N1ZWQgaW4gcmVzcG9uc2UgdG8gdGhlIHVzZXIgc2F5aW5nIHRoZXkgd2FudCB0byBjaGFuZ2UgYSB2YWx1ZSwgZS5nLiBcIlU6IFBsZWFzZSBjaGFuZ2UgdGhlIGV2ZW50IGRhdGUuXCJcbiAqL1xuZXhwb3J0IGNsYXNzIFJlcXVlc3RDaGFuZ2VkVmFsdWVBY3QgZXh0ZW5kcyBJbml0aWF0aXZlQWN0IHtcbiAgICBwYXlsb2FkOiBSZXF1ZXN0Q2hhbmdlZFZhbHVlUGF5bG9hZDtcblxuICAgIGNvbnN0cnVjdG9yKGNvbnRyb2w6IENvbnRyb2wsIHBheWxvYWQ6IFJlcXVlc3RDaGFuZ2VkVmFsdWVQYXlsb2FkKSB7XG4gICAgICAgIHN1cGVyKGNvbnRyb2wpO1xuICAgICAgICB0aGlzLnBheWxvYWQgPSBwYXlsb2FkO1xuICAgIH1cbiAgICByZW5kZXIoaW5wdXQ6IENvbnRyb2xJbnB1dCwgY29udHJvbFJlc3BvbnNlQnVpbGRlcjogQ29udHJvbFJlc3BvbnNlQnVpbGRlcik6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5wYXlsb2FkLnJlbmRlcmVkVGFyZ2V0ICE9PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgY29udHJvbFJlc3BvbnNlQnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudChgV2hhdCBpcyB0aGUgbmV3IHZhbHVlIGZvciAke3RoaXMucGF5bG9hZC5yZW5kZXJlZFRhcmdldH0uYCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBkaXJlY3RseSByZW5kZXIgUmVxdWVzdENoYW5nZWRWYWx1ZUFjdCBhcyBwYXlsb2FkLnJlbmRlcmVkVGFyZ2V0IGlzIHVuZGVmaW5lZC4gJHt0aGlzLnRvU3RyaW5nKCl9LiBgXG4gICAgICAgICAgICArIGBFaXRoZXIgcHJvdmlkZSBhIHJlbmRlcmVkVGFyZ2V0IHdoZW4gY3JlYXRpbmcgdGhlIGFjdCwgb3IgcmVuZGVyIHRoZSBhY3QgaW4gY29udHJvbC5yZW5kZXIoKSBvciBjb250cm9sTWFuYWdlci5yZW5kZXIoKWApO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5cbi8qKlxuICogQXNrcyB0aGUgdXNlciB0byBwcm92aWRlIGEgdmFsdWUgYnkgc3BlYWtpbmcgYW5kIHNob3dpbmcgaXRlbXMgaW4gdGhlIGZvcm0gb2YgYSBsaXN0LlxuICpcbiAqIERlZmF1bHQgcmVuZGVyaW5nIChlbi1VUyk6IFwiV2hhdCB2YWx1ZSBmb3IgKHJlbmRlcmVkVGFyZ2V0KT8gQ2hvaWNlcyBpbmNsdWRlIChyZW5kZXJlZENob2ljZXMpLlwiXG4gKlxuICogVXNhZ2U6XG4gKiAgKiBUeXBpY2FsbHkgaXNzdWVkIHdoZW4gYSBDb250cm9sIGdhaW5zIHRoZSBpbml0aWF0aXZlIGZvciB0aGUgZmlyc3QgdGltZSBhbmQgcmVxdWVzdHMgYSB2YWx1ZSBmb3IgdGhlIGZpcnN0IHRpbWUuXG4gKiAgKiBJZiB0aGUgc3lzdGVtIGFscmVhZHkgaGFzIGEgdmFsdWUgZnJvbSB0aGUgdXNlciBpdCBtYXkgYmUgcHJlZmVyYWJsZSB0byBpc3N1ZSBhIGBSZXF1ZXN0Q2hhbmdlZFZhbHVlQWN0YFxuICogICAgd2hpY2ggaXMgbW9yZSBzcGVjaWZpYyB0byB0aGF0IGNhc2UuXG4gKi9cbmV4cG9ydCBjbGFzcyBSZXF1ZXN0VmFsdWVCeUxpc3RBY3QgZXh0ZW5kcyBJbml0aWF0aXZlQWN0IHtcbiAgICBwYXlsb2FkOiBSZXF1ZXN0VmFsdWVCeUxpc3RQYXlsb2FkO1xuXG4gICAgY29uc3RydWN0b3IoY29udHJvbDogQ29udHJvbCwgcGF5bG9hZDogUmVxdWVzdFZhbHVlQnlMaXN0UGF5bG9hZCkge1xuICAgICAgICBzdXBlcihjb250cm9sKTtcbiAgICAgICAgdGhpcy5wYXlsb2FkID0gcGF5bG9hZDtcbiAgICB9XG4gICAgcmVuZGVyKGlucHV0OiBDb250cm9sSW5wdXQsIGNvbnRyb2xSZXNwb25zZUJ1aWxkZXI6IENvbnRyb2xSZXNwb25zZUJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMucGF5bG9hZC5yZW5kZXJlZFRhcmdldCAhPT0gdW5kZWZpbmVkICYmIHRoaXMucGF5bG9hZC5yZW5kZXJlZENob2ljZXMgIT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICBjb250cm9sUmVzcG9uc2VCdWlsZGVyLmFkZFByb21wdEZyYWdtZW50KGBXaGF0IHZhbHVlIGZvciAke3RoaXMucGF5bG9hZC5yZW5kZXJlZFRhcmdldH0/IENob2ljZXMgaW5jbHVkZSAke3RoaXMucGF5bG9hZC5yZW5kZXJlZENob2ljZXN9LmApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZGlyZWN0bHkgcmVuZGVyIFJlcXVlc3RWYWx1ZUJ5TGlzdCBhcyBwYXlsb2FkLnJlbmRlcmVkVGFyZ2V0IGFuZC9vciBwYXlsb2FkLnJlbmRlcmVkQ2hvaWNlcyBpcyB1bmRlZmluZWQuICR7dGhpcy50b1N0cmluZygpfS4gYFxuICAgICAgICAgICAgKyBgRWl0aGVyIHByb3ZpZGUgYSByZW5kZXJlZFRhcmdldCB3aGVuIGNyZWF0aW5nIHRoZSBhY3QsIG9yIHJlbmRlciB0aGUgYWN0IGluIGNvbnRyb2wucmVuZGVyKCkgb3IgY29udHJvbE1hbmFnZXIucmVuZGVyKClgKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBBc2tzIHRoZSB1c2VyIHRvIHByb3ZpZGUgYSBuZXcvdXBkYXRlZCB2YWx1ZSBieSBzcGVha2luZyBhbmQgc2hvd2luZyBpdGVtcyBpbiB0aGUgZm9ybSBvZiBhIGxpc3QuXG4gKlxuICogRGVmYXVsdCByZW5kZXJpbmcgKGVuLVVTKTogXCJXaGF0IGlzIHRoZSBuZXcgdmFsdWUgZm9yIChyZW5kZXJlZFRhcmdldCk/IENob2ljZXMgaW5jbHVkZSAocmVuZGVyZWRDaG9pY2VzKS5cIlxuICpcbiAqIFVzYWdlOlxuICogICogVHlwaWNhbGx5IGlzc3VlZCB3aGVuIGEgQ29udHJvbCBnYWlucyB0aGUgaW5pdGlhdGl2ZSBmb3IgdGhlIGZpcnN0IHRpbWUgYW5kIHJlcXVlc3RzIGEgdmFsdWUgZm9yIHRoZSBmaXJzdCB0aW1lLlxuICogICogSWYgdGhlIHN5c3RlbSBhbHJlYWR5IGhhcyBhIHZhbHVlIGZyb20gdGhlIHVzZXIgaXQgbWF5IGJlIHByZWZlcmFibGUgdG8gaXNzdWUgYSBgUmVxdWVzdENoYW5nZWRWYWx1ZUFjdGBcbiAqICAgIHdoaWNoIGlzIG1vcmUgc3BlY2lmaWMgdG8gdGhhdCBjYXNlLlxuICovXG5leHBvcnQgY2xhc3MgUmVxdWVzdENoYW5nZWRWYWx1ZUJ5TGlzdEFjdCBleHRlbmRzIEluaXRpYXRpdmVBY3Qge1xuICAgIHBheWxvYWQ6IFJlcXVlc3RDaGFuZ2VkVmFsdWVCeUxpc3RQYXlsb2FkO1xuXG4gICAgY29uc3RydWN0b3IoY29udHJvbDogQ29udHJvbCwgcGF5bG9hZDogUmVxdWVzdENoYW5nZWRWYWx1ZUJ5TGlzdFBheWxvYWQpIHtcbiAgICAgICAgc3VwZXIoY29udHJvbCk7XG4gICAgICAgIHRoaXMucGF5bG9hZCA9IHBheWxvYWQ7XG4gICAgfVxuICAgIHJlbmRlcihpbnB1dDogQ29udHJvbElucHV0LCBjb250cm9sUmVzcG9uc2VCdWlsZGVyOiBDb250cm9sUmVzcG9uc2VCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnBheWxvYWQucmVuZGVyZWRUYXJnZXQgIT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICBjb250cm9sUmVzcG9uc2VCdWlsZGVyLmFkZFByb21wdEZyYWdtZW50KGBXaGF0IGlzIHRoZSBuZXcgdmFsdWUgZm9yICR7dGhpcy5wYXlsb2FkLnJlbmRlcmVkVGFyZ2V0fT8gQ2hvaWNlcyBpbmNsdWRlICR7TGlzdEZvcm1hdHRpbmcuZm9ybWF0KHRoaXMucGF5bG9hZC5jaG9pY2VzRnJvbUFjdGl2ZVBhZ2UpfS5gKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGRpcmVjdGx5IHJlbmRlciBSZXF1ZXN0Q2hhbmdlVmFsdWVCeUxpc3QgYXMgcGF5bG9hZC5yZW5kZXJlZFRhcmdldCBpcyB1bmRlZmluZWQuICR7dGhpcy50b1N0cmluZygpfS4gYFxuICAgICAgICAgICAgKyBgRWl0aGVyIHByb3ZpZGUgYSByZW5kZXJlZFRhcmdldCB3aGVuIGNyZWF0aW5nIHRoZSBhY3QsIG9yIHJlbmRlciB0aGUgYWN0IGluIGNvbnRyb2wucmVuZGVyKCkgb3IgY29udHJvbE1hbmFnZXIucmVuZGVyKClgKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBBbiBpbml0aWF0aXZlIGFjdCB0aGF0IGFza3MgdGhlIHVzZXIgaWYgYSB2YWx1ZSBpcyBjb3JyZWN0LlxuICpcbiAqIERlZmF1bHRzOlxuICogICogVGhlIHJlcHJvbXB0RnJhZ21lbnQgZGVmYXVsdHMgdG8gYmUgaWRlbnRpY2FsIHRvIHByb21wdEZyYWdtZW50LlxuICpcbiAqL1xuZXhwb3J0IGNsYXNzIENvbmZpcm1WYWx1ZUFjdDxUPiBleHRlbmRzIEluaXRpYXRpdmVBY3Qge1xuICAgIHBheWxvYWQ6IFZhbHVlU2V0UGF5bG9hZDxUPjtcblxuICAgIGNvbnN0cnVjdG9yKGNvbnRyb2w6IENvbnRyb2wsIHBheWxvYWQ6IFZhbHVlU2V0UGF5bG9hZDxUPikge1xuICAgICAgICBzdXBlcihjb250cm9sKTtcbiAgICAgICAgdGhpcy5wYXlsb2FkID0gcGF5bG9hZDtcbiAgICB9XG4gICAgcmVuZGVyKGlucHV0OiBDb250cm9sSW5wdXQsIGNvbnRyb2xSZXNwb25zZUJ1aWxkZXI6IENvbnRyb2xSZXNwb25zZUJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgY29udHJvbFJlc3BvbnNlQnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudChgV2FzIHRoYXQgJHt0aGlzLnBheWxvYWQudmFsdWV9P2ApO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBbiBpbml0aWF0aXZlIGFjdCB0aGF0IGRlZmluZXMgbGl0ZXJhbCBwcm9tcHQgYW5kIHJlcHJvbXB0IGZyYWdtZW50cy5cbiAqXG4gKiBEZWZhdWx0czpcbiAqICAqIFRoZSByZXByb21wdEZyYWdtZW50IGRlZmF1bHRzIHRvIGJlIGlkZW50aWNhbCB0byBwcm9tcHRGcmFnbWVudC5cbiAqXG4gKiBVc2FnZTpcbiAqICAqIFVzZSBMaXRlcmFsSW5pdGlhdGl2ZUFjdCBvbmx5IGluIHNpbXBsZSBzaXR1YXRpb25zIHdoZXJlIGl0IHdvdWxkIGJlIGFubm95aW5nXG4gKiAgICB0byBjcmVhdGUgYSBuZXcgY3VzdG9tIGFjdCBvbmx5IHRvIGhhdmUgYSBzaW5nbGUgd2F5IHRvIHJlbmRlciBpdC5cbiAqICAqIEluIGNvbnRyYXN0LCBzcGVjaWZpYyBpbml0aWF0aXZlIGFjdHMgY29udmV5IGluZm9ybWF0aW9uIG1vcmUgY2xlYXJseSxcbiAqICAgIG1haW50YWluIGNvbnRyb2xsZXIvdmlldyBzZXBhcmF0aW9uIGFuZCBjYW4gb2Z0ZW4gYmUgcmV1c2VkIGluIGFkZGl0aW9uYWwgc2NlbmFyaW9zLlxuICovXG5leHBvcnQgY2xhc3MgTGl0ZXJhbEluaXRpYXRpdmVBY3QgZXh0ZW5kcyBJbml0aWF0aXZlQWN0IHtcbiAgICBwYXlsb2FkOiBMaXRlcmFsQ29udGVudFBheWxvYWQ7XG5cbiAgICBjb25zdHJ1Y3Rvcihjb250cm9sOiBDb250cm9sLCBwYXlsb2FkOiBMaXRlcmFsQ29udGVudFBheWxvYWQpIHtcbiAgICAgICAgc3VwZXIoY29udHJvbCk7XG4gICAgICAgIHRoaXMucGF5bG9hZCA9IHtcbiAgICAgICAgICAgIHByb21wdEZyYWdtZW50OiBwYXlsb2FkLnByb21wdEZyYWdtZW50LFxuICAgICAgICAgICAgcmVwcm9tcHRGcmFnbWVudDogcGF5bG9hZC5yZXByb21wdEZyYWdtZW50ID8/IHBheWxvYWQucHJvbXB0RnJhZ21lbnRcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmVuZGVyKGlucHV0OiBDb250cm9sSW5wdXQsIGNvbnRyb2xSZXNwb25zZUJ1aWxkZXI6IENvbnRyb2xSZXNwb25zZUJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgY29udHJvbFJlc3BvbnNlQnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLnBheWxvYWQucHJvbXB0RnJhZ21lbnQpO1xuICAgICAgICBjb250cm9sUmVzcG9uc2VCdWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5wYXlsb2FkLnJlcHJvbXB0RnJhZ21lbnQhKTtcbiAgICB9XG59XG5cbi8qKlxuICogQW4gaW5pdGlhdGl2ZSBhY3QgdGhhdCBzdWdnZXN0cyBhIHNwZWNpZmljIHZhbHVlIHdpdGggYSBhc2tzIHllcy9ubyBxdWVzdGlvbi5cbiAqXG4gKiBEZWZhdWx0czpcbiAqICAqIFRoZSByZXByb21wdEZyYWdtZW50IGRlZmF1bHRzIHRvIGJlIGlkZW50aWNhbCB0byBwcm9tcHRGcmFnbWVudC5cbiAqXG4gKlxuICovXG5leHBvcnQgY2xhc3MgU3VnZ2VzdFZhbHVlQWN0PFQ+IGV4dGVuZHMgSW5pdGlhdGl2ZUFjdCB7XG4gICAgcGF5bG9hZDogVmFsdWVTZXRQYXlsb2FkPFQ+O1xuXG4gICAgY29uc3RydWN0b3IoY29udHJvbDogQ29udHJvbCwgcGF5bG9hZDogVmFsdWVTZXRQYXlsb2FkPFQ+KSB7XG4gICAgICAgIHN1cGVyKGNvbnRyb2wpO1xuICAgICAgICB0aGlzLnBheWxvYWQgPSBwYXlsb2FkO1xuICAgIH1cbiAgICByZW5kZXIoaW5wdXQ6IENvbnRyb2xJbnB1dCwgY29udHJvbFJlc3BvbnNlQnVpbGRlcjogQ29udHJvbFJlc3BvbnNlQnVpbGRlcik6IHZvaWQge1xuICAgICAgICAvLyBUT0RPOiBidWc6IGNoYW5nZSB0aGUgbWVzc2FnZSB0byBpMThuXG4gICAgICAgIGNvbnRyb2xSZXNwb25zZUJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQoYERpZCB5b3UgcGVyaGFwcyBtZWFuICR7dGhpcy5wYXlsb2FkLnZhbHVlfT9gKTtcbiAgICB9XG59XG4iXX0=