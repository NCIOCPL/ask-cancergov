"use strict";
/*
 * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License').
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the 'license' file accompanying this file. This file is distributed
 * on an 'AS IS' BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const mocha_1 = require("mocha");
const Strings_1 = require("../../src/constants/Strings");
const ControlManager_1 = require("../../src/controls/ControlManager");
const SingleValueControlIntent_1 = require("../../src/intents/SingleValueControlIntent");
const ControlHandler_1 = require("../../src/runtime/ControlHandler");
const TestingUtils_1 = require("../../src/utils/testSupport/TestingUtils");
const ListControl_1 = require("../../src/commonControls/listControl/ListControl");
const IntentUtils_1 = require("../../src/utils/IntentUtils");
const AmazonBuiltInIntent_1 = require("../../src/intents/AmazonBuiltInIntent");
TestingUtils_1.waitForDebugger();
mocha_1.suite('ListControl e2e tests', () => {
    class ListControlManager extends ControlManager_1.ControlManager {
        createControlTree(state) {
            return new ListControl_1.ListControl({
                id: 'apple',
                validation: (state, input) => ['iPhone', 'iPad', 'MacBook'].includes(state.value) ? true : { renderedReason: 'Apple Suite category validation failed' },
                listItemIDs: ['iPhone', 'iPad', 'MacBook'],
                slotType: 'AppleSuite',
                confirmationRequired: true,
                prompts: {
                    valueSet: '',
                }
            });
        }
    }
    mocha_1.test('product value valid, needs explicit affirming', async () => {
        const requestHandler = new ControlHandler_1.ControlHandler(new ListControlManager());
        await TestingUtils_1.testE2E(requestHandler, [
            'U: iPhone', TestingUtils_1.TestInput.of(SingleValueControlIntent_1.SingleValueControlIntent.of('AppleSuite', { AppleSuite: 'iPhone' })),
            'A: Was that iPhone?',
            'U: Yeah.', TestingUtils_1.TestInput.of(IntentUtils_1.IntentBuilder.of(AmazonBuiltInIntent_1.AmazonIntent.YesIntent)),
            'A: Great.'
        ]);
    });
    mocha_1.test('product value after disaffirmation, requires request value act', async () => {
        const requestHandler = new ControlHandler_1.ControlHandler(new ListControlManager());
        await TestingUtils_1.testE2E(requestHandler, [
            'U: iPhone', TestingUtils_1.TestInput.of(SingleValueControlIntent_1.SingleValueControlIntent.of('AppleSuite', { AppleSuite: 'iPhone' })),
            'A: Was that iPhone?',
            'U: No.', TestingUtils_1.TestInput.of(IntentUtils_1.IntentBuilder.of(AmazonBuiltInIntent_1.AmazonIntent.NoIntent)),
            'A: My mistake. What is your selection? Some suggestions are iPhone, iPad or MacBook.'
        ]);
    });
    mocha_1.test('product value set and changing it requires confirmation and value changed act', async () => {
        const requestHandler = new ControlHandler_1.ControlHandler(new ListControlManager());
        await TestingUtils_1.testE2E(requestHandler, [
            'U: iPhone', TestingUtils_1.TestInput.of(SingleValueControlIntent_1.SingleValueControlIntent.of('AppleSuite', { AppleSuite: 'iPhone' })),
            'A: Was that iPhone?',
            'U: Yes.', TestingUtils_1.TestInput.of(IntentUtils_1.IntentBuilder.of(AmazonBuiltInIntent_1.AmazonIntent.YesIntent)),
            'A: Great.',
            'U: Change to iPad.', TestingUtils_1.TestInput.of(SingleValueControlIntent_1.SingleValueControlIntent.of('AppleSuite', { AppleSuite: 'iPad', action: Strings_1.Strings.Action.Change })),
            'A: OK, I changed it to iPad. Was that iPad?',
            'U: Yes.', TestingUtils_1.TestInput.of(IntentUtils_1.IntentBuilder.of(AmazonBuiltInIntent_1.AmazonIntent.YesIntent)),
            'A: Great.'
        ]);
    });
    mocha_1.test('product value set and changing it to invalid requires confirmation and checks for validations', async () => {
        const requestHandler = new ControlHandler_1.ControlHandler(new ListControlManager());
        await TestingUtils_1.testE2E(requestHandler, [
            'U: iPhone', TestingUtils_1.TestInput.of(SingleValueControlIntent_1.SingleValueControlIntent.of('AppleSuite', { AppleSuite: 'iPhone' })),
            'A: Was that iPhone?',
            'U: Yes.', TestingUtils_1.TestInput.of(IntentUtils_1.IntentBuilder.of(AmazonBuiltInIntent_1.AmazonIntent.YesIntent)),
            'A: Great.',
            'U: Change to Airpods.', TestingUtils_1.TestInput.of(SingleValueControlIntent_1.SingleValueControlIntent.of('AppleSuite', { AppleSuite: 'Airpods', action: Strings_1.Strings.Action.Change })),
            'A: Sorry, Airpods is not a valid choice because Apple Suite category validation failed. What should I change it to? Some suggestions are iPhone, iPad or MacBook.',
            'U: iPad', TestingUtils_1.TestInput.of(SingleValueControlIntent_1.SingleValueControlIntent.of('AppleSuite', { AppleSuite: 'iPad' })),
            'A: OK, I changed it to iPad. Was that iPad?',
            'U: No.', TestingUtils_1.TestInput.of(IntentUtils_1.IntentBuilder.of(AmazonBuiltInIntent_1.AmazonIntent.NoIntent)),
            'A: My mistake. What is your selection? Some suggestions are iPhone, iPad or MacBook.',
            'U: iPad', TestingUtils_1.TestInput.of(SingleValueControlIntent_1.SingleValueControlIntent.of('AppleSuite', { AppleSuite: 'iPad' })),
            'A: OK, I changed it to iPad. Was that iPad?',
            'U: Yes.', TestingUtils_1.TestInput.of(IntentUtils_1.IntentBuilder.of(AmazonBuiltInIntent_1.AmazonIntent.YesIntent)),
            'A: Great.'
        ]);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTGlzdENvbnRyb2wuc3BlYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Rlc3QvY29tbW9uQ29udHJvbFRlc3RzL0xpc3RDb250cm9sLnNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7OztHQVdHOztBQUVILGlDQUFvQztBQUNwQyx5REFBMkQ7QUFFM0Qsc0VBQW1FO0FBQ25FLHlGQUFzRjtBQUN0RixxRUFBa0U7QUFDbEUsMkVBQStGO0FBQy9GLGtGQUErRTtBQUMvRSw2REFBNEQ7QUFDNUQsK0VBQXFFO0FBRXJFLDhCQUFlLEVBQUUsQ0FBQztBQUVsQixhQUFLLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO0lBQ2hDLE1BQU0sa0JBQW1CLFNBQVEsK0JBQWM7UUFDM0MsaUJBQWlCLENBQUMsS0FBVTtZQUN4QixPQUFPLElBQUkseUJBQVcsQ0FBQztnQkFDbkIsRUFBRSxFQUFFLE9BQU87Z0JBQ1gsVUFBVSxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFLFNBQVMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxjQUFjLEVBQUUsd0NBQXdDLEVBQUU7Z0JBQ3hKLFdBQVcsRUFBRSxDQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUUsU0FBUyxDQUFDO2dCQUMxQyxRQUFRLEVBQUUsWUFBWTtnQkFDdEIsb0JBQW9CLEVBQUUsSUFBSTtnQkFDMUIsT0FBTyxFQUFFO29CQUNMLFFBQVEsRUFBRSxFQUFFO2lCQUNmO2FBQ0osQ0FBQyxDQUFDO1FBQ1AsQ0FBQztLQUNKO0lBRUQsWUFBSSxDQUFDLCtDQUErQyxFQUFFLEtBQUssSUFBSSxFQUFFO1FBQzdELE1BQU0sY0FBYyxHQUFHLElBQUksK0JBQWMsQ0FBQyxJQUFJLGtCQUFrQixFQUFFLENB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Q0FBQyxDQUFDO1lBQ25JLG1LQUFtSztZQUNuSyxTQUFTLEVBQUUsd0JBQVMsQ0FBQyxFQUFFLENBQUMsbURBQXdCLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQzFGLDZDQUE2QztZQUM3QyxRQUFRLEVBQUUsd0JBQVMsQ0FBQyxFQUFFLENBQUMsMkJBQWEsQ0FBQyxFQUFFLENBQUMsa0NBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUMvRCxzRkFBc0Y7WUFDdEYsU0FBUyxFQUFFLHdCQUFTLENBQUMsRUFBRSxDQUFDLG1EQUF3QixDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUMxRiw2Q0FBNkM7WUFDN0MsU0FBUyxFQUFFLHdCQUFTLENBQUMsRUFBRSxDQUFDLDJCQUFhLENBQUMsRUFBRSxDQUFDLGtDQUFZLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDakUsV0FBVztTQUNkLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMjAgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAnTGljZW5zZScpLlxuICogWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogb3IgaW4gdGhlICdsaWNlbnNlJyBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZFxuICogb24gYW4gJ0FTIElTJyBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlclxuICogZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmdcbiAqIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBzdWl0ZSwgdGVzdCB9IGZyb20gJ21vY2hhJztcbmltcG9ydCB7IFN0cmluZ3MgYXMgJCB9IGZyb20gXCIuLi8uLi9zcmMvY29uc3RhbnRzL1N0cmluZ3NcIjtcbmltcG9ydCB7IENvbnRyb2wgfSBmcm9tICcuLi8uLi9zcmMvY29udHJvbHMvQ29udHJvbCc7XG5pbXBvcnQgeyBDb250cm9sTWFuYWdlciB9IGZyb20gJy4uLy4uL3NyYy9jb250cm9scy9Db250cm9sTWFuYWdlcic7XG5pbXBvcnQgeyBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQgfSBmcm9tICcuLi8uLi9zcmMvaW50ZW50cy9TaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQnO1xuaW1wb3J0IHsgQ29udHJvbEhhbmRsZXIgfSBmcm9tICcuLi8uLi9zcmMvcnVudGltZS9Db250cm9sSGFuZGxlcic7XG5pbXBvcnQgeyB0ZXN0RTJFLCBUZXN0SW5wdXQsIHdhaXRGb3JEZWJ1Z2dlciB9IGZyb20gJy4uLy4uL3NyYy91dGlscy90ZXN0U3VwcG9ydC9UZXN0aW5nVXRpbHMnO1xuaW1wb3J0IHsgTGlzdENvbnRyb2wgfSBmcm9tICcuLi8uLi9zcmMvY29tbW9uQ29udHJvbHMvbGlzdENvbnRyb2wvTGlzdENvbnRyb2wnO1xuaW1wb3J0IHsgSW50ZW50QnVpbGRlciB9IGZyb20gJy4uLy4uL3NyYy91dGlscy9JbnRlbnRVdGlscyc7XG5pbXBvcnQgeyBBbWF6b25JbnRlbnQgfSBmcm9tICcuLi8uLi9zcmMvaW50ZW50cy9BbWF6b25CdWlsdEluSW50ZW50Jztcblxud2FpdEZvckRlYnVnZ2VyKCk7XG5cbnN1aXRlKCdMaXN0Q29udHJvbCBlMmUgdGVzdHMnLCAoKSA9PiB7XG4gICAgY2xhc3MgTGlzdENvbnRyb2xNYW5hZ2VyIGV4dGVuZHMgQ29udHJvbE1hbmFnZXIge1xuICAgICAgICBjcmVhdGVDb250cm9sVHJlZShzdGF0ZTogYW55KTogQ29udHJvbCB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IExpc3RDb250cm9sKHtcbiAgICAgICAgICAgICAgICBpZDogJ2FwcGxlJyxcbiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uOiAoc3RhdGUsIGlucHV0KSA9PiBbJ2lQaG9uZScsICdpUGFkJywgJ01hY0Jvb2snXS5pbmNsdWRlcyhzdGF0ZS52YWx1ZSEpID8gdHJ1ZSA6IHsgcmVuZGVyZWRSZWFzb246ICdBcHBsZSBTdWl0ZSBjYXRlZ29yeSB2YWxpZGF0aW9uIGZhaWxlZCcgfSxcbiAgICAgICAgICAgICAgICBsaXN0SXRlbUlEczogWydpUGhvbmUnLCAnaVBhZCcsICdNYWNCb29rJ10sXG4gICAgICAgICAgICAgICAgc2xvdFR5cGU6ICdBcHBsZVN1aXRlJyxcbiAgICAgICAgICAgICAgICBjb25maXJtYXRpb25SZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwcm9tcHRzOiB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlU2V0OiAnJyxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHRlc3QoJ3Byb2R1Y3QgdmFsdWUgdmFsaWQsIG5lZWRzIGV4cGxpY2l0IGFmZmlybWluZycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVxdWVzdEhhbmRsZXIgPSBuZXcgQ29udHJvbEhhbmRsZXIobmV3IExpc3RDb250cm9sTWFuYWdlcigpKTtcbiAgICAgICAgYXdhaXQgdGVzdEUyRShyZXF1ZXN0SGFuZGxlciwgW1xuICAgICAgICAgICAgJ1U6IGlQaG9uZScsIFRlc3RJbnB1dC5vZihTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQub2YoJ0FwcGxlU3VpdGUnLCB7IEFwcGxlU3VpdGU6ICdpUGhvbmUnIH0pKSxcbiAgICAgICAgICAgICdBOiBXYXMgdGhhdCBpUGhvbmU/JyxcbiAgICAgICAgICAgICdVOiBZZWFoLicsIFRlc3RJbnB1dC5vZihJbnRlbnRCdWlsZGVyLm9mKEFtYXpvbkludGVudC5ZZXNJbnRlbnQpKSxcbiAgICAgICAgICAgICdBOiBHcmVhdC4nXG4gICAgICAgIF0pO1xuICAgIH0pO1xuXG4gICAgdGVzdCgncHJvZHVjdCB2YWx1ZSBhZnRlciBkaXNhZmZpcm1hdGlvbiwgcmVxdWlyZXMgcmVxdWVzdCB2YWx1ZSBhY3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3RIYW5kbGVyID0gbmV3IENvbnRyb2xIYW5kbGVyKG5ldyBMaXN0Q29udHJvbE1hbmFnZXIoKSk7XG4gICAgICAgIGF3YWl0IHRlc3RFMkUocmVxdWVzdEhhbmRsZXIsIFtcbiAgICAgICAgICAgICdVOiBpUGhvbmUnLCBUZXN0SW5wdXQub2YoU2luZ2xlVmFsdWVDb250cm9sSW50ZW50Lm9mKCdBcHBsZVN1aXRlJywgeyBBcHBsZVN1aXRlOiAnaVBob25lJyB9KSksXG4gICAgICAgICAgICAnQTogV2FzIHRoYXQgaVBob25lPycsXG4gICAgICAgICAgICAnVTogTm8uJywgVGVzdElucHV0Lm9mKEludGVudEJ1aWxkZXIub2YoQW1hem9uSW50ZW50Lk5vSW50ZW50KSksXG4gICAgICAgICAgICAnQTogTXkgbWlzdGFrZS4gV2hhdCBpcyB5b3VyIHNlbGVjdGlvbj8gU29tZSBzdWdnZXN0aW9ucyBhcmUgaVBob25lLCBpUGFkIG9yIE1hY0Jvb2suJ1xuICAgICAgICBdKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Byb2R1Y3QgdmFsdWUgc2V0IGFuZCBjaGFuZ2luZyBpdCByZXF1aXJlcyBjb25maXJtYXRpb24gYW5kIHZhbHVlIGNoYW5nZWQgYWN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXF1ZXN0SGFuZGxlciA9IG5ldyBDb250cm9sSGFuZGxlcihuZXcgTGlzdENvbnRyb2xNYW5hZ2VyKCkpO1xuICAgICAgICBhd2FpdCB0ZXN0RTJFKHJlcXVlc3RIYW5kbGVyLCBbXG4gICAgICAgICAgICAnVTogaVBob25lJywgVGVzdElucHV0Lm9mKFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5vZignQXBwbGVTdWl0ZScsIHsgQXBwbGVTdWl0ZTogJ2lQaG9uZScgfSkpLFxuICAgICAgICAgICAgJ0E6IFdhcyB0aGF0IGlQaG9uZT8nLFxuICAgICAgICAgICAgJ1U6IFllcy4nLCBUZXN0SW5wdXQub2YoSW50ZW50QnVpbGRlci5vZihBbWF6b25JbnRlbnQuWWVzSW50ZW50KSksXG4gICAgICAgICAgICAnQTogR3JlYXQuJyxcbiAgICAgICAgICAgICdVOiBDaGFuZ2UgdG8gaVBhZC4nLCBUZXN0SW5wdXQub2YoU2luZ2xlVmFsdWVDb250cm9sSW50ZW50Lm9mKCdBcHBsZVN1aXRlJywgeyBBcHBsZVN1aXRlOiAnaVBhZCcsIGFjdGlvbjogJC5BY3Rpb24uQ2hhbmdlfSkpLFxuICAgICAgICAgICAgJ0E6IE9LLCBJIGNoYW5nZWQgaXQgdG8gaVBhZC4gV2FzIHRoYXQgaVBhZD8nLFxuICAgICAgICAgICAgJ1U6IFllcy4nLCBUZXN0SW5wdXQub2YoSW50ZW50QnVpbGRlci5vZihBbWF6b25JbnRlbnQuWWVzSW50ZW50KSksXG4gICAgICAgICAgICAnQTogR3JlYXQuJ1xuICAgICAgICBdKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Byb2R1Y3QgdmFsdWUgc2V0IGFuZCBjaGFuZ2luZyBpdCB0byBpbnZhbGlkIHJlcXVpcmVzIGNvbmZpcm1hdGlvbiBhbmQgY2hlY2tzIGZvciB2YWxpZGF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVxdWVzdEhhbmRsZXIgPSBuZXcgQ29udHJvbEhhbmRsZXIobmV3IExpc3RDb250cm9sTWFuYWdlcigpKTtcbiAgICAgICAgYXdhaXQgdGVzdEUyRShyZXF1ZXN0SGFuZGxlciwgW1xuICAgICAgICAgICAgJ1U6IGlQaG9uZScsIFRlc3RJbnB1dC5vZihTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQub2YoJ0FwcGxlU3VpdGUnLCB7IEFwcGxlU3VpdGU6ICdpUGhvbmUnIH0pKSxcbiAgICAgICAgICAgICdBOiBXYXMgdGhhdCBpUGhvbmU/JyxcbiAgICAgICAgICAgICdVOiBZZXMuJywgVGVzdElucHV0Lm9mKEludGVudEJ1aWxkZXIub2YoQW1hem9uSW50ZW50Llllc0ludGVudCkpLFxuICAgICAgICAgICAgJ0E6IEdyZWF0LicsXG4gICAgICAgICAgICAnVTogQ2hhbmdlIHRvIEFpcnBvZHMuJywgVGVzdElucHV0Lm9mKFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5vZignQXBwbGVTdWl0ZScsIHsgQXBwbGVTdWl0ZTogJ0FpcnBvZHMnLCBhY3Rpb246ICQuQWN0aW9uLkNoYW5nZX0pKSxcbiAgICAgICAgICAgICdBOiBTb3JyeSwgQWlycG9kcyBpcyBub3QgYSB2YWxpZCBjaG9pY2UgYmVjYXVzZSBBcHBsZSBTdWl0ZSBjYXRlZ29yeSB2YWxpZGF0aW9uIGZhaWxlZC4gV2hhdCBzaG91bGQgSSBjaGFuZ2UgaXQgdG8/IFNvbWUgc3VnZ2VzdGlvbnMgYXJlIGlQaG9uZSwgaVBhZCBvciBNYWNCb29rLicsXG4gICAgICAgICAgICAnVTogaVBhZCcsIFRlc3RJbnB1dC5vZihTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQub2YoJ0FwcGxlU3VpdGUnLCB7IEFwcGxlU3VpdGU6ICdpUGFkJyB9KSksXG4gICAgICAgICAgICAnQTogT0ssIEkgY2hhbmdlZCBpdCB0byBpUGFkLiBXYXMgdGhhdCBpUGFkPycsXG4gICAgICAgICAgICAnVTogTm8uJywgVGVzdElucHV0Lm9mKEludGVudEJ1aWxkZXIub2YoQW1hem9uSW50ZW50Lk5vSW50ZW50KSksXG4gICAgICAgICAgICAnQTogTXkgbWlzdGFrZS4gV2hhdCBpcyB5b3VyIHNlbGVjdGlvbj8gU29tZSBzdWdnZXN0aW9ucyBhcmUgaVBob25lLCBpUGFkIG9yIE1hY0Jvb2suJyxcbiAgICAgICAgICAgICdVOiBpUGFkJywgVGVzdElucHV0Lm9mKFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5vZignQXBwbGVTdWl0ZScsIHsgQXBwbGVTdWl0ZTogJ2lQYWQnIH0pKSxcbiAgICAgICAgICAgICdBOiBPSywgSSBjaGFuZ2VkIGl0IHRvIGlQYWQuIFdhcyB0aGF0IGlQYWQ/JyxcbiAgICAgICAgICAgICdVOiBZZXMuJywgVGVzdElucHV0Lm9mKEludGVudEJ1aWxkZXIub2YoQW1hem9uSW50ZW50Llllc0ludGVudCkpLFxuICAgICAgICAgICAgJ0E6IEdyZWF0LidcbiAgICAgICAgXSk7XG4gICAgfSk7XG59KTtcbiJdfQ==