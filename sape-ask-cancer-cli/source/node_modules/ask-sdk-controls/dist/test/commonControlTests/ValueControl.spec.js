"use strict";
/*
 * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License').
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the 'license' file accompanying this file. This file is distributed
 * on an 'AS IS' BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const mocha_1 = require("mocha");
const Strings_1 = require("../../src/constants/Strings");
const ControlManager_1 = require("../../src/controls/ControlManager");
const SingleValueControlIntent_1 = require("../../src/intents/SingleValueControlIntent");
const AmazonBuiltInIntent_1 = require("../../src/intents/AmazonBuiltInIntent");
const ControlHandler_1 = require("../../src/runtime/ControlHandler");
const TestingUtils_1 = require("../../src/utils/testSupport/TestingUtils");
const ValueControl_1 = require("../../src/commonControls/ValueControl");
const IntentUtils_1 = require("../../src/utils/IntentUtils");
TestingUtils_1.waitForDebugger();
mocha_1.suite('ValueControl e2e tests', () => {
    class ValueControlManager extends ControlManager_1.ControlManager {
        createControlTree(state) {
            return new ValueControl_1.ValueControl({
                id: 'userName',
                slotType: 'LOGIN.name',
                confirmationRequired: true,
                validation: (state, input) => ['Alexa', 'Amazon', 'Redfox'].includes(state.value) ? true : { renderedReason: 'Login name validation failed' },
                prompts: {
                    requestValue: 'What is your login name?',
                    valueSet: ''
                },
            });
        }
    }
    mocha_1.test('userName value valid, needs explicit affirming', async () => {
        const requestHandler = new ControlHandler_1.ControlHandler(new ValueControlManager());
        await TestingUtils_1.testE2E(requestHandler, [
            'U: Amazon', TestingUtils_1.TestInput.of(SingleValueControlIntent_1.SingleValueControlIntent.of('LOGIN.name', { 'LOGIN.name': 'Amazon' })),
            'A: Was that Amazon?',
            'U: Yeah.', TestingUtils_1.TestInput.of(IntentUtils_1.IntentBuilder.of(AmazonBuiltInIntent_1.AmazonIntent.YesIntent)),
            'A: Great.'
        ]);
    });
    mocha_1.test('userName value after disaffirmation, requires request value act', async () => {
        const requestHandler = new ControlHandler_1.ControlHandler(new ValueControlManager());
        await TestingUtils_1.testE2E(requestHandler, [
            'U: Amazon', TestingUtils_1.TestInput.of(SingleValueControlIntent_1.SingleValueControlIntent.of('LOGIN.name', { 'LOGIN.name': 'Amazon' })),
            'A: Was that Amazon?',
            'U: No.', TestingUtils_1.TestInput.of(IntentUtils_1.IntentBuilder.of(AmazonBuiltInIntent_1.AmazonIntent.NoIntent)),
            'A: My mistake. What is your login name?'
        ]);
    });
    mocha_1.test('userName value set and changing it requires confirmation and value changed act', async () => {
        const requestHandler = new ControlHandler_1.ControlHandler(new ValueControlManager());
        await TestingUtils_1.testE2E(requestHandler, [
            'U: Alexa', TestingUtils_1.TestInput.of(SingleValueControlIntent_1.SingleValueControlIntent.of('LOGIN.name', { 'LOGIN.name': 'Alexa' })),
            'A: Was that Alexa?',
            'U: Yes.', TestingUtils_1.TestInput.of(IntentUtils_1.IntentBuilder.of(AmazonBuiltInIntent_1.AmazonIntent.YesIntent)),
            'A: Great.',
            'U: Change to Redfox.', TestingUtils_1.TestInput.of(SingleValueControlIntent_1.SingleValueControlIntent.of('LOGIN.name', { 'LOGIN.name': 'Redfox', "action": Strings_1.Strings.Action.Change })),
            'A: OK, I changed it to Redfox. Was that Redfox?',
            'U: Yes.', TestingUtils_1.TestInput.of(IntentUtils_1.IntentBuilder.of(AmazonBuiltInIntent_1.AmazonIntent.YesIntent)),
            'A: Great.',
        ]);
    });
    mocha_1.test('userName value set and changing it to invalid requires confirmation and checks for validations', async () => {
        const requestHandler = new ControlHandler_1.ControlHandler(new ValueControlManager());
        await TestingUtils_1.testE2E(requestHandler, [
            'U: Alexa', TestingUtils_1.TestInput.of(SingleValueControlIntent_1.SingleValueControlIntent.of('LOGIN.name', { 'LOGIN.name': 'Alexa' })),
            'A: Was that Alexa?',
            'U: Yes.', TestingUtils_1.TestInput.of(IntentUtils_1.IntentBuilder.of(AmazonBuiltInIntent_1.AmazonIntent.YesIntent)),
            'A: Great.',
            'U: Change to Apple.', TestingUtils_1.TestInput.of(SingleValueControlIntent_1.SingleValueControlIntent.of('LOGIN.name', { 'LOGIN.name': 'Apple', "action": Strings_1.Strings.Action.Change })),
            'A: Sorry, Apple is not a valid choice because Login name validation failed. What should I change it to?',
            'U: Amazon', TestingUtils_1.TestInput.of(SingleValueControlIntent_1.SingleValueControlIntent.of('LOGIN.name', { 'LOGIN.name': 'Amazon' })),
            'A: OK, I changed it to Amazon. Was that Amazon?',
            'U: No.', TestingUtils_1.TestInput.of(IntentUtils_1.IntentBuilder.of(AmazonBuiltInIntent_1.AmazonIntent.NoIntent)),
            'A: My mistake. What is your login name?',
            'U: Amazon', TestingUtils_1.TestInput.of(SingleValueControlIntent_1.SingleValueControlIntent.of('LOGIN.name', { 'LOGIN.name': 'Amazon' })),
            'A: OK, I changed it to Amazon. Was that Amazon?',
            'U: Yes.', TestingUtils_1.TestInput.of(IntentUtils_1.IntentBuilder.of(AmazonBuiltInIntent_1.AmazonIntent.YesIntent)),
            'A: Great.'
        ]);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmFsdWVDb250cm9sLnNwZWMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi90ZXN0L2NvbW1vbkNvbnRyb2xUZXN0cy9WYWx1ZUNvbnRyb2wuc3BlYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7O0FBRUgsaUNBQW9DO0FBQ3BDLHlEQUEyRDtBQUUzRCxzRUFBbUU7QUFDbkUseUZBQXNGO0FBQ3RGLCtFQUFxRTtBQUNyRSxxRUFBa0U7QUFDbEUsMkVBQStGO0FBQy9GLHdFQUFxRTtBQUNyRSw2REFBNEQ7QUFFNUQsOEJBQWUsRUFBRSxDQUFDO0FBRWxCLGFBQUssQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUU7SUFDakMsTUFBTSxtQkFBb0IsU0FBUSwrQkFBYztRQUM1QyxpQkFBaUIsQ0FBQyxLQUFVO1lBQ3hCLE9BQU8sSUFBSSwyQkFBWSxDQUFDO2dCQUNwQixFQUFFLEVBQUUsVUFBVTtnQkFDZCxRQUFRLEVBQUUsWUFBWTtnQkFDdEIsb0JBQW9CLEVBQUUsSUFBSTtnQkFDMUIsVUFBVSxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxjQUFjLEVBQUUsOEJBQThCLEVBQUU7Z0JBQzlJLE9BQU8sRUFBRTtvQkFDTCxZQUFZLEVBQUUsMEJBQTBCO29CQUN4QyxRQUFRLEVBQUUsRUFBRTtpQkFDZjthQUNKLENBQUMsQ0FBQztRQUNQLENBQUM7S0FDSjtJQUVELFlBQUksQ0FBQyxnREFBZ0QsRUFBRSxLQUFLLElBQUksRUFBRTtRQUM5RCxNQUFNLGNBQWMsR0FBRyxJQUFJLCtCQUFjLENBQUMsSUFBSSxtQkFBbUIsRUFBRSxDQUFDLENBQUM7UUFDckUsTUFBTSxzQkFBTyxD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ekcsV0FBVyxFQUFFLHdCQUFTLENBQUMsRUFBRSxDQUFDLG1EQUF3QixDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQztZQUNoRyxpREFBaUQ7WUFDakQsUUFBUSxFQUFFLHdCQUFTLENBQUMsRUFBRSxDQUFDLDJCQUFhLENBQUMsRUFBRSxDQUFDLGtDQUFZLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDL0QseUNBQXlDO1lBQ3pDLFdBQVcsRUFBRSx3QkFBUyxDQUFDLEVBQUUsQ0FBQyxtREFBd0IsQ0FBQyxFQUFFLENBQUMsWUFBWSxFQUFFLEVBQUUsWUFBWSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUM7WUFDaEcsaURBQWlEO1lBQ2pELFNBQVMsRUFBRSx3QkFBUyxDQUFDLEVBQUUsQ0FBQywyQkFBYSxDQUFDLEVBQUUsQ0FBQyxrQ0FBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ2pFLFdBQVc7U0FDZCxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAyMDIwIEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgJ0xpY2Vuc2UnKS5cbiAqIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIG9yIGluIHRoZSAnbGljZW5zZScgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWRcbiAqIG9uIGFuICdBUyBJUycgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXJcbiAqIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nXG4gKiBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgc3VpdGUsIHRlc3QgfSBmcm9tICdtb2NoYSc7XG5pbXBvcnQgeyBTdHJpbmdzIGFzICQgfSBmcm9tIFwiLi4vLi4vc3JjL2NvbnN0YW50cy9TdHJpbmdzXCI7XG5pbXBvcnQgeyBDb250cm9sIH0gZnJvbSAnLi4vLi4vc3JjL2NvbnRyb2xzL0NvbnRyb2wnO1xuaW1wb3J0IHsgQ29udHJvbE1hbmFnZXIgfSBmcm9tICcuLi8uLi9zcmMvY29udHJvbHMvQ29udHJvbE1hbmFnZXInO1xuaW1wb3J0IHsgU2luZ2xlVmFsdWVDb250cm9sSW50ZW50IH0gZnJvbSAnLi4vLi4vc3JjL2ludGVudHMvU2luZ2xlVmFsdWVDb250cm9sSW50ZW50JztcbmltcG9ydCB7IEFtYXpvbkludGVudCB9IGZyb20gJy4uLy4uL3NyYy9pbnRlbnRzL0FtYXpvbkJ1aWx0SW5JbnRlbnQnO1xuaW1wb3J0IHsgQ29udHJvbEhhbmRsZXIgfSBmcm9tICcuLi8uLi9zcmMvcnVudGltZS9Db250cm9sSGFuZGxlcic7XG5pbXBvcnQgeyB0ZXN0RTJFLCBUZXN0SW5wdXQsIHdhaXRGb3JEZWJ1Z2dlciB9IGZyb20gJy4uLy4uL3NyYy91dGlscy90ZXN0U3VwcG9ydC9UZXN0aW5nVXRpbHMnO1xuaW1wb3J0IHsgVmFsdWVDb250cm9sIH0gZnJvbSAnLi4vLi4vc3JjL2NvbW1vbkNvbnRyb2xzL1ZhbHVlQ29udHJvbCc7XG5pbXBvcnQgeyBJbnRlbnRCdWlsZGVyIH0gZnJvbSAnLi4vLi4vc3JjL3V0aWxzL0ludGVudFV0aWxzJztcblxud2FpdEZvckRlYnVnZ2VyKCk7XG5cbnN1aXRlKCdWYWx1ZUNvbnRyb2wgZTJlIHRlc3RzJywgKCkgPT4ge1xuICAgIGNsYXNzIFZhbHVlQ29udHJvbE1hbmFnZXIgZXh0ZW5kcyBDb250cm9sTWFuYWdlciB7XG4gICAgICAgIGNyZWF0ZUNvbnRyb2xUcmVlKHN0YXRlOiBhbnkpOiBDb250cm9sIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmFsdWVDb250cm9sKHtcbiAgICAgICAgICAgICAgICBpZDogJ3VzZXJOYW1lJyxcbiAgICAgICAgICAgICAgICBzbG90VHlwZTogJ0xPR0lOLm5hbWUnLFxuICAgICAgICAgICAgICAgIGNvbmZpcm1hdGlvblJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHZhbGlkYXRpb246IChzdGF0ZSwgaW5wdXQpID0+IFsnQWxleGEnLCAnQW1hem9uJywgJ1JlZGZveCddLmluY2x1ZGVzKHN0YXRlLnZhbHVlISkgPyB0cnVlIDogeyByZW5kZXJlZFJlYXNvbjogJ0xvZ2luIG5hbWUgdmFsaWRhdGlvbiBmYWlsZWQnIH0sXG4gICAgICAgICAgICAgICAgcHJvbXB0czoge1xuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0VmFsdWU6ICdXaGF0IGlzIHlvdXIgbG9naW4gbmFtZT8nLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZVNldDogJydcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB0ZXN0KCd1c2VyTmFtZSB2YWx1ZSB2YWxpZCwgbmVlZHMgZXhwbGljaXQgYWZmaXJtaW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXF1ZXN0SGFuZGxlciA9IG5ldyBDb250cm9sSGFuZGxlcihuZXcgVmFsdWVDb250cm9sTWFuYWdlcigpKTtcbiAgICAgICAgYXdhaXQgdGVzdEUyRShyZXF1ZXN0SGFuZGxlciwgW1xuICAgICAgICAgICAgJ1U6IEFtYXpvbicsIFRlc3RJbnB1dC5vZihTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQub2YoJ0xPR0lOLm5hbWUnLCB7ICdMT0dJTi5uYW1lJzogJ0FtYXpvbicgfSkpLFxuICAgICAgICAgICAgJ0E6IFdhcyB0aGF0IEFtYXpvbj8nLFxuICAgICAgICAgICAgJ1U6IFllYWguJywgVGVzdElucHV0Lm9mKEludGVudEJ1aWxkZXIub2YoQW1hem9uSW50ZW50Llllc0ludGVudCkpLFxuICAgICAgICAgICAgJ0E6IEdyZWF0LidcbiAgICAgICAgXSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCd1c2VyTmFtZSB2YWx1ZSBhZnRlciBkaXNhZmZpcm1hdGlvbiwgcmVxdWlyZXMgcmVxdWVzdCB2YWx1ZSBhY3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3RIYW5kbGVyID0gbmV3IENvbnRyb2xIYW5kbGVyKG5ldyBWYWx1ZUNvbnRyb2xNYW5hZ2VyKCkpO1xuICAgICAgICBhd2FpdCB0ZXN0RTJFKHJlcXVlc3RIYW5kbGVyLCBbXG4gICAgICAgICAgICAnVTogQW1hem9uJywgVGVzdElucHV0Lm9mKFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5vZignTE9HSU4ubmFtZScsIHsgJ0xPR0lOLm5hbWUnOiAnQW1hem9uJyB9KSksXG4gICAgICAgICAgICAnQTogV2FzIHRoYXQgQW1hem9uPycsXG4gICAgICAgICAgICAnVTogTm8uJywgVGVzdElucHV0Lm9mKEludGVudEJ1aWxkZXIub2YoQW1hem9uSW50ZW50Lk5vSW50ZW50KSksXG4gICAgICAgICAgICAnQTogTXkgbWlzdGFrZS4gV2hhdCBpcyB5b3VyIGxvZ2luIG5hbWU/J1xuICAgICAgICBdKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3VzZXJOYW1lIHZhbHVlIHNldCBhbmQgY2hhbmdpbmcgaXQgcmVxdWlyZXMgY29uZmlybWF0aW9uIGFuZCB2YWx1ZSBjaGFuZ2VkIGFjdCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVxdWVzdEhhbmRsZXIgPSBuZXcgQ29udHJvbEhhbmRsZXIobmV3IFZhbHVlQ29udHJvbE1hbmFnZXIoKSk7XG4gICAgICAgIGF3YWl0IHRlc3RFMkUocmVxdWVzdEhhbmRsZXIsIFtcbiAgICAgICAgICAgICdVOiBBbGV4YScsIFRlc3RJbnB1dC5vZihTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQub2YoJ0xPR0lOLm5hbWUnLCB7ICdMT0dJTi5uYW1lJzogJ0FsZXhhJyB9KSksXG4gICAgICAgICAgICAnQTogV2FzIHRoYXQgQWxleGE/JyxcbiAgICAgICAgICAgICdVOiBZZXMuJywgVGVzdElucHV0Lm9mKEludGVudEJ1aWxkZXIub2YoQW1hem9uSW50ZW50Llllc0ludGVudCkpLFxuICAgICAgICAgICAgJ0E6IEdyZWF0LicsXG4gICAgICAgICAgICAnVTogQ2hhbmdlIHRvIFJlZGZveC4nLCBUZXN0SW5wdXQub2YoU2luZ2xlVmFsdWVDb250cm9sSW50ZW50Lm9mKCdMT0dJTi5uYW1lJywgeyAnTE9HSU4ubmFtZSc6ICdSZWRmb3gnLCBcImFjdGlvblwiOiAkLkFjdGlvbi5DaGFuZ2V9KSksXG4gICAgICAgICAgICAnQTogT0ssIEkgY2hhbmdlZCBpdCB0byBSZWRmb3guIFdhcyB0aGF0IFJlZGZveD8nLFxuICAgICAgICAgICAgJ1U6IFllcy4nLCBUZXN0SW5wdXQub2YoSW50ZW50QnVpbGRlci5vZihBbWF6b25JbnRlbnQuWWVzSW50ZW50KSksXG4gICAgICAgICAgICAnQTogR3JlYXQuJyxcbiAgICAgICAgXSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCd1c2VyTmFtZSB2YWx1ZSBzZXQgYW5kIGNoYW5naW5nIGl0IHRvIGludmFsaWQgcmVxdWlyZXMgY29uZmlybWF0aW9uIGFuZCBjaGVja3MgZm9yIHZhbGlkYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXF1ZXN0SGFuZGxlciA9IG5ldyBDb250cm9sSGFuZGxlcihuZXcgVmFsdWVDb250cm9sTWFuYWdlcigpKTtcbiAgICAgICAgYXdhaXQgdGVzdEUyRShyZXF1ZXN0SGFuZGxlciwgW1xuICAgICAgICAgICAgJ1U6IEFsZXhhJywgVGVzdElucHV0Lm9mKFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5vZignTE9HSU4ubmFtZScsIHsgJ0xPR0lOLm5hbWUnOiAnQWxleGEnIH0pKSxcbiAgICAgICAgICAgICdBOiBXYXMgdGhhdCBBbGV4YT8nLFxuICAgICAgICAgICAgJ1U6IFllcy4nLCBUZXN0SW5wdXQub2YoSW50ZW50QnVpbGRlci5vZihBbWF6b25JbnRlbnQuWWVzSW50ZW50KSksXG4gICAgICAgICAgICAnQTogR3JlYXQuJyxcbiAgICAgICAgICAgICdVOiBDaGFuZ2UgdG8gQXBwbGUuJywgVGVzdElucHV0Lm9mKFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5vZignTE9HSU4ubmFtZScsIHsgJ0xPR0lOLm5hbWUnOiAnQXBwbGUnLCBcImFjdGlvblwiOiAkLkFjdGlvbi5DaGFuZ2V9KSksXG4gICAgICAgICAgICAnQTogU29ycnksIEFwcGxlIGlzIG5vdCBhIHZhbGlkIGNob2ljZSBiZWNhdXNlIExvZ2luIG5hbWUgdmFsaWRhdGlvbiBmYWlsZWQuIFdoYXQgc2hvdWxkIEkgY2hhbmdlIGl0IHRvPycsXG4gICAgICAgICAgICAnVTogQW1hem9uJywgVGVzdElucHV0Lm9mKFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5vZignTE9HSU4ubmFtZScsIHsgJ0xPR0lOLm5hbWUnOiAnQW1hem9uJyB9KSksXG4gICAgICAgICAgICAnQTogT0ssIEkgY2hhbmdlZCBpdCB0byBBbWF6b24uIFdhcyB0aGF0IEFtYXpvbj8nLFxuICAgICAgICAgICAgJ1U6IE5vLicsIFRlc3RJbnB1dC5vZihJbnRlbnRCdWlsZGVyLm9mKEFtYXpvbkludGVudC5Ob0ludGVudCkpLFxuICAgICAgICAgICAgJ0E6IE15IG1pc3Rha2UuIFdoYXQgaXMgeW91ciBsb2dpbiBuYW1lPycsXG4gICAgICAgICAgICAnVTogQW1hem9uJywgVGVzdElucHV0Lm9mKFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5vZignTE9HSU4ubmFtZScsIHsgJ0xPR0lOLm5hbWUnOiAnQW1hem9uJyB9KSksXG4gICAgICAgICAgICAnQTogT0ssIEkgY2hhbmdlZCBpdCB0byBBbWF6b24uIFdhcyB0aGF0IEFtYXpvbj8nLFxuICAgICAgICAgICAgJ1U6IFllcy4nLCBUZXN0SW5wdXQub2YoSW50ZW50QnVpbGRlci5vZihBbWF6b25JbnRlbnQuWWVzSW50ZW50KSksXG4gICAgICAgICAgICAnQTogR3JlYXQuJ1xuICAgICAgICBdKTtcbiAgICB9KTtcbn0pOyJdfQ==