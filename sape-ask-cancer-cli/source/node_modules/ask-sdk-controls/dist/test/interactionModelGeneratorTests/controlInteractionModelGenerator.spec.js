"use strict";
/*
 * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const mocha_1 = require("mocha");
const chai_1 = require("chai");
const sinon_1 = tslib_1.__importDefault(require("sinon"));
const src_1 = require("../../src");
const SingleValueControlIntent_1 = require("../../src/intents/SingleValueControlIntent");
const GeneralControlIntent_1 = require("../../src/intents/GeneralControlIntent");
const ControlInteractionModelGenerator_1 = require("../../src/interactionModelGeneration/ControlInteractionModelGenerator");
const interactionModelForTest_1 = require("./interactionModelForTest");
const ModelTypes_1 = require("../../src/interactionModelGeneration/ModelTypes");
const Logger_1 = require("../../src/logging/Logger");
class SingleValueTestControl extends src_1.Control {
    // dummy canHandle, handle, canTakeInitiative and takeInitiative cause
    // the ControlInteractionModelGenerator only cares about updateInteractionModel and getTargetIds
    canHandle() {
        return true;
    }
    handle() { }
    canTakeInitiative() {
        return true;
    }
    takeInitiative() { }
    updateInteractionModel(generator, imData) {
        generator.addControlIntent(new SingleValueControlIntent_1.SingleValueControlIntent('TEST'), imData);
    }
    getTargetIds() {
        return ['test'];
    }
}
class SimpleTestControl extends src_1.Control {
    canHandle() {
        return true;
    }
    handle() { }
    canTakeInitiative() {
        return true;
    }
    takeInitiative() { }
    updateInteractionModel(generator, imData) {
        generator.addControlIntent(new GeneralControlIntent_1.GeneralControlIntent(), imData);
    }
    getTargetIds() {
        return ['test'];
    }
}
class TestControlManager extends src_1.ControlManager {
    createControlTree() {
        const rootControl = new src_1.ContainerControl({
            id: 'testRootControl',
        });
        rootControl
            .addChild(new SingleValueTestControl('singleValueTestControl'))
            .addChild(new SimpleTestControl('simpleTestControl'));
        return rootControl;
    }
}
const TEST_INVOCATION_NAME = 'TEST_INVOCATION_NAME';
mocha_1.suite('ControlInteractionModel Generator tests', () => {
    afterEach(() => {
        sinon_1.default.restore();
    });
    mocha_1.suite('buildCoreModelForControls tests', () => {
        mocha_1.test('buildCoreModelForControls should successfully build IM for controls tree', () => {
            sinon_1.default.stub(Logger_1.Logger.prototype, 'warn');
            const interactionModel = new ControlInteractionModelGenerator_1.ControlInteractionModelGenerator()
                .buildCoreModelForControls(new TestControlManager())
                .withInvocationName(TEST_INVOCATION_NAME)
                .build();
            const expectedInteractionModel = interactionModelForTest_1.jsonProvider.loadFromMockControls();
            chai_1.expect(interactionModel).deep.equal(expectedInteractionModel);
        });
        mocha_1.test('When locale is not supported, it should use default i18n resources ', () => {
            const interactionModel = new ControlInteractionModelGenerator_1.ControlInteractionModelGenerator()
                .buildCoreModelForControls(new TestControlManager({ locale: 'fr-FR' }))
                .withInvocationName(TEST_INVOCATION_NAME)
                .build();
            const expectedInteractionModel = interactionModelForTest_1.jsonProvider.loadFromMockControls();
            chai_1.expect(interactionModel).deep.equal(expectedInteractionModel);
        });
        mocha_1.test('i18nOverride should work as expected', () => {
            var _a, _b, _c;
            sinon_1.default.stub(Logger_1.Logger.prototype, 'warn');
            const targetInFR = {
                name: ModelTypes_1.SharedSlotType.TARGET,
                values: [
                    {
                        id: 'it',
                        name: {
                            value: 'la',
                            synonyms: [
                                'it',
                                "il",
                                "le"
                            ]
                        }
                    },
                ]
            };
            const i18nOverride = {
                fr: {
                    translation: {
                        SHARED_SLOT_TYPES_TARGET: targetInFR
                    }
                }
            };
            const interactionModel = new ControlInteractionModelGenerator_1.ControlInteractionModelGenerator()
                .buildCoreModelForControls(new TestControlManager({ locale: 'fr-FR', i18nResources: i18nOverride }))
                .withInvocationName(TEST_INVOCATION_NAME)
                .build();
            const expectedInteractionModel = interactionModelForTest_1.jsonProvider.loadFromMockControls();
            (_c = (_b = (_a = expectedInteractionModel.interactionModel) === null || _a === void 0 ? void 0 : _a.languageModel) === null || _b === void 0 ? void 0 : _b.types) === null || _c === void 0 ? void 0 : _c.map(slotType => {
                if (slotType.name === ModelTypes_1.SharedSlotType.TARGET) {
                    slotType.values = targetInFR.values;
                }
                return slotType;
            });
            chai_1.expect(interactionModel).deep.equal(expectedInteractionModel);
        });
        mocha_1.test('When provided override is is not complete, should use the default resource', () => {
            const emptyResourceInEN = {
                en: {
                    translation: {}
                }
            };
            const interactionModel = new ControlInteractionModelGenerator_1.ControlInteractionModelGenerator()
                .buildCoreModelForControls(new TestControlManager({ i18nResources: emptyResourceInEN }))
                .withInvocationName(TEST_INVOCATION_NAME)
                .build();
            const expectedInteractionModel = interactionModelForTest_1.jsonProvider.loadFromMockControls();
            chai_1.expect(interactionModel).deep.equal(expectedInteractionModel);
        });
        mocha_1.test('3P controls without dependency on ControlIntent should be allowed to update IM', () => {
            class TESTControl extends src_1.Control {
                canHandle() {
                    return true;
                }
                handle() { }
                canTakeInitiative() {
                    return true;
                }
                takeInitiative() { }
                updateInteractionModel(generator) {
                    generator.addIntents({
                        name: 'testIntent',
                        samples: ['hello world']
                    });
                }
                getTargetIds() {
                    return [];
                }
            }
            class SimpleControlManager extends src_1.ControlManager {
                createControlTree() {
                    return new TESTControl('test');
                }
            }
            const interactionModel = new ControlInteractionModelGenerator_1.ControlInteractionModelGenerator()
                .buildCoreModelForControls(new SimpleControlManager())
                .withInvocationName(TEST_INVOCATION_NAME)
                .build();
            chai_1.expect(interactionModel).deep.equal({
                interactionModel: {
                    languageModel: {
                        intents: [
                            {
                                name: 'testIntent',
                                samples: ['hello world']
                            }
                        ],
                        invocationName: TEST_INVOCATION_NAME,
                        types: [],
                    },
                    prompts: []
                },
            });
        });
    });
    mocha_1.suite('build tests', () => {
        mocha_1.test('build should throw warning message if targetSlotIds are missing', () => {
            const spy = sinon_1.default.stub(Logger_1.Logger.prototype, 'warn');
            const interactionModel = new ControlInteractionModelGenerator_1.ControlInteractionModelGenerator()
                .buildCoreModelForControls(new TestControlManager())
                .withInvocationName(TEST_INVOCATION_NAME)
                .build();
            chai_1.expect(spy.calledOnceWith('target slot with id test is not present in InteractionModel.')).eq(true);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3Iuc3BlYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Rlc3QvaW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvclRlc3RzL2NvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yLnNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7OztHQVdHOzs7QUFFSCxpQ0FBb0M7QUFHcEMsK0JBQThCO0FBQzlCLDBEQUEwQjtBQUMxQixtQ0FBaUY7QUFDakYseUZBQXNGO0FBQ3RGLGlGQUE4RTtBQUM5RSw0SEFBeUg7QUFDekgsdUVBQXlEO0FBRXpELGdGQUFpRjtBQUNqRixxREFBa0Q7QUFNbEQsTUFBTSxzQkFBdUIsU0FBUSxhQUFPO0lBQ3hDLHNFQUFzRTtJQUN0RSxnR0FBZ0c7SUFDaEcsU0FBUztRQUNMLE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFDRCxNQUFNLEtBQVUsQ0FBQztJQUNqQixpQkFBaUI7UUFDYixPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBQ0QsY0FBYyxLQUFVLENBQUM7SUFFekIsc0JBQXNCLENBQUMsU0FBMkMsRUFBRSxNQUFpQjtRQUNqRixTQUFTLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxtREFBd0IsQ0FBQyxNQUFNLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUM3RSxDQUFDO0lBRUQsWUFBWTtRQUVSLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNwQixDQUFDO0NBQ0o7QUFDRCxNQUFNLGlCQUFrQixTQUFRLGFBQU87SUFDbkMsU0FBUztRQUNMLE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFDRCxNQUFNLEtBQVUsQ0FBQztJQUNqQixpQkFBaUI7UUFDYixPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBQ0QsY0FBYyxLQUFVLENBQUM7SUFDekIsc0JBQXNCLENBQUMsU0FBMkMsRUFBRSxNQUFpQjtR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QyxDQUFDLENBQUM7SUFFSCxhQUFLLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtRQUN0QixZQUFJLENBQUMsaUVBQWlFLEVBQUUsR0FBRyxFQUFFO1lBQ3pFLE1BQU0sR0FBRyxHQUFHLGVBQUssQ0FBQyxJQUFJLENBQUMsZUFBTSxDQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUNqRCxNQUFNLGdCQUFnQixHQUFHLElBQUksbUVBQWdDLEVBQUU7aUJBQzFELHlCQUF5QixDQUFDLElBQUksa0JBQWtCLEVBQUUsQ0FBQztpQkFDbkQsa0JBQWtCLENBQUMsb0JBQW9CLENBQUM7aUJBQ3hDLEtBQUssRUFBRSxDQUFDO1lBRWIsYUFBTSxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsOERBQThELENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4RyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMjAgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuXG4gKiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBvciBpbiB0aGUgXCJsaWNlbnNlXCIgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWRcbiAqIG9uIGFuIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlclxuICogZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmdcbiAqIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBzdWl0ZSwgdGVzdCB9IGZyb20gJ21vY2hhJztcbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IHYxIH0gZnJvbSAnYXNrLXNtYXBpLW1vZGVsJztcbmltcG9ydCB7IGV4cGVjdCB9IGZyb20gXCJjaGFpXCI7XG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xuaW1wb3J0IHsgQ29udGFpbmVyQ29udHJvbCwgQ29udHJvbE1hbmFnZXIsIE1vZGVsRGF0YSwgQ29udHJvbCB9IGZyb20gJy4uLy4uL3NyYyc7XG5pbXBvcnQgeyBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQgfSBmcm9tICcuLi8uLi9zcmMvaW50ZW50cy9TaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQnO1xuaW1wb3J0IHsgR2VuZXJhbENvbnRyb2xJbnRlbnQgfSBmcm9tICcuLi8uLi9zcmMvaW50ZW50cy9HZW5lcmFsQ29udHJvbEludGVudCc7XG5pbXBvcnQgeyBDb250cm9sSW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvciB9IGZyb20gJy4uLy4uL3NyYy9pbnRlcmFjdGlvbk1vZGVsR2VuZXJhdGlvbi9Db250cm9sSW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvcic7XG5pbXBvcnQgeyBqc29uUHJvdmlkZXIgfSBmcm9tICcuL2ludGVyYWN0aW9uTW9kZWxGb3JUZXN0JztcbmltcG9ydCB7IEludGVyYWN0aW9uTW9kZWxDb250cmlidXRvciB9IGZyb20gJy4uLy4uL3NyYy9jb250cm9scy9taXhpbnMvSW50ZXJhY3Rpb25Nb2RlbENvbnRyaWJ1dG9yJztcbmltcG9ydCB7IFNoYXJlZFNsb3RUeXBlIH0gZnJvbSAnLi4vLi4vc3JjL2ludGVyYWN0aW9uTW9kZWxHZW5lcmF0aW9uL01vZGVsVHlwZXMnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vLi4vc3JjL2xvZ2dpbmcvTG9nZ2VyJztcblxuaW1wb3J0IEludGVyYWN0aW9uTW9kZWxEYXRhID0gdjEuc2tpbGwuaW50ZXJhY3Rpb25Nb2RlbC5JbnRlcmFjdGlvbk1vZGVsRGF0YTtcbmltcG9ydCB7IFJlc291cmNlIH0gZnJvbSAnaTE4bmV4dCc7XG5cblxuY2xhc3MgU2luZ2xlVmFsdWVUZXN0Q29udHJvbCBleHRlbmRzIENvbnRyb2wgaW1wbGVtZW50cyBJbnRlcmFjdGlvbk1vZGVsQ29udHJpYnV0b3Ige1xuICAgIC8vIGR1bW15IGNhbkhhbmRsZSwgaGFuZGxlLCBjYW5UYWtlSW5pdGlhdGl2ZSBhbmQgdGFrZUluaXRpYXRpdmUgY2F1c2VcbiAgICAvLyB0aGUgQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3Igb25seSBjYXJlcyBhYm91dCB1cGRhdGVJbnRlcmFjdGlvbk1vZGVsIGFuZCBnZXRUYXJnZXRJZHNcbiAgICBjYW5IYW5kbGUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBoYW5kbGUoKTogdm9pZCB7fVxuICAgIGNhblRha2VJbml0aWF0aXZlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgdGFrZUluaXRpYXRpdmUoKTogdm9pZCB7fVxuXG4gICAgdXBkYXRlSW50ZXJhY3Rpb25Nb2RlbChnZW5lcmF0b3I6IENvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yLCBpbURhdGE6IE1vZGVsRGF0YSkge1xuICAgICAgICBnZW5lcmF0b3IuYWRkQ29udHJvbEludGVudChuZXcgU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KCdURVNUJyksIGltRGF0YSk7XG4gICAgfVxuXG4gICAgZ2V0VGFyZ2V0SWRzKCk6IHN0cmluZ1tdIHtcblxuICAgICAgICByZXR1cm4gWyd0ZXN0J107XG4gICAgfVxufVxuY2xhc3MgU2ltcGxlVGVzdENvbnRyb2wgZXh0ZW5kcyBDb250cm9sIGltcGxlbWVudHMgSW50ZXJhY3Rpb25Nb2RlbENvbnRyaWJ1dG9yIHtcbiAgICBjYW5IYW5kbGUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBoYW5kbGUoKTogdm9pZCB7fVxuICAgIGNhblRha2VJbml0aWF0aXZlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgdGFrZUluaXRpYXRpdmUoKTogdm9pZCB7fVxuICAgIHVwZGF0ZUludGVyYWN0aW9uTW9kZWwoZ2VuZXJhdG9yOiBDb250cm9sSW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvciwgaW1EYXRhOiBNb2RlbERhdGEpIHtcbiAgICAgICAgZ2VuZXJhdG9yLmFkZENvbnRyb2xJbnRlbnQobmV3IEdlbmVyYWxDb250cm9sSW50ZW50KCksIGltRGF0YSk7XG4gICAgfVxuXG4gICAgZ2V0VGFyZ2V0SWRzKCk6IHN0cmluZ1tdIHtcblxuICAgICAgICByZXR1cm4gWyd0ZXN0J107XG4gICAgfVxufVxuY2xhc3MgVGVzdENvbnRyb2xNYW5hZ2VyIGV4dGVuZHMgQ29udHJvbE1hbmFnZXIge1xuICAgIGNyZWF0ZUNvbnRyb2xUcmVlKCkge1xuICAgICAgICBjb25zdCByb290Q29udHJvbCA9IG5ldyBDb250YWluZXJDb250cm9sKHtcbiAgICAgICAgICAgIGlkOiAndGVzdFJvb3RDb250cm9sJyxcbiAgICAgICAgfSk7XG4gICAgICAgIHJvb3RDb250cm9sXG4gICAgICAgICAgICAuYWRkQ2hpbGQobmV3IFNpbmdsZVZhbHVlVGVzdENvbnRyb2woJ3NpbmdsZVZhbHVlVGVzdENvbnRyb2wnKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZChuZXcgU2ltcGxlVGVzdENvbnRyb2woJ3NpbXBsZVRlc3RDb250cm9sJykpO1xuXG4gICAgICAgIHJldHVybiByb290Q29udHJvbDtcbiAgICB9XG59XG5cblxuY29uc3QgVEVTVF9JTlZPQ0FUSU9OX05BTUU6IHN0cmluZyA9ICdURVNUX0lOVk9DQVRJT05fTkFNRSc7XG5cbnN1aXRlKCdDb250cm9sSW50ZXJhY3Rpb25Nb2RlbCBHZW5lcmF0b3IgdGVzdHMnLCAoKSA9PiB7XG5cbiAgICBhZnRlckVhY2goKCkgPT4ge1xuICAgICAgICBzaW5vbi5yZXN0b3JlKCk7XG4gICAgfSk7XG4gICAgc3VpdGUoJ2J1aWxkQ29yZU1vZGVsRm9yQ29udHJvbHMgdGVzdHMnLCAoKSA9PiB7XG4gICAgICAgIHRlc3QoJ2J1aWxkQ29yZU1vZGVsRm9yQ29udHJvbHMgc2hvdWxkIHN1Y2Nlc3NmdWxseSBidWlsZCBJTSBmb3IgY29udHJvbHMgdHJlZScsICgpID0+IHtcbiAgICAgICAgICAgIHNpbm9uLnN0dWIoTG9nZ2VyLnByb3RvdHlwZSwgJ3dhcm4nKTtcbiAgICAgICAgICAgIGNvbnN0IGludGVyYWN0aW9uTW9kZWwgPSBuZXcgQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3IoKVxuICAgICAgICAgICAgICAgIC5idWlsZENvcmVNb2RlbEZvckNvbnRyb2xzKG5ldyBUZXN0Q29udHJvbE1hbmFnZXIoKSlcbiAgICAgICAgICAgICAgICAud2l0aEludm9jYXRpb25OYW1lKFRFU1RfSU5WT0NBVElPTl9OQU1FKVxuICAgICAgICAgICAgICAgIC5idWlsZCgpO1xuXG4gICAgICAgICAgICBjb25zdCBleHBlY3RlZEludGVyYWN0aW9uTW9kZWw6IEludGVyYWN0aW9uTW9kZWxEYXRhID0ganNvblByb3ZpZGVyLmxvYWRGcm9tTW9ja0NvbnRyb2xzKCk7XG5cbiAgICAgICAgICAgIGV4cGVjdChpbnRlcmFjdGlvbk1vZGVsKS5kZWVwLmVxdWFsKGV4cGVjdGVkSW50ZXJhY3Rpb25Nb2RlbCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRlc3QoJ1doZW4gbG9jYWxlIGlzIG5vdCBzdXBwb3J0ZWQsIGl0IHNob3VsZCB1c2UgZGVmYXVsdCBpMThuIHJlc291cmNlcyAnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbnRlcmFjdGlvbk1vZGVsID0gbmV3IENvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yKClcbiAgICAgICAgICAgICAgICAuYnVpbGRDb3JlTW9kZWxGb3JDb250cm9scyhuZXcgVGVzdENvbnRyb2xNYW5hZ2VyKHsgbG9jYWxlOiAnZnItRlInIH0pKVxuICAgICAgICAgICAgICAgIC53aXRoSW52b2NhdGlvbk5hbWUoVEVTVF9JTlZPQ0FUSU9OX05BTUUpXG4gICAgICAgICAgICAgICAgLmJ1aWxkKCk7XG5cbiAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkSW50ZXJhY3Rpb25Nb2RlbDogSW50ZXJhY3Rpb25Nb2RlbERhdGEgPSBqc29uUHJvdmlkZXIubG9hZEZyb21Nb2NrQ29udHJvbHMoKTtcblxuICAgICAgICAgICAgZXhwZWN0KGludGVyYWN0aW9uTW9kZWwpLmRlZXAuZXF1YWwoZXhwZWN0ZWRJbnRlcmFjdGlvbk1vZGVsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGVzdCgnaTE4bk92ZXJyaWRlIHNob3VsZCB3b3JrIGFzIGV4cGVjdGVkJywgKCkgPT4ge1xuICAgICAgICAgICAgc2lub24uc3R1YihMb2dnZXIucHJvdG90eXBlLCAnd2FybicpO1xuICAgICAgICAgICAgY29uc3QgdGFyZ2V0SW5GUiA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiBTaGFyZWRTbG90VHlwZS5UQVJHRVQsXG4gICAgICAgICAgICAgICAgdmFsdWVzOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAnaXQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnbGEnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5bm9ueW1zOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpdCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWxcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCBpMThuT3ZlcnJpZGUgPSB7XG4gICAgICAgICAgICAgICAgZnI6IHtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNsYXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFNIQVJFRF9TTE9UX1RZUEVTX1RBUkdFVDogdGFyZ2V0SW5GUlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IGludGVyYWN0aW9uTW9kZWwgPSBuZXcgQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3IoKVxuICAgICAgICAgICAgICAgIC5idWlsZENvcmVNb2RlbEZvckNvbnRyb2xzKG5ldyBUZXN0Q29udHJvbE1hbmFnZXIoeyBsb2NhbGU6ICdmci1GUicsIGkxOG5SZXNvdXJjZXM6IGkxOG5PdmVycmlkZSB9KSlcbiAgICAgICAgICAgICAgICAud2l0aEludm9jYXRpb25OYW1lKFRFU1RfSU5WT0NBVElPTl9OQU1FKVxuICAgICAgICAgICAgICAgIC5idWlsZCgpO1xuXG4gICAgICAgICAgICBjb25zdCBleHBlY3RlZEludGVyYWN0aW9uTW9kZWw6IEludGVyYWN0aW9uTW9kZWxEYXRhID0ganNvblByb3ZpZGVyLmxvYWRGcm9tTW9ja0NvbnRyb2xzKCk7XG4gICAgICAgICAgICBleHBlY3RlZEludGVyYWN0aW9uTW9kZWwuaW50ZXJhY3Rpb25Nb2RlbD8ubGFuZ3VhZ2VNb2RlbD8udHlwZXM/Lm1hcChzbG90VHlwZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHNsb3RUeXBlLm5hbWUgPT09IFNoYXJlZFNsb3RUeXBlLlRBUkdFVCkge1xuICAgICAgICAgICAgICAgICAgICBzbG90VHlwZS52YWx1ZXMgPSB0YXJnZXRJbkZSLnZhbHVlcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNsb3RUeXBlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGV4cGVjdChpbnRlcmFjdGlvbk1vZGVsKS5kZWVwLmVxdWFsKGV4cGVjdGVkSW50ZXJhY3Rpb25Nb2RlbCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRlc3QoJ1doZW4gcHJvdmlkZWQgb3ZlcnJpZGUgaXMgaXMgbm90IGNvbXBsZXRlLCBzaG91bGQgdXNlIHRoZSBkZWZhdWx0IHJlc291cmNlJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZW1wdHlSZXNvdXJjZUluRU46IFJlc291cmNlID0ge1xuICAgICAgICAgICAgICAgIGVuOiB7XG4gICAgICAgICAgICAgICAgICAgIHRyYW5zbGF0aW9uOiB7fVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCBpbnRlcmFjdGlvbk1vZGVsID0gbmV3IENvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yKClcbiAgICAgICAgICAgICAgICAuYnVpbGRDb3JlTW9kZWxGb3JDb250cm9scyhuZXcgVGVzdENvbnRyb2xNYW5hZ2VyKHsgaTE4blJlc291cmNlczogZW1wdHlSZXNvdXJjZUluRU4gfSkpXG4gICAgICAgICAgICAgICAgLndpdGhJbnZvY2F0aW9uTmFtZShURVNUX0lOVk9DQVRJT05fTkFNRSlcbiAgICAgICAgICAgICAgICAuYnVpbGQoKTtcbiAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkSW50ZXJhY3Rpb25Nb2RlbDogSW50ZXJhY3Rpb25Nb2RlbERhdGEgPSBqc29uUHJvdmlkZXIubG9hZEZyb21Nb2NrQ29udHJvbHMoKTtcblxuICAgICAgICAgICAgZXhwZWN0KGludGVyYWN0aW9uTW9kZWwpLmRlZXAuZXF1YWwoZXhwZWN0ZWRJbnRlcmFjdGlvbk1vZGVsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGVzdCgnM1AgY29udHJvbHMgd2l0aG91dCBkZXBlbmRlbmN5IG9uIENvbnRyb2xJbnRlbnQgc2hvdWxkIGJlIGFsbG93ZWQgdG8gdXBkYXRlIElNJywgKCkgPT4ge1xuICAgICAgICAgICAgY2xhc3MgVEVTVENvbnRyb2wgZXh0ZW5kcyBDb250cm9sIGltcGxlbWVudHMgSW50ZXJhY3Rpb25Nb2RlbENvbnRyaWJ1dG9yIHtcbiAgICAgICAgICAgICAgICBjYW5IYW5kbGUoKTogYm9vbGVhbiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBoYW5kbGUoKTogdm9pZCB7fVxuICAgICAgICAgICAgICAgIGNhblRha2VJbml0aWF0aXZlKCk6IGJvb2xlYW4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGFrZUluaXRpYXRpdmUoKTogdm9pZCB7fVxuICAgICAgICAgICAgICAgIHVwZGF0ZUludGVyYWN0aW9uTW9kZWwoZ2VuZXJhdG9yOiBDb250cm9sSW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvcikge1xuICAgICAgICAgICAgICAgICAgICBnZW5lcmF0b3IuYWRkSW50ZW50cyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAndGVzdEludGVudCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBzYW1wbGVzOiBbJ2hlbGxvIHdvcmxkJ11cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGdldFRhcmdldElkcygpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNsYXNzIFNpbXBsZUNvbnRyb2xNYW5hZ2VyIGV4dGVuZHMgQ29udHJvbE1hbmFnZXIge1xuICAgICAgICAgICAgICAgIGNyZWF0ZUNvbnRyb2xUcmVlKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFRFU1RDb250cm9sKCd0ZXN0Jyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgaW50ZXJhY3Rpb25Nb2RlbCA9IG5ldyBDb250cm9sSW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvcigpXG4gICAgICAgICAgICAgICAgLmJ1aWxkQ29yZU1vZGVsRm9yQ29udHJvbHMobmV3IFNpbXBsZUNvbnRyb2xNYW5hZ2VyKCkpXG4gICAgICAgICAgICAgICAgLndpdGhJbnZvY2F0aW9uTmFtZShURVNUX0lOVk9DQVRJT05fTkFNRSlcbiAgICAgICAgICAgICAgICAuYnVpbGQoKTtcblxuICAgICAgICAgICAgZXhwZWN0KGludGVyYWN0aW9uTW9kZWwpLmRlZXAuZXF1YWwoe1xuICAgICAgICAgICAgICAgIGludGVyYWN0aW9uTW9kZWw6IHtcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2VNb2RlbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZW50czogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ3Rlc3RJbnRlbnQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1wbGVzOiBbJ2hlbGxvIHdvcmxkJ11cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW52b2NhdGlvbk5hbWU6IFRFU1RfSU5WT0NBVElPTl9OQU1FLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZXM6IFtdLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBwcm9tcHRzOiBbXVxuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIHN1aXRlKCdidWlsZCB0ZXN0cycsICgpID0+IHtcbiAgICAgICAgdGVzdCgnYnVpbGQgc2hvdWxkIHRocm93IHdhcm5pbmcgbWVzc2FnZSBpZiB0YXJnZXRTbG90SWRzIGFyZSBtaXNzaW5nJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3B5ID0gc2lub24uc3R1YihMb2dnZXIucHJvdG90eXBlLCAnd2FybicpO1xuICAgICAgICAgICAgY29uc3QgaW50ZXJhY3Rpb25Nb2RlbCA9IG5ldyBDb250cm9sSW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvcigpXG4gICAgICAgICAgICAgICAgLmJ1aWxkQ29yZU1vZGVsRm9yQ29udHJvbHMobmV3IFRlc3RDb250cm9sTWFuYWdlcigpKVxuICAgICAgICAgICAgICAgIC53aXRoSW52b2NhdGlvbk5hbWUoVEVTVF9JTlZPQ0FUSU9OX05BTUUpXG4gICAgICAgICAgICAgICAgLmJ1aWxkKCk7XG5cbiAgICAgICAgICAgIGV4cGVjdChzcHkuY2FsbGVkT25jZVdpdGgoJ3RhcmdldCBzbG90IHdpdGggaWQgdGVzdCBpcyBub3QgcHJlc2VudCBpbiBJbnRlcmFjdGlvbk1vZGVsLicpKS5lcSh0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbiJdfQ==